var Nr=Object.defineProperty,Ar=Object.defineProperties;var Lr=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var jt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var St=(l,e,s)=>e in l?Nr(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s,m=(l,e)=>{for(var s in e||(e={}))jt.call(e,s)&&St(l,s,e[s]);if(it)for(var s of it(e))Zt.call(e,s)&&St(l,s,e[s]);return l},y=(l,e)=>Ar(l,Lr(e));var Jt=l=>typeof l=="symbol"?l:l+"",oe=(l,e)=>{var s={};for(var a in l)jt.call(l,a)&&e.indexOf(a)<0&&(s[a]=l[a]);if(l!=null&&it)for(var a of it(l))e.indexOf(a)<0&&Zt.call(l,a)&&(s[a]=l[a]);return s};var o=(l,e,s)=>(St(l,typeof e!="symbol"?e+"":e,s),s);import{c as Er,a as $r,g as Dr,b as tn,j as Et,d as $,w as D,r as g,O as U,T as M,L as R,F as I,f as sn,e as Pr,h as Or,i as Rr,k as Fr,l as an,R as Se,A as ke,m as nn,n as rn,S as Oe,o as A,C as x,M as N,p as Ur,q as z,s as Be,t as Xe,u as Mr,v as Br,x as Gr,y as Hr,z as qr,B as zr,D as Vr,E as Qr,G as Wr,H as Kr,I as Yr,_ as It,J as jr,K as Zr,N as lt,P as T,Q as B,U as Jr,V as ae,W as Z,X as P,Y as on,Z as ln,$ as Xr,a0 as eo,a1 as to,a2 as so,a3 as be,a4 as Ce,a5 as le,a6 as K,a7 as ao,a8 as io,a9 as L,aa as no,ab as Ge,ac as qe,ad as fe,ae as ro,af as Pe,ag as oo,ah as dn,ai as dt,aj as lo,ak as E,al as f,am as $t,an as ut,ao as se,ap as co,aq as ho,ar as J,as as Ae,at as mt,au as gt,av as nt,aw as po,ax as Ve,ay as uo,az as mo,aA as go,aB as Ne,aC as Re,aD as Fe,aE as Xt,aF as fo,aG as cn,aH as es,aI as _e,aJ as bo,aK as kt,aL as Tt,aM as hn,aN as Ue,aO as Co,aP as yo,aQ as V,aR as Nt,aS as vo,aT as xo,aU as So,aV as Io,aW as wo,aX as _o,aY as ko,aZ as pn,a_ as To,a$ as No,b0 as Ao,b1 as Lo,b2 as Dt,b3 as un,b4 as Eo,b5 as $o,b6 as Do,b7 as Po,b8 as Oo,b9 as Ro,ba as Fo,bb as Uo,bc as Mo,bd as Bo,be as Go,bf as Ho,bg as qo,bh as zo,bi as Vo,bj as Qo,bk as Wo,bl as Ko,bm as ts,bn as wt,bo as Yo,bp as jo,bq as Zo,br as Pt,bs as mn,bt as Ot,bu as ft,bv as Jo,bw as Xo,bx as gn,by as fn,bz as bn,bA as el,bB as tl,bC as sl,bD as al,bE as il,bF as nl,bG as rl,bH as ol,bI as ll,bJ as dl,bK as cl,bL as hl,bM as pl,bN as ul,bO as ml}from"./vendor.b72ec4e7.js";const gl=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}};gl();const fl=(l={},e)=>{switch(e.type){case"SET_LOGGED_IN":return m({},e.payload);default:return l}},bl=(l={},e)=>{switch(e.type){case"SET_GLOBAL_ALERT":return y(m({},e.payload),{ts:Date.now()});case"UNSET_GLOBAL_ALERT":return null;default:return l}},Cl=(l={},e)=>{var s;switch(e.type){case"PUSH_BREADCRUMB_LINK":return y(m({},l),{[e.payload.path]:e.payload.text});case"REMOVE_BREADCRUMB_LINK":const a=l,{[s=e.payload.path]:i}=a;return oe(a,[Jt(s)]);default:return l}},yl=(l=!1,e)=>{switch(e.type){case"SET_COURSE_MENU_OPEN":return y(m({},l),{state:e.payload});default:return l}},vl=(l=!0,e)=>{switch(e.type){case"SET_SHOW_COURSE_MENU":return y(m({},l),{state:e.payload});default:return l}},xl=(l={lessons:[]},e)=>{switch(e.type){case"SET_UNLOCKED_LESSONS":return y(m({},l),{lessons:[...l.lessons,e.payload]});default:return l}},Sl=(l={lessons:[]},e)=>{switch(e.type){case"SET_COMPLETED_LESSONS":return y(m({},l),{lessons:[...l.lessons,e.payload]});default:return l}},Il=(l={lessons:[]},e)=>{switch(e.type){case"SET_QUIZ_PASSED_LESSONS":return y(m({},l),{lessons:[...l.lessons,e.payload]});default:return l}},wl=(l="",e)=>{switch(e.type){case"SET_UPDATE_COURSE_MENU_LESSONS":return y(m({},l),{state:e.payload});default:return l}},_l=(l=!1,e)=>{switch(e.type){case"SET_UPDATE_COURSE_PERCENTAGE":return y(m({},l),{state:e.payload});default:return l}},kl=(l={},e)=>{switch(e.type){case"SET_CURRENT_COURSE":return y(m({},l),{state:e.payload});default:return l}},Tl=(l={},e)=>{switch(e.type){case"SET_NEW_COURSE_POP_UP":return y(m({},l),{state:e.payload});default:return l}},Nl=(l={},e)=>{switch(e.type){case"SET_CURRENT_CHAPTER":return y(m({},l),{state:e.payload});default:return l}},Al=(l={},e)=>{switch(e.type){case"SET_CURRENT_LESSON":return y(m({},l),{state:e.payload});default:return l}},Ll=(l="",e)=>{switch(e.type){case"SET_CURRENT_LESSON_LAYOUT":return y(m({},l),{state:e.payload});default:return l}},El=(l=[],e)=>{switch(e.type){case"SET_ALL_CHAPTERS":return y(m({},l),{state:e.payload});default:return l}},$l=(l=null,e)=>{switch(e.type){case"SET_ALL_LESSONS":return y(m({},l),{state:e.payload});default:return l}},Dl=(l={},e)=>{switch(e.type){case"SET_CURRENT_LESSON_CARD_IDS":return y(m({},l),{state:e.payload});default:return l}},Pl=(l={},e)=>{switch(e.type){case"SET_PREVIEW_COURSE":return Object.assign({},l,e.payload);default:return l}},Ol=(l=!1,e)=>{switch(e.type){case"SET_USER_INACTIVE":return y(m({},l),{state:e.payload});default:return l}},Rl=(l=0,e)=>{switch(e.type){case"SET_LAST_SEEN":return y(m({},l),{state:e.payload});default:return l}},Fl=(l="",e)=>{switch(e.type){case"SET_INACTIVITY_TYPE":return y(m({},l),{state:e.payload});default:return l}},Ul=(l={},e)=>{switch(e.type){case"SET_FORM_ACTIONS":return y(m({},l),{state:e.payload});default:return l}},Ml=(l="",e)=>{switch(e.type){case"SET_EXAM_REMINDER":return y(m({},l),{state:e.payload});default:return l}},Bl=Er({loggedIn:fl,globalAlert:bl,globalBreadcrumb:Cl,currentLesson:Al,currentChapter:Nl,currentCourse:kl,showCourseMenu:vl,newCoursePopUp:Tl,allLessons:$l,allChapters:El,currentLessonCardIds:Dl,currentLessonLayout:Ll,courseMenuOpen:yl,updateCourseMenuLessons:wl,updateCoursePercentage:_l,userInactive:Ol,lastSeen:Rl,inactivityType:Fl,unlockedLessons:xl,completedLessons:Sl,quizPassedLessons:Il,formActions:Ul,examReminder:Ml,coursePreview:Pl}),ct=$r({reducer:Bl,middleware:[...Dr({serializableCheck:!1})]}),C=async(l,e,s=null,a=!1,i=!0)=>{const r="http://localhost:5000/api"+e,d={method:l.toUpperCase(),url:r,data:s,headers:{},withCredentials:a},{loggedIn:c}=ct.getState();if(i){const h=typeof i=="string"?i:c&&c.token?c.token:null;h&&(d.headers.Authorization=`Bearer ${h}`)}s!==null&&(d.headers["Content-Type"]="application/json"),s instanceof FormData&&(d.headers["Content-Type"]="multipart/form-data");try{const{data:h}=await tn(d),{message:p,error:u,success:b,data:v}=h;return{success:b,message:p,response:v||null,error:u||null,raw:h}}catch(h){if(h.response){let{status:p,data:u}=h.response,{message:b,success:v}=u;return p&&p===401&&b==="UNAUTHENTICATED"&&(ct.dispatch({type:"SET_LOGGED_IN",payload:{token:null,user:{},authenticationError:!0}}),localStorage.removeItem("authToken"),history.pushState({},"RealEstateU","/")),{success:v,message:b,response:b!=null?b:"",error:b!=null?b:""}}else return{success:!1,message:"Couldn't connect to server",response:"",error:"SERVERDOWN"}}},t=Et.exports.jsx,n=Et.exports.jsxs,w=Et.exports.Fragment;class Gl extends g.exports.Component{constructor(){super(...arguments);o(this,"eventSource",null);o(this,"state",{notificationCount:0,active:!1});o(this,"logOut",async()=>{const{success:e,message:s}=await C("POST","/users/logout");e?(this.props.setGlobalAlert({type:"success",message:"You've been successfully logged out."}),localStorage.removeItem("authToken"),this.props.setLoggedIn({token:null,user:null}),window.socket.emit("logout")):this.props.setGlobalAlert({type:"error",message:s})});o(this,"toggleMenu",()=>{window.innerWidth>900||this.setState({active:!this.state.active})})}componentDidUpdate(e,s,a){this.eventSource===null&&this.props.loggedIn.token&&(this.eventSource=new EventSource("http://localhost:5000/api/users/notifications?token="+encodeURI(this.props.loggedIn.token)),this.eventSource.onmessage=i=>{const{notificationCount:r}=JSON.parse(i.data);this.setState({notificationCount:r||0})},this.eventSource.onerror=()=>{this.eventSource.close()})}render(){if(!this.props.loggedIn.token)return null;const{active:e}=this.state;return t(w,{children:n("nav",{id:"user-bar",className:e?" active":"",onClick:this.toggleMenu,children:[t(U,{placement:"bottom",overlay:t(M,{id:"user-bar__tooltip__courses",children:"Courses"}),children:t(R,{className:"user-bar__action",to:"/",children:t(I,{icon:sn})})}),t(U,{placement:"bottom",overlay:t(M,{id:"user-bar__tooltip__profile",children:"Profile"}),children:t(R,{className:"user-bar__action",to:"/profile",children:t(I,{icon:Pr})})}),t(U,{placement:"bottom",overlay:t(M,{id:"user-bar__tooltip__notifications",children:this.state.notificationCount===0?"Notifications":this.state.notificationCount+(this.state.notificationCount===1?" unread notification":" unread notifications")}),children:n(R,{className:"user-bar__action",to:"/notifications/",children:[t(I,{icon:Or}),this.state.notificationCount!==0&&t("div",{className:"user-bar__action__notification",children:this.state.notificationCount>9?"+":this.state.notificationCount})]})}),!!this.props.loggedIn.user.adminLevel&&t(U,{placement:"bottom",overlay:t(M,{id:"user-bar__tooltip__notifications",children:"Admin Panel"}),children:t(R,{className:"user-bar__action",to:"/admin/",children:t(I,{icon:Rr})})}),t(U,{placement:"bottom",overlay:t(M,{id:"user-bar__tooltip__notifications",children:"Sign Out"}),children:t("span",{className:"user-bar__action",onClick:this.logOut,children:t(I,{icon:Fr})})})]})})}}var Hl=$(l=>({loggedIn:l.loggedIn}),{setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Gl));class ql extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{loading:!0,globalAlert:null,showGlobalAlert:!1,verifyEmailAlert:!0});o(this,"regexPublicUrls",[/^\/login$/,/^\/reset-password$/,/^\/change-password$/,/^\/terms_of_service$/,/^\/privacy_policy$/,/^\/checkout\/[a-zA-Z0-9]*$/]);o(this,"dismissVerifyEmail",()=>{this.setState({verifyEmailAlert:!1})});o(this,"resendEmail",async()=>{const{success:e,message:s}=await C("GET","/users/verify/resend");this.props.setGlobalAlert({type:e?"success":"error",message:s})});o(this,"updateGlobalAlert",e=>{this.setState({globalAlert:e},()=>{this.setState({showGlobalAlert:!0}),setTimeout(()=>{this.setState({showGlobalAlert:!1},()=>{this.unsetGlobalAlertTimeout=setTimeout(()=>{this.props.unsetGlobalAlert()},250)})},2750)})})}async componentDidMount(){const e=localStorage.getItem("authToken");if(e&&!this.props.loggedIn.token){const{success:s,response:a}=await C("POST","/users/auth",null,!1,e);this.unsetGlobalAlertTimeout=null,s&&(this.props.setLoggedIn(a),localStorage.setItem("authToken",a.token)),window.socket=an("ws://localhost:5000",{query:{token:e},secure:{}.NODE_ENV!=="development"})}this.setState({loading:!1})}componentDidUpdate(e,s,a){if(!!this.props.globalAlert&&!!this.props.globalAlert.message&&(!this.state.globalAlert||this.state.globalAlert.ts!==this.props.globalAlert.ts)){const i=this.state.globalAlert&&this.state.globalAlert.ts?this.state.globalAlert.ts:0,r=this.props.globalAlert.ts-i;r<2e3?(this.unsetGlobalAlertTimeout&&clearTimeout(this.unsetGlobalAlertTimeout),setTimeout(()=>{this.updateGlobalAlert(this.props.globalAlert)},r)):this.updateGlobalAlert(this.props.globalAlert)}}render(){var s,a;let e;if(this.state.loading)e=t("div",{className:"center-loading big",children:t(Oe,{animation:"border"})});else{if(!this.props.loggedIn.token&&!this.regexPublicUrls.some(i=>i.test(this.props.location.pathname)))return t(Se,{to:{pathname:"/login",state:{previousPath:this.props.location.pathname}}});e=this.props.children}return n("div",{className:"wrapper",children:[n("header",{children:[t(R,{to:"/",children:t("img",{className:"logo-img",src:"/logo.png",alt:"RealEstateU logo"})}),t(Hl,{})]}),this.state.verifyEmailAlert&&!!this.props.loggedIn.user&&!((a=(s=this.props.loggedIn)==null?void 0:s.user)!=null&&a.verified)&&t("div",{className:"verify-email",children:n(ke,{variant:"danger",onClose:this.dismissVerifyEmail,dismissible:!0,children:[t(ke.Heading,{children:"Verify your e-mail address"}),n("p",{children:["We have sent an validation link to the address provided by you in the registration process to confirm your e-mail address. Did you not get any e-mail? Be sure to check spam or junk folders or\xA0",t("b",{onClick:this.resendEmail,children:"click here to resend e-mail verification."})]})]})}),t("main",{children:e}),this.state.globalAlert&&n("div",{className:`global-alert global-alert--${this.state.globalAlert.type}`+(this.state.showGlobalAlert?" global-alert--visible":""),children:[this.state.globalAlert.type==="success"&&t(I,{icon:nn}),this.state.globalAlert.type==="error"&&t(I,{icon:rn}),t("span",{className:"message",dangerouslySetInnerHTML:{__html:this.state.globalAlert.message}})]})]})}}var zl=$(l=>({loggedIn:l.loggedIn,globalAlert:l.globalAlert}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l}),unsetGlobalAlert:()=>({type:"UNSET_GLOBAL_ALERT"})})(D(ql));class Vl extends g.exports.Component{constructor(e){super(e);o(this,"handleFormSubmit",async e=>{e.preventDefault();const{response:s,message:a,success:i}=await C("POST","/users/login",{email:this.state.email,password:this.state.password,browserAgent:navigator.userAgent},!1,!1);i?(this.setState({error:null}),localStorage.setItem("authToken",s.token),this.props.setLoggedIn(s),window.socket=an("ws://localhost:5000",{query:{token:s.token}})):this.setState({error:a})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});this.state={email:"",password:"",previousPath:"/"}}componentDidMount(){this.props.location.state&&this.props.location.state.previousPath&&this.setState({previousPath:this.props.location.state.previousPath})}render(){if(this.props.loggedIn.token)return t(Se,{to:this.state.previousPath});const{error:e}=this.state;return t("div",{className:"centered-block",children:n("div",{className:"form form--narrow form--floating"+(e?" form--with-error":""),children:[e&&t("div",{className:"form__error",children:e}),n("div",{className:"form__content",children:[t("h2",{children:"Login"}),n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"email",children:"Email"}),t("input",{type:"email",name:"email",onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"password",children:"Password"}),t("input",{type:"password",name:"password",onChange:this.handleInputChange})]}),n("div",{className:"form__message",children:["By logging in, you are agreeing to the following\xA0",t(R,{to:"/terms_of_service",children:"Terms of Service"}),"\xA0and our\xA0",t(R,{to:"/privacy_policy",children:"Privacy Policy"}),"."]}),n("div",{className:"form__buttons",children:[t("button",{type:"submit",className:"btn bp",children:"Login"}),t(R,{to:"/reset-password",className:"btn btn--link",children:"Forgot your password?"})]})]})]})]})})}}const Ql=l=>({loggedIn:l.loggedIn});var Wl=$(Ql,{setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l})})(Vl);class Kl extends g.exports.Component{constructor(e){super(e);o(this,"handleFormSubmit",async e=>{if(e.preventDefault(),!this.state.email){this.setState({error:"Please enter a valid email address"});return}const{message:s,success:a}=await C("GET","/users/password/"+this.state.email,null,!1);a?this.setState({sent:!0}):this.setState({error:s})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});this.state={error:null,sent:!1,email:null}}render(){if(this.props.loggedIn.token)return t(Se,{to:"/"});const{error:e,sent:s}=this.state;return t("div",{className:"centered-block",children:n("div",{className:"form form--narrow form--floating"+(e?" form--with-error":""),children:[e&&t("div",{className:"form__error",children:e}),n("div",{className:"form__content",children:[t("h2",{children:"Reset password"}),n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[t("div",{className:"form__message",children:s?n("span",{children:["If an account with the email address you entered exists, you will receive a reset link to your inbox within 10 minutes.",t("br",{}),t("br",{}),"Please check your spam/junk folder before you try again or contact support."]}):"Please enter your email address to receive a password reset link."}),s?"":n("div",{className:"form__field",children:[t("label",{htmlFor:"email",children:"Email"}),t("input",{type:"email",name:"email",onChange:this.handleInputChange})]}),n("div",{className:"form__buttons",children:[t("button",{className:"btn "+(s?"bd":"bp"),children:s?"Request again":"Request"}),s?t(R,{to:"/support",className:"btn btn--link",children:"Contact support"}):t(R,{to:"/login",className:"btn btn--link",children:"Login"})]})]})]})]})})}}var Yl=$(l=>({loggedIn:l.loggedIn}),{setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l})})(Kl);class jl extends g.exports.Component{constructor(e){super(e);o(this,"state",{currentPassword:"",password:"",passwordCheck:"",error:"",redirect:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"handleFormSubmit",async e=>{e.preventDefault();const{message:s,success:a}=await C("POST","/users/password"+(this.props.loggedIn.token?`/${this.props.loggedIn.user._id}`:""),{[this.props.loggedIn.token?"currentPassword":"resetToken"]:this.props.loggedIn.token?this.state.currentPassword:this.searchParams.get("resetToken"),password:this.state.password,passwordCheck:this.state.passwordCheck});a?this.setState({error:null,redirect:"/login"}):this.setState({error:s})});this.searchParams=new URLSearchParams(e.location.search)}async componentDidMount(){const{success:e,message:s}=await C("GET","/users/password/token/"+this.searchParams.get("resetToken"));e||(this.setState({redirect:"/"}),this.props.setGlobalAlert({type:"error",message:s==="UNAUTHORIZED"?"You can not perform that action while you are logged in":s}))}render(){const{error:e}=this.state;return this.searchParams.get("resetToken")===null||this.state.redirect?t(Se,{to:this.state.redirect||"/login"}):t("div",{className:"centered-block",children:n("div",{className:"form form--narrow form--floating"+(e?" form--with-error":""),children:[e&&t("div",{className:"form__error",children:e}),n("div",{className:"form__content",children:[t("h2",{children:"Change password"}),n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"password",children:"New password"}),t("input",{type:"password",name:"password",onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"passwordCheck",children:"Repeat new password"}),t("input",{type:"password",name:"passwordCheck",onChange:this.handleInputChange})]}),t("div",{className:"form__buttons",children:t("button",{className:"btn bp",type:"submit",children:"Change password"})})]})]})]})})}}var Zl=$(l=>({loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l})})(D(jl));class Jl extends g.exports.Component{render(){return t("div",{className:"lesson-layout",children:t("main",{className:"main",children:this.props.children})})}}const Xl=l=>{const{currentLessonLayout:e,courseMenuOpen:s,showCourseMenu:a,loggedIn:i}=l;return{currentLessonLayout:e,courseMenuOpen:s,showCourseMenu:a,loggedIn:i}};var Cn=$(Xl)(Jl);class ed extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{loading:!0,failedToLoad:!1,email:"",_id:"",firstName:"",lastName:"",adminLevel:"",phoneNumber:"",addressLineOne:"",addressLineTwo:"",townCity:"",state:"",zipCode:"",suspended:"",verified:"",adminNotes:"",timeZone:"",showModal:!1,passwordError:"",currentPassword:"",password:"",passwordCheck:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"handleFormSubmit",async e=>{e.preventDefault();const{message:s,success:a}=await C("PUT","/users/"+this.props.loggedIn.user._id,{email:this.state.email,firstName:this.state.firstName,lastName:this.state.lastName,adminLevel:this.state.adminLevel,phoneNumber:this.state.phoneNumber,addressLineOne:this.state.addressLineOne,addressLineTwo:this.state.addressLineTwo,townCity:this.state.townCity,state:this.state.state,zipCode:this.state.zipCode,adminNotes:this.state.adminNotes,timeZone:this.state.timeZone});a?this.props.setGlobalAlert({type:"success",message:"Profile changes saved!"}):this.props.setGlobalAlert({type:"error",message:s})});o(this,"toggleShowModal",(e=null)=>{e instanceof Event&&e.preventDefault(),this.setState({showModal:!this.state.showModal})});o(this,"handlePasswordChange",async e=>{e.preventDefault();const{success:s,message:a}=await C("POST","/users/password/change",{currentPassword:this.state.currentPassword,password:this.state.password,passwordCheck:this.state.passwordCheck});s?(this.props.setGlobalAlert({type:"success",message:"You password was changed!"}),this.toggleShowModal()):this.setState({passwordError:a})})}async componentDidMount(){const{response:e,message:s,success:a}=await C("GET","/users/"+this.props.loggedIn.user._id);a?this.setState(y(m({},e),{loading:!1})):this.setState({failedToLoad:s})}render(){if(this.state.loading)return t("div",{className:"center-loading big",children:t(Oe,{animation:"border"})});const{message:e,passwordError:s}=this.state;return t(Cn,{children:n("section",{id:"user-profile",className:"padding--double",children:[n(A,{children:[t(x,{children:t("h3",{children:"Your profile"})}),t(x,{style:{display:"flex",justifyContent:"flex-end"},children:t("button",{className:"btn bp",onClick:this.toggleShowModal,children:"Change password"})})]}),t(A,{children:t(x,{children:n("div",{className:"form"+(e?" form--with-error":""),children:[e&&t(ke,{variant:e.type,children:e.text}),t("div",{className:"form__content",children:n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[n(A,{children:[n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"firstName",children:"First name"}),t("input",{type:"text",name:"firstName",onChange:this.handleInputChange,defaultValue:this.state.firstName})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"lastName",children:"Last name"}),t("input",{type:"text",name:"lastName",onChange:this.handleInputChange,defaultValue:this.state.lastName})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"email",children:"Email"}),t("input",{type:"text",name:"email",onChange:this.handleInputChange,defaultValue:this.state.email})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"phoneNumber",children:"Phone number"}),t("input",{type:"text",name:"phoneNumber",onChange:this.handleInputChange,defaultValue:this.state.phoneNumber})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"timeZone",children:"Time zone"}),t("input",{type:"text",name:"timeZone",onChange:this.handleInputChange,defaultValue:this.state.timeZone})]})]}),n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"addressLineOne",children:"Address line 1"}),t("input",{type:"text",name:"addressLineOne",onChange:this.handleInputChange,defaultValue:this.state.addressLineOne})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"addressLineTwo",children:"Address line 2"}),t("input",{type:"text",name:"addressLineTwo",onChange:this.handleInputChange,defaultValue:this.state.addressLineTwo})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"townCity",children:"Town / City"}),t("input",{type:"text",name:"townCity",onChange:this.handleInputChange,defaultValue:this.state.townCity})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"state",children:"State"}),t("input",{type:"text",name:"state",onChange:this.handleInputChange,defaultValue:this.state.state})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"zipCode",children:"zipCode"}),t("input",{type:"text",name:"zipCode",onChange:this.handleInputChange,defaultValue:this.state.zipCode})]})]})]}),t("div",{className:"form__buttons",children:t("button",{type:"submit",className:"btn bp",children:"Save"})})]})})]})})}),n(N,{show:this.state.showModal,onHide:this.toggleShowModal,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Change password"})}),t(N.Body,{children:n("div",{className:"form"+(s?" form--with-error":""),children:[s&&t("div",{className:"form__error",children:s}),t("div",{className:"form__content",children:n("form",{action:"/",onSubmit:this.handlePasswordChange,children:[this.props.loggedIn.token&&n("div",{className:"form__field",children:[t("label",{htmlFor:"currentPassword",children:"Current password"}),t("input",{type:"password",name:"currentPassword",onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"password",children:"New password"}),t("input",{type:"password",name:"password",onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"passwordCheck",children:"Repeat new password"}),t("input",{type:"password",name:"passwordCheck",onChange:this.handleInputChange})]}),n("div",{className:"form__buttons",children:[t("button",{className:"btn bp",type:"submit",children:"Submit"}),t("button",{className:"btn bd",type:"cancel",onClick:this.toggleShowModal,children:"Cancel"})]})]})})]})})]})]})})}}var td=$(l=>({loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(ed);class sd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{redirect:!1})}async componentDidMount(){const e=new URLSearchParams(this.props.location.search),s=e.get("verifyToken"),{success:a,message:i}=await C("GET",`/users/verify/${s}/`);this.setState({redirect:!0},()=>{const{loggedIn:r}=this.props;this.props.setLoggedIn({token:r.token,user:y(m({},r.user),{verified:new Date().toISOString()})}),this.props.setGlobalAlert({type:a?"success":"error",message:i})})}render(){return t("div",{children:this.state.redirect&&t(Se,{to:"/"})})}}var ad=$(l=>({loggedIn:l.loggedIn}),{setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(sd));class bt{static async call(e,s,a=null,i=null){const{loggedIn:r}=ct.getState();if(!r)throw new Error("user must be logged in to use this method");const d=this.paramBuilder(i),c=r.token,h={method:e.toUpperCase(),url:this.baseUrl+s+d,data:a,headers:{Authorization:`Bearer ${c}`}};return await this.sendRequest(h)}static paramBuilder(e){let s="";if(e){s="?";for(const a in e)if(a&&e[a]!==null&&e[a]!==void 0){const i=`${a}=${e[a]}&`;s=s+i}else continue}return s.slice(0,-1)}static async sendRequest(e){e.data!==null&&(e.headers["Content-Type"]="application/json"),e.data instanceof FormData&&(e.headers["Content-Type"]="multipart/form-data");try{const{data:s}=await tn(e),{message:a,error:i,success:r,data:d}=s;return{success:r,message:a,response:d||null,error:i||null,raw:s}}catch(s){if(s.response){const{data:a}=s.response,{message:i,success:r}=a;return{success:r,message:i,response:i!=null?i:"",error:i!=null?i:""}}else return{success:!1,message:`Couldn't connect to server, please try again.\r
 If the problem persits please contact support`,response:"",error:"SERVERDOWN"}}}}o(bt,"baseUrl","http://localhost:5000/api/");class ze{}o(ze,"USCurrency",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}));const xe=async l=>{if(l){const{success:e,response:s}=await C("GET",`/files/${l}`);if(e){const{url:a}=s;return Array.isArray(a)?a[1]:a}}return""},id=async l=>{if(l){const{success:e,response:s}=await C("GET",`/files/${l}`);return e?s:null}else return null};class At extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:""})}async componentDidMount(){const{fileId:e}=this.props;e instanceof File?this.setState({fileUrl:URL.createObjectURL(e)}):this.setState({fileUrl:await xe(e)})}render(){const{fileUrl:e}=this.state;return e?t("iframe",{ref:this.onIframeRef,src:e}):t(w,{})}}class de extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:""})}async componentDidMount(){await this.setFileUrl()}async componentDidUpdate(e,s){e.fileId!==this.props.fileId&&await this.setFileUrl()}async setFileUrl(){const{fileId:e}=this.props;if(Array.isArray(e)||typeof e=="string"&&e.includes("http")){this.setState({fileUrl:e});return}if(e instanceof File){this.setState({fileUrl:URL.createObjectURL(e)});return}this.setState({fileUrl:await xe(e)})}get className(){const{fileUrl:e}=this.state,{className:s}=this.props;let a="file-image";return e||(a+=" loading"),s&&(a+=` ${s}`),a}render(){const{fileUrl:e}=this.state,r=this.props,{fileId:s,src:a}=r,i=oe(r,["fileId","src"]);return e?Array.isArray(e)?t("img",m({className:this.className,src:e[2],srcSet:`${e[2]} 400w, ${e[1]} 800w`},i)):t("img",m({className:this.className,src:e},i)):t("div",{className:this.className,children:t(I,{icon:Ur})})}}class yn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:""})}async componentDidMount(){const e=await id(this.props.fileId);e!==null&&this.setState({fileUrl:e.url,fileName:e.fileName})}render(){const{props:{children:e},state:{fileUrl:s,fileName:a}}=this;return s?t("a",{href:s,target:"_blank",download:a,rel:"noreferrer",className:"text-link",children:e}):t(w,{})}}const nd=l=>(()=>!!(l.to.startsWith("https://")||l.to.startsWith("http://")||l.to.startsWith("mailto:")))()?t("a",m({href:l.to},l)):l.disabled?t(R,y(m({},l),{onClick:s=>s.preventDefault()})):t(R,m({},l));class vn extends g.exports.Component{constructor(){super(...arguments);o(this,"supportUrl","mailto:support@realestateu.com");o(this,"state",{value:"",link:"/"})}async componentDidMount(){const{userCourse:e}=this.props;(e.suspendedAt||this.isCourseExpired)&&this.setState({value:"Contact support",link:this.supportUrl});const{success:s,response:a}=await bt.call("get",`/users/courses/${e._id}/available`);let i="",r="/";s&&(a.available?e.enrollmentUpdatedAt?e.postExamUpdatedAt?(r=`/courses/${e._id}`,i="View Course"):(e.status==="FINISHED"&&!e.preExamUpdatedAt?r=`/courses/${e._id}/preexam`:e.readyForExam?r=`/courses/${e._id}/exam`:e.status==="EXAM_PASSED"&&!e.postExamUpdatedAt?r=`/courses/${e._id}/postexam`:r=`/courses/${e._id}`,i="Resume"):(r=`/courses/${e._id}/enrollment`,i="Enroll"):i="Course unavailable",this.setState({value:i,link:r}))}get isCourseExpired(){return this.props.userCourse.expiresAt&&new Date(this.props.userCourse.expiresAt)<new Date}render(){const{value:e,link:s}=this.state;return t(nd,{to:s,disabled:s==="/",className:"course-button",children:this.state.value})}}class rd extends g.exports.Component{render(){const{progress:e}=this.props;return n("div",{className:"progress-bar-container",children:[t("div",{className:"bar",children:t("div",{className:"progress",style:{width:`${e}%`}})}),n("span",{children:[e,"% Complete"]})]})}}class od extends g.exports.Component{render(){const{course:e}=this.props;return n("div",{className:"course",children:[t(de,{className:"image",fileId:e.image}),n("div",{className:"info",children:[t("h6",{children:e.title}),t("span",{children:e.description})]}),t(rd,{progress:e.percentageProgress}),t(vn,{userCourse:e})]})}}class ld extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showCourses:!1,courses:[],loaded:!1});o(this,"loadUserPackageById",async e=>{const{success:s,response:a}=await bt.call("get",`/users/packages/${e}/courses`);s&&this.setState({courses:a.courses,loaded:!0})});o(this,"toggleCourses",()=>{this.setState({showCourses:!this.state.showCourses})})}componentDidMount(){this.loadUserPackageById(this.props.packageId)}render(){const{showCourses:e,loaded:s,courses:a}=this.state;return n("div",{className:"package-courses",children:[t("h2",{children:"Courses"}),n("button",{className:"view-courses-button",onClick:this.toggleCourses,children:[t("span",{children:"View Courses"}),t("i",{className:`fas fa-chevron-${e?"up":"down"}`})]}),t("div",{className:"course-list",children:e&&s&&a.map(i=>t(od,{course:i},i._id))})]})}}class dd extends g.exports.Component{render(){const{_id:e}=this.props.userPackage,{title:s,description:a,image:i}=this.props.userPackage.data;return n("div",{className:"package-card",children:[n("div",{className:"package-contents",children:[t(de,{className:"image",fileId:i}),n("div",{className:"description",children:[t("h3",{children:s}),t("div",{dangerouslySetInnerHTML:{__html:a}})]})]}),t(ld,{packageId:e})]})}}class cd extends g.exports.Component{render(){const{userCourse:e}=this.props;return n("div",{className:"course-card",children:[t(de,{className:"image",fileId:e.image}),n("div",{className:"description",children:[t("h3",{children:e.title}),t("div",{dangerouslySetInnerHTML:{__html:e.description}})]}),t(vn,{userCourse:e})]})}}class hd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{packages:[]});o(this,"loadUserPackages",async()=>{const{success:e,response:s}=await bt.call("GET",`users/${this.props.userId}/packages`);e&&this.setState({packages:s.docs})});o(this,"isSingleCourse",e=>e.course!==null)}componentDidMount(){this.loadUserPackages()}render(){const{packages:e}=this.state;return t("div",{className:"package-list",children:e.map(s=>this.isSingleCourse(s)?t(cd,{userCourse:s.course},s._id):t(dd,{userPackage:s},s._id))})}}class pd extends g.exports.Component{render(){return t("div",{className:"package-banner",children:t("span",{children:"NEW: Get paid for sharing our courses with your network. Earn $17 for every new customer you refer to REU (details)."})})}}class ud extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{packages:null,packageCourses:null})}render(){const{loggedIn:e}=this.props;return n("div",{className:"home",children:[t("div",{className:"banner-container",children:t(pd,{})}),n("div",{className:"package-upsells",children:[t(hd,{userId:e.user._id}),t("div",{className:"upsells"})]})]})}}var md=$(l=>({loggedIn:l.loggedIn}))(D(ud));class gd extends g.exports.Component{constructor(e){super(e);o(this,"toggleMenuCollapse",e=>{e.preventDefault(),this.setState(s=>({collapsed:!s.collapsed}))});this.state={collapsed:!1}}render(){const{collapsed:e}=this.state;return n("menu",{className:"side-menu"+(e?" side-menu--collapsed":""),children:[t("div",{className:"side-menu__items",children:g.exports.Children.map(this.props.children,s=>z.isValidElement(s)?z.cloneElement(s,{to:this.props.basePath+s.props.to}):s)}),t("div",{className:"side-menu__toggle",onClick:this.toggleMenuCollapse,children:t(I,{icon:e?Be:Xe,size:"2x",color:"#cacaca"})})]})}}class fd extends g.exports.Component{render(){const{props:e}=this;return n(R,{to:e.to,className:`side-menu__item${this.props.breadcrumbList[e.to]||Object.keys(this.props.breadcrumbList).length===0&&(e.text==="Dashboard"||e.children==="Dashboard")?" side-menu__item--active":""}`,children:[t(I,{icon:e.icon}),t("span",{children:e.text?e.text:e.children})]},e.text)}}var ge=$(l=>({breadcrumbList:l.globalBreadcrumb}))(fd);class bd extends g.exports.Component{constructor(){super(...arguments);o(this,"resendEmail",async()=>{const{success:e,message:s}=await C("GET","/users/verify/resend");this.props.setGlobalAlert({type:e?"success":"error",message:s})})}render(){return n("div",{className:"admin-layout",children:[n(gd,{basePath:"/admin",children:[t(ge,{to:"/dashboard",icon:Mr,children:"Dashboard"}),t(ge,{to:"/settings",icon:Br,children:"Settings"}),t(ge,{to:"/sessions",icon:Gr,children:"Sessions"}),t(ge,{to:"/messages",icon:Hr,children:"Messages"}),t(ge,{to:"/users",icon:qr,children:"Users"}),t(ge,{to:"/invoices",icon:zr,children:"Invoices"}),t(ge,{to:"/packages",icon:Vr,children:"Packages"}),t(ge,{to:"/discounts",icon:Qr,children:"Discounts"}),t(ge,{to:"/courses",icon:sn,children:"Courses"}),t(ge,{to:"/core-libraries",icon:Wr,children:"Core libraries"}),t(ge,{to:"/quizzes",icon:Kr,children:"Quizzes"}),t(ge,{to:"/reporting",icon:Yr,children:"Reporting"})]}),t("main",{children:t("div",{className:"admin-wrapper",children:this.props.children})})]})}}var Cd=$(l=>({breadcrumbList:l.globalBreadcrumb,loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(bd);class yd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{students:0,courses:0,activeSessions:0})}async componentDidMount(){const{response:e,success:s,message:a}=await C("GET","/stats/basic");s?this.setState(e):this.props.setGlobalAlert({type:"error",message:a})}render(){return t("div",{id:"dashboard",children:n(A,{className:"basic-stats",children:[t(x,{children:n("dl",{children:[t("dt",{children:t(It,{start:0,duration:2,end:this.state.students})}),t("dd",{children:"Student accounts"})]})}),t(x,{children:n("dl",{children:[t("dt",{children:t(It,{start:0,duration:2,end:this.state.courses})}),t("dd",{children:"Published courses"})]})}),t(x,{children:n("dl",{children:[t("dt",{children:t(It,{start:0,duration:2,end:this.state.activeSessions})}),t("dd",{children:"Active sessions"})]})})]})})}}var vd=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(yd);const xd=window.ClassicEditor;class H extends g.exports.Component{constructor(e){super(e);o(this,"toolbarObserver",null);o(this,"editorConfig",{uploadAdapter:{uploadUrl:"http://localhost:5000/api/files",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}},link:{decorators:{openInNewTab:{mode:"manual",label:"Open in a new tab?",defaultValue:!0,attributes:{target:"_blank",rel:"noopener noreferrer"}}}},toolbar:{viewportTopOffset:54}});o(this,"editor",null);o(this,"toolbarRef",z.createRef());o(this,"editorRef",z.createRef());o(this,"scrollingParent",e=>e==null?null:e.scrollHeight-1>e.clientHeight||getComputedStyle(e).getPropertyValue("overflow-y")==="scroll"?e:this.scrollingParent(e.parentNode));o(this,"getCharCount",e=>{var a,i;let s=new DOMParser().parseFromString(e,"text/html");return((i=(a=s==null?void 0:s.body)==null?void 0:a.textContent)==null?void 0:i.length)||0});o(this,"handleChange",(e,s)=>{this.setState({charCount:this.getCharCount(s.getData())}),this.props.onChange({target:{name:this.props.name,value:s.getData()}})});o(this,"handleFixedToolbar",({width:e,height:s,y:a})=>{this.toolbarRef.current&&(a<=47?this.setFixedToolbar({width:e,height:s}):this.unsetFixedToolbar())});o(this,"setFixedToolbar",({width:e,height:s,top:a})=>{this.toolbarRef.current&&(this.toolbarRef.current.style.height=`${s}px`,this.toolbarRef.current.firstChild.style.position="fixed",this.toolbarRef.current.firstChild.style.top=`${a}px`,this.toolbarRef.current.firstChild.style.width=`${e}px`,this.toolbarRef.current.firstChild.style.border="1px solid #000",this.toolbarRef.current.firstChild.style.borderRadius="0px",this.toolbarRef.current.firstChild.style.zIndex="99991")});o(this,"unsetFixedToolbar",()=>{this.toolbarRef.current&&this.toolbarRef.current.firstChild.setAttribute("style","")});o(this,"fixedToolbarHandler",e=>{const s=this.toolbarRef.current,a=this.editorRef.current;if(s){const{y:i,width:r,height:d}=s.getBoundingClientRect(),{y:c,height:h}=a.getBoundingClientRect(),{y:p}=e.getBoundingClientRect();i<p&&!this.state.toolbarFixed&&this.state.editorInFocus&&(this.setFixedToolbar({width:r,height:d,top:p}),this.setState({toolbarFixed:!0})),(i>p||p>c+h-d)&&this.state.toolbarFixed&&(this.unsetFixedToolbar(),this.setState({toolbarFixed:!1}))}});o(this,"onReady",e=>{if(this.editor=e,this.toolbarRef.current&&this.toolbarRef.current.appendChild(e.ui.view.toolbar.element),this.editorRef.current){const s=this.scrollingParent(this.editorRef.current);s!==null&&s.addEventListener("scroll",jr(()=>{this.fixedToolbarHandler(s)},100))}});o(this,"onError",({willEditorRestart:e})=>{e&&this.editor.ui.view.toolbar.element.remove()});o(this,"onFocus",()=>{if(this.setState({editorInFocus:!0}),this.editorRef.current){const e=this.scrollingParent(this.editorRef.current);this.fixedToolbarHandler(e)}});o(this,"onBlur",()=>{this.setState({editorInFocus:!1})});this.state={toolbarFixed:!1,charCount:this.getCharCount(e.defaultValue||"")}}render(){return n("div",{className:"editor-wrapper",ref:this.editorRef,children:[t("div",{className:"editor-wrapper__toolbar",ref:this.toolbarRef}),t(Zr.exports.CKEditor,{config:this.editorConfig,editor:xd,data:this.props.defaultValue,onReady:this.onReady,onError:this.onError,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.handleChange}),!this.props.noCharCount&&t("span",{className:"ckeditor-char-counter",children:this.state.charCount})]})}}class Sd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{_id:null,subject:null,message:null,sendingCondition:"USER_REGISTER",sendingTimeCondition:"after",sendingTime:0,formMessage:null,availableVariables:[],previousRoute:"/admin/messages",editor:null});o(this,"updateAvailableVariables",()=>{let e=[...this.props.sendingConditions.GLOBAL_VARIABLES],s={};for(const a of e){let i=a.split(".")[0];s[i]?s[i].push(a):s[i]=[a]}this.setState({availableVariables:s})});o(this,"handleFormSubmit",async e=>{e.preventDefault();const{success:s,message:a}=await C(this.props.match.params.id==="new"?"POST":"PUT",this.props.match.params.id==="new"?"/notifications":"/notifications/"+this.props.match.params.id,{subject:this.state.subject,message:this.state.message,sendingCondition:this.state.sendingCondition,sendingTimeCondition:this.state.sendingTimeCondition,sendingTime:this.state.sendingTime});s?(this.props.history.push(this.state.previousRoute),this.props.setGlobalAlert({type:"success",message:"Notification template saved."})):this.setState({formMessage:a})});o(this,"setEditor",e=>{this.setState({editor:e})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"handleTagClick",e=>{const{editor:s}=this.state;s&&s.isFocus()&&s.insertContent({html:e.target.innerHTML})});o(this,"selectSendingConditions",()=>Object.keys(this.props.sendingConditions).filter(e=>e!=="GLOBAL_VARIABLES").map(e=>({value:e,name:this.props.sendingConditions[e].text})))}async componentDidMount(){if(this.props.match.params.id!=="new"){const{success:e,message:s,response:a}=await C("GET","/notifications/"+this.props.match.params.id);e?this.setState(m({},a)):this.props.setGlobalAlert({type:"error",message:s})}this.updateAvailableVariables()}componentDidUpdate(e,s,a){e.location.pathname&&s.previousRoute!==this.state.previousRoute&&this.setState({previousRoute:e.location.pathname})}render(){const{formMessage:e}=this.state;return n("div",{className:"form-with-variables",children:[n("div",{className:"form"+(e?" form--with-error":""),children:[e&&t(ke,{variant:"warning",children:e}),t("div",{className:"form__content",children:n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[t(A,{children:t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"subject",children:"Subject"}),t("input",{type:"text",name:"subject",onChange:this.handleInputChange,defaultValue:this.state.subject,ref:this.subjectRef})]})})}),t(A,{children:t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"message",children:"Message"}),t(H,{name:"message",defaultValue:this.state.message,onChange:this.handleInputChange,onReady:this.setEditor})]})})}),t(A,{children:t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"sendingCondition",children:"Sending time condition"}),n(A,{children:[n(x,{children:[t("input",{type:"number",name:"sendingTime",value:this.state.sendingTime,onChange:this.handleInputChange}),t("small",{className:"color--light",children:"The amount of time (in seconds) after/before sending the notification."})]}),t(x,{children:t(lt,{name:"sendingTimeCondition",onChange:s=>{this.setState({sendingTimeCondition:s})},defaultValue:this.state.sendingTimeCondition,options:[{value:"after",name:"after"},{value:"before",name:"before"}]})})]})]})})}),t(A,{children:t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"sendingCondition",children:"Sending condition"}),t(lt,{name:"sendingCondition",search:!0,onChange:s=>{this.setState({sendingCondition:s})},defaultValue:this.state.sendingCondition,options:this.selectSendingConditions()})]})})}),n("div",{className:"form__buttons",children:[t("button",{type:"submit",className:"btn bp",children:"Save"}),t(R,{to:this.state.previousRoute,className:"btn btn--link",children:"Cancel"})]})]})})]}),t("aside",{className:"sticky-variables",children:n("nav",{children:[n("div",{children:[t("div",{className:"block-title",children:"Available tags"}),t("small",{children:"These tags can be used either in the subject or content of the message. Clicking on any tag will automatically insert it at the cursor position in the content editor."})]}),t("ul",{children:this.state.availableVariables&&Object.keys(this.state.availableVariables).map(s=>{let a=[];for(const i of this.state.availableVariables[s])a.push(t("li",{onClick:this.handleTagClick,children:`#{${i}}`},i));return n("li",{children:[t("b",{children:s}),t("ul",{children:a})]},s)})})]})})]})}}var Id=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Sd));class wd extends g.exports.Component{constructor(e){super(e);o(this,"loadDocs",async(e=null)=>{const{success:s,response:a,message:i}=await C("GET","/notifications");s?this.setState({messages:a},()=>{e&&e()}):this.props.setGlobalAlert({type:"error",message:i})});o(this,"deleteMessage",async e=>{const{success:s,message:a}=await C("DELETE","/notifications/"+e);s?await this.loadDocs(()=>{this.props.setGlobalAlert({type:"success",message:a})}):this.props.setGlobalAlert({type:"error",message:a})});this.state={messages:null}}async componentDidMount(){await this.loadDocs()}render(){return n("div",{children:[t("div",{className:"page-controls",children:t("div",{className:"page-controls__buttons",children:t(R,{className:"btn bp btn--small",to:"/admin/messages/new",children:"New template"})})}),t("div",{className:"messages-list",children:this.state.messages&&this.state.messages.docs.map(e=>{const{sendingTime:s}=e;let a="Scheduled";return s>=86400?a+=` ${Math.ceil(s/86400)} days`:s>=3600?a+=` ${Math.ceil(s/3600)} hours`:s>=60?a+=` ${Math.ceil(s/60)} minutes`:s>0?a+=` ${Math.ceil(s)} seconds`:a+=" instantly",a+=" "+e.sendingTimeCondition+" "+this.props.sendingConditions[e.sendingCondition].text.toLocaleLowerCase(),t(T,{children:n(B,{children:[n(T.Toggle,{eventKey:e._id,as:B.Header,children:[t("div",{className:"card-title",children:e.subject}),n("div",{className:"card-controls",children:[t(R,{className:"btn btn--small",as:R,to:"/admin/messages/"+e._id,children:t(I,{icon:Jr})}),t("button",{className:"btn btn--small",size:"sm",onClick:async i=>{i.stopPropagation(),await this.deleteMessage(e._id)},children:t(I,{icon:ae})})]})]}),t(T.Collapse,{eventKey:e._id,children:n(B.Body,{className:"padding",children:[t("p",{className:"color--light",children:a}),t("div",{dangerouslySetInnerHTML:{__html:e.message}})]})})]})},e._id)})})]})}}var _d=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(wd);class kd extends g.exports.Component{constructor(e){super(e);e.pushBreadcrumbLink({text:"Messages",path:"/admin/messages"}),this.sendingConditions={GLOBAL_VARIABLES:["website.title","website.url","user.firstName","user.lastName","user.email"],USER_REGISTER:{text:"User registration",availableVariables:[]},USER_COURSE_START:{text:"Course started",availableVariables:[]},USER_COURSE_EXPIRY:{text:"Course expires",availableVariables:[]},USER_EXAM_PASS:{text:"User passes exam",availableVariables:[]},USER_EXAM_FAIL:{text:"User fails exam",availableVariables:[]},COURSE_LESSON_CREATE:{text:"New lesson added to the course",availableVariables:[]}}}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Messages",path:"/admin/messages"})}render(){return t("div",{id:"messages",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/messages",children:t(_d,{sendingConditions:this.sendingConditions})}),t(P,{exact:!0,path:"/admin/messages/:id",children:t(Id,{sendingConditions:this.sendingConditions})})]})})}}var Td=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(kd);class Nd extends g.exports.Component{render(){if(this.props.totalPages<=1)return null;const e=this.props.location.pathname,s=new URLSearchParams(this.props.location.search);return n("div",{className:this.props.className,children:[this.props.activePage!==1&&s.set("page",1)===void 0&&t(R,{to:e+"?"+s,className:"btn btn--small bd",children:"1"}),this.props.activePage-1>1&&s.set("page",this.props.activePage-1)===void 0&&t(R,{to:e+"?"+s,className:"btn btn--small bd",children:t(I,{icon:on})}),s.set("page",this.props.activePage)===void 0&&t(R,{to:e+"?"+s,className:"btn btn--small bp",children:this.props.activePage}),this.props.activePage+1<this.props.totalPages&&s.set("page",this.props.activePage+1)===void 0&&t(R,{to:e+"?"+s,className:"btn btn--small bd",children:this.props.activePage+1===this.props.totalPages-1?this.props.totalPages-1:t(I,{icon:ln})}),this.props.activePage!==this.props.totalPages&&this.props.totalPages>1&&s.set("page",this.props.totalPages)===void 0&&t(R,{to:e+"?"+s,className:"btn btn--small bd",children:this.props.totalPages})]})}}var ss=D(Nd);class as extends g.exports.Component{render(){let{condition:e,url:s,text:a,classes:i,doc:r,icon:d,clickCallback:c,reloadTable:h,disabled:p}=this.props,u=p&&typeof p=="function"?p(r):"",b;if(e&&typeof e=="function"&&!e(r))return null;if(typeof d=="function"&&(d=d(r)),typeof a=="function"&&(a=a(r)),i=i||"",typeof c=="function")b=t("button",{className:`btn btn--small ${i}`,disabled:!!u,style:{pointerEvents:u?"none":"auto"},onClick:v=>{c(v,r,h)},children:d?t(I,{icon:d}):a});else{if(s)s=s.replace(/\/:([a-zA-Z_]*)/,(v,S)=>`/${r[S]}`);else throw new Error("You need to provide either a clickCallback or an url for an element of rowButtons property");b=t(R,{to:s,className:`btn btn--small ${i}`,children:d?t(I,{icon:d}):a})}return u?t(U,{placement:"left",overlay:t(M,{id:`tooltip-${r._id}-disabled-${a.toLocaleLowerCase().replace(/\\s+/g,"")}`,children:u}),children:t("span",{className:"d-inline-block",children:b})}):d?t(U,{placement:"top",overlay:t(M,{id:`tooltip-${r._id}-${a.toLocaleLowerCase().replace(/\\s+/g,"")}`,children:a}),children:b}):b}}function xn(...l){const e=l.filter(Boolean);return e.length?e.length===0?e[0]:s=>{for(const a of e)typeof a=="function"?a(s):a&&(a.current=s)}:null}var is="/home/adrian/work/lms/frontend/src/components/Table/Table.jsx";class Me extends g.exports.Component{constructor(){super(...arguments);o(this,"highlightedRow",z.createRef())}componentDidMount(){this.highlightedRow.current&&this.highlightedRow.current.scrollIntoView({behavior:"smooth"})}render(){const{rows:e,columns:s,emptyMessage:a,onSort:i,onSortReset:r,rowButtons:d,sortData:c,loading:h,minTableWidth:p,reloadRows:u}=this.props;return!e||!e.length?t("div",{className:"table color--light padding--double text--center font--medium",children:a!=null?a:"No records"}):n("div",{className:"table",style:{overflowX:"auto"},children:[n("div",{className:"header",style:{minWidth:p||"auto"},children:[s.map(b=>n("div",{style:{minWidth:b.minWidth||"auto",maxWidth:b.maxWidth||"auto"},onClick:!!b.sortKey&&i?async v=>{await i(v,b.sortKey)}:void 0,onContextMenu:!!b.sortKey&&r?async v=>await r(v,b.sortKey):void 0,className:`col${b.headClassName?" "+b.headClassName:""}`,children:[b.text,!!b.sortKey&&n("div",{className:"col--sort",children:[c[b.sortKey]===void 0||c[b.sortKey]===-1?t(Xr,{}):t(eo,{}),c[b.sortKey]===void 0||c[b.sortKey]===1?t(to,{}):t(so,{})]})]},b.field)),d&&d.length&&t("div",{className:"col col--controls",style:{minWidth:d.reduce((b,v)=>(v.icon?b+=2.06:b+=v.text.length*.9,b),0)+(d.length-1)*.75+1.3+"rem"}})]}),this.props.draggableId?t(be,{onDragEnd:b=>{this.props.handleDragAndDrop(this.props.chapter._id,b)},children:t(Ce,{droppableId:`droppable-${this.props.droppableId}`,children:b=>n("div",y(m({},b.droppableProps),{ref:b.innerRef,className:"main",style:{minWidth:p||"auto"},children:[t("div",{className:`table-loading ${h?"":" hide"}`,children:t(Oe,{animation:"border"})}),e.map((v,S)=>{const _=this.props.highlightRow(v);return t(le,{draggableId:`draggable-${this.props.draggableId}-${v._id}`,index:S,children:k=>n("div",y(m({className:`row${_?" row--highlight":""}`,ref:_?xn(k.innerRef,this.highlightedRow):k.innerRef},k.draggableProps),{children:[s.map((O,F)=>t("div",{style:{minWidth:O.minWidth||"auto",maxWidth:O.maxWidth||"auto"},className:`col${O.className?` ${O.className}`:""}`,children:typeof O.field=="function"?O.field(y(m({},v),{provided:k})):v[O.field]},`${v._id}-${F}`)),(d==null?void 0:d.length)&&t("div",{className:"col col--controls",style:{minWidth:d.reduce((O,F)=>(F.icon?O+=2.06:O+=F.text.length*.9,O),0)+(d.length-1)*.75+1.3+"rem"},children:d.map(O=>g.exports.createElement(as,y(m({},O),{doc:v,key:`${v._id}-${K()}`,reloadTable:u,__self:this,__source:{fileName:is,lineNumber:188,columnNumber:69}})))})]}),v._id)},`draggable-${this.props.draggableId}-${v._id}`)}),b.placeholder]}))})}):n("div",{className:"main",style:{minWidth:p||"auto"},children:[t("div",{className:`table-loading ${h?"":" hide"}`,children:t(Oe,{animation:"border"})}),e.map((b,v)=>n("div",{className:"row",children:[s.map((S,_)=>t("div",{style:{minWidth:S.minWidth||"auto",maxWidth:S.maxWidth||"auto"},className:`col${S.className?" "+S.className:""}`,children:typeof S.field=="function"?S.field(b,v):b[S.field]},`${b._id}-${_}`)),(d==null?void 0:d.length)&&t("div",{className:"col col--controls",style:{minWidth:d.reduce((S,_)=>(_.icon?S+=2.06:S+=_.text.length*.9,S),0)+(d.length-1)*.75+1.3+"rem"},children:d.map(S=>g.exports.createElement(as,y(m({},S),{doc:b,key:`${b._id}-${K()}`,reloadTable:u,__self:this,__source:{fileName:is,lineNumber:250,columnNumber:45}})))})]},b._id))]})]})}}class Ad extends g.exports.Component{render(){if(this.props.totalPages<=1)return null;const{totalPages:e,page:s}=this.props;return n("div",{className:this.props.className,children:[s!==1&&t("button",{onClick:this.props.onPageChange(1),className:"btn btn--small bd",children:"1"}),s-1>1(t("button",{onClick:this.props.onPageChange(s-1),className:"btn btn--small bd",children:t(I,{icon:on})})),t("button",{onClick:this.props.onPageChange(s),className:"btn btn--small bp",children:s}),s+1<e&&t("button",{onClick:this.props.onPageChange(activePage+1),className:"btn btn--small bd",children:s+1===e-1?e-1:t(I,{icon:ln})}),s!==e&&e>1&&t("button",{onClick:this.props.onPageChange(e),className:"btn btn--small bd",children:t(I,{icon:e})})]})}}class Ld extends g.exports.Component{constructor(e){super(e);o(this,"loadTableData",async()=>{this.state.loading||this.setState({loading:!0});let e=new URLSearchParams(this.props.location.search);const{response:s,message:a,success:i}=await C(this.props.apiCall.method,this.props.apiCall.path+(e.toString()?`?${e.toString()}`:""),this.props.apiCall.payload!==void 0?this.props.apiCall.payload:null,this.props.apiCall.auth!==void 0?this.props.apiCall.auth:!0);i?this.setState({tableData:s,loading:!1}):this.props.setGlobalAlert({type:"error",message:a})});o(this,"updateURLParams",()=>{let e=new URLSearchParams(this.props.location.search);if(Object.keys(this.state.sort).length){let s="";for(const a of Object.keys(this.state.sort))s+=`${a}=${this.state.sort[a]},`;s=s.substring(0,s.length-1),e.set("sort",s)}else e.get("sort")&&e.delete("sort");this.props.history.replace(`${this.props.match.url}?${e.toString()}`)});o(this,"handleSort",async(e,s)=>{e.preventDefault(),this.state.sort[s]?this.setState({sort:y(m({},this.state.sort),{[s]:this.state.sort[s]===1?-1:1})},this.updateURLParams):this.setState({sort:y(m({},this.state.sort),{[s]:1})},this.updateURLParams)});o(this,"handleSortReset",async(e,s)=>{e.preventDefault();let{sort:a}=this.state;return delete a[s],this.setState({sort:a},this.loadTableData),!1});o(this,"handleSearchSubmit",e=>{e.preventDefault()});o(this,"handleSearchChange",async e=>{const s=e.target;this.setState({search:s.value},()=>{this.timeOutFunction&&clearTimeout(this.timeOutFunction),this.timeOutFunction=setTimeout(()=>{s.value?this.searchParams.set("search",encodeURI(this.state.search)):this.searchParams.delete("search"),this.searchParams.delete("page"),this.props.history.push(this.props.location.pathname+"?"+this.searchParams.toString())},1e3)})});this.searchParams=e.location.search?new URLSearchParams(e.location.search):new URLSearchParams;let s=this.searchParams.get("sort");s&&(s=ao(s.split(",").reduce((a,i)=>{let[r,d]=i.split("=");if(d=parseInt(d),r.indexOf("-"))for(const c of r.split("-"))Number.isNaN(d)||a.push([c,d]);else Number.isNaN(d)||a.push([r,d]);return a},[]))),this.timeOutFunction=null,this.state={tableData:null,search:this.searchParams.get("search")?decodeURI(this.searchParams.get("search")):"",loading:!0,sort:s!=null?s:{}}}async componentDidMount(){await this.loadTableData()}async componentDidUpdate(e,s,a){(e.location.search!==this.props.location.search||e.reload!==this.props.reload)&&await this.loadTableData()}render(){var e,s;if(this.state.tableData){const{state:{tableData:a,sort:i,loading:r},props:{hideControls:d,columns:c,rowButtons:h,noSearch:p,addNew:u},handleSort:b,handleSortReset:v,loadTableData:S}=this;return n("div",{className:"table-wrapper",children:[!d&&n("div",{className:"table-controls",children:[t(ss,{className:"table-pagination",activePage:a.page,totalPages:a.totalPages}),u&&t("button",{onClick:()=>{u.action(this.loadTableData)},className:" add-new btn",children:u.label}),!p&&t("div",{className:"table-search",children:t("form",{action:"/",className:"form",onSubmit:(e=this.props.handleSearch)!=null?e:this.handleSearchSubmit,children:n("div",{className:"form__field form__field--inside-icon",children:[t("input",{type:"text",name:"search",defaultValue:this.state.search,placeholder:"Search...",onChange:(s=this.props.handleSearchInputChange)!=null?s:this.handleSearchChange}),t("button",{className:"btn bp btn--small",type:"submit",children:t(I,{icon:io})})]})})})]}),t(Me,{rows:a.docs,rowButtons:h,columns:c,onSort:b,onSortReset:v,sortData:i,loading:r,reloadRows:S}),!d&&t("div",{className:"table-controls table-controls--bottom",children:this.props.onPageChange?t(Ad,{onPageChange:this.props.onPageChange,className:"table-pagination",activePage:a.page,totalPages:a.totalPages}):t(ss,{className:"table-pagination",activePage:a.page,totalPages:a.totalPages})})]})}return t("div",{})}}var he=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Ld));class X extends g.exports.Component{render(){return n(N,{show:this.props.show,onHide:this.props.hideModal,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:this.props.titleText})}),t(N.Body,{children:this.props.bodyText}),n(N.Footer,{children:[t(L,{variant:"secondary",onClick:this.props.hideModal,children:this.props.cancelButtonText||"Cancel"}),t(L,{variant:"primary",onClick:this.props.confirmAction,children:this.props.confirmButtonText||"Confirm"})]})]})}}const Ed=(l,e)=>{e&&l.preventDefault()};class $d extends g.exports.Component{constructor(e){super(e);o(this,"state",{toDelete:!1,modalConfirmAction:null,showModalForm:!1,modalFormMessage:"",firstName:"",lastName:"",email:"",emailCheck:"",adminLevel:"",reloadTable:0});o(this,"toggleShowModalForm",e=>{e&&e.preventDefault(),this.setState({showModalForm:!this.state.showModalForm})});o(this,"handleFormSubmit",async()=>{const{email:e,emailCheck:s}=this.state;if(!no.isEmail(e)){this.props.setGlobalAlert({type:"error",message:"Enter valid e-mail address"});return}if(e!==s){this.props.setGlobalAlert({type:"error",message:"E-mail addresses must match"});return}await this.submitRegistrationForm()});o(this,"submitRegistrationForm",async()=>{let e=this.state.adminLevel===0?"/users/admin/users/":"/users/admin";const{success:s,message:a}=await C("POST",e,{email:this.state.email.toLowerCase(),emailCheck:this.state.emailCheck.toLowerCase(),firstName:this.state.firstName,lastName:this.state.lastName,adminLevel:this.state.adminLevel===0?void 0:this.state.adminLevel});this.props.setGlobalAlert({type:s?"success":"error",message:a}),this.setState({showModalForm:!this.state.showModalForm,email:"",emailCheck:"",firstName:"",lastName:"",adminLevel:"",reloadTable:s?this.state.reloadTable+1:this.state.reloadTable})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"unsetUserToDelete",()=>{this.setState({toDelete:!1})});e.pushBreadcrumbLink({text:"Users",path:"/admin/users"})}render(){return n("div",{children:[n(A,{className:"page-header padding",children:[t(x,{children:t("h3",{children:"Users"})}),t("div",{className:"page-controls",children:t(L,{onClick:()=>{this.setState({adminLevel:1}),this.toggleShowModalForm()},className:"bp",children:"Create new admin"})}),t("div",{className:"page-controls",children:t(L,{onClick:()=>{this.setState({adminLevel:0}),this.toggleShowModalForm()},className:"bd ml-1",children:"Create new student"})})]}),t(he,{reload:this.state.reloadTable,basePath:"/admin/users",apiCall:{method:"GET",path:"/users"},columns:[{text:"",field:e=>{var a,i;const{editingAdmin:s}=e;return t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-edit-course)}`,children:s&&(s==null?void 0:s._id)!==((i=(a=this.props.loggedIn)==null?void 0:a.user)==null?void 0:i._id)?`${s.firstName} ${s.lastName} editing`:"Edit user"}),children:t(R,{onClick:r=>{var d,c;Ed(r,(s==null?void 0:s._id)&&(s==null?void 0:s._id)!==((c=(d=this.props.loggedIn)==null?void 0:d.user)==null?void 0:c._id))},className:"btn btn--small",to:"/admin/users/"+e._id,children:t(I,{icon:Ge})})})},maxWidth:"3.11rem"},{text:"Full name",sortKey:"firstName-lastName",field:e=>`${e.firstName} ${e.lastName}`},{text:"Email",field:"email",sortKey:"email"},{text:"Phone number",field:"phoneNumber",sortKey:"phoneNumber"},{text:"Address",field:e=>{let s=e.addressLineOne;return e.addressLineTwo&&(s+=` ${e.addressLineTwo}`),e.townCity&&(s+=`, ${e.townCity}`),e.zipCode&&(s+=` ${e.zipCode}`),e.state&&(s+=`, ${e.state}`),s},minWidth:"35%"}],rowButtons:[{text:"Delete user",icon:ae,clickCallback:async(e,s,a)=>{this.setState({toDelete:s,modalConfirmAction:async()=>{this.setState({toDelete:!1});const{success:i,message:r}=await C("DELETE","/users/"+s._id);i?(this.props.setGlobalAlert({type:"success",message:r}),await a()):this.props.setGlobalAlert({type:"error",message:r})}})}}]}),n(N,{size:"lg",show:this.state.showModalForm,onHide:this.toggleShowModalForm,children:[t(N.Header,{closeButton:!0,children:n(N.Title,{children:["Create new ",this.state.adminLevel===0?"student":"admin"," user"]})}),t(N.Body,{children:t("div",{className:"form",children:t("div",{className:"form__content",children:n("form",{action:"/",children:[n(A,{children:[t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"firstName",children:"First name"}),t("input",{type:"text",name:"firstName",onChange:this.handleInputChange,defaultValue:this.state.firstName})]})}),t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"lastName",children:"Last name"}),t("input",{type:"text",name:"lastName",onChange:this.handleInputChange,defaultValue:this.state.lastName})]})}),this.state.adminLevel!==0?t(x,{xs:2,children:n("div",{className:"form__field",children:[t("label",{htmlFor:"adminLevel",children:"Admin level"}),t("input",{type:"number",name:"adminLevel",min:"1",max:"9",onChange:this.handleInputChange,defaultValue:this.state.adminLevel})]})}):t(w,{})]}),n(A,{children:[t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"email",children:"Email address"}),t("input",{type:"text",name:"email",onChange:this.handleInputChange,defaultValue:this.state.email})]})}),t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"emailCheck",children:"Email address confirmation"}),t("input",{type:"text",name:"emailCheck",onChange:this.handleInputChange,defaultValue:this.state.emailCheck})]})})]})]})})})}),n(N.Footer,{children:[t(L,{onClick:this.handleFormSubmit,children:"Create"}),t("button",{className:"btn bd",onClick:this.toggleShowModalForm,children:"Cancel"})]})]}),t(X,{show:this.state.toDelete!==!1,hideModal:this.unsetUserToDelete,titleText:`Delete user ${this.state.toDelete!==!1?this.state.toDelete.firstName+" "+this.state.toDelete.lastName:""} `,bodyText:"Are you sure you want to delete user's account?",confirmAction:this.state.modalConfirmAction})]})}}var Dd=$(({loggedIn:l})=>({loggedIn:l}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l})})($d);const Pd=l=>({type:"SET_FORM_ACTIONS",payload:l});class Od extends g.exports.Component{constructor(e){super(e);o(this,"toUpdate",()=>{let e={};for(const s of Object.keys(this.state.initialUser))this.state[s]!==this.state.initialUser[s]&&(e[s]=this.state[s]);return e});o(this,"handleFormSubmit",async e=>{e.preventDefault();const s=this.toUpdate(),a={type:"success",text:"User updated"};if(!s)this.setState({message:{type:"success",text:"User updated"}});else{const{success:i,message:r}=await C("PUT","/users/"+this.state.initialUser._id,s);a.text=r,i||(a.type="warning")}this.setState({message:a})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});this.state=m({message:null,initialUser:e.user},e.user)}componentDidMount(){this.props.createFormActions({save:!0,id:"user-profile-form"})}componentWillUnmount(){this.props.createFormActions({})}render(){const{message:e}=this.state;return n("section",{id:"user-profile",children:[n("div",{className:"pt-3",children:[n("span",{children:[t("b",{children:"Account ID: "}),this.state._id.toLocaleUpperCase().substr(0,16).replace(/([A-Z0-9]{4})([A-Z0-9]{4})([A-Z0-9]{4})([A-Z0-9]{4})/,"$1-$2-$3-$4")]}),"\xA0\xA0\xA0\xA0",n("span",{children:[t("b",{children:"Student ID: "}),this.state._id.toLocaleUpperCase().substr(-8).replace(/([A-Z0-9]{2})([A-Z0-9]{2})([A-Z0-9]{2})([A-Z0-9]{2})/,"$1-$2-$3-$4")]}),"\xA0\xA0\xA0\xA0",n("span",{children:[t("b",{children:"Email address: "}),this.state.email.toLowerCase()]}),t("hr",{})]}),n("div",{className:"form form--two-cols"+(e?" form--with-error":""),children:[e&&t(ke,{variant:e.type,children:e.text}),t("div",{className:"form__content py-1",children:t("form",{action:"/",id:"user-profile-form",onSubmit:this.handleFormSubmit,children:n(A,{children:[n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"firstName",children:"First name"}),t("input",{type:"text",name:"firstName",onChange:this.handleInputChange,defaultValue:this.state.firstName})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"lastName",children:"Last name"}),t("input",{type:"text",name:"lastName",onChange:this.handleInputChange,defaultValue:this.state.lastName})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"email",children:"Email"}),t("input",{type:"text",name:"email",onChange:this.handleInputChange,defaultValue:this.state.email})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"phoneNumber",children:"Phone number"}),t("input",{type:"text",name:"phoneNumber",onChange:this.handleInputChange,defaultValue:this.state.phoneNumber})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"timeZone",children:"Time zone"}),t("input",{type:"text",name:"timeZone",onChange:this.handleInputChange,defaultValue:this.state.timezone})]})]}),n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"addressLineOne",children:"Address line 1"}),t("input",{type:"text",name:"addressLineOne",onChange:this.handleInputChange,defaultValue:this.state.addressLineOne})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"addressLineTwo",children:"Address line 2"}),t("input",{type:"text",name:"addressLineTwo",onChange:this.handleInputChange,defaultValue:this.state.addressLineTwo})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"townCity",children:"Town / City"}),t("input",{type:"text",name:"townCity",onChange:this.handleInputChange,defaultValue:this.state.townCity})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"state",children:"State"}),t("input",{type:"text",name:"state",onChange:this.handleInputChange,defaultValue:this.state.state})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"zipCode",children:"zipCode"}),t("input",{type:"text",name:"zipCode",onChange:this.handleInputChange,defaultValue:this.state.zipCode})]})]}),t(x,{children:n("div",{className:"form__field",children:[t("label",{htmlFor:"adminNotes",children:"Admin notes"}),t("textarea",{name:"adminNotes",onChange:this.handleInputChange,defaultValue:this.state.adminNotes,rows:"6",style:{minHeight:"6rem"}})]})})]})})})]})]})}}const Rd={createFormActions:Pd};var Fd=D($(null,Rd)(Od)),je=qe.humanizer({language:"shortEn",languages:{shortEn:{y:()=>"y",mo:()=>"mo",w:()=>"w",d:()=>"d",h:()=>"h",m:()=>"m",s:()=>"s",ms:()=>"ms"}},spacer:"",delimiter:" ",round:!0});class Q extends g.exports.Component{render(){return t("div",{className:"centered-block loading",children:t(Oe,{animation:"border",role:"status",style:{width:"3.2rem",height:"3.2rem",borderWidth:".3rem"},children:t("span",{className:"sr-only",children:"Loading..."})})})}}var gs,fs;class Ud extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{edit:(gs=this.props.new)!=null?gs:!1,text:(fs=this.props.message)!=null?fs:""});o(this,"toggleEdit",()=>{this.setState({edit:!this.state.edit})});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"handleEdit",()=>{this.props.onSave(this.state.text,()=>{this.setState({text:""})}),this.props.new||this.toggleEdit()})}render(){const{state:{edit:e,text:s},props:{_id:a,author:i,createdAt:r,updatedAt:d,showHr:c,loggedIn:{user:{_id:h}}}}=this;return t("div",{className:"info-comments__comment",children:e?n(w,{children:[t("textarea",{placeholder:"Type your comment here...",onChange:this.handleInputChange,onFocus:p=>{p.preventDefault(),p.stopPropagation()},name:"text",value:s}),n("div",{className:"info-comments__comment__buttons",children:[!this.props.new&&t(L,{onClick:this.toggleEdit,size:"sm",className:"bd",children:t(I,{icon:fe})}),t(L,{size:"sm",onClick:this.handleEdit,className:"bp",children:this.props.new?"Comment":"Save"})]}),t("hr",{})]}):n(w,{children:[t("div",{className:"info-comments__comment__text",children:s}),n("div",{className:"info-comments__comment__info",children:[n("span",{children:["by ",`${i.firstName} ${i.lastName}`]}),"\xB7",t("span",{children:new Date(r).toLocaleString("en-US")}),r!==d&&"\xB7",r!==d&&t("span",{children:"Edited"}),i._id===h&&n(w,{children:[t(U,{placement:"top",overlay:t(M,{id:"edit-comment-",children:"Edit"}),children:t(L,{onClick:this.toggleEdit,size:"sm",children:t(I,{icon:ro})})}),t(U,{placement:"top",overlay:t(M,{id:`edit-comment-${a}`,children:"Delete"}),children:t(L,{onClick:this.props.onDelete,size:"sm",children:t(I,{icon:ae})})})]})]}),c&&t("hr",{})]})},a)}}var ns=$(l=>({loggedIn:l.loggedIn}))(Ud),Md="/home/adrian/work/lms/frontend/src/components/InfoComments/Comments.jsx";class Bd extends g.exports.Component{render(){const i=this.props,{items:e,articleId:s}=i,a=oe(i,["items","articleId"]);return t(Pe,y(m({},a),{id:`comments-popover__${s}`,children:n(Pe.Content,{children:[t(ns,{new:!0,showHr:!0,onSave:(r,d)=>{this.props.onComment(s,r,d)}}),e.length===0?"There is nothing here yet.":e.map((r,d)=>g.exports.createElement(ns,y(m({},r),{showHr:d!==e.length-1&&e.length-1!==0,onSave:c=>{this.props.onEdit(d,c)},onDelete:()=>{this.props.onDelete(d)},key:r._id,__self:this,__source:{fileName:Md,lineNumber:22,columnNumber:31}})))]})}))}}class Gd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{comments:[]});o(this,"handleDelete",async e=>{const{props:{articleType:s},state:{comments:a}}=this,i=a[e],{success:r,message:d}=await C("DELETE",`/users/${s}/comments/${i._id}`);a.splice(e,1),this.setState({comments:a},()=>{this.props.setGlobalAlert({type:r?"success":"error",message:d})})});o(this,"handleEdit",async(e,s)=>{const{props:{articleType:a},state:{comments:i}}=this,r=i[e],{success:d,message:c,response:h}=await C("PUT",`/users/${a}/comments/${r._id}`,{text:s});i[e]=y(m({},r),{message:h.message}),this.setState({comments:i},()=>{this.props.setGlobalAlert({type:d?"success":"error",message:c})})});o(this,"handleComment",async(e,s,a)=>{const{props:{articleType:i},state:{comments:r}}=this,{response:d,success:c,message:h}=await C("POST",`/users/${i}/${e}/comments`,{text:s});r.unshift(d),this.setState({comments:r},()=>{this.props.setGlobalAlert({type:c?"success":"error",message:h}),a()})})}async componentDidMount(){const{articleId:e,articleType:s}=this.props,{response:a,success:i}=await C("GET",`/users/${s}/${e}/comments`);i&&this.setState({comments:a})}render(){const{state:{comments:e},props:{articleId:s}}=this;return t("div",{className:`info-comments${e.length!==0?" info-comments__active":""}`,children:t(U,{trigger:"click",placement:"left",rootClose:!0,overlay:t(Bd,{onDelete:this.handleDelete,onEdit:this.handleEdit,onComment:this.handleComment,items:e,articleId:s}),children:t(I,{icon:oo})})})}}var rs=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Gd);class et extends g.exports.Component{render(){const{children:e,tabs:s}=this.props;return t(dn,{mountOnEnter:!0,unmountOnExit:!0,children:e&&e.length!==0?g.exports.Children.map(e,a=>{const{tabTitle:i,hidden:r}=a.props,d=i.toLowerCase().replace(" ","-");if(!r)return t(dt,{eventKey:d,title:i,children:a},d)}):s.map(a=>{const{tabTitle:i,TabComponent:r}=a,d=i.toLowerCase().replace(" ","-");return t(dt,{eventKey:d,title:i,children:t(r,{docId:this.props.docId,user:this.props.user})},d)})})}}class Sn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{preview:""});o(this,"handleDownload",()=>{const e=new lo("p","px","a4"),{attempt:s}=this.props,a=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),r=9,d="#f5fafd",c="#eafaf5",h="#2fcca1",p="#ffbb69",u="#fff",b="#000",v=s.answers.reduce((O,F,G)=>(s.questions[G].correctOptionIdx===F&&O++,O),0),S=`You have scored ${Math.round(v/s.questions.length*100)} % (${v}/${s.questions.length}) in ${qe(s.spentTime*6e4,{round:!0})}`;e.setFillColor(d),e.rect(0,0,a,r*3.6,"F"),e.setFontSize(r*1.4),e.setFont("helvetica","bold"),e.text(`Attempt #${s._id.toUpperCase()} answers`,r*1.2,r*2.1),e.setFontSize(r),e.setFont("helvetica","normal");const{w:_}=e.getTextDimensions(S);e.text(S,a-_-r*1.2,r*2.1);let k=r*5.6;for(const O in s.questions){e.setFontSize(r*1.2);const F=s.questions[O],G=e.splitTextToSize(`${parseInt(O)+1}. ${F.title}`,a-r*6),{h:q}=e.getTextDimensions(G);e.setFont("helvetica","bold"),e.text(G,r*1.2,k),k+=q+r*1.2;for(const ve in F.options){e.setFontSize(r*1);let Le=e.splitTextToSize(F.options[ve]+(s.answers[O]==ve?" - Your answer":""),a-r*10);const{h:Ee}=e.getTextDimensions(Le);if(F.correctOptionIdx==ve){e.setFillColor(c),e.rect(r,k-10,a-r*2,Ee+9,"F");const $e="Correct answer",{w:He}=e.getTextDimensions($e);e.setFont("helvetica","bold"),e.text($e,a-r*2.4-He,k)}e.setFillColor(u),e.setDrawColor(b),e.setLineWidth(.6),e.circle(r*2,k-2.5,r*.36,"DF"),s.answers[O]==ve&&(e.setFillColor(b),e.circle(r*2,k-2.5,r*.22,"F")),e.setFont("helvetica","normal"),e.text(Le,r*3,k),k+=Ee+r}const j=s.answers[O]===F.correctOptionIdx?"Correct answer!":"Wrong answer",Y=e.splitTextToSize(s.answers[O]===F.correctOptionIdx?F.msgIfCorrect:F.msgIfWrong,a-r*2.7),{h:ee}=e.getTextDimensions(j),{h:me}=e.getTextDimensions(Y),ye=ee+me+r*2;e.setFillColor(d),e.rect(r,k,a-r*2,ye,"F"),e.setFillColor(s.answers[O]===F.correctOptionIdx?h:p),e.rect(r,k,3,ye,"F"),e.setFont("helvetica","bold"),e.text(j,r*1.4+3,k+r*1.2),e.setFont("helvetica","normal"),e.text(Y,r*1.4+3,k+r*1.8+ee),k+=ye+r*2,k>i-140&&(k=20,e.addPage())}e.save(`attempt-${s._id}.pdf`)})}render(){return t(L,{className:"bd mr-2",onClick:this.handleDownload,children:"Download"})}}const Te=({condition:l,wrapper:e,children:s})=>l?e(s):s;class Rt extends g.exports.Component{render(){const{title:e,options:s,answer:a,prepend:i,onAnswer:r}=this.props,d=e.split("___").reduce((c,h,p)=>(p===0&&i&&c.push(i),c.push(n(z.Fragment,{children:[" ",h]},`question-part-${p}`)),p===0&&c.push(n("select",{value:a,onChange:r?u=>{r(u.target.value)}:void 0,children:[t("option",{value:-1}),s.map((u,b)=>t("option",{value:b,children:u},b))]},"question-select")),c),[]);return t("div",{className:"fillGapQuestion",children:d})}}class Je extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showTimeOut:!1,showLeave:!1});o(this,"handleTimeout",()=>{this.setState({showTimeout:!0})});o(this,"toggleLeave",()=>{this.setState({showLeave:!this.state.showLeave})});o(this,"paddingZero",e=>e.toString().length===1?`0${e}`:e);o(this,"handlePause",()=>{this.props.onPause(),this.toggleLeave()})}componentDidMount(){this.props.timeLimit<Date.now()&&this.handleTimeout()}rand(e){return e[e.length*Math.random()|0]}render(){var a;const{props:e}=this,s=e.answers.reduce((i,r,d)=>(e.questions[d].correctOptionIdx===r&&i++,i),0);return t("div",{className:e.exam?"questions-modal":"",children:n(Te,{condition:!e.exam,wrapper:i=>t(N,{className:"questions-modal",onHide:e.readOnly?e.onHide:()=>{},show:!!e.title,size:"xl",children:i}),children:[!e.exam&&e.title&&n(N.Title,{children:[e.readOnly&&t("b",{children:"Your last attempt's anwers\xA0-\xA0"}),e.title]}),t(N.Body,{children:t("div",{children:e.questions.map((i,r)=>t(A,{className:"pt-0 pb-2",children:n(x,{children:[i.title.includes("___")?t(Rt,y(m({},i),{answer:e.answers[r],prepend:`${r+1}. `,onAnswer:this.props.readOnly?null:d=>e.onAnswer(r,d)})):n(E,{children:[n(f.Label,{className:"pb-2",children:[r+1,". ",i.title]}),i.options.map((d,c)=>{var h;return t(f.Check,{id:`Q${r}A${c}`,type:"radio",name:d.title,label:d,className:{"questions-modal--option":!0,"questions-modal--option__valid":c===((h=e.questions[r])==null?void 0:h.correctOptionIdx)&&e.readOnly,"questions-modal--option__chosen":e.answers[r]===c&&e.readOnly},onChange:this.props.readOnly?null:()=>e.onAnswer(r,c),readOnly:e.readOnly,checked:e.answers[r]===c},c)})]}),e.readOnly&&n(ke,{variant:e.answers[r]===(i==null?void 0:i.correctOptionIdx)?"success":"warning",children:[t(ke.Heading,{children:e.answers[r]===(i==null?void 0:i.correctOptionIdx)?"Correct answer!":"Wrong answer"}),t("div",{children:e.answers[r]===(i==null?void 0:i.correctOptionIdx)?i.msgIfCorrect:i.msgIfWrong})]}),t("hr",{})]})},r))})}),n(N.Footer,{children:[t("div",{children:e.error&&t(ke,{variant:"warning",children:e.error})}),n("div",{children:[t("div",{children:e.readOnly?[t("span",{children:"You have scored "},"text"),Math.round(s/e.questions.length*100)+`% (${s}/${e.questions.length}) in ${qe(((a=e.attempt)==null?void 0:a.spentTime)*6e4,{round:!0})}`]:n("div",{children:[t("span",{children:"You have answered "}),this.props.answers.filter(i=>i!==null).length," /\xA0",this.props.questions.length]})}),!e.readOnly&&n("div",{children:[t("span",{children:"Time remaining:\xA0"}),t($t,{date:e.timeLimit,onComplete:this.handleTimeout,renderer:({hours:i,minutes:r,seconds:d,completed:c})=>n("span",{children:[this.paddingZero(i),":",this.paddingZero(r),":",this.paddingZero(d)]})})]}),e.readOnly?n("div",{children:[t(Sn,{attempt:this.props.attempt}),t(L,{className:"bd",onClick:e.onHide,children:"Close"})]}):n("div",{className:"qm-buttons",children:[!e.exam&&t("span",{onClick:this.toggleLeave,children:"Leave"}),t(Te,{condition:e.answers.filter(i=>i!==null).length!==e.questions.length&&!e.allowSkip||e.questions.length!==e.answers.length,wrapper:i=>t(U,{overlay:t(M,{id:"tooltip-submit",children:"You must answer all questions"}),children:i}),children:t(L,{className:{bp:e.questions.length===e.answers.length,bd:e.answers.filter(i=>i!==null).length!==e.questions.length&&!e.allowSkip||e.questions.length!==e.answers.length},onClick:i=>{e.answers.filter(r=>r!==null).length!==e.questions.length&&!e.allowSkip||e.questions.length!==e.answers.length?i.preventDefault():this.props.onSubmit()},children:"Submit"})})]})]})]}),n(N,{className:"qm-timeout",show:this.state.showTimeout,onHide:()=>{},children:[t(N.Body,{children:t("center",{children:"Your time has expired"})}),t(N.Footer,{children:t(L,{className:"bp",onClick:e.onSubmit,children:"Submit"})})]}),n(N,{className:"qm-leave",show:this.state.showLeave,onHide:()=>{},children:[t(N.Body,{children:t("center",{children:"You are about to leave an ongoing quiz, are you sure you want to proceed?"})}),n(N.Footer,{children:[t(Te,{condition:!e.answers.length,wrapper:i=>t(U,{overlay:t(M,{id:"tooltip-submit",children:"You must answer at least one question to be able to resume later"}),children:i}),children:t(L,{className:`${e.answers.length?"bp":"bd"} mr-auto`,onClick:i=>{e.answers.length?this.handlePause():i.preventDefault()},children:"Save & resume later"})}),t(L,{className:"bd",onClick:this.toggleLeave,children:"Cancel"})]})]})]})})}}class Ft extends g.exports.Component{render(){return n(w,{children:[t("h3",{className:"last-attempts__heading",children:"Past attempts"}),t("div",{className:"last-attempts__items",children:this.props.items.map(e=>{var i,r,d,c;const s=e.answers.reduce((h,p,u)=>(p===e.questions[u].correctOptionIdx&&h++,h),0),a=e.questions.length;return n("div",{className:`last-attempts__item${e.status?e.status==="FAIL"?" last-attempts__item--fail":" last-attempts__item--success":""}`,children:[t("h6",{children:((i=e==null?void 0:e.pausedAt)==null?void 0:i.length)===((r=e==null?void 0:e.startedAt)==null?void 0:r.length)&&!e.status?"Saved":e.status==="FAIL"?"Failed":"Passed"}),n("span",{className:"last-attempts__item__date",children:[new Date(e.startedAt[0]).toLocaleDateString("en-US"),"\xA0",new Date(e.startedAt[0]).toLocaleTimeString("en-US")]}),!!e.status&&t(U,{overlay:t(M,{id:`tooltip-${e._id}-qr`,children:"Your answers rating"}),children:n("div",{className:"last-attempts__item__rating",children:[Math.round(s/a*100),"%"]})}),!!e.status&&t(U,{overlay:t(M,{id:`tooltip-${e._id}-qt`,children:"# correct / # total"}),children:n("div",{className:"last-attempts__item__answers",children:[s," / ",a]})}),n("div",{className:"last-attempts__item__buttons",children:[!e.status&&((d=e==null?void 0:e.startedAt)==null?void 0:d.length)===((c=e==null?void 0:e.pausedAt)==null?void 0:c.length)&&(this.props.onResume?t(L,{className:"bp",onClick:this.props.onResume,children:"Resume"}):"Paused"),!!e.status&&t(L,{onClick:()=>{this.props.onItemClick(e)},className:"bd",children:"Review"}),!!e.status&&t(Sn,{attempt:e,children:"Download"})]})]},e._id)})})]})}}const pe=z.createContext({});class In extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showTimeout:!1,showLeave:!1});o(this,"toggleLeave",()=>{this.setState({showLeave:!this.state.showLeave})});o(this,"handlePause",()=>{this.props.onPause(),this.context.setCardsQuizState({isInQuiz:!1}),this.toggleLeave()});o(this,"handleTimeout",()=>{this.setState({showTimeout:!0})});o(this,"handleAnswer",(e,s)=>{let{answerInc:a=0,answers:i}=this.context.cardsQuiz;typeof i[e]!="number"&&a++,i[e]=s,this.context.setCardsQuizState({answerInc:a,answers:i}),this.props.onAnswer(e,s)})}componentDidMount(){const{questions:e,timeLimit:s,allowSkip:a,answers:i,onSubmit:r}=this.props;s<Date.now()&&this.handleTimeout(),this.context.setCardsQuizState({allowSkip:a,answers:i,onSubmit:r,isInQuiz:!0,questionsLength:e.length,questionIndex:0})}componentDidUpdate(e){if(this.props.quizId!==e.quizId){const{questions:s,allowSkip:a,answers:i}=this.props;this.context.setCardsQuizState({allowSkip:a,answers:i,isInQuiz:!0,questionsLength:s.length,questionIndex:0})}}render(){const{questions:e,answers:s,timeLimit:a,onSubmit:i}=this.props,{showTimeout:r,showLeave:d}=this.state,{questionIndex:c=0}=this.context.cardsQuiz,h=e[c];return n(w,{children:[n("div",{className:"cards-quiz",children:[n("header",{children:[n("div",{className:"cards-quiz__tracker",children:[t("span",{children:"You have answered "}),t("strong",{children:s.filter(p=>p!==null).length})," / ",e.length]}),n("div",{className:"cards-quiz__timer",children:[t("div",{className:"bd",onClick:this.toggleLeave,children:"Leave"}),t("span",{children:"Time remaining:\xA0"}),t($t,{date:a,onComplete:this.handleTimeout,renderer:({hours:p,minutes:u,seconds:b,completed:v})=>n("span",{children:[p.toString().padStart(2,"0"),":",u.toString().padStart(2,"0"),":",b.toString().padStart(2,"0")]})})]})]}),t("div",{children:h.title.includes("___")?t(Rt,y(m({},h),{answer:s[c],prepend:`${c+1}. `,onAnswer:p=>this.handleAnswer(c,p)})):n(E,{children:[n(f.Label,{className:"pb-2",children:[c+1,". ",h.title]}),h.options.map((p,u)=>t(f.Check,{id:`Q${c}A${u}`,type:"radio",name:p.title,label:p,className:"cards-quiz--option",onChange:()=>this.handleAnswer(c,u),checked:s[c]===u},u))]})})]}),n(N,{className:"qm-timeout",show:r,onHide:()=>{},children:[t(N.Body,{children:t("center",{children:"Your time has expired"})}),t(N.Footer,{children:t(L,{className:"bp",onClick:i,children:"Submit"})})]}),n(N,{className:"qm-leave",show:d,onHide:()=>{},children:[t(N.Body,{children:t("center",{children:"You are about to leave an ongoing quiz, are you sure you want to proceed?"})}),n(N.Footer,{children:[t(Te,{condition:!s.length,wrapper:p=>t(U,{overlay:t(M,{id:"tooltip-submit",children:"You must answer at least one question to be able to resume later"}),children:p}),children:t(L,{className:`${s.length?"bp":"bd"} mr-auto`,onClick:p=>{s.length?this.handlePause():p.preventDefault()},children:"Save & resume later"})}),t(L,{className:"bd",onClick:this.toggleLeave,children:"Cancel"})]})]})]})}}o(In,"contextType",pe);class wn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{lastAttempts:[],showLastAttempts:!1,current:{pausedAt:[],startedAt:[]},showQuiz:!1,message:null,modalError:"",attemptToShow:null,showAbandon:!1,stickyLastAttempts:!1});o(this,"initSocketEvents",()=>{window.socket.on("quiz started",e=>{this.setState({current:y(m({},this.state.current),{startedAt:e}),showQuiz:!0,modalError:""}),this.context.unlockNextLesson==="ON_QUIZ_START"&&!this.context.nextLesson.unlocked&&this.context.unlockNextLessonFn(),this.setLeaveWarning()}),window.socket.on("quiz paused",e=>{this.setState({current:y(m({},this.state.current),{pausedAt:e}),showQuiz:!1}),this.unsetLeaveWarning()}),window.socket.on("quiz resumed",e=>{this.setState({current:y(m({},this.state.current),{startedAt:e}),modalError:"",showQuiz:!0}),this.setLeaveWarning()}),window.socket.on("quiz canceled",e=>{this.setState(y(m({},e.data),{showQuiz:!0}),this.handleAttempt)}),window.socket.on("quiz submited",async e=>{if(e.success){const s=e.data.lastAttempts[0].status==="SUCCESS";this.setState(y(m({},e.data),{message:s?{type:"success",text:`You can continue with the course or practice a little more.
                                  To continue please click on the "NEXT" button.`}:null,showQuiz:!1})),s&&this.context.unlockNextLesson==="ON_QUIZ_PASS"&&!this.context.completed&&this.context.unlockNextLessonFn(),this.context.unlockNextLesson==="ON_QUIZ_END"&&!this.context.completed&&this.context.unlockNextLessonFn(),this.unsetLeaveWarning()}else this.setState({modalError:e.message})})});o(this,"showAbandonOptions",()=>{this.setState({showAbandon:!this.state.showAbandon})});o(this,"setLeaveWarning",()=>{window.addEventListener("beforeunload",this.leaveWarningCallback)});o(this,"unsetLeaveWarning",()=>{window.removeEventListener("beforeunload",this.leaveWarningCallback)});o(this,"checkAnswer",async(e,s)=>{const{success:a,response:i}=await C("GET",`/users/chapters/quiz/${this.state.current._id}/answer/${e}/${s}`);if(a){let r=this.state.current.answers;r[e]=s,this.setState({marks:this.state.marks+i.marks,current:y(m({},this.state.current),{answers:r,spentTime:i.spentTime})})}});o(this,"handleCancel",async()=>{var e;window.socket.emit("cancel quiz",(e=this.state.current)==null?void 0:e._id,this.context.endOfChapterQuizId,this.props.match.params.lessonId)});o(this,"handlePause",async()=>{var e;window.socket.emit("pause quiz",(e=this.state.current)==null?void 0:e._id)});o(this,"handleResume",async()=>{var e;window.socket.emit("resume quiz",(e=this.state.current)==null?void 0:e._id)});o(this,"handleAttempt",async()=>{var e;window.socket.emit("start quiz",(e=this.state.current)==null?void 0:e._id)});o(this,"handleSubmit",async()=>{var e;window.socket.emit("submit quiz",{quizId:(e=this.state.current)==null?void 0:e._id,lessonId:this.props.match.params.lessonId,endOfChapterQuizId:this.context.endOfChapterQuizId})});o(this,"hideLastAttempt",()=>{this.setState({attemptToShow:null})});o(this,"setAttemptToShow",e=>{this.setState({attemptToShow:e})});o(this,"handleScroll",e=>{e.target.scrollTop>337?this.setState({stickyLastAttempts:!0}):this.setState({stickyLastAttempts:!1})})}async componentDidMount(){var i,r,d,c,h,p,u,b,v,S;const{success:e,response:s,message:a}=await C("GET",`/users/lessons/${this.props.match.params.lessonId}/quiz?quizId=${this.context.endOfChapterQuizId}`);if(e){const _=s.lastAttempts.findIndex(k=>k.status==="SUCCESS")!==-1;this.setState(y(m({},s),{message:s.lastAttempts[0]&&_?{type:"success",text:`You can continue with the course or practice a little more.
                              To continue please click on the "NEXT" button.`}:null,showQuiz:!!((r=(i=s.current)==null?void 0:i.startedAt)!=null&&r.length)&&!((c=(d=s.current)==null?void 0:d.pausedAt)!=null&&c.length)||!!((p=(h=s.current)==null?void 0:h.startedAt)!=null&&p.length)&&((b=(u=s.current)==null?void 0:u.pausedAt)==null?void 0:b.length)<((S=(v=s.current)==null?void 0:v.startedAt)==null?void 0:S.length)}))}this.initSocketEvents()}leaveWarningCallback(e){const s=e||window.event;s.returnValue="",s.preventDefault()}render(){var r,d,c,h,p,u,b,v,S,_,k,O,F,G,q;let{current:e,lastAttempts:s,stickyLastAttempts:a}=this.state,{lessonLayout:i}=this.props;return s=e.pausedAt[0]?[e,...s]:s,n("div",{className:`lesson-cards__endofchapter-quiz-type${a?" lesson-cards__endofchapter-quiz-type--stickyLastAttempts":""}`,onScroll:this.handleScroll,children:[n("div",{className:"quiz__info",children:[t("h4",{children:t("b",{children:(d=e==null?void 0:e.title)!=null?d:(r=s[0])==null?void 0:r.title})}),this.state.message&&n("div",{className:`quiz__alert quiz__alert--${this.state.message.type}`,children:[t("h6",{children:"Passed"}),t("span",{children:this.state.message.text})]}),n("div",{className:"quiz__footer",children:[n("div",{className:"quiz__data",children:[n("p",{children:["Number of questions: ",(u=(c=e==null?void 0:e.questions)==null?void 0:c.length)!=null?u:(p=(h=s[0])==null?void 0:h.questions)==null?void 0:p.length]}),n("p",{children:["Passing percentage: ",(v=e==null?void 0:e.passPct)!=null?v:(b=s[0])==null?void 0:b.passPct,"%"]}),n("p",{children:["Time limit:\xA0",je(((_=e==null?void 0:e.timeLimit)!=null?_:(S=s[0])==null?void 0:S.timeLimit)*6e4)]})]}),t(L,{className:"bp",onClick:!e.status&&e.pausedAt.length===e.startedAt.length&&e.startedAt.length!==0?this.showAbandonOptions:this.handleAttempt,children:"Start new quiz"})]})]}),!!s[0]&&t(Ft,{items:s,onResume:this.handleResume,onItemClick:this.setAttemptToShow}),e&&((k=e==null?void 0:e.startedAt)==null?void 0:k.length)>((O=e==null?void 0:e.pausedAt)==null?void 0:O.length)&&(i==="card"?t(In,{quizId:this.context.endOfChapterQuizId,questions:e==null?void 0:e.questions,answers:e==null?void 0:e.answers,timeLimit:new Date().getTime()+(e.timeLimit-e.spentTime)*6e4,allowSkip:e==null?void 0:e.allowSkip,onAnswer:this.checkAnswer,onSubmit:this.handleSubmit,onPause:this.handlePause}):t(Je,{show:this.state.showQuiz,title:e==null?void 0:e.title,questions:e==null?void 0:e.questions,answers:e==null?void 0:e.answers,error:this.state.modalError,timeLimit:new Date().getTime()+(e.timeLimit-e.spentTime)*6e4,allowSkip:e==null?void 0:e.allowSkip,onAnswer:this.checkAnswer,onSubmit:this.handleSubmit,onPause:this.handlePause})),this.state.attemptToShow&&t(Je,{show:!!this.state.attemptToShow,onHide:this.hideLastAttempt,questions:(F=this.state.attemptToShow)==null?void 0:F.questions,title:(G=this.state.attemptToShow)==null?void 0:G.title,answers:(q=this.state.attemptToShow)==null?void 0:q.answers,attempt:this.state.attemptToShow,readOnly:!0}),n(N,{show:this.state.showAbandon,onHide:this.showAbandonOptions,children:[t(N.Body,{children:"Are you sure you want to abandon your previous attempt?"}),n(N.Footer,{className:"d-flex",children:[t(L,{className:"bd mb-0",onClick:()=>{this.handleCancel(),this.showAbandonOptions()},children:"Yes, start a new quiz"}),t(L,{className:"bp ml-auto mb-0",onClick:()=>{this.handleResume(),this.showAbandonOptions()},children:"No, resume previous attempt"})]})]})]})}}o(wn,"contextType",pe);var Hd=D(wn);class qd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{lastAttempts:[],attemptToShow:null,showAttempts:!1});o(this,"setAttemptToShow",e=>{this.setState({attemptToShow:e})});o(this,"hideLastAttempt",()=>{this.setState({attemptToShow:null})});o(this,"loadAttempts",async()=>{const{success:e,response:s}=await C("GET",`/users/lessons/${this.props.lessonId}/quiz`);e?this.setState({lastAttempts:s.lastAttempts}):this.props.setGlobalAlert({type:"error",message:"Failed to load user quiz attempts"})});o(this,"toggleShowAttempts",async()=>{this.state.lastAttempts[0]||await this.loadAttempts(),this.setState({showAttempts:!this.state.showAttempts})})}render(){const{lastAttempts:e,attemptToShow:s,showAttempts:a}=this.state;return n(w,{children:[t(L,{size:"sm",className:this.props.buttonClassName,onClick:this.toggleShowAttempts,children:"Attempts"}),n(N,{size:"lg",show:a,className:"course-progress__last-attempts",onHide:this.toggleShowAttempts,children:[t(N.Header,{closeButton:!0,children:t("h3",{children:"User past attempts"})}),t(N.Body,{children:e[0]?t("div",{className:"last-attempts",children:t(Ft,{items:e,onItemClick:this.setAttemptToShow})}):"User did not attempt to take the quiz yet"})]}),s&&t(Je,{show:!!s,onHide:this.hideLastAttempt,questions:s==null?void 0:s.questions,title:s==null?void 0:s.title,answers:s==null?void 0:s.answers,attempt:s,readOnly:!0})]})}}var zd=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(qd);class Vd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{chapters:[],checkedChapters:new Set,checkedLessons:new Set,bulkAction:"",updatedAt:"",lessonChapters:{},userCourse:null,modalShow:!1});o(this,"allLessons",new Set);o(this,"loadData",async()=>{const{courseId:e}=this.props,{success:s,response:a}=await C("GET",`/users/courses/${e}/chapters/admin`);s&&(this.allLessons=new Set,a.chapters.map(i=>this[`ref-${i._id}`]=z.createRef()),this.setState({chapters:a.chapters,userCourse:a.userCourse}))});o(this,"handleSelectAll",e=>{e.target.checked?this.setState({checkedChapters:new Set(this.state.chapters.map(s=>s._id)),checkedLessons:new Set(this.allLessons)}):this.setState({checkedChapters:new Set,checkedLessons:new Set})});o(this,"handleChapterCheck",e=>{const{checkedChapters:s,checkedLessons:a}=this.state,i=e.target;let r=i.parentElement.parentElement.querySelectorAll('input[type="checkbox"][name^="lesson"]');r.length&&(r=[...r]),i.checked?(s.add(i.dataset.id),r.map(d=>a.add(d.dataset.id))):(s.delete(i.dataset.id,1),r.map(d=>a.delete(d.dataset.id))),this.setState({checkedChapters:s,checkedLessons:a})});o(this,"handleLessonCheck",e=>{const{checkedLessons:s}=this.state,a=e.target;a.checked?s.add(a.dataset.id):s.delete(a.dataset.id),this.setState({checkedLessons:s})});o(this,"handleActionSelect",e=>{this.setState({bulkAction:e.target.value})});o(this,"submitAction",async()=>{const{state:{bulkAction:e,checkedChapters:s,checkedLessons:a},props:{courseId:i}}=this,{success:r,message:d}=await C("POST",`/users/courses/${i}/many/${e}`,{chapters:Array.from(s),lessons:Array.from(a)});this.props.setGlobalAlert({type:r?"success":"error",message:d}),this.setState({checkedChapters:new Set,checkedLessons:new Set},this.loadData)});o(this,"handleSubmit",async e=>{e.preventDefault();const{bulkAction:s}=this.state;s==="reset"?this.setState({modalShow:!0}):s&&this.submitAction()});o(this,"scrollingParent",e=>e==null?null:e.scrollHeight-1>e.clientHeight||getComputedStyle(e).getPropertyValue("overflow-y")==="scroll"?e:this.scrollingParent(e.parentNode))}async componentDidMount(){await this.loadData()}render(){const{chapters:e,checkedChapters:s,checkedLessons:a,bulkAction:i,userCourse:r}=this.state;return r?n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:()=>{this.submitAction(),this.setState({modalShow:!1})},titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:"erase"},"modal-type")," all user progress."]}),n("form",{onSubmit:this.handleSubmit,children:[n("div",{className:"bulk-actions",children:[n("label",{htmlFor:"selectAll",children:[t("input",{type:"checkbox",name:"selectAll",id:"selectAll",onChange:this.handleSelectAll,checked:s.size===e.length&&a.size===this.allLessons.size}),"\xA0 Select all"]}),n(f.Control,{as:"select",onChange:this.handleActionSelect,children:[t("option",{value:"",children:"Bulk action"}),t("option",{value:"unlock",children:"Unlock selected"}),t("option",{value:"complete",children:"Complete selected"}),t("option",{value:"lock",children:"Lock selected"}),t("option",{value:"reset",children:"Reset selected"})]}),t(L,{className:"bd",type:"submit",disabled:s.size===0&&a.size===0||!i,children:"Update"})]}),t(T,{className:"table-tree",defaultActiveKey:(r==null?void 0:r.lastChapterId)||"",children:e.map(d=>n(B,{children:[n(B.Header,{children:[t("input",{type:"checkbox",name:`chapter-${d._id}`,"data-id":d._id,onChange:this.handleChapterCheck,checked:s.has(d._id)}),t(T.Toggle,{as:"span",eventKey:d._id,children:d.title})]}),t(T.Collapse,{eventKey:d._id,children:t(B.Body,{children:t(Me,{minTableWidth:"1300px",rows:d==null?void 0:d.lessons,columns:[{text:"",field:c=>(this.allLessons.add(c._id),t("input",{type:"checkbox",name:`lesson-${c._id}`,"data-id":c._id,onChange:this.handleLessonCheck,checked:this.state.checkedLessons.has(c._id)})),maxWidth:"1.5rem"},{text:"Lesson Name (Progress Time)",field:c=>n(w,{children:[t(U,{placement:"right",overlay:t(M,{id:`ltt-${c._id}`,children:c.title}),children:t("span",{children:c.title})}),n("div",{children:["\xA0(",new Date(c.maxTime*6e4).toISOString().substr(11,8),")"]})]}),minWidth:"30rem",className:"limitTitle"},{text:"Status",field:c=>c._id===this.state.userCourse.lastLessonId?n("div",{className:"alignIconCenter",children:[t(I,{icon:ut}),"\xA0Active"]}):c.completed?n("div",{className:"alignIconCenter",children:[t(I,{icon:se}),"\xA0Complete"]}):c.unlocked?n("div",{className:"alignIconCenter",children:[t(I,{icon:co}),"\xA0Unlocked"]}):n("div",{className:"alignIconCenter",children:[t(I,{icon:ho}),"\xA0Locked"]}),minWidth:"10rem"},{text:"Time spent",field:c=>{var u;const h=(u=c==null?void 0:c.enteredAt)==null?void 0:u.length,p=Array.isArray(c.enteredAt)?c.enteredAt.reduce((b,v,S)=>{const _=new Date(v);return b+=(S===h-1&&(!c.leftAt||!c.leftAt[S])?new Date:new Date(c.leftAt[S])).getTime()-_.getTime(),b},0):0;return new Date(Number.isNaN(p)?0:p).toISOString().substr(11,8)},minWidth:"10rem"},{text:"Completed at",field:c=>c.completed?new Date(c.completed).toLocaleString("en-US"):"-",minWidth:"15rem"},{text:"Assessment",className:"col--flex",field:c=>c.isQuiz?t(zd,{lessonId:c._id,buttonClassName:c.currentTime>0?"bp":"bd"}):"-",minWidth:"10rem"}]})})})]},d._id))})]})]}):t("div",{children:t(Q,{})})}}var Qd=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Vd);function Wd(){const l=g.exports.useContext(Ae);return t("span",{className:"pull-right",style:{cursor:"pointer"},children:t(I,{className:"float-right",style:{fontSize:"20px"},icon:l?mt:gt})})}class Kd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{userCourse:null});o(this,"inputTypeMap",{text:"text",number:"number",date:"date",file:"url",typeDNA:"text",textarea:"textarea",options:"select",checkbox:"checkbox",radio:"radio"});o(this,"accordionKeyMap",{enrollment:{title:"Enrollment"},preExam:{title:"Pre Exam"},postExam:{title:"Post Exam"}});o(this,"componentDidMount",async()=>{const{success:e,response:s}=await C("GET",`/users/courses/${this.props.doc._id}/admin`);if(e&&s){let a=m({},s[0]);Object.keys(this.accordionKeyMap).map(i=>{a[i+"UpdatedAt"]=s[0][i+"UpdatedAt"]?new Date(s[0][i+"UpdatedAt"]).toLocaleDateString("en-US")+" "+new Date(s[0][i+"UpdatedAt"]).toLocaleTimeString("en-US"):"-"}),this.setState({userCourse:a})}});o(this,"toggleFieldEditable",(e,s,a)=>{this.setState({userCourse:y(m({},this.state.userCourse),{[s+"Form"]:y(m({},this.state.userCourse[s+"Form"]),{fields:this.state.userCourse[s+"Form"].fields.map((i,r)=>(e===i._id&&(i.editable=a),i))})})})});o(this,"handleAnswerSave",async(e,s,a)=>{const{success:i,response:r}=await C("PUT",`/users/enrollment/${this.state.userCourse._id}/${s.key}`,{value:a});i&&this.toggleFieldEditable(s._id,e,!1)});o(this,"handleAnswerChange",(e,s,a,i)=>{this.setState({userCourse:y(m({},this.state.userCourse),{[e+"Form"]:y(m({},s),{answers:y(m({},s.answers),{[a]:i})})})})});o(this,"handleMulticheckboxChange",(e,s,a,i,r)=>{let d=s.answers[a];d||(d=[]),d=[...d],r?d.push(i):d=d.filter(c=>c!==i),this.handleAnswerChange(e,s,a,d)})}render(){return t("div",{className:"pt-3",children:Object.keys(this.accordionKeyMap).map(e=>{var s,a,i;return t(T,{defaultActiveKey:null,className:"py-2",children:n(B,{children:[t(T.Toggle,{as:B.Header,eventKey:"0",style:{backgroundColor:"#dcf5ee"},children:n(A,{children:[t(x,{xs:8,style:{fontWeight:"bold"},children:this.accordionKeyMap[e].title}),t(x,{xs:3,children:this.state.userCourse&&this.state.userCourse[e+"UpdatedAt"]!=="-"?t("div",{className:"float-right",children:n("span",{children:[t("strong",{children:"Completed: "}),this.state.userCourse?this.state.userCourse[e+"UpdatedAt"]:"-"]})}):t(w,{})}),t(x,{xs:1,children:t(T.Toggle,{as:Wd,className:"mx-1",eventKey:"1"})})]})}),t(T.Collapse,{eventKey:"0",children:t(B.Body,{children:this.state.userCourse&&this.state.userCourse[e+"Form"]?t(Me,{columns:[{text:"Field",field:"label"},{text:"Value",field:r=>{const d=this.inputTypeMap[r.inputType],c=this.state.userCourse[e+"Form"],h=c.answers[r.key];return r.editable&&d&&d!=="url"?d==="textarea"?t("textarea",{value:h,onChange:p=>{this.handleAnswerChange(e,c,r.key,p.target.value)}}):d==="select"?t("select",{className:"form-control",value:h,onChange:p=>{this.handleAnswerChange(e,c,r.key,p.target.value)},children:r.extra.options.map((p,u)=>t("option",{value:p,children:p},`${r.key}-${u}`))}):d==="checkbox"?t("div",{children:r.extra.options.map((p,u)=>t(f.Check,{type:"checkbox",label:p,checked:h.indexOf(p)>=0,onChange:b=>{this.handleMulticheckboxChange(e,c,r.key,p,b.target.checked)}},`${r.key}-${u}`))}):d==="radio"?t("div",{children:r.extra.options.map((p,u)=>t(f.Check,{type:"radio",name:r.label,label:p,checked:h===p,onChange:b=>{this.handleAnswerChange(e,c,r.key,p)}},`${r.key}-${u}`))}):t(f.Control,{type:d,value:h,onChange:p=>{this.handleAnswerChange(e,c,r.key,p.target.value)}}):d==="url"?t(yn,{fileId:h,children:"Click to download"}):t(w,{children:String(h)})}}],rows:Array.isArray((i=(a=(s=this.state)==null?void 0:s.userCourse)==null?void 0:a[e+"Form"])==null?void 0:i.fields)&&this.state.userCourse[e+"Form"].fields.filter(r=>this.inputTypeMap[r.inputType]),rowButtons:[{type:"button",text:r=>r.editable?"Save":"Edit",icon:r=>r.editable?se:J,condition:r=>{const d=this.inputTypeMap[r.inputType];return d&&d!=="url"},clickCallback:(r,d)=>{if(!d.editable)this.toggleFieldEditable(d._id,e,!0);else{const c=this.state.userCourse[e+"Form"].answers[d.key];this.handleAnswerSave(e,d,c)}}}]}):n("div",{children:[this.accordionKeyMap[e].title," has not been completed yet."]})})})]})},e)})})}}class Yd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{lastAttempts:[],attemptToShow:null,showAttempts:!1});o(this,"componentDidMount",()=>{this.loadAttempts()});o(this,"loadAttempts",async()=>{const{success:e,response:s}=await C("GET",`/users/exam/${this.props.courseId}`);e&&s&&this.setState({lastAttempts:s.lastAttempts})});o(this,"hideLastAttempt",()=>{this.setState({attemptToShow:null})})}render(){var e,s,a;return t("div",{className:"pt-3",children:this.state.lastAttempts&&this.state.lastAttempts.length?n("div",{children:[t("div",{className:"last-attempts",children:t(Ft,{items:this.state.lastAttempts,onItemClick:i=>{this.setState({attemptToShow:i})}})}),this.state.attemptToShow&&t(Je,{show:!!this.state.attemptToShow,onHide:this.hideLastAttempt,questions:(e=this.state.attemptToShow)==null?void 0:e.questions,title:(s=this.state.attemptToShow)==null?void 0:s.title,answers:(a=this.state.attemptToShow)==null?void 0:a.answers,attempt:this.state.attemptToShow,readOnly:!0})]}):"User did not attempt to take the exam yet"})}}class jd extends g.exports.Component{render(){return t("div",{className:"pt-3",children:n(et,{children:[t(Qd,{tabTitle:"Progress",courseId:this.props.course._id}),t(Kd,{tabTitle:"Forms",doc:this.props.course}),t(Yd,{tabTitle:"Exams",courseId:this.props.course._id})]})})}}var _n=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(jd));class Qe extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{focused:null});o(this,"renderMonthElement",({month:e,onMonthSelect:s,onYearSelect:a})=>n("div",{style:{display:"flex",justifyContent:"center"},children:[t("div",{children:t("select",{value:e.month(),onChange:i=>s(e,i.target.value),children:nt.months().map((i,r)=>t("option",{value:r,children:i},`${r}-${this.props.id}`))})}),t("div",{children:t("select",{value:e.year(),onChange:i=>a(e,i.target.value),children:this.returnYears()})})]}));o(this,"returnYears",()=>{let e=[];for(let s=nt().year()-100;s<=nt().year();s++)e.push(t("option",{value:s,children:s},`year-${s}`));return e})}render(){return n(w,{children:[this.props.label?t("label",{htmlFor:this.props.id,children:t("strong",{children:this.props.label?this.props.label:""})}):t(w,{}),t(po.SingleDatePicker,{required:!!this.props.required,numberOfMonths:1,showClearDate:!1,renderMonthElement:this.renderMonthElement,block:!0,isOutsideRange:()=>!1,onDateChange:e=>{e?this.props.raw||(e=e.format("YYYY-MM-DD")):e=null,this.props.handleDateChange(this.props.id,e)},onFocusChange:({focused:e})=>{this.setState({focused:e})},focused:this.state.focused,id:this.props.id,date:this.props.date?nt(this.props.date):void 0,placeholder:"MM/DD/YYYY",displayFormat:"MM/DD/YYYY",readOnly:!0})]})}}function Zd(){const l=g.exports.useContext(Ae);return t(I,{className:"float-right",style:{fontSize:"20px"},icon:l?mt:gt})}class Jd extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{userPackages:[],availablePackages:[],selectedPackageId:"",loading:!0,modalShow:!1,modalAction:null,showRefundModal:!1,refundAmount:0,showPostRefundSuspendModal:!1,showTransactionsModal:!1,showSuspendPackageModal:!1,showReactivatePackageModal:!1,showManageModal:!1,showSuspendCourseModal:!1,showReactivateCourseModal:!1,currentUserCourse:null,currentUserPackage:null,editExpiryDate:!1});o(this,"formatDate",e=>e?new Date(e).toLocaleDateString("en-US"):"-");o(this,"loadPackages",async()=>{this.setState({loading:!0});const{success:e,response:s}=await C("GET","/packages?perPage=all&publishedOnly=1"),{success:a,response:i}=await C("GET",`/users/${this.props.user._id}/packages?perPage=all`);let r=[];if(a&&i.docs){let d=!1;r=i.docs.map(async c=>{const{success:h,response:p}=await C("GET",`/users/${this.props.user._id}/packages/${c._id}/courses`);if(h&&p.courses&&p.courses.length&&(c.courses=p.courses,this.state.currentUserCourse&&!d)){for(const u of p.courses)if(u._id===this.state.currentUserCourse._id){this.setState({currentUserCourse:u}),d=!0;break}}return c}),r=await Promise.all(r)}this.setState({availablePackages:s.docs,userPackages:r,loading:!1})});o(this,"componentDidMount",async()=>{this.loadPackages()});o(this,"addPackage",async e=>{if(e.preventDefault(),this.state.selectedPackageId){this.setState({loading:!0});const{success:s,response:a}=await C("POST",`/users/${this.props.user._id}/packages/add/${this.state.selectedPackageId}`);s?(this.loadPackages(),this.props.setGlobalAlert({type:"success",message:"Package has been added"})):this.props.setGlobalAlert({type:"error",message:"There was a problem with adding this Package. Please try again"})}});o(this,"removeUserPackage",async e=>{this.setState({loading:!0});const{success:s}=await C("DELETE",`/users/${this.props.user._id}/packages/${e}`);s?(this.loadPackages(),this.props.setGlobalAlert({type:"success",message:"Package has been deleted"})):(this.props.setGlobalAlert({type:"error",message:"There was a problem with deleting this Package. Please try again"}),this.setState({loading:!1})),this.setState({modalShow:!1})});o(this,"handleRefundChange",e=>{this.setState({refundAmount:e.target.value})});o(this,"suspendUserPackage",async()=>{const{success:e,response:s}=await C("POST",`/users/packages/${this.state.currentUserPackage._id}/suspend`);e&&this.loadPackages()});o(this,"reactivateUserPackage",async()=>{const{success:e,response:s}=await C("POST",`/users/packages/${this.state.currentUserPackage._id}/reactivate`);e&&this.loadPackages()});o(this,"suspendUserCourse",async()=>{const{success:e,response:s}=await C("POST",`/users/courses/${this.state.currentUserCourse._id}/suspend`);e&&this.loadPackages()});o(this,"reactivateUserCourse",async()=>{const{success:e,response:s}=await C("POST",`/users/courses/${this.state.currentUserCourse._id}/reactivate`);e&&this.loadPackages()});o(this,"saveExpiryDate",async()=>{this.state.currentUserCourse.expiresAt&&await C("PUT",`/users/courses/${this.state.currentUserCourse._id}/expiry`,{date:this.state.currentUserCourse.expiresAt})});o(this,"handleCourseChange",(e,s,a)=>{const i=a||s.target.value;let r=y(m({},this.state.currentUserCourse),{[e]:i?new Date(i).toISOString():null}),d=this.state.userPackages.map(c=>{let h=c.courses.map(p=>p._id==this.state.currentUserCourse._id?r:p);return c.courses=h,c});this.setState({currentUserCourse:r,userPackages:d})});o(this,"closeManageModal",()=>{this.setState({showManageModal:!1}),window.socket.emit("clear admin editing")});o(this,"resetUserPackage",async(e,s)=>{this.setState({loading:!0});const{success:a}=await C("PATCH",`/users/${this.props.user._id}/packages/${e}/reset`,{packageId:s});a?(this.loadPackages(),this.props.setGlobalAlert({type:"success",message:"Package has been reset"})):(this.props.setGlobalAlert({type:"error",message:"There was a problem with reseting this Package. Please try again"}),this.setState({loading:!1}))})}selectPackage(e){this.setState({selectedPackageId:e.target.value})}render(){var e,s,a,i;if(this.state.loading)return t("section",{children:t(Q,{})});{const r=je(((s=(e=this.state.currentUserCourse)==null?void 0:e.lessons)==null?void 0:s.totalRequiredTime)*6e4,{units:["h"],round:!0});return n("section",{id:"user-page__packages",children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:"remove"},"modal-type")," this Package Subscription."]}),n(N,{enforceFocus:!1,dialogClassName:"modal-90w admin-modal",show:this.state.showManageModal,onHide:this.closeManageModal,backdrop:"static",keyboard:!1,children:[t(N.Header,{style:{borderBottom:"none"},children:n("div",{className:"d-flex align-items-center",style:{width:"100%",marginRight:0,marginLeft:0},children:[t("div",{className:"pl-2",children:this.state.currentUserCourse&&this.state.currentUserCourse.title}),n("div",{className:"user-page__packages__user-data",children:[this.props.user.firstName," ",this.props.user.lastName," (",this.props.user.email,")"]}),this.state.currentUserCourse&&t("div",{children:t(rs,{articleType:"courses",articleId:this.state.currentUserCourse._id})}),n("div",{className:"pr-0",style:{minWidth:"266px"},children:[t(L,{variant:"info",className:"mx-1",onClick:()=>{this.state.currentUserCourse&&this.state.currentUserCourse.suspendedAt?this.setState({showReactivateCourseModal:!0}):this.setState({showSuspendCourseModal:!0})},children:t("strong",{children:this.state.currentUserCourse&&this.state.currentUserCourse.suspendedAt?"Reactivate Course":"Suspend Course"})}),t("button",{type:"button",className:"btn bp mx-1",onClick:this.closeManageModal,children:t("strong",{children:"Close"})})]})]})}),n(N.Body,{className:"pt-0 pb-4 header-labels",children:[n(A,{style:{backgroundColor:"#fff",padding:"10px"},children:[n(x,{sm:2,children:[t("div",{children:t("strong",{children:"Enrolled On: "})}),t("div",{children:this.state.currentUserCourse&&this.state.currentUserCourse.enrollmentUpdatedAt?new Date(this.state.currentUserCourse.enrollmentUpdatedAt).toLocaleDateString("en-US"):"-"})]}),n(x,{sm:4,style:{display:"flex",justifyContent:"flex-end"},children:[t("div",{children:t("strong",{children:"Expiry Date:"})}),n("div",{style:{width:"70%",display:"flex",justifyContent:"flex-start"},children:[this.state.editExpiryDate?t(Qe,{id:"expiresAt",handleDateChange:(d,c)=>{this.handleCourseChange(d,null,c)},date:this.state.currentUserCourse&&this.state.currentUserCourse.expiresAt?this.state.currentUserCourse.expiresAt.split("T")[0]:""}):t("span",{children:this.state.currentUserCourse&&this.state.currentUserCourse.expiresAt?new Date(this.state.currentUserCourse.expiresAt).toLocaleDateString("en-US"):"-"}),this.state.editExpiryDate?t("button",{type:"button",className:"btn bp ml-1",onClick:()=>{this.setState({editExpiryDate:!1}),this.saveExpiryDate()},children:t(I,{icon:se})}):t(I,{onClick:()=>{this.setState({editExpiryDate:!0})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]})]}),n(x,{sm:2,children:[t("div",{children:t("strong",{children:"Progress: "})}),this.state.currentUserCourse&&n("div",{children:[this.state.currentUserCourse.percentageProgress,"% of ",r]})]}),n(x,{sm:2,children:[t("div",{children:t("strong",{children:"Time Spent: "})}),t("div",{children:(i=(a=this.state.currentUserCourse)==null?void 0:a.lessons)!=null&&i.timeSpent?je(this.state.currentUserCourse.lessons.timeSpent):"N/A"})]}),n(x,{sm:2,children:[t("div",{children:t("strong",{children:"Completed On: "})}),t("div",{children:this.state.currentUserCourse&&this.state.currentUserCourse.completedAt?new Date(this.state.currentUserCourse.completedAt).toLocaleDateString("en-US"):"-"})]})]}),this.state.currentUserCourse&&t(_n,{course:this.state.currentUserCourse,userId:this.props.docId})]})]}),n(N,{show:this.state.showTransactionsModal,onHide:()=>{this.setState({showTransactionsModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Transactions"})}),t(N.Body,{className:"py-4",children:t("p",{children:"Here you will see a list of any financial transactions and links to any paperwork such as invoices or refund receipts..."})})]}),n(N,{show:this.state.showSuspendPackageModal,onHide:()=>{this.setState({showSuspendPackageModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Suspend Student?"})}),t(N.Body,{className:"py-4",children:t("p",{className:"my-0",children:"Do you want to suspend Student without issuing a refund?"})}),n(N.Footer,{children:[t(L,{variant:"secondary",onClick:()=>{this.suspendUserPackage(),this.setState({showSuspendPackageModal:!1})},children:"Suspend"}),t(L,{variant:"primary",onClick:()=>{this.setState({showSuspendPackageModal:!1,showRefundModal:!0})},children:"Refund"})]})]}),n(N,{show:this.state.showSuspendCourseModal,onHide:()=>{this.setState({showSuspendCourseModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Suspend Student?"})}),t(N.Body,{className:"py-4",children:t("p",{className:"my-0",children:"Do you want to suspend Student from this Course?"})}),n(N.Footer,{children:[t(L,{variant:"secondary",onClick:()=>{this.suspendUserCourse(),this.setState({showSuspendCourseModal:!1})},children:"Suspend"}),t(L,{variant:"primary",onClick:()=>{this.setState({showSuspendCourseModal:!1})},children:"Cancel"})]})]}),n(N,{show:this.state.showReactivatePackageModal,onHide:()=>{this.setState({showReactivatePackageModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Reactivate Student?"})}),t(N.Body,{className:"py-4",children:t("p",{className:"my-0",children:"Do you want to reactivate Student Package?"})}),n(N.Footer,{children:[t(L,{variant:"secondary",className:"bd",onClick:()=>{this.setState({showReactivatePackageModal:!1})},children:"No"}),t(L,{variant:"primary",className:"bp",onClick:()=>{this.reactivateUserPackage(),this.setState({showReactivatePackageModal:!1})},children:"Yes"})]})]}),n(N,{show:this.state.showReactivateCourseModal,onHide:()=>{this.setState({showReactivateCourseModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Reactivate Student?"})}),t(N.Body,{className:"py-4",children:t("p",{className:"my-0",children:"Do you want to reactivate Student Course?"})}),n(N.Footer,{children:[t(L,{variant:"secondary",className:"bd",onClick:()=>{this.setState({showReactivateCourseModal:!1})},children:"No"}),t(L,{variant:"primary",className:"bp",onClick:()=>{this.reactivateUserCourse(),this.setState({showReactivateCourseModal:!1})},children:"Yes"})]})]}),n(N,{show:this.state.showPostRefundSuspendModal,onHide:()=>{this.setState({showPostRefundSuspendModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Suspend Student?"})}),t(N.Body,{className:"py-4",children:t("p",{className:"my-0",children:"Do you want to suspend Student from this Package?"})}),n(N.Footer,{children:[t(L,{variant:"secondary",onClick:()=>{this.setState({showPostRefundSuspendModal:!1})},children:"No"}),t(L,{variant:"primary",onClick:()=>{this.suspendUserPackage(),this.setState({showPostRefundSuspendModal:!1})},children:"Yes"})]})]}),n(N,{size:"lg",show:this.state.showRefundModal,onHide:()=>{this.setState({showRefundModal:!1})},backdrop:"static",keyboard:!1,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Refund"})}),t(N.Body,{className:"py-4",children:t(f,{id:"refundForm",children:n(f.Group,{as:A,className:"my-0",children:[t(f.Label,{column:!0,sm:4,className:"text-right pt-2",children:"Amount to Refund:"}),t(x,{sm:8,children:t(f.Control,{type:"number",required:!0,min:"0",max:100,id:"refund",name:"refund",onChange:this.handleRefundChange,placeholder:`Max ${100}...`})})]})})}),n(N.Footer,{children:[t(L,{variant:"secondary",onClick:()=>{this.setState({showRefundModal:!1})},children:"Close"}),t(L,{disabled:!this.state.refundAmount||this.state.refundAmount==0,variant:"primary",onClick:()=>{this.setState({showRefundModal:!1,refundAmount:0}),this.state.currentUserPackage.suspendedAt||this.setState({showPostRefundSuspendModal:!0})},children:"Refund"})]})]}),n(A,{className:"pt-4 pb-2",children:[t(x,{md:2,lg:4,xl:6}),t(x,{md:10,lg:8,xl:6,children:n("div",{className:"input-group",children:[n(f.Control,{as:"select",value:this.state.selectedPackageId,custom:!0,onChange:d=>{this.selectPackage(d)},children:[t("option",{disabled:!0,value:"",children:"Select..."}),this.state.availablePackages.map((d,c)=>t("option",{value:d._id,children:d.title},c))]}),t(Te,{condition:!this.state.selectedPackageId,wrapper:d=>t(U,{overlay:t(M,{id:"tooltip-submit",children:"Select a package to add"}),children:d}),children:t(L,{className:"ml-3",type:"button",variant:"info",onClick:this.addPackage,children:t("strong",{children:"Add & Save"})})})]})})]}),this.state.userPackages.map((d,c)=>{var h;return t(A,{className:"py-2",children:t(x,{children:t(T,{defaultActiveKey:null,children:n(B,{children:[n(B.Header,{style:{backgroundColor:"#dcf5ee"},children:[t(T.Toggle,{as:"strong",eventKey:"0",children:d.data.title}),d.suspendedAt?n(T.Toggle,{as:"span",eventKey:"0",children:[t("strong",{children:"Suspended: "}),this.formatDate(d.suspendedAt)]}):t(w,{}),n(T.Toggle,{as:"span",eventKey:"0",children:[t("strong",{children:"Purchased: "}),this.formatDate(d.createdAt),(h=d==null?void 0:d.invoice)!=null&&h.manual?" (Manual)":""]}),t(rs,{articleType:"packages",articleId:d._id}),t(U,{placement:"top",overlay:t(M,{id:`tooltip-view-${c}`,children:"View"}),children:t(T.Toggle,{as:"span",size:"sm",variant:"link",eventKey:"0",children:t(Zd,{})})},`tooltip-view-${c}`)]}),t(T.Collapse,{eventKey:"0",children:n(B.Body,{children:[t(A,{children:t(x,{className:"pt-1 pb-4",children:n("div",{className:"float-right d-block",children:[d.suspendedAt&&t(U,{placement:"top",overlay:t(M,{id:`tooltip-remove-${c}`,children:"Remove"}),children:t(L,{variant:"info",className:"mr-1",onClick:p=>{p.stopPropagation(),this.setState({modalShow:!0,modalAction:()=>{this.removeUserPackage(d._id)}})},children:t(I,{icon:Ve})})},`tooltip-remove-${c}`),t(L,{variant:"info",className:"mx-1",onClick:()=>{this.resetUserPackage(d._id,d.packageId)},children:t("strong",{children:"Reset"})}),t(L,{variant:"info",className:"mx-1",onClick:()=>{this.setState({showTransactionsModal:!0})},children:t("strong",{children:"Transactions"})}),t(L,{variant:"info",className:"mx-1",onClick:()=>{d.suspendedAt?this.setState({showReactivatePackageModal:!0}):this.setState({showSuspendPackageModal:!0}),this.setState({currentUserPackage:d})},children:t("strong",{children:d.suspendedAt?"Reactivate":"Suspend"})}),t("button",{type:"button",className:"btn bd ml-1",onClick:()=>{this.setState({showRefundModal:!0})},children:t("strong",{children:"Refund"})})]})})}),t(Me,{minTableWidth:"1200px",rows:d.courses,rowButtons:[{type:"button",text:p=>p.suspendedAt?"Reactivate":"Suspend",icon:p=>p.suspendedAt?uo:mo,clickCallback:(p,u)=>{u.suspendedAt?this.setState({showReactivateCourseModal:!0}):this.setState({showSuspendCourseModal:!0}),this.setState({currentUserCourse:u})}},{type:"button",text:"Manage",classes:"bp",disabled:p=>{var u;return(u=p==null?void 0:p.editingAdmin)!=null&&u._id?`${p.editingAdmin.firstName} ${p.editingAdmin.lastName} is editing`:""},clickCallback:(p,u)=>{this.setState({showManageModal:!0,currentUserCourse:u})}}],columns:[{text:"Course name",field:p=>t("span",{children:p.title}),maxWidth:"20rem",className:"limitTitle"},{text:"Enrolled on",field:p=>this.formatDate(p.enrollmentUpdatedAt)},{text:"Expiry date",field:p=>this.formatDate(p.expiresAt)},{text:"Progress",field:p=>{const u=je(p.lessons.totalRequiredTime*6e4,{units:["h"],round:!0});return n(w,{children:[p.percentageProgress," % of\xA0",u]})}},{text:"Time spent",field:p=>{var u;return t(w,{children:je((u=p.lessons)==null?void 0:u.timeSpent)})}},{text:"Completed on",field:p=>this.formatDate(p.completedAt)}]})]})})]})})})},c)})]})}}}var Xd=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Jd));class ec extends g.exports.Component{render(){return t("div",{children:"UserMessages!"})}}class tc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{user:null,modal:null});o(this,"tabs",[{tabTitle:"Packages",TabComponent:Xd},{tabTitle:"Profile",TabComponent:Fd},{tabTitle:"Messages",TabComponent:ec}]);o(this,"setUserModal",e=>{this.setState({modal:e})})}async componentDidMount(){const{success:e,response:s,message:a}=await C("GET","/users/"+this.props.match.params.id);e?(this.setState({user:s}),this.props.pushBreadcrumbLink({text:`${s.firstName} ${s.lastName} (${s.email})`,path:"/admin/users/"+this.props.match.params.id}),this.props.createFormActions(y(m({},this.props.formActions.state),{userActions:!0,user:s}))):this.props.setGlobalAlert({type:"error",message:a})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:`${this.state.user.firstName} ${this.state.user.lastName} (${this.state.user.email})`,path:"/admin/users/"+this.props.match.params.id}),this.props.createFormActions({})}render(){return this.state.user?n("div",{id:"user-page",children:[t(et,{tabs:this.tabs,docId:this.props.match.params.id,user:this.state.user}),this.state.modal]}):t("div",{})}}var sc=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(tc));class ac extends g.exports.Component{constructor(e){super(e);e.pushBreadcrumbLink({text:"Users",path:"/admin/users"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Users",path:"/admin/users"})}render(){return t("div",{id:"users",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/users",component:Dd}),t(P,{path:"/admin/users/:userId/course/:courseId/progress",component:_n}),t(P,{path:"/admin/users/:id",component:sc})]})})}}var ic=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(ac);class nc extends g.exports.Component{constructor(e){super(e);o(this,"duplicateCourse",async(e,s)=>{const{success:a}=await C("POST",`/courses/${e}/clone`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Course has been duplicated"})):this.props.setGlobalAlert({type:"error",message:"Course has not been duplicated. Please try again."})});o(this,"deleteCourse",async(e,s)=>{const{success:a}=await C("DELETE",`/courses/${e}`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Course has been deleted"})):this.props.setGlobalAlert({type:"error",message:"Course has not been deleted. Please try again."})});this.state={modalShow:!1,modalAction:null,modalType:""}}render(){return n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this Course."]}),t("a",{className:"btn bp btn--small",href:"/admin/courses/new",children:"New Course"}),t(he,{basePath:"/admin/courses",apiCall:{method:"GET",path:"/courses"},columns:[{text:"",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-edit-course)}`,children:"Edit course"}),children:t(R,{className:"btn btn--small",to:"/admin/courses/"+e._id,children:t(I,{icon:Ge})})}),maxWidth:"3.11rem"},{text:"Title",field:"title",minWidth:"55%",sortKey:"title"},{text:"Created at",field:"createdAt",sortKey:"createdAt"},{text:"",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-enrolled-students)}`,children:"Show enrolled students"}),children:t(R,{className:"btn btn--small",to:"/admin/courses/"+e._id+"/students",children:t(I,{icon:go})})}),maxWidth:"3.11rem"}],rowButtons:[{type:"button",text:"Duplicate course",icon:Ne,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.duplicateCourse(s._id,a)},modalType:"duplicate"})}},{type:"button",text:"Delete course",icon:ae,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.deleteCourse(s._id,a)},modalType:"delete"})}}]})]})}}var rc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(nc);class We extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileVal:"",fileUrl:""});o(this,"handleFileChange",e=>{if(e.target.value){const s=e.target.files[0],a=URL.createObjectURL(s);this.setState({fileVal:e.target.value,fileUrl:a}),this.props.handleFileChange&&this.props.handleFileChange(this.props.type,a,s),this.props.onChange&&this.props.onChange(e,s,a),this.props.updatePreviewUrl&&this.props.updatePreviewUrl(a)}})}componentDidUpdate(e,s){const a={};this.props.url!==s.fileUrl&&(a.fileUrl=this.props.url),this.props.deletedAt!==null&&this.props.deletedAt!==e.deletedAt&&(a.fileVal="",this.props.handleFileChange&&this.props.handleFileChange(this.props.type,void 0,void 0),this.props.onChange&&this.props.onChange({target:{name:this.props.name}},void 0,void 0)),Object.keys(a).length!==0&&this.setState(a)}render(){var e;return n("div",{children:[n("label",{children:[(e=this.props.label)!=null?e:this.props.type[0].toUpperCase()+this.props.type.substr(1).toLowerCase(),this.props.deleteFileHandle&&t("div",{className:"bd",onClick:this.props.deleteFileHandle,children:t(I,{icon:Ve})})]}),t("br",{}),t("input",{type:"file",className:"mb-2",accept:this.props.type==="image"?".png,.jpg,.jpeg,.webp,.svg":this.props.type==="audio"?".mp3,.wav,.m4a,.mp4,.wma,.aac":this.props.type==="video"?".mp4,.mov,.wmv,.flv,.avi,.mkv,.webm":this.props.type==="document"?".doc,.pdf":"",value:this.state.fileVal,id:this.props.id,name:this.props.name,onChange:this.handleFileChange,disabled:this.props.disabled}),t("br",{}),!!this.state.fileUrl&&this.props.type==="image"&&t("img",{src:Array.isArray(this.state.fileUrl)?this.state.fileUrl[2]:this.state.fileUrl,style:{height:"115px",objectFit:"cover"}}),!!this.state.fileUrl&&this.props.type==="audio"&&t("audio",{controls:"controls",src:this.state.fileUrl}),!!this.state.fileUrl&&this.props.type==="video"&&t("video",{height:"200",width:"300",controls:"controls",src:this.state.fileUrl}),!!this.state.fileUrl&&this.props.type==="document"&&t("div",{children:t("iframe",{style:{width:"100%",height:"800px"},src:this.state.fileUrl})})]})}}class ne extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:"",deletedAt:null});o(this,"updateFileUrl",e=>{this.setState({fileUrl:e})});o(this,"deleteFileHandle",async()=>{const{file:e}=this.props;e&&typeof e=="string"&&e.substr(0,4)!=="blob"&&await C("DELETE",`/files/${e}`),this.setState({fileUrl:"",deletedAt:new Date().getTime()},()=>{this.setState({deletedAt:null})})})}async componentDidMount(){const{file:e}=this.props;let s=e;e&&typeof e=="string"&&e.substr(0,4)!=="blob"&&(s=await xe(e)),this.setState({fileUrl:s})}render(){const r=this,{props:d}=r,c=d,{file:e}=c,s=oe(c,["file"]),{state:{fileUrl:a,deletedAt:i}}=r;return t("div",{className:"asyncpreview-fileupload",children:t(We,y(m({},s),{deletedAt:i,url:a,updatePreviewUrl:this.updateFileUrl,deleteFileHandle:this.deleteFileHandle}))})}}class oc extends g.exports.Component{constructor(e){super(e);o(this,"handleFileChange",(e,s,a)=>{this.props.handleFileChange(this.props.item,e,s,a)});this.state={inputTitle:e.item.inputType[0].toUpperCase()+e.item.inputType.substr(1),modalShow:!1,modalAction:null,modalType:"",fileUrl:""}}async componentDidMount(){var e,s;(s=(e=this.props.item)==null?void 0:e.extra)!=null&&s.fileId&&this.setState({fileUrl:await xe(this.props.item.extra.fileId)})}render(){var a,i;const e=[{value:".pdf",label:"pdf"},{value:".doc",label:"doc"},{value:".jpg",label:"jpg"},{value:".jpeg",label:"jpeg"},{value:".gif",label:"gif"},{value:".png",label:"png"},{value:".webp",label:"webp"}];let s=[];return this.props.item.inputType==="file"&&this.props.item.extra.allowedFileTypes.length&&(s=this.props.item.extra.allowedFileTypes.split(", ").map(r=>({value:r,label:r.replace(".","")}))),n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this Form Input."]}),t(T,{defaultActiveKey:"1",children:n(B,{children:[t(T.Toggle,{as:B.Header,eventKey:"0",children:n(A,{children:[n(x,{xs:12,md:6,children:[t("span",y(m({},this.props.dragHandleProps),{onClick:r=>{r.stopPropagation()},children:t(I,{icon:Re,style:{marginRight:"20px"}})})),t(f.Label,{htmlFor:"blockTitle",className:"pt-2",style:{fontWeight:"normal"},children:this.state.inputTitle})]}),n(x,{xs:12,md:6,className:"my-2 my-md-0",children:[t(U,{placement:"top",overlay:t(M,{id:`tooltip-delete-${this.props.idx}`,children:"Delete"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:r=>{r.stopPropagation(),this.setState({modalShow:!0,modalAction:()=>{this.props.deleteItem(this.props.idx)},modalType:"delete"})},children:t(I,{icon:ae})})},`tooltip-delete-${this.props.idx}`),t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${this.props.idx}`,children:"Edit"}),children:t(T.Toggle,{as:L,variant:"link",className:"float-right mx-1",eventKey:"0",children:t(I,{icon:J})})},`tooltip-edit-${this.props.idx}`)]})]})}),t(T.Collapse,{eventKey:"0",children:n(B.Body,{children:[this.props.item.inputType==="textBlock"&&t(A,{children:t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"textBlock",children:"Text"}),t(H,{id:"textBlock",name:"textBlock",defaultValue:(i=(a=this.props.item)==null?void 0:a.extra)==null?void 0:i.copy,onChange:r=>{this.props.handleChange(this.props.idx,"extra.copy",r.target.value)}})]})})}),this.props.item.inputType==="document"&&t(A,{children:t(x,{children:t(E,{children:t(We,{id:`document-${K()}`,name:`document-${K()}`,url:this.state.fileUrl,handleFileChange:this.handleFileChange,type:"document"})})})}),this.props.item.inputType==="image"&&t(A,{children:t(x,{children:t(E,{children:t(We,{id:"image",name:"image",url:this.state.fileUrl,handleFileChange:this.handleFileChange,type:"image"})})})}),this.props.item.inputType!=="textBlock"&&this.props.item.inputType!=="document"&&this.props.item.inputType!=="image"&&n("div",{children:[n(A,{children:[n(x,{xs:12,md:6,children:[n(E,{children:[t(f.Label,{htmlFor:"label",children:"Label"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"label",name:"label",value:this.props.item.label,onChange:r=>{this.props.handleChange(this.props.idx,"label",r.target.value)}})]}),this.props.item.inputType==="typeDNA"&&n(E,{children:[t(f.Label,{htmlFor:"passRate",children:"Pass Rate %"}),t(f.Control,{type:"number",required:!0,min:"0",max:"100",id:"passRate",name:"passRate",value:this.props.item.extra.passRate,onChange:r=>{this.props.handleChange(this.props.idx,"extra.passRate",r.target.value)}})]}),this.props.item.inputType==="file"&&n(E,{children:[t(f.Label,{htmlFor:"allowedFileTypes",children:"Allowed File Types"}),t(Fe,{required:!0,defaultValue:s,isMulti:!0,id:"allowedFileTypes",name:"allowedFileTypes",options:e,className:"basic-multi-select",classNamePrefix:"select",menuPortalTarget:document.body,menuPosition:"fixed",onChange:r=>{this.props.handleChange(this.props.idx,"extra.allowedFileTypes",r.map(d=>d.value).join(", "))}})]}),t(E,{children:n(A,{children:[n(x,{children:[t(f.Label,{htmlFor:"requiredField",children:"Required Field"}),n(f.Control,{as:"select",id:"requiredField",name:"requiredField",required:!0,value:this.props.item.required,onChange:r=>{this.props.handleChange(this.props.idx,"required",r.target.value)},children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]}),n(x,{children:[t(f.Label,{htmlFor:"key",children:"Key"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"key",name:"key",value:this.props.item.key,onChange:r=>{this.props.handleChange(this.props.idx,"key",r.target.value)}})]})]})})]}),t(x,{xs:12,md:6,children:n(E,{children:[t(f.Label,{htmlFor:"description",children:"Description"}),t(f.Control,{as:"textarea",type:"text",rows:"5",id:"description",name:"description",value:this.props.item.description,onChange:r=>{this.props.handleChange(this.props.idx,"description",r.target.value)}})]})})]}),this.props.item.inputType==="options"||this.props.item.inputType==="checkbox"||this.props.item.inputType==="radio"?t(A,{children:n(x,{xs:12,md:6,children:[t(E,{children:t(f.Label,{className:"mb-0",children:"Options"})}),this.props.item.extra.options.map((r,d)=>n(Xt,{className:"mb-3",children:[t(fo,{value:r,onChange:c=>{this.props.handleOptionChange(this.props.item,d,c.target.value)}}),t(Xt.Append,{children:t(L,{type:"button",variant:"link",onClick:()=>{this.props.removeItemOption(this.props.item,d)},children:t(I,{icon:fe})})})]},d)),t(L,{variant:"btn bd",type:"button",className:"mt-3",onClick:()=>{this.props.addItemOption(this.props.item)},children:"Add an option"})]})}):t(w,{})]})]})})]})})]})}}class Ye extends z.Component{constructor(){super(...arguments);o(this,"state",{modalVisible:!1,lastLocation:null,confirmedNavigation:!1});o(this,"showModal",e=>this.setState({modalVisible:!0,lastLocation:e}));o(this,"closeModal",e=>{this.setState({modalVisible:!1})});o(this,"handleBlockedNavigation",e=>{const{confirmedNavigation:s}=this.state,{shouldBlockNavigation:a}=this.props;return!s&&a(e)?(this.showModal(e),!1):!0});o(this,"handleConfirmNavigationClick",()=>{const{navigate:e}=this.props,{lastLocation:s}=this.state;s&&this.setState({confirmedNavigation:!0},()=>{e(s.pathname+s.search)})})}render(){const{when:e}=this.props,{modalVisible:s}=this.state;return n(w,{children:[t(cn,{when:e,message:this.handleBlockedNavigation}),t(X,{show:s,hideModal:this.closeModal,confirmAction:this.handleConfirmNavigationClick,titleText:"Leave site?",bodyText:"Changes you made will not be saved.",confirmButtonText:"Leave"})]})}}class lc extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",e=>{this.props.onChange(e.target.name,e.target.value)});o(this,"handleCheckboxChange",e=>{this.props.onChange(e.target.name,e.target.checked)})}render(){const{props:{fieldKey:e,inputType:s,extra:a,label:i,required:r,onChange:d,value:c,description:h}}=this;switch(s){case"textBlock":return t("div",{className:"form-builder__textBlock",dangerouslySetInnerHTML:{__html:a==null?void 0:a.copy}});case"checkbox":return t("div",{className:`form-builder__${s}Input${r?" required":""}`,children:n("label",{htmlFor:e,children:[t("input",{type:s,name:e,id:e,required:r,checked:c,onChange:this.handleCheckboxChange}),i]})});case"text":case"number":return t("div",{className:`form-builder__${s}Input${r?" required":""}`,children:n("label",{htmlFor:e,children:[i,!!h&&t("small",{children:h}),t("input",{type:s,name:e,id:e,required:r,defaultValue:c,onChange:this.handleInputChange})]})});case"textarea":return n("div",{className:`form-builder__textAreaInput${r?" required":""}`,children:[t("label",{htmlFor:e,children:i}),t("textarea",{name:e,id:e,required:r,onChange:this.handleInputChange,defaultValue:c})]});case"radio":return t("div",{className:`form-builder__radioInput${r?" required":""}`,children:a.options.map(p=>n("label",{htmlFor:`${e}-${p}`,children:[t("input",{type:s,name:e,id:`${e}-${p}`,defaultValue:p,required:r,onChange:this.handleInputChange}),p]},p))});case"options":return t("div",{className:`form-builder__optionsInput${r?" required":""}`,children:a.options.map(p=>n("label",{htmlFor:`${e}-${p}`,children:[t("input",{type:"checkbox",name:e,id:`${e}-${p}`,required:r,"data-fieldkey":e,onChange:this.handleCheckboxChange}),p]},p))});case"date":return t("div",{className:`form-builder__optionsInput${r?" required":""}`,children:t(Qe,{id:e,handleDateChange:d,date:c,label:i,required:r})});case"document":return t("div",{className:"form-builder__documentViewer",children:t(At,{fileId:a.fileId})});case"image":return t("div",{className:"form-builder__imageViewer",children:t(de,{fileId:a.fileId})});default:return t(w,{})}}}var dc="/home/adrian/work/lms/frontend/src/components/FormBuilder/FormBuilder.jsx";class Ct extends g.exports.Component{constructor(e){super(e);o(this,"handleInputChange",(e,s)=>{this.setState({[e]:s})});this.state=Array.isArray(e.fields)?Object.fromEntries(e.fields.reduce((s,a)=>(a.key&&s.push([a.key,null]),s),[])):[]}render(){var i;const{onSubmit:e,fields:s,header:a}=this.props;return n("form",{className:"form-builder",onSubmit:r=>{r.preventDefault(),e&&typeof e=="function"&&e(this.state)},children:[a&&t(a,{}),t("main",{children:Array.isArray(s)&&s.length>0?t("div",{children:s.map((r,d)=>g.exports.createElement(lc,y(m({},r),{fieldKey:r.key,key:`${r.key}-${d}`,value:this.state[r.key],onChange:this.handleInputChange,__self:this,__source:{fileName:dc,lineNumber:46,columnNumber:33}})))}):t("div",{})}),t("footer",{children:t("button",{type:"submit",className:"bp",children:(i=this.props.submitText)!=null?i:"Submit"})})]})}}class cc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showPreview:!1});o(this,"togglePreview",e=>{e&&e.preventDefault(),this.setState({showPreview:!this.state.showPreview})})}render(){const{props:{fields:e},state:{showPreview:s}}=this;return n(w,{children:[t("button",{className:"bp",onClick:this.togglePreview,children:"Preview"}),n(N,{size:"xl",show:s,className:"form-constructor__preview",onHide:this.togglePreview,children:[t(N.Header,{closeButton:!0,children:"Form preview"}),t(N.Body,{children:t(Ct,{fields:e})})]})]})}}class hc extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"handleFileChange",(e,s,a,i)=>{this.setState({items:this.state.items.map(r=>(e.uuid===r.uuid&&(r.file=i,r.extra.fileId=a),r))})});o(this,"handleSubmit",e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setState({loading:!0,isDirty:!1}),this.submit()});o(this,"submit",async()=>{const e=this.state.items.map(async d=>{if(d.file){let c=new FormData;return c.append("file",d.file),C("POST","/files",c).then(({success:h,response:p})=>{h&&this._isMounted&&this.setState({items:this.state.items.map(u=>(d.uuid===u.uuid&&(delete u.file,u.extra.fileId=p.fileId),u))})})}});await Promise.all(e);let s="POST",a=`/courses/${this.state.type}s/`;this.state.subtype!=="enrollment"&&(a=`/courses/${this.props.match.params.courseId}/exams/${this.state.subtype}`),this.state.subtype==="enrollment"&&this.state.objectId&&(s="PUT",a=`/courses/enrollments/${this.state.objectId}`);const{success:i,response:r}=await C(s,a,{fields:this.state.items,courseId:this.props.match.params.courseId});this._isMounted&&(i&&r?(this.setState({objectId:r._id}),this.props.setGlobalAlert({type:"success",message:`${this.props.tab} has been ${this.state.objectId?"updated":"created"}`})):this.props.setGlobalAlert({type:"error",message:`There was a problem with saving this ${this.props.tab}. Please try again`}),this.setState({loading:!1}))});o(this,"componentDidMount",async()=>{this._isMounted=!0;const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}/${this.state.type}`);e&&s&&this._isMounted&&this.setState({items:s[this.state.tabType==="enrollment"?"fields":this.state.tabType+"Fields"].map(a=>y(m({},a),{uuid:a._id})),objectId:s._id}),this.props.createFormActions({save:!0,cancel:!0,id:`${this.props.tab}Form`}),this._isMounted&&this.setState({loading:!1})});o(this,"componentWillUnmount",()=>{this._isMounted=!1,this.props.createFormActions({})});o(this,"deleteItem",e=>{this.setState({items:this.state.items.filter((s,a)=>e!=a),isDirty:!0})});o(this,"handleChange",(e,s,a)=>{const i=this.state.items.map((r,d)=>{if(d===e){let c=s.split("."),h=c.pop(),p=c.reduce((u,b)=>u==null?void 0:u[b],r);typeof p=="object"&&(p[h]=a)}return r});this.setState({items:i,isDirty:!0})});o(this,"handleOptionChange",(e,s,a)=>{this.setState({items:this.state.items.map(i=>(i.uuid===e.uuid&&(i.extra.options[s]=a),i))})});o(this,"handleDragAndDrop",e=>{if(!e.destination||e.source.index===e.destination.index)return;let s=[...this.state.items];const[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.setState({items:s,isDirty:!0})});o(this,"addItemOption",e=>{this.setState({items:this.state.items.map(s=>(s.uuid===e.uuid&&s.extra.options.push(""),s))})});o(this,"removeItemOption",(e,s)=>{this.setState({items:this.state.items.map(a=>(a.uuid===e.uuid&&(a.extra.options=a.extra.options.filter((i,r)=>s!==r)),a))})});this.state={loading:!0,tabType:this.props.tab.charAt(0).toLowerCase()+this.props.tab.slice(1),type:this.props.tab==="PreExam"||this.props.tab==="PostExam"?"exam":"enrollment",subtype:this.props.tab==="PreExam"?"pre":this.props.tab==="PostExam"?"post":"enrollment",objectId:null,items:[],isDirty:!1}}componentDidUpdate(){this.props.formActions.state&&this.props.formActions.state.reload&&this.props.history.push("/admin/courses")}getEmptyItem(e){let s={inputType:e,label:"",required:!1,key:"",description:"",extra:{},uuid:K()};return e==="typeDNA"?s.extra.passRate="":e==="file"?s.extra.allowedFileTypes=[]:e==="textBlock"?s.extra.copy="":e==="document"||e==="image"?s.extra.sourceUrl="":(e==="radio"||e==="checkbox"||e==="options")&&(s.extra.options=[]),s}render(){return this.state.loading?t(Q,{}):n("div",{children:[t(Ye,{when:this.state.isDirty,navigate:e=>this.props.history.push(e),shouldBlockNavigation:()=>this.state.isDirty}),n(f,{onSubmit:this.handleSubmit,id:`${this.props.tab}Form`,className:"form-constructor",children:[n("header",{children:[n("div",{children:[this.props.tab," Form Inputs"]}),t("div",{children:t(cc,{fields:this.state.items})})]}),t(be,{onDragEnd:this.handleDragAndDrop,children:t(Ce,{droppableId:this.props.tab,children:e=>n("ul",y(m({},e.droppableProps),{ref:e.innerRef,style:{listStyleType:"none",padding:"0px",margin:"0px"},children:[this.state.items.map((s,a)=>t(le,{draggableId:s.uuid,index:a,children:i=>t("li",y(m({className:"li_admin",ref:i.innerRef},i.draggableProps),{children:t(A,{className:"pt-2",children:t(x,{children:t(oc,{idx:a,item:s,handleChange:this.handleChange,handleFileChange:this.handleFileChange,deleteItem:this.deleteItem,dragHandleProps:i.dragHandleProps,addItemOption:this.addItemOption,removeItemOption:this.removeItemOption,handleOptionChange:this.handleOptionChange})})})}))},`draggable-${s.uuid}`)),e.placeholder]}))})}),n(A,{className:"pt-5",children:[t(x,{xs:6,md:3,children:t(es,{title:"Form Inputs",id:"buttonDropdown",variant:"btn bd w-100",children:["text","number","date","file","typeDNA","textarea","options","checkbox","radio"].map((e,s)=>t(_e.Item,{eventKey:s,onClick:()=>{this.setState({items:[...this.state.items,this.getEmptyItem(e)]})},children:e.charAt(0).toUpperCase()+e.slice(1)},s))})}),t(x,{xs:6,md:3,children:t(es,{title:"Content Blocks",id:"buttonDropdown",variant:"btn bd w-100",children:["textBlock","document","image"].map((e,s)=>t(_e.Item,{eventKey:s,onClick:()=>{this.setState({items:[...this.state.items,this.getEmptyItem(e)]})},children:e.charAt(0).toUpperCase()+e.slice(1)},s))})})]})]})]})}}var Ut=$(l=>({formActions:l.formActions}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(hc));class pc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{course:{}});o(this,"componentDidMount",async()=>{const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})})}render(){return t(Ut,{tab:"Enrollment"})}}var uc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(pc));class mc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{course:{}});o(this,"componentDidMount",async()=>{const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})})}render(){return t(Ut,{tab:"PreExam"})}}var gc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(mc));class fc extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"componentDidMount",async()=>{this._isMounted=!0,this.createButtons();const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`}),window.socket.emit("remove user editing course",this.docId),this._isMounted=!1,this.props.createFormActions({})});o(this,"setIsDirty",e=>{this.setState({isDirty:e})});o(this,"toggleSpinner",e=>{this.setState({loading:!this.state.loading})});o(this,"duplicateExam",async(e,s)=>{const{success:a}=await C("POST",`/courses/exams/${e}/clone`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Exam has been duplicated"})):this.props.setGlobalAlert({type:"error",message:"Exam has not been duplicated. Please try again."})});o(this,"deleteExam",async(e,s)=>{const{success:a}=await C("DELETE",`/courses/exams/${e}`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Exam has been deleted"})):this.props.setGlobalAlert({type:"error",message:"Exam has not been deleted. Please try again."})});o(this,"handleChange",e=>{this.setState({isDirty:!0,course:y(m({},this.state.course),{[e.target.name]:e.target.value})})});o(this,"createButtons",()=>{this.props.createFormActions({customButtons:[{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:!this.state.isDirty}]})});o(this,"handleSubmit",async e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setIsDirty(!1),this.toggleSpinner(),await this.submit()});o(this,"submit",async()=>{if(!this._isMounted)return;const{success:e,response:s}=await C("PUT",`/courses/${this.docId}`,{minimumCompletionTime:this.state.course.minimumCompletionTime,maximumCompletionTime:this.state.course.maximumCompletionTime,attemptLimit:this.state.course.attemptLimit,attemptDelay:this.state.course.attemptDelay,randomExam:this.state.course.randomExam==="true"});this._isMounted&&(e&&s?this.doRedirect(s._id):this.handleSubmitFailed())});o(this,"doRedirect",e=>{this.toggleSpinner(),this.props.setGlobalAlert({type:"success",message:`Course has been ${this.docId!=="new"?"updated":"created"}`}),this.docId==="new"&&this.setState({redirect:`/admin/courses/${e}`})});o(this,"handleSubmitFailed",()=>{this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Course. Please try again"}),this.toggleSpinner()});this.docId=this.props.match.params.courseId,this.state={course:{},isDirty:!1,loading:!1,modalShow:!1,modalAction:null,modalType:""}}componentDidUpdate(e,s,a){this.state.isDirty!==s.isDirty&&this.createButtons()}render(){return this.state.loading?t(Q,{}):n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this Exam."]}),t(f,{onSubmit:this.handleSubmit,id:"examTableForm",children:n(A,{className:"pt-5",children:[t(x,{md:3,children:n(E,{children:[t(f.Label,{children:"Randomize Exams?"}),n(f.Control,{as:"select",id:"randomExam",name:"randomExam",required:!0,value:this.state.course.randomExam,onChange:this.handleChange,children:[t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"minimumCompletionTime",children:"Minimum Completion Time"}),t(f.Control,{type:"number",required:!0,min:"0",id:"minimumCompletionTime",name:"minimumCompletionTime",value:this.state.course.minimumCompletionTime,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"maximumCompletionTime",children:"Maximum Completion Time"}),t(f.Control,{type:"number",required:!0,min:"0",id:"maximumCompletionTime",name:"maximumCompletionTime",value:this.state.course.maximumCompletionTime,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"attemptLimit",children:"Attempt Limit"}),t(f.Control,{type:"number",required:!0,min:"0",id:"attemptLimit",name:"attemptLimit",value:this.state.course.attemptLimit,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"attemptDelay",children:"Attempt Delay (days)"}),t(f.Control,{type:"number",required:!0,min:"0",id:"attemptDelay",name:"attemptDelay",value:this.state.course.attemptDelay,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})})]})}),t("a",{className:"btn bp btn--small",href:`/admin/courses/ext/${this.docId}/exams/create/`,children:"New Exam"}),t(he,{apiCall:{method:"GET",path:`/courses/${this.docId}/exams/`},columns:[{text:"",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-edit-exam)}`,children:"Edit exam"}),children:t(R,{className:"btn btn--small",to:"/admin/courses/ext/exams/edit/"+e._id,children:t(I,{icon:Ge})})}),maxWidth:"3.11rem"},{text:"Title",field:"title",minWidth:"45%"},{text:"Created at",field:"createdAt"}],rowButtons:[{type:"button",text:"Duplicate exam",icon:Ne,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.duplicateExam(s._id,a)},modalType:"duplicate"})}},{type:"button",text:"Delete exam",icon:ae,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.deleteExam(s._id,a)},modalType:"delete"})}}]})]})}}var bc=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(fc));class Cc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{course:{}});o(this,"componentDidMount",async()=>{const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})})}render(){return t(Ut,{tab:"PostExam"})}}var yc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(Cc));class vc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{course:{}});o(this,"componentDidMount",async()=>{const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})})}render(){return t("div",{children:"Messages!"})}}var xc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(vc));class Sc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{title:"",backgroundUrl:null,certificateFile:null,scale:1,backgroundWidth:0,backgroundHeight:0,backgroundCenter:!1,originalWidth:0,originalHeight:0,editorContent:"",blockCounter:1,blocks:[],loading:!0,preview:!1,course:{},availableVariables:{user:["user.firstName","user.lastName","user.email"],website:["website.title","website.url"]}});o(this,"worktableRef",z.createRef());o(this,"handleCKEditorChange",(e,s)=>{this.setState({[`block_${e}_content`]:s})});o(this,"getCourseCertificate",async()=>{const{response:{title:e,image:s,blocks:a},success:i,message:r}=await C("GET",`/courses/${this.props.match.params.courseId}/certificate`);if(i)this.calculateWorkTableData(s,e,a);else{const{success:d}=await C("PUT",`/courses/${this.props.match.params.courseId}/certificate`,{title:"default certificate"});d?this.getCourseCertificate():this.props.setGlobalAlert({type:"error",message:r})}});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"handleFileChange",(e,s,a)=>{this.calculateWorkTableData(s)});o(this,"calculateWorkTableData",(e,s=null,a=null)=>{const i=new Image,r=this;let d,c=parseInt(window.getComputedStyle(this.worktableRef.current).getPropertyValue("width").slice(0,-2));i.onload=function(){let h,p,u=!1;this.width>c?(d=this.height/this.width*c,h=this.height/d,p=this.width/c):(c=this.width,d=this.height,u=!0);const b={backgroundWidth:c,backgroundHeight:d,backgroundCenter:u,backgroundUrl:e,originalWidth:this.width,originalHeight:this.height,scale:h?Math.min(p,h):1};if(s&&(b.title=s),a){const v=[];for(const S of a){const _=K();v.push(_);for(const k of Object.keys(S))b[`block_${_}_${k}`]=S[k]}b.blocks=v}r.setState(b)},i.src=e,this.setState({loading:!1})});o(this,"addCustomBlock",()=>{const{blocks:e,blockCounter:s}=this.state,a=K();e.unshift(a),this.setState({blocks:e,[`block_${a}_key`]:`unique_${s}`,[`block_${a}_content`]:"",[`block_${a}_x`]:0,[`block_${a}_y`]:0,blockCounter:s+1})});o(this,"removeCustomBlock",e=>{const{blocks:s}=this.state;s.splice(e,1),this.setState({blocks:s,[`block_${e}_key`]:void 0,[`block_${e}_content`]:void 0,[`block_${e}_x`]:void 0,[`block_${e}_y`]:void 0,[`block_${e}_width`]:void 0,[`block_${e}_height`]:void 0})});o(this,"setCustomBlockPosition",(e,{x:s,y:a})=>{const{scale:i}=this.state;this.setState({[`block_${e}_x`]:s*i,[`block_${e}_y`]:a*i})});o(this,"setCustomBlockSize",(e,s,{x:a,y:i})=>{const{scale:r}=this.state,d=window.getComputedStyle(s);this.setState({[`block_${e}_x`]:a*r,[`block_${e}_y`]:i*r,[`block_${e}_width`]:parseInt(d.getPropertyValue("width").slice(0,-2))*r,[`block_${e}_height`]:parseInt(d.getPropertyValue("height").slice(0,-2))*r})});o(this,"submitCertificateChanges",async()=>{const e=this.state.blocks.map(i=>({key:this.state[`block_${i}_key`],content:this.state[`block_${i}_content`],x:this.state[`block_${i}_x`],y:this.state[`block_${i}_y`],width:this.state[`block_${i}_width`],height:this.state[`block_${i}_height`]})),{success:s,message:a}=await C("PATCH",`/courses/${this.props.match.params.courseId}/certificate`,{title:this.state.title,blocks:e,image:"https://i.imgur.com/Wwlyc6a.jpg"});this.props.setGlobalAlert({type:s?"success":"error",message:a})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"toggleCertificatePreview",()=>{this.setState({preview:!this.state.preview})});o(this,"generateCertificate",async()=>{const{success:e,message:s,raw:a}=await C("GET","/courses/61dfe5dc4d1cc023ac068a35/certificate/generate");if(e!==!1){const i=await(await fetch(a)).blob(),r=window.URL.createObjectURL(i),d=document.createElement("a");d.href=r,d.download="certificate",d.click()}else console.log(s)})}async componentDidMount(){const{successCourse:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`}),this.getCourseCertificate()}render(){const{scale:e}=this.state;return this.state.loading?t("div",{className:"cb p-4",ref:this.worktableRef,children:t(Q,{})}):n("div",{className:"cb p-4",children:[n("div",{className:"mb-4 certificate-button-row",children:[t(L,{variant:"primary",onClick:this.submitCertificateChanges,children:"Save"}),t(L,{variant:"primary",onClick:this.generateCertificate,children:"Generate"}),t(L,{variant:"secondary",onClick:this.toggleCertificatePreview,children:this.state.preview?"Editing mode":"Preview mode"})]}),n(A,{children:[t(x,{children:n("div",{className:"cb__input",children:[t("label",{htmlFor:"title",children:"Certificate title"}),t("input",{type:"text",id:"title",name:"title",value:this.state.title,onChange:this.handleInputChange})]})}),t(x,{children:t("div",{className:"cb__input cb__input--image-upload",children:t(We,{name:"background",url:this.state.backgroundUrl,type:"image",label:"Certificate background",handleFileChange:this.handleFileChange})})})]}),t("div",{className:"cb__worktable my-4",ref:this.worktableRef,style:{backgroundImage:`url(${this.state.backgroundUrl})`,height:this.state.backgroundHeight===0?"auto":`${this.state.backgroundHeight}px`,width:this.state.backgroundWidth===0?"auto":`${this.state.backgroundWidth}px`,backgroundSize:`${this.state.backgroundWidth}px ${this.state.backgroundHeight}px`,backgroundPosition:this.state.backgroundCenter?"center":"auto"},children:this.state.backgroundUrl?this.state.blocks.map(s=>this.state.preview?t("div",{style:{position:"absolute",left:this.state[`block_${s}_x`]/e+"px",top:this.state[`block_${s}_y`]/e+"px",width:this.state[`block_${s}_width`]/e+"px",height:this.state[`block_${s}_height`]/e+"px"},dangerouslySetInnerHTML:{__html:this.state[`block_${s}_content`]}},s):t(bo,{default:{x:this.state[`block_${s}_x`]/e,y:this.state[`block_${s}_y`]/e,width:this.state[`block_${s}_width`]/e,height:this.state[`block_${s}_height`]/e},bounds:"parent",className:"cb__worktable__block",onDragStop:(a,i)=>{this.setCustomBlockPosition(s,i)},onResizeStop:(a,i,r,d,c)=>{this.setCustomBlockSize(s,r,c)},children:t("span",{children:this.state[`block_${s}_key`]})},s)):t("div",{className:"cb__worktable__empty",children:"Upload a certificate background to get started"})}),t("div",{className:"available-variables",children:n("nav",{children:[n("div",{children:[t("div",{className:"block-title",children:"Available tags"}),t("small",{children:"These tags can be used either in the subject or content of the message. Clicking on any tag will copy it to your clipboard"})]}),t("ul",{children:this.state.availableVariables&&Object.keys(this.state.availableVariables).map(s=>{let a=[];for(const i of this.state.availableVariables[s])a.push(t("li",{onClick:()=>{navigator.clipboard.writeText(`#{${i}}`)},children:`#{${i}}`},i));return n("li",{children:[t("b",{children:s}),t("ul",{children:a})]},s)})})]})}),n("div",{className:"cb__input",children:[n("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[t("label",{htmlFor:"cb__blocks",className:"m-0",children:"Custom blocks"}),t(L,{variant:"outline-dark",onClick:this.addCustomBlock,children:"Add block"})]}),t("div",{id:"cb__blocks",children:this.state.blocks.map(s=>n("div",{className:"cb__custom-block",children:[n("div",{className:"d-flex justify-content-between",children:[t("input",{type:"text",name:`block_${s}_key`,value:this.state[`block_${s}_key`],onChange:this.handleInputChange}),t(L,{variant:"link",size:"sm",className:"ml-2 mb-2",onClick:this.removeCustomBlock,children:t(I,{icon:ae})})]}),t(H,{defaultValue:this.state[`block_${s}_content`],onChange:a=>{this.handleCKEditorChange(s,a.target.value)},noCharCount:!0})]},s))})]})]})}}var Ic=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Sc));class wc extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"componentDidMount",async()=>{this._isMounted=!0,this.createButtons();const{success:e,response:s}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:s}),this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`}),window.socket.emit("remove user editing course",this.docId),this._isMounted=!1,this.props.createFormActions({})});o(this,"setIsDirty",e=>{this.setState({isDirty:e})});o(this,"toggleSpinner",e=>{this.setState({loading:!this.state.loading})});o(this,"handleChange",e=>{this.setState({isDirty:!0,course:y(m({},this.state.course),{[e.target.name]:e.target.value})})});o(this,"createButtons",()=>{this.props.createFormActions({customButtons:[{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:!this.state.isDirty}]})});o(this,"handleSubmit",async e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setIsDirty(!1),this.toggleSpinner(),await this.submit()});o(this,"submit",async()=>{if(!this._isMounted)return;const{success:e,response:s}=await C("PUT",`/courses/${this.docId}`,{extensionLimit:this.state.course.extensionLimit,offerOptions:this.state.course.offerOptions,offerConditions:this.state.course.offerConditions});this._isMounted&&(e&&s?this.doRedirect(s._id):this.handleSubmitFailed())});o(this,"doRedirect",e=>{this.toggleSpinner(),this.props.setGlobalAlert({type:"success",message:"Course has been updated"})});o(this,"handleSubmitFailed",()=>{this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Course. Please try again"}),this.toggleSpinner()});o(this,"addNew",e=>{let s=this.state.course;s.offerOptions||(s.offerOptions={extension:[],repurchase:[]}),(s.offerOptions[e]=s.offerOptions[e]||[]).push({time:0,price:0}),this.setState({isDirty:!0,course:s})});o(this,"hanldeTableChange",(e,s,a,i)=>{let r=this.state.course;r.offerOptions[e][a][s]=i,this.setState({isDirty:!0,course:r})});o(this,"hanldeOfferConditionChange",({target:e})=>{let s=this.state.course;s.offerConditions||(s.offerConditions={pass:null,fail:null,expiry:null,certificateExpiry:null}),s.offerConditions[e.name]=e.value,this.setState({isDirty:!0,course:s})});this.docId=this.props.match.params.courseId,this.state={course:{},isDirty:!1,loading:!1}}componentDidUpdate(e,s,a){this.state.isDirty!==s.isDirty&&this.createButtons()}render(){var e,s,a,i,r,d,c,h,p,u,b,v,S,_,k,O;return this.state.loading?t(Q,{}):n("div",{children:[t(f,{onSubmit:this.handleSubmit,id:"examTableForm",children:n(A,{className:"pt-5",children:[t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"extensionLimit",children:"Extension Limit"}),t(f.Control,{type:"number",required:!0,min:"0",id:"extensionLimit",name:"extensionLimit",value:this.state.course.extensionLimit,onChange:this.handleChange})]})}),n(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:[t(f.Label,{htmlFor:"pass",children:"On Pass"}),n(f.Control,{as:"select",id:"pass",name:"pass",required:!0,value:(s=(e=this.state.course)==null?void 0:e.offerConditions)==null?void 0:s.pass,onChange:this.hanldeOfferConditionChange,children:[t("option",{value:"none",children:"None"}),t("option",{value:"extension",children:"Extension Only"}),t("option",{value:"repurchase",children:"Repurchase Only"}),t("option",{value:"extension-repurchase",children:"Extension Or Repurchase"})]})]}),n(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:[t(f.Label,{htmlFor:"fail",children:"On Fail"}),n(f.Control,{as:"select",id:"fail",name:"fail",required:!0,value:(i=(a=this.state.course)==null?void 0:a.offerConditions)==null?void 0:i.fail,onChange:this.hanldeOfferConditionChange,children:[t("option",{value:"none",children:"None"}),t("option",{value:"extension",children:"Extension Only"}),t("option",{value:"repurchase",children:"Repurchase Only"}),t("option",{value:"extension-repurchase",children:"Extension Or Repurchase"})]})]}),n(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:[t(f.Label,{htmlFor:"expiry",children:"On Expiry"}),n(f.Control,{as:"select",id:"expiry",name:"expiry",required:!0,value:(d=(r=this.state.course)==null?void 0:r.offerConditions)==null?void 0:d.expiry,onChange:this.hanldeOfferConditionChange,children:[t("option",{value:"none",children:"None"}),t("option",{value:"extension",children:"Extension Only"}),t("option",{value:"repurchase",children:"Repurchase Only"}),t("option",{value:"extension-repurchase",children:"Extension Or Repurchase"})]})]}),n(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:[t(f.Label,{htmlFor:"certificateExpiry",children:"On Certificate Expiry"}),n(f.Control,{as:"select",id:"certificateExpiry",name:"certificateExpiry",required:!0,value:(h=(c=this.state.course)==null?void 0:c.offerConditions)==null?void 0:h.certificateExpiry,onChange:this.hanldeOfferConditionChange,children:[t("option",{value:"none",children:"None"}),t("option",{value:"extension",children:"Extension Only"}),t("option",{value:"repurchase",children:"Repurchase Only"}),t("option",{value:"extension-repurchase",children:"Extension Or Repurchase"})]})]})]})}),t(L,{className:"mb-3 mt-4 bp",onClick:()=>{this.addNew("extension")},children:"New Extension"}),t(Me,{rows:(v=(b=(u=(p=this.state)==null?void 0:p.course)==null?void 0:u.offerOptions)==null?void 0:b.extension)!=null?v:[],columns:[{text:"Extension Time",field:(F,G)=>t("input",{type:"text",name:"extension-time",id:`extension-time-${G}`,value:F.time,onChange:q=>{this.hanldeTableChange("extension","time",G,q.target.value)}}),maxWidth:"50%",minWidth:"50%"},{text:"Price",field:(F,G)=>t("input",{type:"text",name:"extension-price",id:`extension-price-${G}`,value:F.price,onChange:q=>{this.hanldeTableChange("extension","price",G,q.target.value)}}),maxWidth:"50%",minWidth:"50%"}]}),t(L,{className:"mb-3 mt-5 bp",onClick:()=>{this.addNew("repurchase")},children:"New Repurchase"}),t(Me,{rows:(O=(k=(_=(S=this.state)==null?void 0:S.course)==null?void 0:_.offerOptions)==null?void 0:k.repurchase)!=null?O:[],columns:[{text:"Price",field:(F,G)=>t("input",{type:"text",name:"repurchase-price",id:`repurchase-price-${F._id}`,value:F.price,onChange:q=>{this.hanldeTableChange("repurchase","price",G,q.target.value)}}),maxWidth:"50%",minWidth:"50%"}]})]})}}var _c=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(wc));class Lt extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{title:""});o(this,"handleTitleChange",e=>{this.setState({title:e.target.value})})}render(){return n("div",{className:"pt-4",children:[n("label",{htmlFor:"newItemTitle",children:["Add new ",this.props.type]}),n("div",{style:{display:"flex",justifyContent:"start"},children:[t("div",{className:"pr-3 w-100",children:t(f.Control,{type:"text",minLength:"3",maxLength:"512",name:"newItemTitle",placeholder:`${this.props.type[0].toUpperCase()+this.props.type.substr(1)} title`,value:this.state.title,onChange:this.handleTitleChange})}),t("div",{children:t(L,{disabled:!this.state.title,variant:"link",type:"button",onClick:()=>{this.props.addNewItem(this.state.title,this.props.type,this.props.parentId,this.props.numOfItems),this.setState({title:""})},children:t("strong",{children:"Create"})})})]})]})}}class rt extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{editable:!1,value:this.props.doc[this.props.prop]});o(this,"submit",async()=>{const{success:e,message:s}=await C("PATCH",`/courses/lessons/${this.props.doc._id}`,{[this.props.prop]:this.state.value});e&&(this.setState({editable:!1}),this.props.recalculateTotalTimes&&this.props.recalculateTotalTimes(y(m({},this.props.doc),{[this.props.prop]:this.state.value}))),this.props.setGlobalAlert({type:e?"success":"error",message:s})})}render(){return n("div",{className:"limitTitle",children:[this.state.editable?this.props.inputField?this.props.inputField(this.state.value,e=>{this.setState({value:e})}):t(f.Control,{className:"d-inline-block",type:this.props.type,required:!0,minLength:this.props.type==="text"?"3":void 0,maxLength:this.props.type==="text"?"512":void 0,min:this.props.type==="number"?"0":void 0,name:this.props.prop,value:this.state.value,onClick:e=>{e.stopPropagation()},onChange:e=>{this.setState({value:e.target.value})}}):t("span",{children:this.props.translateValue?this.props.translateValue(this.state.value):this.state.value}),this.state.editable?t("button",{type:"button",className:"btn bp ml-2",onClick:e=>{e.stopPropagation(),this.submit()},children:t(I,{icon:se})}):t(I,{onClick:e=>{e.stopPropagation(),this.setState({editable:!0})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]})}}function kc(){const l=g.exports.useContext(Ae);return t(L,{variant:"link",type:"button",children:t(I,{icon:l?mt:gt})})}class Tc extends g.exports.Component{constructor(e){super(e);o(this,"state",{isLoading:!1,chapters:[],checkedChapters:new Set,checkedLessons:new Set,bulkAction:"",totalProgressTime:0,totalRequiredTime:0,modalShow:!1,modalAction:()=>{},modalText:"",activeChapterId:""});o(this,"allLessons",new Set);o(this,"UNLOCK_LESSON_OPTS",{ALWAYS_UNLOCKED:"All time",ON_LESSON_START:"When started",REQUIRED_TIME_MET:"When Timer Met",ON_QUIZ_START:"When Quiz Started",ON_QUIZ_END:"When Quiz Finished",ON_QUIZ_PASS:"When Quiz Passed"});o(this,"unlockLessonOpts",[]);o(this,"loadData",async()=>{if(this.props.courseId){this.setState({isLoading:!0});const{success:e,response:s}=await C("GET",`/courses/chapters/course/${this.props.courseId}`);if(e){this.allLessons=new Set;const a=s.chapters.map(i=>{this[`ref-${i._id}`]=z.createRef();const r=i.lessons.map(d=>(this.allLessons.add(d._id),d.editable={title:!1,maxTime:!1,requiredTime:!1,unlockNextLesson:!1},d.unlockNextLesson||(d.unlockNextLesson="ALWAYS_UNLOCKED"),d));return y(m({},i),{lessons:r,editable:{title:!1}})});this.setState({chapters:a}),this.recalculateTotalTimes()}this.setState({isLoading:!1})}});o(this,"handleSelectAll",e=>{e.target.checked?this.setState({checkedChapters:new Set(this.state.chapters.map(s=>s._id)),checkedLessons:new Set(this.allLessons)}):this.setState({checkedChapters:new Set,checkedLessons:new Set})});o(this,"handleChapterCheck",e=>{const{checkedChapters:s,checkedLessons:a}=this.state,i=e.target;let r=i.parentElement.parentElement.parentElement.parentElement.parentElement.querySelectorAll('input[type="checkbox"][name^="lesson"]');r.length&&(r=[...r]),i.checked?(s.add(i.dataset.id),r.map(d=>a.add(d.dataset.id))):(s.delete(i.dataset.id,1),r.map(d=>a.delete(d.dataset.id))),this.setState({checkedChapters:s,checkedLessons:a})});o(this,"handleLessonCheck",e=>{const{checkedLessons:s}=this.state,a=e.target;a.checked?s.add(a.dataset.id):s.delete(a.dataset.id),this.setState({checkedLessons:s})});o(this,"handleActionSelect",e=>{this.setState({bulkAction:e.target.value})});o(this,"submitAction",async()=>{const{state:{bulkAction:e,checkedChapters:s,checkedLessons:a}}=this,{success:i,message:r}=await C("PATCH","/courses/lessons/bulk",{lessons:Array.from(a),fields:{unlockNextLesson:e}});i&&(this.props.setGlobalAlert({type:i?"success":"error",message:r}),this.setState({checkedChapters:new Set,checkedLessons:new Set},this.loadData))});o(this,"handleSubmit",async e=>{e.preventDefault();let{bulkAction:s,checkedLessons:a}=this.state;!s||!a.size||(a=Array.from(a),s==="DELETE_SELECTED"?this.setState({modalShow:!0,modalText:"delete selected lessons",modalAction:async()=>{const{success:i,message:r}=await C("DELETE",`/courses/lessons/${a.join(",")}`);i&&(this.props.setGlobalAlert({type:i?"success":"error",message:r}),this.setState({checkedChapters:new Set,checkedLessons:new Set},this.loadData))}}):this.submitAction())});o(this,"handleChapterChange",(e,s,a)=>{this.setState({chapters:this.state.chapters.map(i=>i._id===e?y(m({},i),{[s]:a}):i)})});o(this,"recalculateTotalTimes",(e,s)=>{e&&s&&this.setState({chapters:this.state.chapters.map(d=>(d._id===e._id&&(d.lessons=d.lessons.map(c=>c._id===s._id?s:c)),d))});let a=0,i=0;const r=this.state.chapters.map(d=>(d=this.calculateChapterTimes(d),a+=d.maxTime,i+=d.requiredTime,d));this.setState({chapters:r,totalProgressTime:a,totalRequiredTime:i})});o(this,"calculateChapterTimes",e=>{const s=e.lessons.reduce((i,r)=>{const d=r.maxTime;return i+parseInt(d||0)},0),a=e.lessons.reduce((i,r)=>{const d=r.requiredTime;return i+parseInt(d||0)},0);return e.maxTime=s,e.requiredTime=a,e});o(this,"submitLesson",async(e,s,a)=>{const{success:i,message:r}=await C("PATCH",`/courses/lessons/${s._id}`,{[a]:s[a]});this.props.setGlobalAlert({type:i?"success":"error",message:r})});o(this,"submitChapter",async e=>{const{success:s,message:a}=await C("PUT",`/courses/chapters/${e._id}`,{title:e.title,menuIndex:e.menuIndex});s&&this.handleChapterChange(e._id,"editable",y(m({},e.editable),{title:!1})),this.props.setGlobalAlert({type:s?"success":"error",message:a})});o(this,"handleDragAndDropChapter",e=>{if(!e.destination||e.destination.index===e.source.index)return;let s=[...this.state.chapters];const[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.setState({chapters:s.map((i,r)=>(i.menuIndex!==r&&(i.menuIndex=r,this.submitChapter(i)),i))})});o(this,"handleDragAndDropLesson",(e,s)=>{if(!s.destination||s.destination.index===s.source.index)return;const a=this.state.chapters.map(i=>{if(e===i._id){let r=[...i.lessons];const[d]=r.splice(s.source.index,1);r.splice(s.destination.index,0,d),i.lessons=r.map((c,h)=>(c.menuIndex!==h&&(c.menuIndex=h,this.submitLesson(i,c,"menuIndex")),c))}return i});this.setState({chapters:a})});o(this,"convertTime",e=>{let s=Math.floor(e/60),a=e-s*60;return s+"h "+a+"m"});o(this,"delete",async(e,s)=>{const a=`/courses/${e}s/${s}`,{success:i,response:r}=await C("DELETE",a);i?(this.props.setGlobalAlert({type:"success",message:`${e[0].toUpperCase()+e.substr(1)} has been deleted`}),this.loadData()):this.props.setGlobalAlert({type:"error",message:`There was an unexpected problem with deleting this ${e}`})});o(this,"clone",async(e,s)=>{const a=`/courses/${e}s/${s}/clone`,{success:i,response:r}=await C("POST",a);i?(this.props.setGlobalAlert({type:"success",message:`${e[0].toUpperCase()+e.substr(1)} has been cloned`}),this.loadData()):this.props.setGlobalAlert({type:"error",message:`There was an unexpected problem with cloning this ${e}`})});o(this,"addNewItem",async(e,s,a,i)=>{const r=`/courses/${s}s`,d=s==="lesson"?"chapterId":"courseId",{success:c,response:h,message:p}=await C("POST",r,{[d]:a,title:e,menuIndex:i});this.props.setGlobalAlert({type:c?"success":"error",message:p}),c&&this.loadData()});this.unlockLessonOpts=Object.keys(this.UNLOCK_LESSON_OPTS).map(s=>({value:s,label:this.UNLOCK_LESSON_OPTS[s]}))}async componentDidMount(){await this.loadData()}render(){const{chapters:e,checkedChapters:s,checkedLessons:a,bulkAction:i}=this.state,r=new URLSearchParams(this.props.location.search);return this.state.isLoading?t("div",{children:t(Q,{})}):n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:()=>{this.state.modalAction(),this.setState({modalShow:!1})},titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalText},"modal-type"),"."]}),n("form",{onSubmit:this.handleSubmit,children:[n("div",{className:"bulk-actions",children:[t("div",{style:{width:"14%",paddingTop:"8px"},children:n("label",{htmlFor:"selectAll",children:[t("input",{type:"checkbox",name:"selectAll",id:"selectAll",onChange:this.handleSelectAll,checked:s.size===e.length&&a.size===this.allLessons.size}),"\xA0 Select all"]})}),t("div",{style:{width:"26%",display:"flex",justifyContent:"flex-end"},children:n("div",{className:"px-3",children:[t("strong",{children:"Total Progress:\xA0"}),t("div",{className:"d-inline-block",children:this.convertTime(this.state.totalProgressTime)})]})}),t("div",{style:{width:"26%",display:"flex",justifyContent:"flex-end"},children:n("div",{className:"px-3",children:[t("strong",{children:"Total Required:\xA0"}),t("div",{className:"d-inline-block",children:this.convertTime(this.state.totalRequiredTime)})]})}),n("div",{style:{width:"34%",display:"flex",justifyContent:"flex-end"},children:[n(f.Control,{as:"select",onChange:this.handleActionSelect,children:[t("option",{value:"",children:"Bulk action"}),t("option",{value:"ON_LESSON_START",children:"Update to When Started"}),t("option",{value:"REQUIRED_TIME_MET",children:"Update to When Timer Met"}),t("option",{value:"ON_QUIZ_START",children:"Update to When Quiz Started"}),t("option",{value:"ON_QUIZ_END",children:"Update to When Quiz Finished"}),t("option",{value:"ON_QUIZ_PASS",children:"Update to When Quiz Passed"}),t("option",{value:"DELETE_SELECTED",children:"Delete Selected"})]}),t(L,{className:"bd",type:"submit",disabled:s.size===0&&a.size===0||!i,children:"Update"})]})]}),t(T,{className:"table-tree",defaultActiveKey:this.state.activeChapterId||r.get("focus"),children:t(be,{onDragEnd:this.handleDragAndDropChapter,children:t(Ce,{droppableId:"droppable-chapters",children:d=>n("div",y(m({},d.droppableProps),{ref:d.innerRef,children:[e.map((c,h)=>t(le,{draggableId:`draggable-chapter-${c._id}`,index:h,children:p=>{var u,b;return n(B,y(m({ref:p.innerRef},p.draggableProps),{children:[t(B.Header,{children:n(T.Toggle,{as:"div",style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"56px"},eventKey:c._id,children:[n("div",{style:{display:"flex",width:"6%",minWidth:"70px",maxWidth:"82px",justifyContent:"flex-start",alignItems:"center"},children:[t("div",{children:t("span",y(m({style:{padding:"0 0 0 10px"}},p.dragHandleProps),{onClick:v=>{v.stopPropagation()},children:t(I,{icon:Re})}))}),t("div",{children:t("input",{style:{margin:"4px 0 0 20px"},type:"checkbox",name:`chapter-${c._id}`,"data-id":c._id,onChange:this.handleChapterCheck,onClick:v=>{v.stopPropagation()},checked:s.has(c._id)})})]}),n("div",{style:{width:"30%"},children:[(u=c.editable)!=null&&u.title?t(f.Control,{className:"d-inline-block",type:"text",required:!0,minLength:"3",maxLength:"512",name:"title",value:c.title,onClick:v=>{v.stopPropagation()},onChange:v=>{this.handleChapterChange(c._id,"title",v.target.value)}}):c.title,(b=c.editable)!=null&&b.title?t("button",{type:"button",className:"btn bp ml-2",onClick:v=>{v.stopPropagation(),this.submitChapter(c)},children:t(I,{icon:se})}):t(I,{onClick:v=>{v.stopPropagation(),this.handleChapterChange(c._id,"editable",y(m({},c.editable),{title:!0}))},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]}),n("div",{className:"px-3",style:{width:"20%"},children:[t("strong",{children:"Progress:\xA0"}),t("div",{className:"d-inline-block",children:this.convertTime(c.maxTime)})]}),n("div",{className:"px-3",style:{width:"20%"},children:[t("strong",{children:"Required:\xA0"}),t("div",{className:"d-inline-block",children:this.convertTime(c.requiredTime)})]}),n("div",{style:{width:"24%",display:"flex",justifyContent:"flex-end",paddingRight:"10px"},children:[t(U,{placement:"top",overlay:t(M,{id:`tooltip-delete-${c._id}`,children:"Delete"}),children:t(L,{variant:"link",type:"button",onClick:v=>{v.stopPropagation(),this.setState({modalShow:!0,modalText:"delete this chapter",modalAction:()=>{this.delete("chapter",c._id)}})},children:t(I,{icon:Ve})})},`tooltip-delete-${c._id}`),t(U,{placement:"top",overlay:t(M,{id:`tooltip-clone-${c._id}`,children:"Clone"}),children:t(L,{variant:"link",type:"button",className:"mx-2",onClick:v=>{v.stopPropagation(),this.setState({modalShow:!0,modalText:"clone this chapter",modalAction:()=>{this.clone("chapter",c._id),this.setState({activeChapterId:c._id})}})},children:t(I,{icon:Ne})})},`tooltip-clone-${c._id}`),t(kc,{})]})]})}),t(T.Collapse,{eventKey:c._id,children:n(B.Body,{children:[t(Me,{handleDragAndDrop:this.handleDragAndDropLesson,highlightRow:v=>this.props.location.search.includes(v._id),chapter:c,droppableId:"lessons",draggableId:"lesson",minTableWidth:"992px",rows:c==null?void 0:c.lessons,columns:[{text:"",field:v=>n("div",{style:{display:"block",width:"70px"},children:[t("div",{className:"d-inline-block pl-1",style:{width:"40%"},children:t("span",y(m({style:{padding:0}},v.provided.dragHandleProps),{onClick:S=>{S.stopPropagation()},children:t(I,{icon:Re})}))}),t("div",{className:"d-inline-block px-1",style:{width:"60%"},children:t("input",{type:"checkbox",name:`lesson-${v._id}`,"data-id":v._id,onChange:this.handleLessonCheck,checked:this.state.checkedLessons.has(v._id)})})]}),minWidth:"6%",maxWidth:"6%"},{text:"Lesson Name",field:v=>t(rt,{doc:v,type:"text",prop:"title",setGlobalAlert:this.props.setGlobalAlert}),maxWidth:"29%",minWidth:"29%"},{text:"Progress Time",field:v=>t(rt,{doc:v,type:"number",prop:"maxTime",recalculateTotalTimes:S=>{this.recalculateTotalTimes(c,S)},setGlobalAlert:this.props.setGlobalAlert}),maxWidth:"14%",minWidth:"14%"},{text:"Required Time",field:v=>t(rt,{doc:v,type:"number",prop:"requiredTime",recalculateTotalTimes:S=>{this.recalculateTotalTimes(c,S)},setGlobalAlert:this.props.setGlobalAlert}),maxWidth:"14%",minWidth:"14%"},{text:"Unlock Next Lesson",field:v=>t(rt,{doc:v,prop:"unlockNextLesson",setGlobalAlert:this.props.setGlobalAlert,translateValue:S=>this.UNLOCK_LESSON_OPTS[S],inputField:(S,_)=>t(Fe,{menuShouldBlockScroll:!0,name:"unlockNextLesson",defaultValue:S||"ALWAYS_UNLOCKED",value:this.unlockLessonOpts.filter(k=>k.value===S)[0],options:this.unlockLessonOpts,menuPortalTarget:document.body,menuPosition:"fixed",onChange:k=>{_(k.value)}})}),maxWidth:"24%",minWidth:"24%"},{text:"",field:v=>n("div",{style:{display:"flex",justifyContent:"flex-end"},children:[t(U,{placement:"top",overlay:t(M,{id:`tooltip-delete-${v._id}`,children:"Delete"}),children:t(L,{variant:"link",type:"button",onClick:S=>{S.stopPropagation(),this.setState({modalShow:!0,modalText:"delete this lesson",modalAction:()=>{this.delete("lesson",v._id),this.setState({activeChapterId:c._id})}})},children:t(I,{icon:Ve})})},`tooltip-delete-${v._id}`),t(U,{placement:"top",overlay:t(M,{id:`tooltip-clone-${v._id}`,children:"Clone"}),children:t(L,{variant:"link",type:"button",className:"mx-2",onClick:S=>{S.stopPropagation(),this.setState({modalShow:!0,modalText:"clone this lesson",modalAction:()=>{this.clone("lesson",v._id)}})},children:t(I,{icon:Ne})})},`tooltip-clone-${v._id}`),t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${v._id}`,children:"Edit"}),children:t(R,{className:"btn",to:`/admin/courses/${this.props.courseId}/chapters/${c._id}/lessons/${v._id}`,children:t(I,{icon:Ge})})},`tooltip-edit-${v._id}`)]}),maxWidth:"13%",minWidth:"13%"}]}),t(Lt,{type:"lesson",addNewItem:(v,S,_,k)=>{this.addNewItem(v,S,_,k),this.setState({activeChapterId:c._id})},parentId:c._id,numOfItems:c.lessons.length})]})})]}),c._id)}},`draggable-chapter-${c._id}`)),d.placeholder]}))})})})]}),t(Lt,{type:"chapter",addNewItem:this.addNewItem,parentId:this.props.courseId,numOfItems:this.state.chapters.length})]})}}var Nc=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Tc));class Ac extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"state",{loading:!0,isDirty:!1,redirect:null,course:{title:"",description:"",inactiveTime:"",mediaControlsTimer:!1,outOfFocusPause:!1,availability:"",imageFileId:"",imagePreviewUrl:"",imageFile:null}});o(this,"doRedirect",e=>{this.toggleSpinner(),this.props.setGlobalAlert({type:"success",message:`Course has been ${this.docId!=="new"?"updated":"created"}`}),this.docId==="new"&&this.setState({redirect:`/admin/courses/${e}`})});o(this,"getPayload",()=>({title:this.state.course.title,description:this.state.course.description,image:this.state.course.imageFileId,mediaControlsTimer:this.state.course.mediaControlsTimer,outOfFocusPause:this.state.course.outOfFocusPause,inactiveTime:this.state.course.inactiveTime*60,availability:this.state.course.availability,conditionStatement:this.state.course.conditionStatement}));o(this,"setIsDirty",e=>{this.setState({isDirty:e})});o(this,"handleChange",e=>{this.setState({isDirty:!0,course:y(m({},this.state.course),{[e.target.name]:e.target.value})})});o(this,"handleImageChange",(e,s,a)=>{this.setState({isDirty:!0,course:y(m({},this.state.course),{imagePreviewUrl:s,imageFile:a})})});o(this,"handleSubmit",async e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setIsDirty(!1),this.toggleSpinner(),await this.submit()});o(this,"handleSubmitFailed",()=>{this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Course. Please try again"}),this.toggleSpinner()});o(this,"toggleSpinner",e=>{this.setState({loading:!this.state.loading})});o(this,"submit",async()=>{if(this.state.course.imageFile){let r=new FormData;r.append("file",this.state.course.imageFile);const{success:d,response:c}=await C("POST","/files",r);d&&this._isMounted&&this.setState({course:y(m({},this.state.course),{imageFileId:c.fileId,imagePreviewUrl:await xe(c.fileId),imageFile:null})})}if(!this._isMounted)return;let e="POST",s="/courses";this.docId!=="new"&&(e="PUT",s=`/courses/${this.docId}`);const{success:a,response:i}=await C(e,s,this.getPayload());this._isMounted&&(a&&i?this.doRedirect(i._id):this.handleSubmitFailed())});o(this,"createButtons",()=>{var s,a,i,r;let e=[{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:!this.state.isDirty},{label:"Publish",disabled:!0}];(a=(s=this.state)==null?void 0:s.lesson)!=null&&a.previousLesson&&e.push({label:"Previous",className:"lesson-navigation-btn",icon:faChevronLeft,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.state.lesson.previousLesson.chapterId}/ext/lessons/edit/${this.state.lesson.previousLesson._id}`}),(r=(i=this.state)==null?void 0:i.lesson)!=null&&r.nextLesson&&e.push({label:"Next",className:"lesson-navigation-btn",icon:faChevronRight,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.state.lesson.nextLesson.chapterId}/ext/lessons/edit/${this.state.lesson.nextLesson._id}`}),this.props.createFormActions({customButtons:e})});o(this,"componentDidMount",async()=>{this._isMounted=!0,this.docId!=="new"&&await this.loadData(),this.createButtons()});o(this,"componentWillUnmount",()=>{this._isMounted=!1,window.socket.emit("remove user editing course",this.docId),this.props.createFormActions({})});o(this,"loadData",async()=>{if(this.docId&&this.docId!=="new"){this.setState({loading:!0});const{success:e,response:s}=await C("GET",`/courses/${this.docId}`);e&&this._isMounted&&this.setState({loading:!1,redirect:null,course:y(m({},s),{imagePreviewUrl:await xe(s.image),availability:s.availability,inactiveTime:s.inactiveTime/60})})}else this.setState({loading:!1})});o(this,"onKeyPress",e=>{if(e.charCode===13&&e.target.nodeName!=="TEXTAREA"){e.preventDefault();const s=["TEXTAREA","INPUT","SELECT"],a=document.getElementById("form");if(a){const i=Array.from(a.elements).filter(d=>s.indexOf(d.tagName)>=0),r=i.indexOf(e.target);i[(r+1)%i.length].focus()}}});this.docId=this.props.match.params.courseId}async componentDidUpdate(e,s,a){this.state.isDirty!==s.isDirty&&this.createButtons(),e.match.params.courseId!==this.props.match.params.courseId&&(this.docId=this.props.match.params.courseId,await this.loadData()),this.props.formActions.state&&this.props.formActions.state.reload&&(this.props.formActions.state.cancel&&this.props.history.push("/admin/courses"),this.props.createFormActions(y(m({},this.props.formActions.state),{reload:!1})),await this.loadData())}render(){let e;if(this.state.redirect)e=t(Se,{to:this.state.redirect});else if(this.state.loading&&this.docId!=="new")e=t(Q,{});else{const{course:s}=this.state;e=n(w,{children:[Array.isArray(s.editingAdmins)&&s.editingAdmins.length>1&&t("div",{className:"pt-4",children:t("span",{className:"message-alert warning narrow",dangerouslySetInnerHTML:{__html:`${s.editingAdmins.reduce((a,{_id:i,firstName:r,lastName:d})=>(i!==this.props.loggedIn.user._id&&a.push(`<b>${r} ${d}</b>`),a),[]).join(", ")}
                                ${s.editingAdmins.length>2?" are":" is "}
                                also editing this course`}})}),t(f,{onSubmit:this.handleSubmit,id:"courseForm",onKeyPress:this.onKeyPress,children:n(A,{className:"pt-5",children:[t(x,{lg:7,children:n(A,{children:[n(x,{lg:8,children:[t(A,{children:t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Course Name"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"title",name:"title",value:s.title,onChange:this.handleChange})]})})}),n(A,{className:"pt-4",children:[t(x,{xs:12,md:6,children:n(E,{children:[t(f.Label,{htmlFor:"inactiveTime",children:"Inactive Time (mins)"}),t(f.Control,{type:"number",min:"0",id:"inactiveTime",name:"inactiveTime",value:s.inactiveTime,onChange:this.handleChange})]})}),t(x,{xs:12,md:6,children:n(E,{children:[n(f.Label,{htmlFor:"outOfFocusPause",children:[t(kt,{effect:"solid",multiline:!0}),"Pause on non focus\xA0",t(Tt,{"data-tip":"When enabled, the timer will pause and a popup will appear <br/> when the student navigates away from the lessons tab."})]}),n(f.Control,{as:"select",required:!0,id:"outOfFocusPause",name:"outOfFocusPause",value:s.outOfFocusPause,onChange:this.handleChange,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})})]})]}),t(x,{lg:4,children:n(A,{children:[t(x,{xs:12,children:n(E,{children:[t(f.Label,{htmlFor:"availability",children:"Availability (days)"}),t(f.Control,{id:"availability",name:"availability",type:"number",min:"0",step:"1",value:s.availability||"",onChange:this.handleChange})]})}),t(x,{xs:12,className:"pt-4",children:n(E,{children:[n(f.Label,{htmlFor:"mediaControlsTimer",children:[t(kt,{effect:"solid",multiline:!0}),"Pause on media controls\xA0",t(Tt,{"data-tip":"When enabled, the timer will pause and a popup will appear <br/> when media playback is paused."})]}),n(f.Control,{as:"select",required:!0,id:"mediaControlsTimer",name:"mediaControlsTimer",value:s.mediaControlsTimer,onChange:this.handleChange,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})})]})})]})}),t(x,{lg:5,children:n(A,{children:[t(x,{lg:6,children:t(A,{children:t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"description",children:"Description"}),t(f.Control,{as:"textarea",type:"text",required:!0,rows:"6",id:"description",name:"description",value:s.description,onChange:this.handleChange})]})})})}),t(x,{lg:6,children:t(A,{children:t(x,{children:t(E,{children:t(We,{id:"image",name:"image",url:s.imagePreviewUrl,handleFileChange:this.handleImageChange,type:"image",required:s.imagePreviewUrl})})})})})]})})]})}),t(A,{className:"pt-0",children:t(x,{children:t(Nc,{courseId:this.docId})})})]})}return n("div",{children:[t(Ye,{when:this.state.isDirty,navigate:s=>this.props.history.push(s),shouldBlockNavigation:()=>this.state.isDirty}),t("main",{children:e})]})}}var Lc=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(Ac));class Ec extends g.exports.Component{render(){var i;const{provided:e,field:s,isPdf:a}=this.props;return t(B.Header,y(m({},e.dragHandleProps),{children:n(T.Toggle,{as:"div",className:"field-header",eventKey:`draggable-${s.id}`,children:[!a&&t(I,{icon:hn}),s.control.titleEditable===!0?n(w,{children:[t(f.Control,{className:"d-inline-block",type:"text",required:!0,minLength:3,maxLength:512,name:"title",value:(i=s.control.tempTitle)!=null?i:s.title,onClick:r=>{r.stopPropagation()},onChange:r=>{this.props.handleFieldTitleChange(r.target.value)}}),t("div",{className:"rf-action confirm-wrapper",onClick:r=>{r.stopPropagation(),this.props.confirmTitleChange()},children:t(I,{icon:se})}),t("div",{className:"rf-action cancel-wrapper",onClick:r=>{r.stopPropagation(),this.props.cancelTitleChange()},children:t(I,{icon:fe})})]}):n(w,{children:[s.title,!a&&t("div",{className:"rf-action edit-wrapper",onClick:r=>{r.stopPropagation(),this.props.toggleEditTitle()},children:t(I,{icon:J})})]}),!a&&t("div",{className:"rf-action delete-wrapper",onClick:r=>{r.stopPropagation(),this.props.deleteField()},children:t(I,{icon:ae})})]})}))}}class _t extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isOpen:!1});o(this,"toggleIsOpen",()=>{this.setState({isOpen:!this.state.isOpen})})}render(){return n("div",{className:"reporting-field-section",children:[n("div",{className:"section-header",onClick:this.toggleIsOpen,children:[t(I,{icon:this.state.isOpen?Ue:Be}),t("span",{children:this.props.label}),t("div",{className:"divider"})]}),this.state.isOpen&&t("div",{className:"rfs-children",children:this.props.children})]})}}class De extends g.exports.Component{render(){const{name:e,id:s,type:a,onChange:i,checked:r,value:d,onClick:c}=this.props;return n("div",{className:`toggle-input toggle-input--${a}${r?` toggle-input--${a}--checked`:""}`,onClick:c,children:[t("input",{type:a==="radio"?"radio":"checkbox",name:e,value:d,id:s,checked:r,onChange:i}),a==="checkbox"?t("svg",{id:"check",fill:"currentColor",viewBox:"-281 373 48 48",width:"18px",height:"18px",children:t("path",{id:"check-stroke",d:"M-273.2,398.2l10,9.9 l22.4-22.3"})}):t("div",{})]})}}class $c extends g.exports.Component{constructor(){super(...arguments);o(this,"selectOption",e=>{this.props.handleChange("capitalisation",e.target.name)})}render(){return n("div",{className:"capitalisation-option",children:[n("div",{className:"toggle-option",children:[t(De,{type:"radio",name:"none",id:"none",checked:this.props.selectedOption==="none"||this.props.selectedOption===void 0,onChange:this.selectOption}),t("label",{htmlFor:"none",children:"None"})]}),n("div",{className:"toggle-option",children:[t(De,{type:"radio",name:"capitalise",id:"capitalise",checked:this.props.selectedOption==="capitalise",onChange:this.selectOption}),t("label",{htmlFor:"capitalise",children:"Capitalise"})]}),n("div",{className:"toggle-option",children:[t(De,{type:"radio",name:"uppercase",id:"uppercase",checked:this.props.selectedOption==="uppercase",onChange:this.selectOption}),t("label",{htmlFor:"uppercase",children:"Uppercase"})]}),n("div",{className:"toggle-option",children:[t(De,{type:"radio",name:"lowercase",id:"lowercase",checked:this.props.selectedOption==="lowercase",onChange:this.selectOption}),t("label",{htmlFor:"lowercase",children:"Lowercase"})]})]})}}class Dc extends g.exports.Component{constructor(){super(...arguments);o(this,"handleChange",(e,s)=>{this.props.handleChange(this.props.index,e,s)});o(this,"handleInputChange",e=>{this.handleChange(e.target.name,e.target.value)})}render(){var a,i,r;const{options:e}=this.props,s=this.props.options.type;return n(E,{className:"source-options",children:[t(I,{icon:fe,onClick:this.props.closeSouceOptions}),["string"].includes(s)&&t(_t,{label:"Capitalisation",children:t($c,{handleChange:this.handleChange,selectedOption:e.capitalisation})}),["date"].includes(s)&&n(_t,{label:"Date Format",children:[t(f.Label,{htmlFor:"dateFormat"}),t(f.Control,{type:"text",required:!0,minLength:3,maxLength:512,id:"dateFormat",name:"dateFormat",value:(a=e.dateFormat)!=null?a:"mm/dd/yyyy",onChange:this.handleInputChange})]}),["string","number","date"].includes(s)&&n(_t,{label:"Custom Text",children:[t(f.Label,{htmlFor:"prependString",children:"Prepend"}),t(f.Control,{type:"text",required:!0,minLength:3,maxLength:512,id:"prependString",name:"prependString",value:(i=e.prependString)!=null?i:"",onChange:this.handleInputChange}),t(f.Label,{htmlFor:"appendString",children:"Append"}),t(f.Control,{type:"text",required:!0,minLength:3,maxLength:512,id:"appendString",name:"appendString",value:(r=e.appendString)!=null?r:"",onChange:this.handleInputChange})]})]})}}class Pc extends g.exports.Component{render(){const{provided:e,source:s,index:a,activeOptions:i,sourceLength:r,availableDataTargets:d}=this.props;return n("div",y(m(m({className:"target"},e.draggableProps),e.dragHandleProps),{ref:e.innerRef,children:[t("div",{className:"rf-action move-wrapper",children:t(I,{icon:hn})}),t(f.Control,{as:"select",id:"target",name:"target",value:s.target,onChange:c=>{this.props.handleChange(a,c.target.value)},children:d==null?void 0:d.map((c,h)=>t("option",{value:c.path,children:c.label},h))}),r!==1&&t("div",{className:"rf-action delete-wrapper",onClick:()=>{this.props.deleteSource(a)},children:t(I,{icon:ae})}),t("div",{className:"rf-action",onClick:()=>{this.props.addNewSource(a)},children:t(I,{icon:Co})}),t(L,{className:i===a?"selected":"",variant:"link",type:"button",onClick:()=>{this.props.setActiveOptions(a)},children:t("strong",{children:"Options"})})]}))}}class Oc extends g.exports.Component{constructor(e){super(e);o(this,"handleSourceChange",(e,s)=>{var r;const a=Object.assign({},this.state.field),i=this.props.availableDataTargets.find(d=>d.path===s);a.data[e].target=s,a.data[e].options.type=(r=i==null?void 0:i.type)!=null?r:"string",this.setState({field:a}),this.props.onChange("data",a.data)});o(this,"addNewSource",e=>{const s=Object.assign({},this.state.field),a={target:this.props.availableDataTargets[0].path,options:{type:this.props.availableDataTargets[0].type,prependString:" "}};s.data.splice(e+1,0,a),this.setState({field:s}),this.props.onChange("data",s.data)});o(this,"deleteSource",e=>{const s=Object.assign({},this.state.field);s.data.splice(e,1),this.setState({field:s}),this.props.onChange("data",s.data)});o(this,"setActiveOptions",e=>{let s=this.state.activeOptions;s===null||s!==e?s=e:s=null,this.setState({activeOptions:s})});o(this,"closeSouceOptions",()=>{this.setState({activeOptions:null})});o(this,"handleOptionsChange",(e,s,a)=>{const i=Object.assign({},this.state.field);i.data[e].options[s]=a,this.setState({field:i}),this.props.onChange("data",i.data)});o(this,"handleDragAndDropSource",(e,s)=>{if(!e.destination||e.destination.index===e.source.index)return;const a=this.state.field.data.slice(),[i]=a.splice(e.source.index,1);a.splice(e.destination.index,0,i);const r=y(m({},this.state.field),{data:a});this.setState({field:r}),this.props.onChange("data",r.data)});this.state={field:e.field,activeOptions:null}}componentDidUpdate(e){JSON.stringify(e.field)!==JSON.stringify(this.props.field)&&this.setState({field:this.props.field})}render(){const{field:e,activeOptions:s}=this.state;return t(T.Collapse,{className:"rf-field-card-body",eventKey:`draggable-${e.id}`,children:n(B.Body,{children:[t(E,{className:"targets",children:t(be,{onDragEnd:this.handleDragAndDropSource,children:t(Ce,{droppableId:"droppable-sources",children:a=>n("div",y(m({},a.droppableProps),{ref:a.innerRef,children:[e.data.map((i,r)=>(i.target=i.target||this.props.availableDataTargets[0].path,t(le,{draggableId:`draggable-${r}`,index:r,children:d=>t(Pc,{sourceLength:e.data.length,provided:d,source:i,index:r,availableDataTargets:this.props.availableDataTargets,activeOptions:s,handleChange:this.handleSourceChange,deleteSource:this.deleteSource,addNewSource:this.addNewSource,setActiveOptions:this.setActiveOptions})},`draggable-${r}`))),a.placeholder]}))})})}),s!==null&&t("div",{className:"source-options-container",children:t(Dc,{index:s,options:e.data[s].options,closeSouceOptions:this.closeSouceOptions,handleChange:this.handleOptionsChange})})]})})}}class Rc extends g.exports.Component{constructor(e){super(e);o(this,"handleFieldTitleChange",e=>{const s=this.state.control;s.oldTitle!==null&&(s.oldTitle=this.state.title),s.tempTitle=e,this.setState({control:s})});o(this,"toggleEditTitle",()=>{this.setState({control:y(m({},this.state.control),{titleEditable:!this.state.control.titleEditable})})});o(this,"confirmTitleChange",()=>{const e=this.state.control.tempTitle!==null?this.state.control.tempTitle:this.state.title;this.setState({title:e,control:{titleEditable:!1,oldTitle:null,tempTitle:null}},()=>{this.update()})});o(this,"cancelTitleChange",()=>{this.setState({control:{titleEditable:!1,oldTitle:null,tempTitle:null}})});o(this,"handleBodyChange",(e,s)=>{this.setState(y(m({},this.state),{[e]:s}),()=>{this.update()})});o(this,"deleteField",()=>{this.props.deleteField(this.props.index)});o(this,"update",()=>{const a=this.state,{control:e}=a,s=oe(a,["control"]);this.props.updateField(this.props.index,s)});this.state=y(m({},e.field),{control:{titleEditable:!1,oldTitle:null,tempTitle:null}})}componentDidUpdate(e){JSON.stringify(e.field)!==JSON.stringify(this.props.field)&&this.setState(y(m({},this.props.field),{control:this.state.control}))}render(){const e=this.state,{provided:s,index:a,isPdf:i}=this.props;return n(B,y(m({className:"reporting-field-card",ref:s.innerRef},s.draggableProps),{children:[t(Ec,{provided:s,field:e,handleFieldTitleChange:this.handleFieldTitleChange,toggleEditTitle:this.toggleEditTitle,confirmTitleChange:this.confirmTitleChange,cancelTitleChange:this.cancelTitleChange,deleteField:this.deleteField,isPdf:i}),t(Oc,{field:e,index:a,onChange:this.handleBodyChange,availableDataTargets:this.props.availableDataTargets})]}),`draggable-${e.id}`)}}class Fc extends g.exports.Component{constructor(e){super(e);o(this,"update",e=>{this.setState({fields:e},()=>{this.props.onChange(e)})});o(this,"handleDragAndDropField",e=>{if(!e.destination||e.destination.index===e.source.index)return;const s=this.state.fields.slice(),[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.update(s)});o(this,"updateField",(e,s)=>{const a=this.state.fields.slice();a[e]=s,this.update(a)});o(this,"deleteField",e=>{const s=this.state.fields.slice();s.splice(e,1),this.update(s)});o(this,"addNewField",e=>{const s=this.state.fields.slice(),a={id:yo(),title:e,data:[{target:"",options:{type:"string"}}]};s.push(a),this.update(s)});this.state={fields:e.fields}}componentDidUpdate(e){(JSON.stringify(e.fields)!==JSON.stringify(this.props.fields)||e.isPdf!==this.props.isPdf)&&this.setState({fields:this.props.fields})}render(){const{availableDataTargets:e,isPdf:s}=this.props;return n("div",{className:"reporting-fields",children:[t(T,{className:"table-tree",children:t(be,{onDragEnd:this.handleDragAndDropField,children:t(Ce,{droppableId:"droppable-fields",children:a=>n("div",y(m({},a.droppableProps),{ref:a.innerRef,children:[this.state.fields.map((i,r)=>t(le,{draggableId:`draggable-${i.id}`,index:r,isDragDisabled:s,children:d=>t(Rc,{provided:d,field:i,availableDataTargets:e,index:r,updateField:this.updateField,deleteField:this.deleteField,isPdf:s})},`draggable-${i.id}`)),a.placeholder]}))})})}),!s&&t(Lt,{type:"Field",addNewItem:this.addNewField})]})}}class kn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showModal:!1,modalAction:()=>{},modalBodyText:""});o(this,"handleChange",e=>{const s=Object.assign(this.props.reportingData);s[e.target.name]=e.target.value,this.update(s)});o(this,"handleNoHeaderChange",e=>{const s=y(m({},this.props.reportingData),{noHeader:e.target.name==="noHeader"});this.update(s)});o(this,"handleDateChange",(e,s)=>{const a=y(m({},this.props.reportingData),{[e]:s});this.update(a)});o(this,"handleFieldChange",e=>{const s=Object.assign(this.props.reportingData);s.fields=e,this.update(s)});o(this,"handlePdfDataFieldChange",e=>{const s=Object.assign(this.props.reportingData);s.pdfFields={fields:e},this.update(s)});o(this,"update",e=>{this.props.update(e)});o(this,"confirmLoadTemplate",async e=>{var r;e.preventDefault(),e.stopPropagation();const s=this.props.reportingData.template;if(s==="none"||s===void 0||s===null)return;const{success:a,response:i}=await C("get",`/reporting/templates/${s}`);a&&this.setState({showModal:!0,modalAction:()=>this.loadTemplate(i),modalBodyText:`Are you sure you want to load ${(r=i.title)!=null?r:"this template"}? it will overwrite any changes`})});o(this,"loadTemplate",e=>{this.update(y(m({},e),{template:this.props.reportingData.template,_id:this.props.reportingData._id})),this.setState({showModal:!1,modalAction:()=>{},modalBodyText:""})});o(this,"confirmSaveTemplate",async e=>{var r;e.preventDefault(),e.stopPropagation();const s=this.props.reportingData.template;if(s==="none"||s===void 0||s===null)return;const{success:a,response:i}=await C("get",`/reporting/templates/${s}`);a&&this.setState({showModal:!0,modalAction:()=>this.saveTemplate(s),modalBodyText:`Are you sure you want to overwrite ${(r=i.title)!=null?r:"this template"} with the current settings?`})});o(this,"saveTemplate",async e=>{await C("patch",`/reporting/templates/${e}`,this.props.reportingData),this.setState({showModal:!1,modalAction:()=>{},modalBodyText:""})});o(this,"confirmSaveAsTemplate",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({showModal:!0,modalAction:()=>this.saveAsTemplate(),modalBodyText:`Are you sure you want to save ${this.props.reportingData.title} as a new template?`})});o(this,"saveAsTemplate",async()=>{var a,i;const{success:e,response:s}=await C("post","/reporting/templates",{templateData:this.props.reportingData});e&&((i=(a=this.props)==null?void 0:a.addNewTemplate)==null||i.call(a,s._id),this.setState({showModal:!1,modalAction:()=>{},modalBodyText:""}))})}render(){var s,a;const{reportingData:e}=this.props;return n("div",{className:"reporting-inputs",children:[n(f,{id:"courseForm",children:[t(A,{className:"pt-4",children:t(x,{lg:3,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Title"}),t(f.Control,{type:"text",required:!0,minLength:3,maxLength:512,id:"title",name:"title",value:e.title,onChange:this.handleChange})]})})}),n(A,{className:"pt-2",children:[t(x,{lg:2,children:t(Qe,{raw:!0,id:"start",handleDateChange:this.handleDateChange,date:e.start,label:"Start Date"})}),t(x,{lg:2,children:t(Qe,{raw:!0,id:"end",handleDateChange:this.handleDateChange,date:e.end,label:"End Date"})})]}),n(A,{className:"pt-2",children:[t(x,{lg:2,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Format"}),n(f.Control,{as:"select",id:"format",name:"format",value:e.format,onChange:this.handleChange,children:[t("option",{value:"excel",children:"Excel"}),t("option",{value:"csv",children:"CSV"}),t("option",{value:"txt",children:"TXT"}),t("option",{value:"pdf",children:"PDF"})]})]})}),t(x,{lg:2,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Target"}),n(f.Control,{as:"select",id:"target",name:"target",value:e.target,onChange:this.handleChange,children:[t("option",{value:"passed",children:"Passed"}),t("option",{value:"failed",children:"Failed"}),t("option",{value:"all",children:"All students"})]})]})})]}),this.props.type==="course"&&this.props.availableTemplates&&e.format!=="pdf"&&n(w,{children:[n(A,{className:"pt-2",children:[t(x,{lg:2,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Template"}),n(f.Control,{as:"select",id:"template",name:"template",value:e.template,onChange:this.handleChange,children:[t("option",{value:"none",children:"No Template"},"none"),this.props.availableTemplates.map(i=>t("option",{value:i._id,children:i.title},i._id))]})]})}),n(x,{lg:2,children:[t(f.Label,{htmlFor:"title",children:"Header"}),t(E,{children:n(A,{className:"pt-2 header-toggle",children:[t(De,{type:"radio",name:"header",id:"header",checked:!e.noHeader,onChange:this.handleNoHeaderChange}),t("label",{htmlFor:"header",children:"Header"}),t(De,{type:"radio",name:"noHeader",id:"noHeader",checked:!!e.noHeader,onChange:this.handleNoHeaderChange}),t("label",{htmlFor:"noHeader",children:"No Header"})]})})]})]}),n(A,{className:"pt-2 buttons",children:[t("button",{onClick:this.confirmLoadTemplate,className:"btn bp btn--small",children:"Load Template"}),t("button",{onClick:this.confirmSaveTemplate,className:"btn bp btn--small",children:"Save Template"}),t("button",{onClick:this.confirmSaveAsTemplate,className:"btn bp btn--small",children:"Save as Template"})]})]}),t(A,{className:"pt-4",children:t(Fc,{onChange:e.format==="pdf"?this.handlePdfDataFieldChange:this.handleFieldChange,fields:e.format==="pdf"?(a=(s=e==null?void 0:e.pdfData)==null?void 0:s.fields)!=null?a:[]:e.fields,availableDataTargets:this.props.availableDataTargets,isPdf:e.format==="pdf"})})]}),t(X,{show:this.state.showModal,hideModal:()=>{this.setState({showModal:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:this.state.modalBodyText})]})}}class Uc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isLoading:!0,isEdited:!1,reportingData:{_id:"",title:"",start:new Date(Date.now()),end:new Date(Date.now()),format:"excel",target:"passed",fields:[],pdfData:{fields:[]}},availableTemplates:[],availableDataTargets:[],course:{}});o(this,"fetchCourseData",async()=>{this.state.isLoading||this.setState({isLoading:!0});const{response:e}=await C("GET",`/courses/${this.props.match.params.courseId}`);this.setState({course:e})});o(this,"setBreadcumbs",()=>{this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.props.match.params.courseId}`})});o(this,"fetchReportSettings",async()=>{var i;this.state.isLoading||this.setState({isLoading:!0});const{success:e,response:s,message:a}=await C("get",`/courses/reportsettings/${this.props.match.params.courseId}`);e?(s.target=(i=s.target)!=null?i:"passed",this.setState({reportingData:s,isLoading:!1})):(await this.createReportSettings(),this.fetchReportSettings())});o(this,"createReportSettings",async()=>{await C("post",`/courses/reportsettings/${this.props.match.params.courseId}`)});o(this,"setButtons",()=>{this.props.createFormActions({customButtons:[{label:"Generate Report",onClick:this.generateReport,className:"bp",disabled:this.state.isEdited},{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:!this.state.isEdited}]})});o(this,"generateReport",async()=>{this.setState({isLoading:!0});const{success:e,response:s,message:a}=await C("post",`/courses/reportsettings/${this.state.reportingData._id}/generate`);e?window.open(s.url,"_blank"):this.props.setGlobalAlert({type:"error",message:a}),this.setState({isLoading:!1})});o(this,"viewReports",()=>{console.log("View reports")});o(this,"handleSubmit",e=>{e&&(e.preventDefault(),e.stopPropagation()),this.save()});o(this,"save",async()=>{this.setState({isLoading:!0});const{success:e,message:s}=await C("patch",`/courses/reportsettings/${this.state.reportingData._id}`,this.submitData);e?this.props.setGlobalAlert({type:"success",message:"Saved successfully"}):this.props.setGlobalAlert({type:"error",message:s}),this.setState({isLoading:!1,isEdited:!1})});o(this,"fetchavAilableTemplates",async()=>{const{success:e,response:s}=await C("GET","/reporting/templates");e&&s.docs.length>0?this.setState({availableTemplates:s.docs,reportingData:m({template:s.docs[0]._id},this.state.reportingData)}):this.setState({availableTemplates:[]})});o(this,"fetchavAilableDataTargets",async()=>{const{success:e,response:s}=await C("GET","/courses/reportsettings/targets");e&&this.setState({availableDataTargets:s})});o(this,"handleUpdate",e=>{this.setState({reportingData:e,isEdited:!0})});o(this,"handleNewTemplate",e=>{this.setState({reportingData:y(m({},this.state.reportingData),{template:e}),isEdited:!0}),this.fetchavAilableTemplates()})}async componentDidMount(){await this.fetchCourseData(),this.setBreadcumbs(),this.fetchReportSettings(),this.fetchavAilableTemplates(),this.fetchavAilableDataTargets(),this.setButtons()}componentDidUpdate(e,s){s.isEdited!==this.state.isEdited&&this.setButtons()}componentWillUnmount(){this.props.createFormActions({customButtons:[]})}get submitData(){const e=Object.assign({},this.state.reportingData);return e.fields=e.fields.map(s=>{const a=Object.assign({},s);return delete a.control,a}),e}render(){return this.state.isLoading?t(Q,{}):t(kn,{update:this.handleUpdate,addNewTemplate:this.handleNewTemplate,reportingData:this.state.reportingData,availableTemplates:this.state.availableTemplates,availableDataTargets:this.state.availableDataTargets,type:"course"})}}var Mc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(Uc));class Bc extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{modalShow:!1});o(this,"handleChange",e=>{const s=e.target.name.split("-")[0];this.props.handleQuestionChange(this.props.idx,s,e.target.value)});o(this,"handleOptionChange",(e,s)=>{let a=[...this.props.question.options];a[e]=s,this.props.handleQuestionChange(this.props.idx,"options",a)})}render(){const{idx:e}=this.props;return n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:()=>{this.props.deleteQuestion(this.props.idx),this.setState({modalShow:!1})},titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:"delete"},"modal-type")," this Question."]}),t(T,{defaultActiveKey:"1",children:n(B,{children:[t(T.Toggle,{as:B.Header,eventKey:"0",children:n(A,{children:[n(x,{xs:12,lg:2,className:"my-2 my-lg-0 pt-2",children:[t("span",y(m({},this.props.dragHandleProps),{onClick:s=>{s.stopPropagation()},children:this.props.handleQuizChange&&!this.props.editable?t("div",{}):t(I,{icon:Re,style:{marginRight:"20px"}})})),"Q",this.props.idx+1]}),t(x,{xs:12,lg:8,children:t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:`title-${e}`,name:`title-${e}`,placeholder:"Question title",style:{width:"90%",marginRight:"20px"},onClick:s=>{s.stopPropagation()},value:this.props.question.title,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})}),this.props.handleQuizChange&&!this.props.editable?t(x,{xs:12,lg:2,className:"my-2 my-md-0"}):n(x,{xs:12,lg:2,className:"my-2 my-md-0",children:[t(U,{placement:"top",overlay:t(M,{children:"Delete"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:s=>{s.stopPropagation(),this.setState({modalShow:!0})},children:t(I,{icon:ae})})}),t(U,{placement:"top",overlay:t(M,{children:"Edit"}),children:t(T.Toggle,{as:L,variant:"link",className:"float-right mx-1",eventKey:"0",children:t(I,{icon:J})})})]})]})}),t(T.Collapse,{eventKey:"0",children:n(B.Body,{children:[n(A,{children:[n(x,{xs:7,sm:8,md:9,children:[t(f.Label,{children:"Options"}),["A","B","C","D","E"].map((s,a)=>t(f.Group,{children:n(A,{children:[t(x,{xs:2,md:1,className:"pt-2 text-center",children:s}),t(x,{xs:10,md:11,children:t(f.Control,{type:"text",maxLength:"512",id:`choice${s}-${e}`,name:`choice${s}-${e}`,value:this.props.question.options[a]||"",onChange:i=>{this.handleOptionChange(a,i.target.value),!i.target.value&&this.props.question.correctOptionIdx===a&&this.props.handleQuestionChange(this.props.idx,"correctOptionIdx",null)},readOnly:this.props.handleQuizChange&&!this.props.editable})})]})},`opt-${a}`))]}),n(x,{xs:5,sm:4,md:3,children:[t(f.Label,{children:"Correct Opt."}),["A","B","C","D","E"].map((s,a)=>t(f.Group,{children:t(f.Check,{style:{height:"38px"},className:"pt-2",type:"radio",label:"",name:`optradio-${this.props.question._id||this.props.question.uuid}`,disabled:!this.props.question.options[a]||this.props.handleQuizChange&&!this.props.editable,onChange:i=>{i.target.checked&&this.props.handleQuestionChange(this.props.idx,"correctOptionIdx",a)},checked:this.props.question.correctOptionIdx===a})},`opt-radio-${a}`))]})]}),n(A,{className:"pt-2",children:[n(x,{md:6,children:[t(f.Label,{htmlFor:`msgIfCorrect-${e}`,children:"Message if Correct"}),t(f.Control,{type:"text",maxLength:"512",id:`msgIfCorrect-${e}`,name:`msgIfCorrect-${e}`,value:this.props.question.msgIfCorrect,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]}),n(x,{md:6,children:[t(f.Label,{htmlFor:`msgIfWrong-${e}`,children:"Message if Wrong"}),t(f.Control,{type:"text",maxLength:"512",id:`msgIfWrong-${e}`,name:`msgIfWrong-${e}`,value:this.props.question.msgIfWrong,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})]}),n(A,{className:"pt-3",children:[n(x,{md:4,children:[t(f.Label,{htmlFor:`marksIfCorrect-${e}`,children:"Marks if Correct"}),t(f.Control,{type:"number",id:`marksIfCorrect-${e}`,name:`marksIfCorrect-${e}`,value:this.props.question.marksIfCorrect||"",onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]}),n(x,{md:4,children:[t(f.Label,{htmlFor:`marksIfWrong-${e}`,children:"Marks if Wrong"}),t(f.Control,{type:"number",id:`marksIfWrong-${e}`,name:`marksIfWrong-${e}`,value:this.props.question.marksIfWrong||"",onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]}),n(x,{md:4,children:[t(f.Label,{htmlFor:`marksIfSkipped-${e}`,children:"Marks if Skipped"}),t(f.Control,{type:"number",id:`marksIfSkipped-${e}`,name:`marksIfSkipped-${e}`,value:this.props.question.marksIfSkipped||"",onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})]})]})})]})})]})}}class Gc extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"lastQuestionRef",z.createRef());o(this,"createExamBreadcrumb",()=>{const e=this.type==="Quiz"?"quizzes":"exams",s=this.type.toUpperCase()[0]+this.type.substr(1).toLowerCase();this.type!=="Quiz"&&this.props.pushBreadcrumbLink({text:`${s}: ${this.state.exam.title}`,path:`/admin/courses/ext/${e}/edit/${this.props.match.params.courseId}`})});o(this,"removeExamBreadcrumbs",()=>{const e=this.type==="Quiz"?"quizzes":"exams",s=this.type.toUpperCase()[0]+this.type.substr(1).toLowerCase();this.type!=="Quiz"&&this.props.removeBreadcrumbLink({text:`${s}: ${this.state.exam.title}`,path:`/admin/courses/ext/${e}/edit/${this.props.match.params.courseId}`})});o(this,"createBreadcrumbs",()=>{this.type!=="Quiz"&&(this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.state.course._id&&this.props.pushBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.state.course._id}`}),this.state.exam._id&&this.createExamBreadcrumb())});o(this,"removeBreadcrumbs",()=>{this.type!=="Quiz"&&(this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.state.course._id&&this.props.removeBreadcrumbLink({text:`Course: ${this.state.course.title}`,path:`/admin/courses/${this.state.course._id}`}),this.state.exam._id&&this.removeExamBreadcrumbs())});o(this,"componentDidMount",async()=>{this._isMounted=!0;let e={loading:!1},s={};if(this.props.match.params.parentId&&(s=(await C("GET",`/courses/${this.props.match.params.parentId}`)).response),this.props.match.params.courseId||this.props.match.params.lessonId){this.setState({loading:!0});const a=this.type==="Quiz"?`/courses/quizzes/${this.props.match.params.lessonId}`:`/courses/exams/${this.props.match.params.courseId}`,{success:i,response:r}=await C("GET",a);i&&r&&this._isMounted&&(this.type!=="Quiz"&&!s._id&&(s=(await C("GET",`/courses/${r.parentId}`)).response),e=y(m({},e),{exam:y(m({},r),{questions:(r.questions||[]).map(d=>y(m({},d),{uuid:K()}))})}))}e.course=s,this.setState(e),this.type!=="Quiz"&&(this.props.createFormActions({save:!0,cancel:!0,cancelAction:"return",returnPath:"/admin/courses",id:"examForm"}),this.createBreadcrumbs())});o(this,"componentWillUnmount",()=>{this._isMounted=!1,this.type!=="Quiz"&&(this.removeBreadcrumbs(),this.props.createFormActions({}))});o(this,"handleChange",e=>{this.setState({exam:y(m({},this.state.exam),{[e.target.name]:e.target.value}),isDirty:!0})});o(this,"handleQuestionChange",(e,s,a)=>{let i=[...this.state.exam.questions];i[e][s]=a,this.setState({exam:y(m({},this.state.exam),{questions:i}),isDirty:!0})});o(this,"shiftQuestionOptions",e=>y(m({},e),{questions:e.questions.map(s=>{let a=[];return y(m({},s),{options:s.options.filter((i,r)=>(i||a.push(r),i)),correctOptionIdx:s.correctOptionIdx-a.filter(i=>i<s.correctOptionIdx).length})})}));o(this,"handleSubmit",async e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setState({loading:!0});let s=this.shiftQuestionOptions(this.state.exam);if(delete s._id,delete s.updatedAt,delete s.createdAt,delete s.__v,delete s.chapter,this.type==="Quiz")await this.handleQuizSubmit();else{let a="POST",i="/courses/exams";this.props.match.params.courseId?(a="PUT",i+=`/${this.state.exam._id}`):s.parentId=this.props.match.params.parentId;const{success:r,response:d}=await C(a,i,s);this._isMounted&&(this.setState({loading:!1}),r?(this.props.setGlobalAlert({type:"success",message:`${this.type} has been ${this.props.match.params.courseId?"updated":"created"}`}),this.setState({isDirty:!1}),a=="POST"?this.doRedirect(d.data._id):(this.removeExamBreadcrumbs(),this.createExamBreadcrumb())):this.props.setGlobalAlert({type:"error",message:`There was a problem with saving this ${this.type}. Please try again`}))}});o(this,"handleQuizSubmit",async()=>{let e="POST",s="/courses/quizzes",b=this.state.exam,{_id:a,updatedAt:i,createdAt:r,__v:d,chapter:c}=b,h=oe(b,["_id","updatedAt","createdAt","__v","chapter"]);this.state.exam._id&&(e="PUT",s+=`/${this.state.exam._id}`),s+=`?lessonId=${this.props.match.params.lessonId}`;const{success:p,response:u}=await C(e,s,this.shiftQuestionOptions(h));if(this._isMounted){const v={loading:!1};p&&(v.isDirty=!0,v.exam=u),this.setState(v,()=>{this.props.setGlobalAlert({type:p?"success":"error",message:p?`${this.type} has been ${e==="PUT"?"updated":"created"}`:"There was a problem with saving this quiz. Please try again"})})}});o(this,"handleUpload",e=>{e.preventDefault();let s=e.target.files[0],a=new FileReader;const i=this;a.onload=function(r){var d=r.target.result;let c=XLSX.read(d,{type:"binary"});const h=c.Sheets.Config,p=c.Sheets.Questions,u=XLSX.utils.sheet_to_json(h,{header:1}),b=XLSX.utils.sheet_to_json(p,{header:1});i.populateExamFromJson(u,b)},s&&(this.setState({loading:!0}),a.readAsBinaryString(s))});o(this,"populateExamFromJson",(e,s)=>{let a=[];const i=S=>S.toLowerCase()==="yes"?"true":S.toLowerCase()==="no"?"false":"",r=S=>S*100,d=S=>{let _=["never","always","on_pass"];return S=S.toLowerCase(),_.indexOf(S)<0&&(S=""),S},p={TITLE:["title",null],MARKS_PER_CORRECT_ANSWER:["marksIfCorrect",null],MARKS_PER_WRONG_ANSWER:["marksIfWrong",null],MARKS_PER_SKIPPED_ANSWER:["marksIfSkipped",null],PASS_PERCENTAGE:["passPct",r],ALLOW_SKIP:["allowSkip",i],BLOCKS_FUTURE_LESSONS:["blocksFutureLessons",i],RANDOMIZE:["randomize",i],QUESTION_SUBSET_COUNT:["questionSubsetCount",null],NOTIFY_STUDENT:["notifyStudent",d],NOTIFY_ACADEMY:["notifyAcademy",d],TIME_LIMIT_MINUTES:["timeLimit",null],TIMEOUT_ACTION:["timeoutAction",S=>{let _=["submit","cancel"];return S=S.toLowerCase(),_.indexOf(S)<0&&(S=""),S}],REVEAL_ANSWERS:["revealAnswers",d],ALLOW_REATTEMPT:["allowReattempt",S=>{let _=["never","always","on_fail"];return S=S.toLowerCase(),_.indexOf(S)<0&&(S=""),S}],IS_FINAL:["isFinal",i]};let u=m({},this.state.exam);e.forEach((S,_)=>{if(_===0||!S||!S.length)return;const k=S[0];if(!(k in p))return;let O=S[1];const F=p[k][0],G=p[k][1];G!==null&&(O=G(O)),u[F]=O});let b=[];const v={A:0,B:1,C:2,D:3,E:4};if(s.forEach((S,_)=>{if(_===0||!S||!S.length)return;let k=this.getEmptyQuestion();S[0]?k.title=S[0]:a.push(`Missing QUESTION title for Question in row ${_+1}`),!S[1]||!S[2]?a.push(`Not enough options provided for Question in row ${_+1}`):k.options=[S[1],S[2]],[3,4,5].forEach(O=>{S[O]&&k.options.push(S[O])}),S[6]?k.correctOptionIdx=v[S[6].toUpperCase()]:a.push(`Missing CORRECT_CHOICE_LETTER for Question in row ${_+1}`),k.marksIfCorrect=S[7],k.marksIfWrong=S[8],k.marksIfSkipped=S[9],S[10]&&(k.msgIfCorrect=S[10]),S[11]&&(k.msgIfWrong=S[11]),k.uuid=K(),b.push(k)}),u.questions=b,a.length){const S=`There was a problem with uploading this file. Please correct the following: <ul>${a.map(_=>`<li>${_}</li>`).join("")}</ul>`;this.props.setGlobalAlert({type:"error",message:S}),this.setState({loading:!1,errorMessage:S})}else this.setState({exam:u,isDirty:!0,loading:!1})});o(this,"getEmptyQuestion",()=>({uuid:K(),title:"",options:[],msgIfCorrect:"",msgIfWrong:"",marksIfCorrect:null,marksIfWrong:null,marksIfSkipped:null,correctOptionIdx:null}));o(this,"handleDragAndDrop",e=>{if(!e.destination||e.source.index===e.destination.index)return;let s=[...this.state.exam.questions];const[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.setState({exam:y(m({},this.state.exam),{questions:s}),isDirty:!0})});o(this,"deleteQuestion",e=>{let s=[...this.state.exam.questions];s.splice(e,1),this.setState({exam:y(m({},this.state.exam),{questions:s}),isDirty:!0})});o(this,"deleteQuestions",()=>{this.setState({exam:y(m({},this.state.exam),{questions:[]}),isDirty:!0})});o(this,"doRedirect",e=>{this.setState({redirect:this.type==="Quiz"?`/admin/courses/${this.props.match.params.courseId}/chapters/${this.props.match.params.chapterId}/lessons/${e}`:`/admin/courses/ext/exams/edit/${e}`})});o(this,"handleAddQuestion",()=>{this.setState({exam:y(m({},this.state.exam),{questions:[...this.state.exam.questions,this.getEmptyQuestion()]})},()=>{this.lastQuestionRef.current&&this.lastQuestionRef.current.scrollIntoView({behavior:"smooth",block:"end"})})});this.type=this.props.type==="Quiz"?"Quiz":"Exam",this.state={exam:this.props.quiz?this.props.quiz:{title:"",passPct:"",timeLimit:"",timeoutAction:"submit",allowSkip:!0,randomize:!0,isFinal:!0,blocksFutureLessons:!0,questionSubsetCount:"",revealAnswers:"never",allowReattempt:"never",marksIfCorrect:"",marksIfWrong:"",marksIfSkipped:"",notifyStudent:"never",notifyAcademy:"never",questions:[]},loading:!1,redirect:null,isDirty:!1,modalShow:!1,course:{},errorMessage:null}}componentDidUpdate(){this.props.formActions.state&&this.props.formActions.state.reload&&(this.props.handleQuizChange?this.props.hideQuizModal():this.props.history.push("/admin/courses")),this.props.formActions.state&&this.props.formActions.state.save&&this.type!=="Quiz"&&this.props.handleQuizChange&&(this.props.handleQuizChange(this.state.exam),this.props.hideQuizModal())}render(){let e;return this.state.redirect?e=t(Se,{to:this.state.redirect}):this.state.loading?e=t(Q,{}):e=n(w,{children:[this.state.errorMessage?t("p",{style:{color:"red",fontWeight:"bold"},dangerouslySetInnerHTML:{__html:this.state.errorMessage}}):t(w,{}),t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:()=>{this.deleteQuestions(),this.setState({modalShow:!1})},titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:"delete"},"modal-type")," all Questions."]}),this.props.type==="Quiz"&&n("div",{className:"examForm-actions",children:[(this.props.editable||this.type==="Quiz")&&t(L,{type:"button",className:"bd",onClick:this.handleAddQuestion,children:"Add Question"}),this.state.exam.questions&&this.state.exam.questions.length>0&&(this.props.editable||this.type==="Quiz")&&t(L,{type:"button",className:"btn--danger",onClick:s=>{s.stopPropagation(),this.setState({modalShow:!0})},children:"Delete all questions"}),t("button",{type:"button",className:"bp examForm-actions__save",onClick:this.handleSubmit,children:"Save"})]}),n(f,{onSubmit:this.handleSubmit,id:"examForm",children:[n(A,{className:"pt-3",children:[t(x,{xs:12,md:6,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Title"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"title",name:"title",value:this.state.exam.title,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),this.props.handleQuizChange&&!this.props.editable?t(x,{xs:12,md:6}):t(x,{xs:12,md:6,children:n(E,{children:[t(f.Label,{htmlFor:"import",children:"Import from Excel"}),t(f.Control,{type:"file",accept:".xlsx",id:"import",name:"import"})]})})]}),n(A,{className:"pt-4",children:[t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"passPct",children:"Pass Percentage"}),t(f.Control,{type:"number",required:!0,min:"0",max:"100",id:"passPct",name:"passPct",value:this.state.exam.passPct,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"questionSubsetCount",children:"Question Subset Count"}),t(f.Control,{type:"number",required:!0,id:"questionSubsetCount",name:"questionSubsetCount",value:this.state.exam.questionSubsetCount,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"timeLimit",children:"Time Limit (mins)"}),t(f.Control,{type:"number",required:!0,min:"0",max:"9999",id:"timeLimit",name:"timeLimit",value:this.state.exam.timeLimit,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"marksIfCorrect",children:"Marks if Correct"}),t(f.Control,{type:"number",required:!0,id:"marksIfCorrect",name:"marksIfCorrect",value:this.state.exam.marksIfCorrect,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"marksIfWrong",children:"Marks if Wrong"}),t(f.Control,{type:"number",required:!0,id:"marksIfWrong",name:"marksIfWrong",value:this.state.exam.marksIfWrong,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"marksIfSkipped",children:"Marks if Skipped"}),t(f.Control,{type:"number",required:!0,id:"marksIfSkipped",name:"marksIfSkipped",value:this.state.exam.marksIfSkipped,onChange:this.handleChange,readOnly:this.props.handleQuizChange&&!this.props.editable})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"allowSkip",children:"Allow Skip"}),n(f.Control,{as:"select",id:"allowSkip",name:"allowSkip",required:!0,value:this.state.exam.allowSkip,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"blocksFutureLessons",children:"Blocks Future Lessons"}),n(f.Control,{as:"select",id:"blocksFutureLessons",name:"blocksFutureLessons",required:!0,value:this.state.exam.blocksFutureLessons,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"randomize",children:"Randomize"}),n(f.Control,{as:"select",id:"randomize",name:"randomize",required:!0,value:this.state.exam.randomize,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"timeoutAction",children:"Timeout Action"}),n(f.Control,{as:"select",id:"timeoutAction",name:"timeoutAction",required:!0,value:this.state.exam.timeoutAction,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"submit",children:"Submit"}),t("option",{value:"cancel",children:"Cancel"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"notifyStudent",children:"Notify Student"}),n(f.Control,{as:"select",id:"notifyStudent",name:"notifyStudent",required:!0,value:this.state.exam.notifyStudent,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"never",children:"Never"}),t("option",{value:"always",children:"Always"}),t("option",{value:"on_pass",children:"On Pass"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"notifyAcademy",children:"Notify Academy"}),n(f.Control,{as:"select",id:"notifyAcademy",name:"notifyAcademy",required:!0,value:this.state.exam.notifyAcademy,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"never",children:"Never"}),t("option",{value:"always",children:"Always"}),t("option",{value:"on_pass",children:"On Pass"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"revealAnswers",children:"Reveal Answers"}),n(f.Control,{as:"select",id:"revealAnswers",name:"revealAnswers",required:!0,value:this.state.exam.revealAnswers,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"never",children:"Never"}),t("option",{value:"always",children:"Always"}),t("option",{value:"on_pass",children:"On Pass"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"allowReattempt",children:"Allow Reattempt"}),n(f.Control,{as:"select",id:"allowReattempt",name:"allowReattempt",required:!0,value:this.state.exam.allowReattempt,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"never",children:"Never"}),t("option",{value:"always",children:"Always"}),t("option",{value:"on_fail",children:"On Fail"})]})]})}),t(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:n(E,{children:[t(f.Label,{htmlFor:"isFinal",children:"Is Final"}),n(f.Control,{as:"select",id:"isFinal",name:"isFinal",required:!0,value:this.state.exam.isFinal,onChange:this.handleChange,disabled:this.props.handleQuizChange&&!this.props.editable,children:[t("option",{disabled:!0,value:""}),t("option",{value:"true",children:"Yes"}),t("option",{value:"false",children:"No"})]})]})})]}),t(L,{type:"button",className:"bd",onClick:this.handleAddQuestion,children:"Add Question"}),this.state.exam.questions?n(w,{children:[this.state.exam.questions.length>0&&t(A,{className:"pt-4",children:t(x,{children:t(E,{children:t(f.Label,{children:"Questions"})})})}),t(be,{onDragEnd:this.handleDragAndDrop,children:t(Ce,{droppableId:"examQuestions",children:s=>n("ul",y(m({},s.droppableProps),{ref:s.innerRef,style:{listStyleType:"none",padding:"0px",margin:"0px"},children:[this.state.exam.questions.map((a,i)=>t(le,{draggableId:a.uuid,index:i,children:r=>t("li",y(m({ref:xn(r.innerRef,i===this.state.exam.questions.length-1?this.lastQuestionRef:void 0)},r.draggableProps),{children:t(A,{className:"my-2",children:t(x,{children:t(Bc,{dragHandleProps:r.dragHandleProps,question:a,handleQuestionChange:this.handleQuestionChange,deleteQuestion:this.deleteQuestion,idx:i,editable:this.props.editable,handleQuizChange:this.props.handleQuizChange})})})}))},`draggable-${a.uuid}`)),s.placeholder]}))})})]}):t(w,{})]})]}),n(w,{children:[t(Ye,{when:this.state.isDirty,navigate:s=>this.props.history.push(s),shouldBlockNavigation:()=>this.state.isDirty}),e]})}}var Ze=$(l=>({formActions:l.formActions}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(Gc));class Hc extends g.exports.Component{render(){return n("div",{id:"course",children:[this.props.location.pathname.indexOf("/admin/courses/ext/")<0?n(V,{variant:"tabs",activeKey:this.props.location.pathname,children:[t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}`,to:`/admin/courses/${this.props.match.params.courseId}`,children:"Course"})},"course"),this.props.match.params.courseId!=="new"&&[t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/enrollment`,to:`/admin/courses/${this.props.match.params.courseId}/enrollment`,children:"Enrollment"})},"enrollment"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/pre-exam`,to:`/admin/courses/${this.props.match.params.courseId}/pre-exam`,children:"Pre Exam"})},"pre-exam"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/exam`,to:`/admin/courses/${this.props.match.params.courseId}/exam`,children:"Exam"})},"exam"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/post-exam`,to:`/admin/courses/${this.props.match.params.courseId}/post-exam`,children:"Post Exam"})},"post-exam"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/messages`,to:`/admin/courses/${this.props.match.params.courseId}/messages`,children:"Messages"})},"messages"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/certificate`,to:`/admin/courses/${this.props.match.params.courseId}/certificate`,children:"Certificate"})},"certificate"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/extensions`,to:`/admin/courses/${this.props.match.params.courseId}/extensions`,children:"Extensions"})},"extensions"),t(V.Item,{children:t(V.Link,{as:R,eventKey:`/admin/courses/${this.props.match.params.courseId}/reporting`,to:`/admin/courses/${this.props.match.params.courseId}/reporting`,children:"Reporting"})},"reporting")]]}):t(w,{}),t("div",{className:"tab-content",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/courses/:courseId",component:Lc}),t(P,{exact:!0,path:"/admin/courses/:courseId/enrollment",component:uc}),t(P,{exact:!0,path:"/admin/courses/:courseId/pre-exam",component:gc}),t(P,{exact:!0,path:"/admin/courses/:courseId/exam",component:bc}),t(P,{exact:!0,path:"/admin/courses/:courseId/post-exam",component:yc}),t(P,{exact:!0,path:"/admin/courses/:courseId/messages",component:xc}),t(P,{exact:!0,path:"/admin/courses/:courseId/certificate",component:Ic}),t(P,{exact:!0,path:"/admin/courses/:courseId/extensions",component:_c}),t(P,{exact:!0,path:"/admin/courses/:courseId/reporting",component:Mc}),t(P,{exact:!0,path:"/admin/courses/ext/exams/edit/:courseId",children:t(Ze,{},"exam-edit")}),t(P,{exact:!0,path:"/admin/courses/ext/:parentId/exams/create",children:t(Ze,{},"exam-create")}),t(P,{exact:!0,path:"/admin/courses/ext/quizzes/edit/:courseId",children:t(Ze,{},"quiz-edit")}),t(P,{exact:!0,path:"/admin/courses/ext/chapters/:parentId/quiz/create",children:t(Ze,{},"quiz-create")})]})})]})}}var qc=$(null,{setCoursePreview:l=>({type:"SET_PREVIEW_COURSE",payload:l})})(D(Hc));class zc extends g.exports.Component{constructor(){super(...arguments);o(this,"componentDidMount",async()=>{this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.pushBreadcrumbLink({text:"Enrolled Students",path:`/admin/courses/${this.props.match.params.courseId}/students`})});o(this,"componentWillUnmount",()=>{this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"}),this.props.removeBreadcrumbLink({text:"Enrolled Students",path:`/admin/courses/${this.props.match.params.courseId}/students`})})}render(){return t(he,{basePath:"/admin/courses",apiCall:{method:"GET",path:`/courses/${this.props.match.params.courseId}/enrolled`},columns:[{text:"Full name",field:e=>`${e.firstName} ${e.lastName}`,sortKey:"firstName-lastName"},{text:"Enrolled #",field:"enrolledTimes"},{text:"Suspended #",field:"suspendedTimes"},{text:"Completed #",field:"completedTimes"}]})}}var Vc=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(zc)),Ke=z.createContext({pageStatus:"LOADING",lesson:null,chapter:{},course:{},cards:[],deletedCards:[],setGlobalAlert:()=>null,handleLessonChange:()=>null,updateDeletedCards:()=>null,updatedCards:()=>null});var bs,Cs,ys;class Tn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{currentLessonId:(ys=(Cs=(bs=this.context)==null?void 0:bs.lesson)==null?void 0:Cs._id)!=null?ys:""});o(this,"handleInputChange",e=>{const s=e.target;this.context.updateLessonForm({[s.name]:s.value},this.context.enableSaveButton)})}componentDidMount(){var e,s,a,i,r,d,c,h,p,u,b,v,S,_,k,O,F,G,q,j,Y,ee,me,ye;this.context.updateLessonForm({title:(i=(a=(s=(e=this.context)==null?void 0:e.lesson)==null?void 0:s.draft)==null?void 0:a.title)!=null?i:"",hasQuiz:(h=(c=(d=(r=this.context)==null?void 0:r.lesson)==null?void 0:d.draft)==null?void 0:c.hasQuiz)!=null?h:!1,lessonLayout:(v=(b=(u=(p=this.context)==null?void 0:p.lesson)==null?void 0:u.draft)==null?void 0:b.lessonLayout)!=null?v:"PAGE",lessonType:(O=(k=(_=(S=this.context)==null?void 0:S.lesson)==null?void 0:_.draft)==null?void 0:k.lessonType)!=null?O:"BASIC",unlockNextLesson:(j=(q=(G=(F=this.context)==null?void 0:F.lesson)==null?void 0:G.draft)==null?void 0:q.unlockNextLesson)!=null?j:"ALWAYS_UNLOCKED",lessonTypeComment:(ye=(me=(ee=(Y=this.context)==null?void 0:Y.lesson)==null?void 0:ee.draft)==null?void 0:me.lessonTypeComment)!=null?ye:""})}componentDidUpdate(e,s){var a,i,r,d,c,h;s.currentLessonId!==((r=(i=(a=this.context)==null?void 0:a.lesson)==null?void 0:i._id)!=null?r:"")&&this.setState({currentLessonId:(h=(c=(d=this.context)==null?void 0:d.lesson)==null?void 0:c._id)!=null?h:""},()=>{var p,u,b,v,S,_,k,O,F,G,q,j,Y,ee,me,ye,ve,Le,Ee,$e,He,st,te,at;this.context.updateLessonForm({title:(v=(b=(u=(p=this.context)==null?void 0:p.lesson)==null?void 0:u.draft)==null?void 0:b.title)!=null?v:"",hasQuiz:(O=(k=(_=(S=this.context)==null?void 0:S.lesson)==null?void 0:_.draft)==null?void 0:k.hasQuiz)!=null?O:!1,lessonLayout:(j=(q=(G=(F=this.context)==null?void 0:F.lesson)==null?void 0:G.draft)==null?void 0:q.lessonLayout)!=null?j:"PAGE",lessonType:(ye=(me=(ee=(Y=this.context)==null?void 0:Y.lesson)==null?void 0:ee.draft)==null?void 0:me.lessonType)!=null?ye:"BASIC",unlockNextLesson:($e=(Ee=(Le=(ve=this.context)==null?void 0:ve.lesson)==null?void 0:Le.draft)==null?void 0:Ee.unlockNextLesson)!=null?$e:"ALWAYS_UNLOCKED",lessonTypeComment:(at=(te=(st=(He=this.context)==null?void 0:He.lesson)==null?void 0:st.draft)==null?void 0:te.lessonTypeComment)!=null?at:""})})}render(){const{title:e,lessonLayout:s="PAGE",lessonType:a,lessonTypeComment:i}=this.props.lessonForm;return n("form",{className:"lesson-inputs",children:[n("div",{children:[t("label",{htmlFor:"title",children:"Lesson name"}),t("input",{type:"text",name:"title",id:"title",defaultValue:e,onChange:this.handleInputChange})]}),n("div",{className:"lessonType",children:[t("label",{htmlFor:"lessonType",children:"Lesson type"}),n("select",{name:"lessonType",id:"lessonType",value:a,onChange:this.handleInputChange,children:[t("option",{value:"BASIC",children:"Basic"}),t("option",{value:"STATE",children:"State"}),t("option",{value:"NATIONAL",children:"National"})]})]}),t("div",{className:`lessonTypeComment${a==="BASIC"?" disabled":""}`,children:a!=="BASIC"&&n(w,{children:[t("label",{htmlFor:"lessonTypeComment",children:"Lesson type comment"}),t("textarea",{id:"lessonTypeComment",name:"lessonTypeComment",defaultValue:i,onChange:this.handleInputChange})]})}),n("div",{children:[t("label",{htmlFor:"lessonLayout",children:"Lesson layout"}),n("select",{name:"lessonLayout",id:"lessonLayout",value:s,onChange:this.handleInputChange,children:[t("option",{value:"CARD",children:"Card"}),t("option",{value:"PAGE",children:"Page"})]})]})]})}}o(Tn,"contextType",Ke);var Qc=D(Tn);class ie extends g.exports.Component{constructor(){super(...arguments);o(this,"dispatchLessonChange",()=>{const{orderIndex:e,cardId:s,cardType:a,cardTitle:i}=this.props,c=this.state,{isPopupVisible:r}=c,d=oe(c,["isPopupVisible"]);this.context.handleLessonChange("card",y(m({},d),{cardTitle:i,lessonId:this.context.lesson._id,orderIndex:e,cardType:a,_id:s}),this.context.enableSaveButton)});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleCheckboxClick",e=>{this.setState({[e.target.name]:!this.state[e.target.name]},this.dispatchLessonChange)})}componentDidMount(){if(this.state!==null){const{orderIndex:s,cardId:a,cardType:i,cardTitle:r}=this.props,e=this.state,{isPopupVisible:d}=e,c=oe(e,["isPopupVisible"]);this.context.handleLessonChange("card",y(m({},c),{cardTitle:r,lessonId:this.context.lesson._id,orderIndex:s,cardType:i,_id:a}))}}render(){return t(w,{})}}o(ie,"contextType",Ke);class ue extends g.exports.Component{constructor(){super(...arguments);o(this,"colors",{default:"#fff",navy:"#25255e",green:"#2fcca1",blue:"#a0d6ef",cyan:"#aceded",honeydew:"#ebfaf6",yellow:"#fef5c5",cinderalla:"#fde3d1",orange:"#ffd9a7",pink:"#ffbbb9",kobi:"#eca8d4",vanilla:"#eecee6"});o(this,"state",{theme:""});o(this,"handleColorClick",e=>s=>{this.props.handleInputChange({target:{name:"theme",value:e}})})}render(){const{orderIndex:e,theme:s}=this.props;return n("div",{children:[t("label",{htmlFor:`theme-${e}`,children:"Color theme"}),t("div",{className:"color-select",children:Object.keys(this.colors).map(a=>{const i=["navy","green"].includes(a);return t(U,{placement:"top",overlay:n(M,{id:`color-${this.colors[a]}`,children:[`${a[0].toUpperCase()}${a.slice(1)}`,"\xA0",i?"header":"background"]}),children:t("div",{className:`color-select__option${s===a?" color-select__option--active":""}${i?" color-select__option--header":""}`,onClick:this.handleColorClick(a),style:{backgroundColor:this.colors[a]}})},this.colors[a])})})]})}}var vs,xs,Ss;class W extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{charCount:(Ss=(xs=(vs=this.props)==null?void 0:vs.defaultValue)==null?void 0:xs.length)!=null?Ss:0});o(this,"handleChange",e=>{var a,i;const s=e.target.value;this.setState({charCount:s.length}),(i=(a=this.props)==null?void 0:a.onChange)==null||i.call(a,e,s)})}componentDidMount(){var s,a;let e=(a=(s=this.props.defaultValue)!=null?s:this.props.value)!=null?a:"";this.setState({charCount:e.length})}render(){var e,s,a,i;return n(w,{children:[t("input",{className:this.props.className+" text-input-component-char-count",type:(e=this.props.type)!=null?e:"text",name:this.props.name,id:(s=this.props.id)!=null?s:this.props.name,value:(i=(a=this.props.defaultValue)!=null?a:this.props.value)!=null?i:"",onChange:this.handleChange}),t("span",{className:"char-counter",children:this.state.charCount})]})}}var Is,ws,_s,ks,Ts,Ns,As;class Wc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(Is=this.props.theme)!=null?Is:"",heading:(ws=this.props.heading)!=null?ws:"",subHeading:(_s=this.props.subHeading)!=null?_s:"",content:(ks=this.props.content)!=null?ks:"",info:(Ts=this.props.info)!=null?Ts:"",bgColor:(Ns=this.props.bgColor)!=null?Ns:"#f5a623",fgColor:(As=this.props.fgColor)!=null?As:"#ffffff"})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,bgColor:r,fgColor:d,theme:c},props:{orderIndex:h}}=this;return n(w,{children:[t(ue,{theme:c,orderIndex:h,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${h}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${h}`,defaultValue:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${h}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${h}`,defaultValue:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${h}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${h}`,onChange:this.handleInputChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${h}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${h}`,onChange:this.handleInputChange})]})})})]})]})}}var Ls,Es,$s,Ds,Ps,Os,Rs,Fs,Us,Ms;class Kc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(Ls=this.props.theme)!=null?Ls:"",heading:(Es=this.props.heading)!=null?Es:"",subHeading:($s=this.props.subHeading)!=null?$s:"",content:(Ds=this.props.content)!=null?Ds:"",info:(Ps=this.props.info)!=null?Ps:"",sourceImage:(Os=this.props.sourceImage)!=null?Os:"",imageUrl:(Rs=this.props.imageUrl)!=null?Rs:"",imagePosition:(Fs=this.props.imagePosition)!=null?Fs:"LEFT",imageImportance:(Us=this.props.imageImportance)!=null?Us:!1,allowEnlargeImage:(Ms=this.props.allowEnlargeImage)!=null?Ms:!1});o(this,"handleInputChange",e=>{let s=e.target,a;s.name==="imageImportance"?a=s.value==="preserveSizing":a=s.value,this.setState({[s.name]:a},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,sourceImage:i,imageUrl:r,imagePosition:d,info:c,theme:h,allowEnlargeImage:p},props:{orderIndex:u}}=this,b=this.state.imageImportance?"preserveSizing":"default";return n(w,{children:[t(ue,{theme:h,orderIndex:u,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${u}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${u}`,value:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${u}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${u}`,value:s,onChange:this.handleInputChange})]}),t("div",{children:n("ul",{children:[n("li",{children:[t("label",{htmlFor:`imagePosition-${u}`,children:"Image location"}),n("select",{name:"imagePosition",id:`imagePosition-${u}`,value:d,onChange:this.handleInputChange,children:[t("option",{value:"TOP",children:"Top"}),t("option",{value:"LEFT",children:"Left"}),t("option",{value:"RIGHT",children:"Right"}),t("option",{value:"BG",children:"Background"})]})]}),n("li",{children:[t("label",{htmlFor:`imageUrl-${u}`,children:"External URL"}),t("input",{type:"text",name:"imageUrl",id:`imageUrl-${u}`,value:r,onChange:this.handleInputChange})]})]})}),t("div",{children:t(ne,{label:"Upload image",type:"image",id:`sourceImage-${u}`,name:"sourceImage",file:i,onChange:this.handleFileChange})}),n("div",{children:[t("label",{htmlFor:`content-${u}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${u}`,onChange:this.handleInputChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:n("main",{children:[n("div",{children:[t("label",{htmlFor:`info-${u}`,children:"Info"}),t(H,{defaultValue:c,name:"info",id:`info-${u}`,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`image-importance-${u}`,children:"Image Importance"}),n("select",{name:"imageImportance",id:`image-importance-${u}`,defaultValue:b,onChange:this.handleInputChange,children:[t("option",{value:"default",children:"Default"}),t("option",{value:"preserveSizing",children:"Preserve Sizing"})]})]}),t("div",{children:n("label",{htmlFor:`allowEnlargeImage-${u}`,children:["Show image enlarge option?\xA0\xA0\xA0",t("input",{type:"checkbox",name:"allowEnlargeImage",id:`allowEnlargeImage-${u}`,checked:p,onChange:this.handleCheckboxClick})]})})]})})]})]})}}var Bs,Gs,Hs,qs,zs,Vs;class Yc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(Bs=this.props.theme)!=null?Bs:"",heading:(Gs=this.props.heading)!=null?Gs:"",subHeading:(Hs=this.props.subHeading)!=null?Hs:"",content:(qs=this.props.content)!=null?qs:"",info:(zs=this.props.info)!=null?zs:"",sourceImage:(Vs=this.props.sourceImage)!=null?Vs:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,sourceImage:r,theme:d},props:{orderIndex:c}}=this;return n(w,{children:[t(ue,{theme:d,orderIndex:c,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${c}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${c}`,value:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${c}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${c}`,value:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${c}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${c}`,onChange:this.handleInputChange})]}),t("div",{children:t(ne,{label:"Upload icon",type:"image",id:`sourceImage-${c}`,name:"sourceImage",file:r,onChange:this.handleFileChange})}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${c}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${c}`,onChange:this.handleInputChange})]})})})]})]})}}var Qs,Ws,Ks,Ys;class jc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(Qs=this.props.theme)!=null?Qs:"",transcript:(Ws=this.props.transcript)!=null?Ws:"",info:(Ks=this.props.info)!=null?Ks:"",sourceVideo:(Ys=this.props.sourceVideo)!=null?Ys:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleVideoIdPaste",async e=>{const s=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/gi.exec((e.clipboardData||window.clipboardData).getData("text"));s&&s[1]&&(e.preventDefault(),e.stopPropagation(),this.props.handleInputChange({target:{name:e.target.name,value:s[1]}}))})}render(){const{state:{sourceVideo:e,transcript:s,info:a,theme:i},props:{orderIndex:r}}=this;return n(w,{children:[t(ue,{theme:i,orderIndex:r,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`sourceVideo-${r}`,children:"Vimeo ID"}),t("input",{type:"text",name:"sourceVideo",id:`sourceVideo-${r}`,value:e,onPaste:this.handleVideoIdPaste,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`transcript-${r}`,children:"Transcript"}),t(H,{defaultValue:s,name:"transcript",id:`transcript-${r}`,onChange:this.handleInputChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${r}`,children:"Info"}),t(H,{defaultValue:a,name:"info",id:`info-${r}`,onChange:this.handleInputChange})]})})})]})]})}}var js,Zs,Js,Xs,ea,ta,sa;class Zc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(js=this.props.theme)!=null?js:"",heading:(Zs=this.props.heading)!=null?Zs:"",subHeading:(Js=this.props.subHeading)!=null?Js:"",transcript:(Xs=this.props.transcript)!=null?Xs:"",content:(ea=this.props.content)!=null?ea:"",sourceAudio:(ta=this.props.sourceAudio)!=null?ta:"",info:(sa=this.props.info)!=null?sa:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,transcript:r,sourceAudio:d,theme:c},props:{orderIndex:h}}=this;return n(w,{children:[t(ue,{theme:c,orderIndex:h,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${h}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${h}`,value:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${h}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${h}`,value:s,onChange:this.handleInputChange})]}),t("div",{children:t(ne,{label:"Upload audio",type:"audio",id:`sourceAudio-${h}`,name:"sourceAudio",file:d,onChange:this.handleFileChange})}),n("div",{children:[t("label",{htmlFor:`content-${h}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${h}`,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`transcript-${h}`,children:"Transcript"}),t(H,{defaultValue:r,name:"transcript",id:`transcript-${h}`,onChange:this.handleInputChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${h}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${h}`,onChange:this.handleInputChange})]})})})]})]})}}var aa,ia,na,ra,oa;class Jc extends ie{constructor(){super(...arguments);o(this,"state",{heading:(aa=this.props.heading)!=null?aa:"",subHeading:(ia=this.props.subHeading)!=null?ia:"",content:(na=this.props.content)!=null?na:"",sourceAudio:(ra=this.props.sourceAudio)!=null?ra:"",info:(oa=this.props.info)!=null?oa:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,sourceAudio:r},props:{orderIndex:d}}=this;return n(w,{children:[n("div",{children:[t("label",{htmlFor:`heading-${d}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${d}`,value:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${d}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${d}`,value:s,onChange:this.handleInputChange})]}),t("div",{children:t(ne,{label:"Upload audio",type:"audio",id:`sourceAudio-${d}`,name:"sourceAudio",file:r,onChange:this.handleFileChange})}),n("div",{children:[t("label",{htmlFor:`content-${d}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${d}`,onChange:this.handleInputChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${d}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${d}`,onChange:this.handleInputChange})]})})})]})]})}}var la,da,ca,ha,pa;class Xc extends ie{constructor(){super(...arguments);o(this,"state",{theme:(la=this.props.theme)!=null?la:"",sourceDocument:(da=this.props.sourceDocument)!=null?da:"",heading:(ca=this.props.heading)!=null?ca:"",content:(ha=this.props.content)!=null?ha:"",info:(pa=this.props.info)!=null?pa:""});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{sourceDocument:e,heading:s,content:a,theme:i,info:r},props:{orderIndex:d}}=this;return n(w,{children:[t(ue,{theme:i,orderIndex:d,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${d}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${d}`,defaultValue:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${d}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${d}`,onChange:this.handleInputChange})]}),t("div",{children:t(ne,{label:"Upload document",type:"document",id:`sourceDocument-${d}`,name:"sourceDocument",file:e,onChange:this.handleFileChange})}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${d}`,children:"Info"}),t(H,{defaultValue:r,name:"info",id:`info-${d}`,onChange:this.handleInputChange})]})})})]})]})}}var ua,ma;class eh extends ie{constructor(){super(...arguments);o(this,"state",{theme:(ua=this.props.theme)!=null?ua:"",quizId:(ma=this.props.quizId)!=null?ma:"",showModal:!1});o(this,"toggleShowModal",()=>{this.setState({showModal:!this.state.showModal})})}render(){const{state:{quizId:e,showModal:s,theme:a},props:{orderIndex:i}}=this;return n(w,{children:[t(ue,{theme:a,orderIndex:i,handleInputChange:this.handleInputChange}),t(x,{children:t(L,{onClick:this.toggleShowModal,children:"Edit"})}),n(N,{style:{maxHeight:"calc(100vh - 60px)"},show:s,onHide:this.toggleShowModal,backdrop:"static",keyboard:!1,dialogClassName:"modal-90w",children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Quiz"})}),t(N.Body,{children:t(Ze,{type:"Quiz",handleQuizChange:this.handleQuizChange,hideQuizModal:this.toggleShowModal})})]})]})}}class we extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{value:Array.isArray(this.props.value)?this.props.value:[]});o(this,"addNewItem",e=>{const{state:{value:s},props:{emptyValue:a}}=this;let i=typeof a=="function"?a(e):a;s.splice(e,0,i),this.setState({value:s})});o(this,"removeItem",e=>{const s=Object.assign(this.state.value);s.splice(e,1),this.setState({value:s}),this.props.onChange(s)});o(this,"onChange",(e,s)=>{const a=[...this.state.value];a.splice(e,1,s),this.setState({value:a},()=>{this.props.onChange(this.state.value)})})}componentDidMount(){this.state.value.length===0&&this.setState({value:[typeof this.props.emptyValue=="function"?this.props.emptyValue():this.props.emptyValue]})}componentDidUpdate(e,s){var a;if(JSON.stringify(e.value)!==JSON.stringify(this.props.value)&&this.setState({value:Array.isArray(this.props.value)?this.props.value:[]}),this.state.value.length>this.props.limit){this.setState({value:this.state.value.slice(0,this.props.limit)});return}typeof((a=this.props)==null?void 0:a.onChange)=="function"&&JSON.stringify(s.value)!==JSON.stringify(this.state.value)&&!(this.state.value.length===1&&this.state.value[0]===this.props.emptyValue)&&this.props.onChange(this.state.value)}render(){const{state:{value:e},props:h}=this,p=h,{limit:s,value:a,emptyValue:i,onChange:r,component:d}=p,c=oe(p,["limit","value","emptyValue","onChange","component"]);return t("div",{className:"input-stack",children:e.map((u,b)=>n("div",{children:[t(d,m({value:u,index:b+1,onChange:(v,S)=>{var _,k;this.onChange(b,(k=(_=v==null?void 0:v.target)==null?void 0:_.value)!=null?k:S)}},c)),(!s||s>e.length)&&t("button",{className:"bd add",onClick:()=>{this.addNewItem(b+1)},children:t(Nt,{})}),e.length!==1&&t("button",{className:"bd delete",onClick:()=>{this.removeItem(b)},children:t(vo,{})})]},b))})}}var ga,fa,ba;class Nn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isAnswer:(ga=this.props.value.isAnswer)!=null?ga:!1,text:(fa=this.props.value.text)!=null?fa:void 0,image:(ba=this.props.value.image)!=null?ba:void 0});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"handleCheckboxClick",e=>{this.setState({[e.target.name]:!this.state[e.target.name]})});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}componentDidUpdate(e,s){var a,i,r;JSON.stringify(s)!==JSON.stringify(this.state)&&this.props.onChange(null,this.state),JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState({isAnswer:(a=this.props.value.isAnswer)!=null?a:!1,text:(i=this.props.value.text)!=null?i:void 0,image:(r=this.props.value.image)!=null?r:void 0})}render(){const{state:{isAnswer:e,text:s,image:a},props:{hideImageOption:i}}=this;return n("div",{className:"single-question-option",children:[t("input",{type:"checkbox",name:"isAnswer",checked:e,onChange:this.handleCheckboxClick}),t(W,{type:"text",name:"text",value:s||"",onChange:this.handleInputChange}),!i&&t(ne,{label:"Option image",type:"image",name:"image",id:`question-image-${K()}`,file:a,onChange:this.handleFileChange})]})}}var Ca,ya,va,xa,Sa;class Mt extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{question:(va=(ya=(Ca=this.props)==null?void 0:Ca.value)==null?void 0:ya.question)!=null?va:"",options:Array.isArray((Sa=(xa=this.props)==null?void 0:xa.value)==null?void 0:Sa.options)?this.props.value.options.map((e,s)=>y(m({},e),{isAnswer:this.props.value.answer.includes(s)})):[]});o(this,"emptyOption",{isAnswer:!1,text:"",image:void 0});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"handleOptionsChange",e=>{this.setState({options:e})})}componentDidUpdate(e,s){var a;if(JSON.stringify(e.value)!==JSON.stringify(this.props.value))this.setState({question:(a=this.props.value.question)!=null?a:"",options:Array.isArray(this.props.value.options)?this.props.value.options.map((i,r)=>y(m({},i),{isAnswer:this.props.value.answer.includes(r)})):[]});else if(JSON.stringify(s)!==JSON.stringify(this.state)){let{question:i,options:r}=this.state,d=[];r=r.map((c,h)=>{const{text:p,image:u,isAnswer:b}=c;return b&&d.push(h),{text:p,image:u}}),this.props.onChange(null,{question:i,options:r,answer:d})}}render(){var r,d;const{state:{question:e},props:{index:s,hideImageOption:a}}=this;let i=Array.isArray((d=(r=this.props)==null?void 0:r.value)==null?void 0:d.options)?this.props.value.options.map((c,h)=>y(m({},c),{isAnswer:this.props.value.answer.includes(h)})):[];return n("div",{className:"question-form",children:[n("label",{htmlFor:`question-${s}`,children:["Question #",s]}),t(W,{type:"text",name:"question",id:`question-${s}`,onChange:this.handleInputChange,value:e}),n("div",{className:"question-form__options",children:[t("b",{children:"Options"}),t(we,{value:i,onChange:this.handleOptionsChange,emptyValue:this.emptyOption,component:Nn,hideImageOption:a})]})]})}}var th=z.createContext({questionType:"SINGLE_QUESTION"});class sh extends g.exports.Component{render(){return n(w,{children:[t("label",{htmlFor:`heading-${this.props.index}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${this.props.index}`,onChange:this.props.handleInputChange,value:this.props.heading}),t("label",{className:"mt-3",htmlFor:`subheading-${this.props.index}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subheading-${this.props.index}`,onChange:this.props.handleInputChange,value:this.props.subHeading}),n("div",{children:[t("label",{htmlFor:`content-${this.props.index}`,children:"Content"}),t(H,{defaultValue:this.props.content,name:"content",id:`content-${this.props.index}`,onChange:this.props.handleInputChange})]}),t("br",{}),t("h4",{className:"mt-3 mb-4",children:"Questions"}),t(we,{value:this.props.questions,emptyValue:this.props.emptyQuestion,component:Mt,onChange:this.props.handleQuestionsChange})]})}}var Ia;class ah extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{question:(Ia=this.props.value.question)!=null?Ia:"",options:Array.isArray(this.props.value.options)?this.props.value.options.map((e,s)=>y(m({},e),{isAnswer:this.props.value.answer.includes(s)})):[]});o(this,"emptyOption",{isAnswer:!1,text:"",image:void 0});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"handleOptionsChange",e=>{this.setState({options:e})})}componentDidUpdate(e,s){var a;if(JSON.stringify(e.value)!==JSON.stringify(this.props.value))this.setState({question:(a=this.props.value.question)!=null?a:"",options:Array.isArray(this.props.value.options)?this.props.value.options.map((i,r)=>y(m({},i),{isAnswer:this.props.value.answer.includes(r)})):[]});else if(JSON.stringify(s)!==JSON.stringify(this.state)){let{question:i,options:r}=this.state,d=[];r=r.map((c,h)=>{const{text:p,image:u,isAnswer:b}=c;return b&&d.push(h),{text:p,image:u}}),this.props.onChange(null,{question:i,options:r,answer:d})}}render(){const{state:{question:e},props:{index:s}}=this;let a=Array.isArray(this.props.value.options)?this.props.value.options.map((i,r)=>y(m({},i),{isAnswer:this.props.value.answer.includes(r)})):[];return a=a.slice(0,2),n("div",{className:"question-form",children:[n("label",{htmlFor:`question-${s}`,children:["Question #",s]}),t(W,{type:"text",name:"question",id:`question-${s}`,onChange:this.handleInputChange,value:e}),n("div",{className:"question-form__options",children:[t("b",{children:"Options"}),t(we,{value:a,onChange:this.handleOptionsChange,emptyValue:this.emptyOption,component:Nn,limit:2})]})]})}}class ih extends ie{render(){return n(w,{children:[n("div",{className:"mt-2",children:[t("label",{htmlFor:`heading-${this.props.index}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${this.props.index}`,onChange:this.props.handleInputChange,value:this.props.heading})]}),n("div",{className:"mt-2",children:[t("label",{htmlFor:`subheading-${this.props.index}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subheading-${this.props.index}`,onChange:this.props.handleInputChange,value:this.props.subHeading})]}),n("div",{className:"mt-2",children:[t("label",{htmlFor:`content-${this.props.index}`,children:"Content"}),t(H,{defaultValue:this.props.content,name:"content",id:`content-${this.props.index}`,onChange:this.props.handleInputChange})]}),t(we,{value:this.props.questions,emptyValue:this.props.emptyQuestion,component:ah,onChange:this.props.handleQuestionsChange})]})}}class nh extends g.exports.Component{render(){const{index:e,heading:s,subHeading:a,content:i,handleInputChange:r,emptyQuestion:d,handleQuestionsChange:c,questions:h}=this.props;return n(w,{children:[t("label",{htmlFor:`heading-${e}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${e}`,onChange:r,value:s}),t("label",{className:"mt-3",htmlFor:`subheading-${e}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subheading-${e}`,onChange:r,value:a}),n("div",{children:[t("label",{htmlFor:`content-${e}`,children:"Content"}),t(H,{defaultValue:i,name:"content",id:`content-${e}`,onChange:r})]}),t("br",{}),t("h4",{className:"mt-3 mb-4",children:"Questions"}),t(we,{value:h,emptyValue:d,component:Mt,onChange:c,hideImageOption:!0})]})}}var wa,_a,ka,Ta,Na,Aa,La,Ea,$a,Da,Pa;class rh extends ie{constructor(){super(...arguments);o(this,"state",{theme:(wa=this.props.theme)!=null?wa:"",heading:(_a=this.props.heading)!=null?_a:"",subHeading:(ka=this.props.subHeading)!=null?ka:"",content:(Ta=this.props.content)!=null?Ta:"",questions:(Na=this.props.questions)!=null?Na:[],questionType:(Aa=this.props.questionType)!=null?Aa:"SINGLE_QUESTION",nextCardAvailable:(La=this.props.nextCardAvailable)!=null?La:"AFTER_CORRECT",correctFeedback:(Ea=this.props.correctFeedback)!=null?Ea:"",incorrectFeedback:($a=this.props.incorrectFeedback)!=null?$a:"",detailedQuestion:(Da=this.props.detailedQuestion)!=null?Da:!1,info:(Pa=this.props.info)!=null?Pa:""});o(this,"getEmptyQuestion",e=>{var r,d;const{questionType:s,questions:a}=this.state;let i={question:"",options:[{isAnswer:!1,text:"",image:void 0},{isAnswer:!1,text:"",image:void 0},{isAnswer:!1,text:"",image:void 0},{isAnswer:!1,text:"",image:void 0}],answer:[]};return s!=="SINGLE_QUESTION"&&((r=a==null?void 0:a[e-1])==null?void 0:r.options)&&(i.options=(d=a==null?void 0:a[e-1])==null?void 0:d.options),i});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)});o(this,"handleQuestionsChange",e=>{this.setState({questions:e},this.dispatchLessonChange)})}render(){let{props:{questions:e,orderIndex:s},state:{heading:a,subHeading:i,questionType:r,nextCardAvailable:d,correctFeedback:c,incorrectFeedback:h,detailedQuestion:p,content:u,theme:b,info:v}}=this;return n("div",{className:"question-card",children:[n("div",{className:"options",children:[n("div",{children:[t("label",{htmlFor:`questionType-${s}`,children:"Question type"}),n("select",{name:"questionType",id:`questionType-${s}`,value:r,onChange:this.handleInputChange,children:[t("option",{value:"SINGLE_QUESTION",children:"Multiple choice"}),t("option",{value:"FILL_GAP",children:"Fill the gap"}),t("option",{value:"SWITCH_CHOICE",children:"Choice switch"}),t("option",{value:"DOUBLE_CHOICE",children:"Double choice"})]})]}),n("div",{children:[t("label",{htmlFor:`nextCardAvailable-${s}`,children:"Next Card Available"}),n("select",{name:"nextCardAvailable",id:`nextCardAvailable-${s}`,value:d,onChange:this.handleInputChange,children:[t("option",{value:"ALWAYS",children:"Always"}),t("option",{value:"AFTER_ANSWER",children:"After Answer"}),t("option",{value:"AFTER_CORRECT",children:"After Correct"})]})]})]}),n(th.Provider,{value:{questionType:r},children:[t(ue,{theme:b,orderIndex:s,handleInputChange:this.handleInputChange}),this.state.questionType==="SINGLE_QUESTION"&&n(w,{children:[n("label",{htmlFor:"detailedQuestion",className:"mb-4",children:[t("input",{type:"checkbox",checked:p,onChange:this.handleCheckboxClick,name:"detailedQuestion",id:`detailedQuestion-${s}`}),"\xA0No heading banner"]}),!p&&n(w,{children:[n("div",{children:[t("label",{htmlFor:`heading-${s}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${s}`,value:a,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${s}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${s}`,value:i,onChange:this.handleInputChange})]})]}),t(we,{value:e,emptyValue:this.getEmptyQuestion,component:Mt,onChange:this.handleQuestionsChange,limit:1})]}),this.state.questionType==="FILL_GAP"&&t(sh,{heading:this.state.heading,subHeading:this.state.subHeading,content:this.state.content,index:this.state.index,questions:e,handleInputChange:this.handleInputChange,handleQuestionsChange:this.handleQuestionsChange,emptyQuestion:this.getEmptyQuestion}),this.state.questionType==="SWITCH_CHOICE"&&t(nh,{heading:this.state.heading,subHeading:this.state.subHeading,content:this.state.content,index:this.state.index,questions:e,handleInputChange:this.handleInputChange,handleQuestionsChange:this.handleQuestionsChange,emptyQuestion:this.getEmptyQuestion}),this.state.questionType==="DOUBLE_CHOICE"&&t(ih,{heading:this.state.heading,subHeading:this.state.subHeading,content:this.state.content,index:this.state.index,questions:e,handleInputChange:this.handleInputChange,handleQuestionsChange:this.handleQuestionsChange,emptyQuestion:this.getEmptyQuestion}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:n("main",{children:[n("div",{children:[t("label",{htmlFor:`correctFeedback-${s}`,children:"Correct Feedback"}),t(H,{defaultValue:c,name:"correctFeedback",id:`correctFeedback-${s}`,onChange:this.handleInputChange}),t("label",{htmlFor:`incorrectFeedback-${s}`,children:"Incorrect Feedback"}),t(H,{defaultValue:h,name:"incorrectFeedback",id:`incorrectFeedback-${s}`,onChange:this.handleInputChange})]}),t("label",{htmlFor:`info-${s}`,children:"Info"}),t(H,{defaultValue:v,name:"info",id:`info-${s}`,onChange:this.handleInputChange})]})})]})]})]})}}var Oa;class oh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{nodes:(Oa=this.props.nodes)!=null?Oa:[],activePopoverIndex:null,activeNodeRef:null,activeTitle:"",activeMessage:""});o(this,"handleMapClick",e=>{if(e.target.classList.contains("hotspot-map__node"))return;const s=e.currentTarget.getBoundingClientRect(),a=(e.clientX-s.x-12)*100/s.width,i=(e.clientY-s.y-12)*100/s.height,r=[...this.state.nodes],{activePopoverIndex:d,activeTitle:c,activeMessage:h}=this.state;r.push({x:a,y:i,title:"",message:""}),d!==null&&(r[d].title=c,r[d].message=h),this.setState({nodes:r,activePopoverIndex:r.length-1,activeTitle:"",activeMessage:""})});o(this,"setActiveNodeRef",e=>{e!==null&&this.setState({activeNodeRef:e})});o(this,"handleNodeClick",e=>s=>{s.stopPropagation(),s.preventDefault();const{activePopoverIndex:a}=this.state;a===e?this.handleCloseNodePopover(e):this.handleOpenNodePopover(e)});o(this,"handleCloseNodePopover",e=>{const s=[...this.state.nodes],{activeTitle:a,activeMessage:i}=this.state;s[e]=y(m({},s[e]),{title:a,message:i}),this.setState({nodes:s,activeTitle:"",activeMessage:"",activePopoverIndex:null})});o(this,"handleOpenNodePopover",e=>{const{title:s,message:a}=this.state.nodes[e];this.setState({activePopoverIndex:e,activeTitle:s,activeMessage:a})});o(this,"handleNodeRightClick",e=>s=>{s.stopPropagation(),s.preventDefault();const{activePopoverIndex:a}=this.state,i=[...this.state.nodes],r={};a===e&&(r.activePopoverIndex=null,r.activeTitle="",r.activeMessage=""),i.splice(e,1),r.nodes=i,this.setState(r)});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"handleSaveNodes",e=>{const{activePopoverIndex:s}=this.state;if(s===null){this.props.onSave(this.state.nodes);return}const a=[...this.state.nodes],{activeTitle:i,activeMessage:r}=this.state;a[s]=y(m({},a[s]),{title:i,message:r}),this.setState({nodes:a,activeTitle:"",activeMessage:"",activePopoverIndex:null},()=>{this.props.onSave(this.state.nodes)})});o(this,"handleCloseMap",e=>{this.setState({activePopoverIndex:null},this.props.onClose)});o(this,"closePopup",()=>{this.setState({activeTitle:"",activeMessage:"",activePopoverIndex:null})})}componentDidUpdate(e,s){JSON.stringify(e.nodes)!==JSON.stringify(this.props.nodes)&&JSON.stringify(this.state.nodes)!==JSON.stringify(this.props.nodes)&&this.setState({nodes})}render(){const{sourceImage:e,isVisible:s}=this.props,{nodes:a,activePopoverIndex:i,activeNodeRef:r,activeTitle:d,activeMessage:c}=this.state;return n(w,{children:[n(N,{className:"hotspot-map__modal",show:s,enforceFocus:!1,children:[t(N.Body,{children:n("div",{onClick:this.handleMapClick,onContextMenu:h=>h.preventDefault(),children:[t(de,{draggable:"false",fileId:e}),a.map(({y:h,x:p},u)=>t("div",{ref:i===u?this.setActiveNodeRef:null,className:"hotspot-map__node",style:{top:`${h}%`,left:`${p}%`},onClick:this.handleNodeClick(u),onContextMenu:this.handleNodeRightClick(u)},u))]})}),n(N.Footer,{children:[t(L,{onClick:this.handleSaveNodes,children:"Save"}),t(L,{onClick:this.handleCloseMap,children:"Close"})]})]}),t(xo,{target:r,show:i!==null,placement:"right",children:t(Pe,{id:"node-popover",children:n(Pe.Content,{children:[t(I,{onClick:this.closePopup,icon:fe}),n("label",{htmlFor:"node-title",children:[t("b",{children:"Title"}),t(W,{type:"text",name:"activeTitle",id:"node-title",value:d,onChange:this.handleInputChange})]}),n("label",{htmlFor:"node-message",className:"m-0",children:[t("b",{children:"Message"}),t("textarea",{style:{resize:"none"},name:"activeMessage",id:"node-message",rows:"5",value:c,onChange:this.handleInputChange})]}),n("div",{className:"hotspot-popup-buttons",children:[t("button",{className:"save-hotspot",onClick:h=>{this.handleNodeClick(i)(h)},children:"Save"}),t("button",{className:"delete-hotspot",onClick:h=>{this.handleNodeRightClick(i)(h)},children:"Delete"})]})]})})})]})}}var Ra,Fa,Ua,Ma,Ba,Ga,Ha,qa;class lh extends ie{constructor(){super(...arguments);o(this,"state",{info:(Ra=this.props.info)!=null?Ra:"",theme:(Fa=this.props.theme)!=null?Fa:"",heading:(Ua=this.props.heading)!=null?Ua:"",subHeading:(Ma=this.props.subHeading)!=null?Ma:"",sourceImage:(Ba=this.props.sourceImage)!=null?Ba:void 0,nodes:(Ga=this.props.nodes)!=null?Ga:[],nodesTheme:(Ha=this.props.nodesTheme)!=null?Ha:"navy",isPopupVisible:!1,allowSkipNodes:(qa=this.props.allowSkipNodes)!=null?qa:!1});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)});o(this,"updateNodes",e=>{this.setState({nodes:e},this.dispatchLessonChange)});o(this,"toggleNodesPopup",()=>{this.setState({isPopupVisible:!this.state.isPopupVisible})})}render(){const{state:{heading:e,subHeading:s,sourceImage:a,nodes:i,isPopupVisible:r,theme:d,nodesTheme:c,allowSkipNodes:h,info:p},props:{orderIndex:u}}=this;return n("div",{className:"hotspot-map-card",children:[t(ue,{theme:d,orderIndex:u,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${u}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${u}`,defaultValue:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${u}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${u}`,defaultValue:s,onChange:this.handleInputChange})]}),t("div",{children:n("label",{htmlFor:`allowSkipNodes-${u}`,children:["Allow students to progress without viewing all the nodes?\xA0\xA0\xA0",t("input",{type:"checkbox",name:"allowSkipNodes",id:`allowSkipNodes-${u}`,checked:h,onChange:this.handleCheckboxClick})]})}),n("div",{children:[t(ne,{label:"Option image",type:"image",name:"sourceImage",id:`question-image-${K()}`,file:a,onChange:this.handleFileChange}),n("small",{children:[t("p",{children:"Recommended sizes to prevent panning"}),n("ul",{children:[t("li",{children:"800x400 - without heading and subheading"}),t("li",{children:"800x341 - just heading"}),t("li",{children:"800x312 - with both heading and subheading"})]})]})]}),n("div",{children:[t("label",{htmlFor:`nodesTheme-${u}`,children:"Nodes color theme"}),n("select",{name:"nodesTheme",id:`nodesTheme-${u}`,value:c,onChange:this.handleInputChange,children:[t("option",{value:"navy",children:"Navy"}),t("option",{value:"green",children:"Green"})]})]}),t("button",{className:"set-hotspots",onClick:this.toggleNodesPopup,children:"Set hotspots"}),t(oh,{onClose:this.toggleNodesPopup,onSave:this.updateNodes,sourceImage:a,nodes:i,isVisible:r}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:n("main",{children:[t("label",{htmlFor:`info-${u}`,children:"Info"}),t(H,{defaultValue:p,name:"info",id:`info-${u}`,onChange:this.handleInputChange})]})})]})]})}}var za,Va,Qa;class dh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{image:(za=this.props.value.image)!=null?za:"",content:(Va=this.props.value.content)!=null?Va:"",title:(Qa=this.props.value.title)!=null?Qa:""});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)})}componentDidUpdate(e,s){JSON.stringify(s)!==JSON.stringify(this.state)&&this.props.onChange(null,this.state)}render(){const{image:e,content:s,title:a}=this.state,{orderIndex:i}=this.props;return n("div",{className:"hotspotlist__item",children:[t(ne,{label:"Hotspot image",type:"image",name:"image",id:`hostspot-image-${K()}`,file:e,onChange:this.handleFileChange}),n("div",{children:[t("label",{htmlFor:`hotspotLabel-${i}`,children:"Hotspot title"}),t("input",{name:"title",type:"text",id:`hotspotLabel-${i}`,onChange:this.handleInputChange,defaultValue:a})]}),n("div",{children:[t("label",{htmlFor:`hotspotcontent-${K()}`,children:"Hotspot content"}),t(H,{defaultValue:s,name:"content",id:`hotspotcontent-${K()}`,onChange:this.handleInputChange})]})]})}}var Wa,Ka,Ya,ja,Za,Ja,Xa,ei;class ch extends ie{constructor(){super(...arguments);o(this,"state",{theme:(Wa=this.props.theme)!=null?Wa:"",direction:(Ka=this.props.direction)!=null?Ka:"vertical",heading:(Ya=this.props.heading)!=null?Ya:"",subHeading:(ja=this.props.subHeading)!=null?ja:"",content:(Za=this.props.content)!=null?Za:"",info:(Ja=this.props.info)!=null?Ja:"",imageTextList:(Xa=this.props.imageTextList)!=null?Xa:[],allowSkipNodes:(ei=this.props.allowSkipNodes)!=null?ei:!1});o(this,"emptyHotspotListItem",{image:"",content:"",title:""});o(this,"handleListChange",e=>{this.setState({imageTextList:e},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,imageTextList:r,theme:d,direction:c,allowSkipNodes:h},props:{orderIndex:p}}=this;return n(w,{children:[t(ue,{theme:d,orderIndex:p,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`direction-${p}`,children:"List Direction"}),n("select",{name:"direction",id:`direction-${p}`,onChange:this.handleInputChange,defaultValue:c,children:[t("option",{value:"vertical",children:"Vertical"}),t("option",{value:"horizontal",children:"Horizontal"})]})]}),n("div",{children:[t("label",{htmlFor:`heading-${p}`,children:"Heading"}),t("input",{type:"text",name:"heading",id:`heading-${p}`,defaultValue:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${p}`,children:"Subheading"}),t("input",{type:"text",name:"subHeading",id:`subHeading-${p}`,defaultValue:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${p}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${p}`,onChange:this.handleInputChange})]}),t("div",{children:n("label",{htmlFor:`allowSkipNodes-${p}`,children:["Allow students to progress without viewing all the nodes?\xA0\xA0\xA0",t("input",{type:"checkbox",name:"allowSkipNodes",id:`allowSkipNodes-${p}`,checked:h,onChange:this.handleCheckboxClick})]})}),t(we,{value:r,emptyValue:this.emptyHotspotListItem,component:dh,onChange:this.handleListChange,orderIndex:p}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${p}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${p}`,onChange:this.handleInputChange})]})})})]})]})}}var ti,si;class hh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{image:(ti=this.props.value.image)!=null?ti:"",content:(si=this.props.value.content)!=null?si:""});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)})}componentDidUpdate(e,s){JSON.stringify(s)!==JSON.stringify(this.state)&&this.props.onChange(null,this.state)}render(){const{image:e,content:s}=this.state;return n("div",{className:"hotspotlist__item",children:[t(ne,{label:"Image",type:"image",name:"image",id:`hostspot-image-${K()}`,file:e,onChange:this.handleFileChange}),n("div",{children:[t("label",{htmlFor:`hotspotcontent-${K()}`,children:"Hotspot content"}),t(H,{defaultValue:s,name:"content",id:`hotspotcontent-${K()}`,onChange:this.handleInputChange})]})]})}}var ai,ii,ni,ri,oi;class ph extends ie{constructor(){super(...arguments);o(this,"state",{theme:(ai=this.props.theme)!=null?ai:"",heading:(ii=this.props.heading)!=null?ii:"",subHeading:(ni=this.props.subHeading)!=null?ni:"",content:(ri=this.props.content)!=null?ri:"",info:(oi=this.props.info)!=null?oi:"",horizontalListItems:this.props.horizontalListItems||[]});o(this,"emptyHorizontalListItem",{image:"",content:""});o(this,"handleListChange",e=>{this.setState({horizontalListItems:e},this.dispatchLessonChange)})}render(){const{state:{heading:e,subHeading:s,content:a,info:i,horizontalListItems:r,theme:d},props:{orderIndex:c}}=this;return n(w,{children:[t(ue,{theme:d,orderIndex:c,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${c}`,children:"Heading"}),t("input",{type:"text",name:"heading",id:`heading-${c}`,defaultValue:e,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${c}`,children:"Subheading"}),t("input",{type:"text",name:"subHeading",id:`subHeading-${c}`,defaultValue:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${c}`,children:"Content"}),t(H,{defaultValue:a,name:"content",id:`content-${c}`,onChange:this.handleInputChange})]}),t(we,{value:r,emptyValue:this.emptyHorizontalListItem,component:hh,onChange:this.handleListChange,limit:3}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${c}`,children:"Info"}),t(H,{defaultValue:i,name:"info",id:`info-${c}`,onChange:this.handleInputChange})]})})})]})]})}}var li,di,ci;class uh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{image:(li=this.props.value.image)!=null?li:"",content:(di=this.props.value.content)!=null?di:"",title:(ci=this.props.value.title)!=null?ci:""});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},this.dispatchLessonChange)})}componentDidUpdate(e,s){var a,i,r;JSON.stringify(e.value)!==JSON.stringify(this.props.value)?this.setState({title:(a=this.props.value.title)!=null?a:"",content:(i=this.props.value.content)!=null?i:"",image:(r=this.props.value.image)!=null?r:""}):JSON.stringify(s)!==JSON.stringify(this.state)&&this.props.onChange(null,this.state)}render(){const{image:e,content:s,title:a}=this.state,{orderIndex:i}=this.props;return n("div",{className:"mnemonic-item",children:[t(ne,{label:"Hotspot image",type:"image",name:"image",id:`hostspot-image-${K()}`,file:e,onChange:this.handleFileChange}),n("div",{children:[t("label",{htmlFor:`mnemonicLabel-${i}`,children:"Mnemonic title"}),t(W,{name:"title",type:"text",id:`mnemonicLabel-${i}`,onChange:this.handleInputChange,defaultValue:a})]}),n("div",{children:[t("label",{htmlFor:`mnemoniccontent-${K()}`,children:"Mnemonic content"}),t(H,{defaultValue:s,name:"content",id:`mnemoniccontent-${K()}`,onChange:this.handleInputChange})]})]})}}var hi;class mh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{value:(hi=this.props.value)!=null?hi:[]});o(this,"emptyMnemonicItem",{title:"",content:"",image:""});o(this,"handleMnmonicRowChange",e=>{this.setState({value:e})})}componentDidUpdate(e,s){var a,i,r;JSON.stringify(e.value)!==JSON.stringify(this.props.value)?this.setState({title:(a=this.props.value.title)!=null?a:"",content:(i=this.props.value.content)!=null?i:"",image:(r=this.props.value.image)!=null?r:""}):JSON.stringify(s.value)!==JSON.stringify(this.state.value)&&this.props.onChange(null,this.state.value)}render(){const{value:e,index:s}=this.props;return n(T,{as:B,className:"mnemonic-row",children:[n(T.Toggle,{as:B.Header,eventKey:`mnemonic-row-${s}`,children:["Mnemonic row #",s]}),t(T.Collapse,{eventKey:`mnemonic-row-${s}`,children:t(B.Body,{children:t(we,{value:e,emptyValue:this.emptyMnemonicItem,component:uh,onChange:this.handleMnmonicRowChange})})})]})}}var pi,ui,mi,gi,fi,bi,Ci;class gh extends ie{constructor(){super(...arguments);o(this,"state",{theme:(pi=this.props.theme)!=null?pi:"",heading:(ui=this.props.heading)!=null?ui:"",subHeading:(mi=this.props.subHeading)!=null?mi:"",content:(gi=this.props.content)!=null?gi:"",info:(fi=this.props.info)!=null?fi:"",mnemonicList:(bi=this.props.mnemonicList)!=null?bi:[],allowSkipNodes:(Ci=this.props.allowSkipNodes)!=null?Ci:!1});o(this,"emptyMnemonicRow",[]);o(this,"handleMnemonicListChange",e=>{this.setState({mnemonicList:e},this.dispatchLessonChange)})}render(){const{theme:e,heading:s,subHeading:a,content:i,info:r,mnemonicList:d,allowSkipNodes:c}=this.state,{orderIndex:h}=this.props;return n(w,{children:[t(ue,{theme:e,orderIndex:h,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`heading-${h}`,children:"Heading"}),t(W,{type:"text",name:"heading",id:`heading-${h}`,value:s,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`subHeading-${h}`,children:"Subheading"}),t(W,{type:"text",name:"subHeading",id:`subHeading-${h}`,value:a,onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:`content-${h}`,children:"Content"}),t(H,{defaultValue:i,name:"content",id:`content-${h}`,onChange:this.handleInputChange})]}),t("div",{children:n("label",{htmlFor:`allowSkipNodes-${h}`,children:["Allow students to progress without viewing all the nodes?\xA0\xA0\xA0",t("input",{type:"checkbox",name:"allowSkipNodes",id:`allowSkipNodes-${h}`,checked:c,onChange:this.handleCheckboxClick})]})}),n("div",{children:[t("label",{htmlFor:`mnemonicList-${h}`,children:"Mnemonic rows"}),t(we,{value:d,emptyValue:this.emptyMnemonicRow,component:mh,onChange:this.handleMnemonicListChange})]}),n(T,{as:"footer",className:"lesson-cards__item__extras",children:[t(T.Toggle,{as:"button",className:"bd",eventKey:"0",children:"Extras"}),t(T.Collapse,{eventKey:"0",children:t("main",{children:n("div",{children:[t("label",{htmlFor:`info-${h}`,children:"Info"}),t(H,{defaultValue:r,name:"info",id:`info-${h}`,onChange:this.handleInputChange})]})})})]})]})}}var yi,vi,xi,Si,Ii;class fh extends ie{constructor(){super(...arguments);o(this,"state",{theme:(yi=this.props.theme)!=null?yi:"",content:(vi=this.props.content)!=null?vi:"",sourceImage:(xi=this.props.sourceImage)!=null?xi:"",sourceIcon:(Si=this.props.sourceIcon)!=null?Si:"",iconPosition:(Ii=this.props.iconPosition)!=null?Ii:"TOP"});o(this,"handleInputChange",e=>{let s=e.target,a;s.name==="imageImportance"?a=s.value==="preserveSizing":a=s.value,this.setState({[s.name]:a},this.dispatchLessonChange)});o(this,"handleFileChange",(e,s)=>{const a=e.target;this.setState({[a.name]:s},this.dispatchLessonChange)})}render(){const{state:{content:e,sourceImage:s,sourceIcon:a,iconPosition:i,theme:r},props:{orderIndex:d}}=this;return this.state.imageImportance,n(w,{children:[t(ue,{theme:r,orderIndex:d,handleInputChange:this.handleInputChange}),n("div",{children:[t("label",{htmlFor:`iconPosition-${d}`,children:"Image location"}),n("select",{name:"iconPosition",id:`iconPosition-${d}`,value:i,onChange:this.handleInputChange,children:[t("option",{value:"TOP",children:"Top"}),t("option",{value:"BOTTOM",children:"Bottom"}),t("option",{value:"LEFT",children:"Left"}),t("option",{value:"RIGHT",children:"Right"})]})]}),t("div",{children:t(ne,{label:"Upload background image",type:"image",id:`sourceImage-${d}`,name:"sourceImage",file:s,onChange:this.handleFileChange})}),t("div",{children:t(ne,{label:"Upload icon",type:"image",id:`sourceIcon-${d}`,name:"sourceIcon",file:a,onChange:this.handleFileChange})}),n("div",{children:[t("label",{htmlFor:`content-${d}`,children:"Content"}),t(H,{defaultValue:e,name:"content",id:`content-${d}`,onChange:this.handleInputChange})]})]})}}class bh extends g.exports.Component{render(){const{cardType:e,isNew:s,orderIndex:a,_id:i,cardTitle:r,theme:d}=this.props;switch(e){case"TRANSITION":{const{content:c,sourceImage:h,sourceIcon:p,iconPosition:u}=this.props;return t(fh,{sourceImage:h,sourceIcon:p,iconPosition:u,content:c,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,theme:d})}case"HEADING":{const{heading:c,subHeading:h,content:p,bgColor:u,fgColor:b,info:v}=this.props;return t(Wc,{heading:c,subHeading:h,content:p,bgColor:u,fgColor:b,info:v,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,theme:d})}case"IMAGE":{const{heading:c,subHeading:h,content:p,sourceImage:u,imageUrl:b,imagePosition:v,info:S,imageImportance:_,allowEnlargeImage:k}=this.props;return t(Kc,{heading:c,subHeading:h,content:p,sourceImage:u,imageUrl:b,imagePosition:v,info:S,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,imageImportance:_,theme:d,allowEnlargeImage:k})}case"VIDEO":{const{transcript:c,info:h,sourceVideo:p,cardType:u}=this.props;return t(jc,{transcript:c,sourceVideo:p,info:h,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:u,theme:d})}case"AUDIO":{const{heading:c,subHeading:h,content:p,transcript:u,info:b,sourceAudio:v}=this.props;return t(Zc,{heading:c,subHeading:h,content:p,transcript:u,sourceAudio:v,info:b,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,theme:d})}case"AUDIO_BIG":{const{heading:c,subHeading:h,info:p,sourceAudio:u,cardType:b}=this.props;return t(Jc,{heading:c,subHeading:h,sourceAudio:u,info:p,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:b,theme:d})}case"DOCUMENT":{const{sourceDocument:c,heading:h,content:p}=this.props;return t(Xc,{sourceDocument:c,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,heading:h,content:p,theme:d})}case"SINGLE_QUESTION":{const{heading:c,subHeading:h,info:p,questionType:u,questions:b,nextCardAvailable:v,correctFeedback:S,incorrectFeedback:_,detailedQuestion:k,content:O}=this.props;return t(rh,{heading:c,subHeading:h,info:p,questionType:u,questions:b,isNew:s,cardId:i,content:O,orderIndex:a,cardTitle:r,cardType:e,nextCardAvailable:v,correctFeedback:S,incorrectFeedback:_,detailedQuestion:k,theme:d})}case"HOTSPOT_LIST":{const{heading:c,subHeading:h,content:p,imageTextList:u,info:b,direction:v,allowSkipNodes:S}=this.props;return t(ch,{heading:c,subHeading:h,content:p,imageTextList:u,info:b,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,direction:v,theme:d,allowSkipNodes:S})}case"HOTSPOT_MAP":{const{heading:c,subHeading:h,nodes:p,sourceImage:u,nodesTheme:b,allowSkipNodes:v}=this.props;return t(lh,{heading:c,subHeading:h,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,sourceImage:u,nodes:p,theme:d,nodesTheme:b,allowSkipNodes:v})}case"HORIZONTAL_LIST":{const{heading:c,subHeading:h,content:p,horizontalListItems:u,info:b}=this.props;return t(ph,{heading:c,subHeading:h,content:p,horizontalListItems:u,info:b,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,theme:d})}case"QUIZ":{const{quizId:c,cardType:h}=this.props;return t(eh,{quizId:c,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:h,theme:d})}case"MNEMONIC":{const{heading:c,subHeading:h,content:p,info:u,mnemonicList:b,allowSkipNodes:v}=this.props;return t(gh,{isNew:s,cardId:i,theme:d,orderIndex:a,heading:c,subHeading:h,content:p,info:u,mnemonicList:b,cardTitle:r,cardType:e,allowSkipNodes:v})}default:{const{heading:c,subHeading:h,content:p,info:u,sourceImage:b}=this.props;return t(Yc,{heading:c,subHeading:h,sourceImage:b,content:p,info:u,isNew:s,cardId:i,orderIndex:a,cardTitle:r,cardType:e,theme:d})}}}}var wi,_i;class An extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{_id:this.props._id,cardType:(wi=this.props.cardType)!=null?wi:"TEXT",cardTitle:(_i=this.props.cardTitle)!=null?_i:"Card reference"});o(this,"cardTypes",{TRANSITION:"Transition",TEXT:"Text",HEADING:"Heading",AUDIO:"Audio",VIDEO:"Video",IMAGE:"Image",SINGLE_QUESTION:"Question",HOTSPOT_LIST:"Hotspot list",HOTSPOT_MAP:"Hotspot map",HORIZONTAL_LIST:"Horizontal list",MNEMONIC:"Mnemonic",DOCUMENT:"Document",QUIZ:"Quiz"});o(this,"accordionToggleRef",z.createRef());o(this,"stopPropagation",e=>{e&&typeof(e==null?void 0:e.stopPropagation)=="function"&&e.stopPropagation()});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value},()=>{this.context.patchLessonCard(this.props.orderIndex,{[s.name]:s.value},this.context.enableSaveButton)})});o(this,"handleDragHandleClick",(e,s)=>{s==="0"&&this.accordionToggleRef.current?this.accordionToggleRef.current.click():this.stopPropagation(e)})}render(){const{props:{lastCardIndex:e,insertNewCard:s,removeCard:a,handleIndexChange:i,orderIndex:r,cloneCard:d},state:{cardTitle:c,cardType:h,_id:p},context:{lesson:{draft:u}}}=this;return t(le,{draggableId:p,index:r,children:(b,v)=>n("div",{className:"lesson-cards__item",children:[t("span",{className:"bd",onClick:()=>{s()},"data-orderindex":r,children:t(Nt,{})}),t(T,y(m({ref:b.innerRef},b.draggableProps),{children:t(Ae.Consumer,{children:S=>n(B,{children:[n(T.Toggle,{as:B.Header,ref:this.accordionToggleRef,eventKey:"0",children:[t("span",y(m({},b.dragHandleProps),{onMouseDown:_=>{this.handleDragHandleClick(_,S)},onClick:this.stopPropagation,children:t(So,{})})),t("input",{type:"number",name:"orderIndex",id:"orderIndex",value:r+1,onChange:i,onClick:this.stopPropagation}),t("input",{type:"text",name:"cardTitle",id:`cardTitle-${r}`,value:c,onChange:this.handleInputChange,onClick:this.stopPropagation}),t("div",{className:"cardType-select",children:t("select",{name:"cardType",id:"cardType",value:h,onChange:this.handleInputChange,onClick:this.stopPropagation,children:Object.keys(this.cardTypes).map(_=>t("option",{value:_,children:this.cardTypes[_]},_))})}),n("div",{children:[t("button",{className:"bd",children:t(Io,{})}),t("button",{className:"bd",onClick:_=>{this.stopPropagation(_),d()},children:t(wo,{})}),t("button",{className:"bd",onClick:_=>{this.stopPropagation(_),a()},"data-orderindex":r,children:t(_o,{})})]})]}),t(T.Collapse,{eventKey:"0",children:t(B.Body,{className:"lesson-cards__item__form",children:t(bh,y(m({},this.props),{cardType:h,cardTitle:c,quizId:u.endOfChapterQuizId}))})})]})})})),r===e&&t("span",{className:"bd",onClick:()=>{s(e+1)},children:t(Nt,{})})]})})}}o(An,"contextType",Ke);var Ch="/home/adrian/work/lms/frontend/src/pages/Admin/Courses/Lesson/LessonCards.jsx";const yh=ko({proto:!0});class Ln extends g.exports.Component{constructor(e){super(e);o(this,"counterS",0);o(this,"_isMounted",!1);o(this,"reorderCards",(e,s)=>{const a=[...this.context.cards],[i]=a.splice(e,1);a.splice(s,0,i),this.context.updateCards(a.map((r,d)=>y(m({},r),{orderIndex:d})),this.context.enableSaveButton)});o(this,"handleDragAndDropEnd",e=>{this.reorderCards(e.source.index,e.destination.index)});o(this,"loadLessonCards",async e=>{const{success:s,response:a}=await C("GET",`/courses/lessons/${e}/cards`);this._isMounted&&(s?this.setState({pageStatus:"READY",currentLessonId:e},()=>{this.context.updateCards(a.length>0?a.map(i=>{const c=i,{draft:r}=c,d=oe(c,["draft"]);return m(m({},d),r)}).sort((i,r)=>i.orderIndex-r.orderIndex):[{_id:K(),cardType:"TEXT",cardTitle:"Card reference",orderIndex:0}])}):this.props.setGlobalAlert({type:"error",message:"Failed to load lesson cards"}))});o(this,"cloneCard",e=>{this.insertNewCard(e+1,Object.assign({},yh(this.context.cards[e]),{_id:K(),cardTitle:`${this.context.cards[e].cardTitle} copy`}))});o(this,"insertNewCard",(e,s)=>{const a=[...this.context.cards];a.splice(e,0,s!=null?s:{_id:K(),cardType:"TEXT",cardTitle:"Card reference",orderIndex:e}),this.context.updateCards(a,this.context.enableSaveButton)});o(this,"removeCard",e=>{const s=[...this.context.cards],a=[...this.context.deletedCards],[i]=s.splice(e,1);if(s.length===0&&s.splice(0,0,{_id:K(),cardType:"TEXT",cardTitle:"Card reference",orderIndex:e}),!i._id.includes("-")){const{_id:r,cardTitle:d,orderIndex:c}=i;a.push({_id:r,cardTitle:d,orderIndex:c})}this.context.updateCards(s,this.context.enableSaveButton),this.context.updateDeletedCards(a)});o(this,"handleIndexChange",(e,s)=>{const a=e.target,i=parseInt(a.value);this.reorderCards(s,i)});var s,a,i;this.state={pageStatus:"LOADING",cardsSubmitted:0,currentLessonId:(i=(a=(s=e==null?void 0:e.match)==null?void 0:s.params)==null?void 0:a.lessonId)!=null?i:""}}async componentDidMount(){var e,s;this._isMounted=!0,this.loadLessonCards((s=(e=this.context)==null?void 0:e.lesson)==null?void 0:s._id)}async componentDidUpdate(e,s){var a,i,r,d,c,h;s.currentLessonId!==((r=(i=(a=this.context)==null?void 0:a.lesson)==null?void 0:i._id)!=null?r:"")&&this.setState({pageStatus:"LOADING",currentLessonId:(h=(c=(d=this.context)==null?void 0:d.lesson)==null?void 0:c._id)!=null?h:""},()=>{var p,u;this.loadLessonCards((u=(p=this.context)==null?void 0:p.lesson)==null?void 0:u._id)})}componentWillUnmount(){this._isMounted=!1}render(){const{state:{pageStatus:e},context:{cards:s}}=this;return e==="READY"?t(be,{onDragEnd:this.handleDragAndDropEnd,children:t(Ce,{droppableId:"lessonCards",children:(a,i)=>n("div",y(m({},a.droppableProps),{ref:a.innerRef,children:[s.map((r,d)=>g.exports.createElement(An,y(m({_id:r._id},r),{key:r._id,lastCardIndex:s.length-1,insertNewCard:c=>{this.insertNewCard(c!=null?c:d)},cloneCard:()=>{this.cloneCard(d)},removeCard:()=>{this.removeCard(d)},orderIndex:d,handleIndexChange:c=>{this.handleIndexChange(c,d)},__self:this,__source:{fileName:Ch,lineNumber:185,columnNumber:37}}))),a.placeholder]}))})}):t(Q,{})}}o(Ln,"contextType",Ke);var vh=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Ln));class xh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{showRevertModal:!1});o(this,"setPageButtons",()=>{var r,d;const{props:{adminLessonContext:e}}=this,{isSaveDisabled:s,isSubmitDisabled:a}=e,i=[{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:s},{label:"Publish",onClick:this.handlePublish,className:a?"":"bp",disabled:a},{label:"Revert",onClick:this.handleShowRevertWarningModal,disabled:a}];(r=e==null?void 0:e.lesson)!=null&&r.previousLesson&&i.push({label:"Previous",className:"lesson-navigation-btn",icon:Xe,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${e.lesson.previousLesson.chapterId}/lessons/${e.lesson.previousLesson._id}`}),(d=e==null?void 0:e.lesson)!=null&&d.nextLesson&&i.push({label:"Next",className:"lesson-navigation-btn",icon:Be,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${e.lesson.nextLesson.chapterId}/lessons/${e.lesson.nextLesson._id}`}),this.props.setFormActions({customButtons:i})});o(this,"handleShowRevertWarningModal",async()=>{this.setState({showRevertModal:!this.state.showRevertModal})});o(this,"handleSubmit",async()=>{this.props.adminLessonContext.disableSaveButton(),await this.handleSubmitLessonCards(),await this.handleDeletedLessonCards(),await this.handleSubmitLessonForm()});o(this,"handleSubmitLessonForm",async()=>{const{lesson:{_id:e,chapterId:s},lessonForm:h}=this.props.adminLessonContext,p=h,{hasQuiz:a,currentLessonId:i}=p,r=oe(p,["hasQuiz","currentLessonId"]),{success:d,message:c}=await C("PUT",`/courses/lessons/${e}`,y(m({},r),{chapterId:s}));d?this.props.adminLessonContext.enablePublishButton(()=>{this.props.setGlobalAlert({type:"success",message:"Lesson draft saved"})}):(this.props.setGlobalAlert({type:"error",message:`Lesson draft could not be saved: ${c}`}),this.props.adminLessonContext.enableSaveButton())});o(this,"handleSubmitLessonCards",async()=>{const{cards:e}=this.props.adminLessonContext;for(const s in e)await this.submitLessonCard(e[s],parseInt(s))});o(this,"submitLessonCard",async(e,s)=>{var h,p;let a=y(m({},e),{orderIndex:s});delete a._id,a=await this.handleFileUploads(a);const i=(p=(h=e==null?void 0:e._id)==null?void 0:h.includes("-"))!=null?p:!0,{success:r,message:d,response:c}=await C(i?"POST":"PUT",i?`/courses/lessons/${this.props.adminLessonContext.lesson._id}/cards`:`/courses/lessons/cards/${e._id}`,a);r?i&&this.props.adminLessonContext.patchLessonCard(a.orderIndex,{_id:c._id}):(this.props.setGlobalAlert({type:"error",message:`[${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${d}`}),this.props.adminLessonContext.enableSaveButton())});o(this,"handleFileUploads",async e=>{const s=m({},e),a={sourceImage:"Image file",sourceAudio:"Audio file",sourceDocument:"Document file"};for(const i of["sourceImage","sourceAudio","sourceDocument","sourceIcon"])if(i in e&&e[i]instanceof File){const r=new FormData;r.append("file",e[i]);const{success:d,response:{fileId:c}={},message:h}=await C("POST","/files",r);if(d)s[i]=c;else{this.props.setGlobalAlert({type:"error",message:`${a[i]} for [${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${h}`}),this.props.adminLessonContext.enableSaveButton();return}}if(Array.isArray(s.questions)){for(const i of s.questions)if(Array.isArray(i.options)){for(const r of i.options)if(r.image instanceof File){const d=new FormData;d.append("file",r.image);const{success:c,response:{fileId:h}={},message:p}=await C("POST","/files",d);if(c)r.image=h;else{this.props.setGlobalAlert({type:"error",message:`${a.sourceImage} for [${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${p}`}),this.props.adminLessonContext.enableSaveButton();return}}}}if(Array.isArray(s.imageTextList)){for(const i of s.imageTextList)if(i.image instanceof File){const r=new FormData;r.append("file",i.image);const{success:d,response:{fileId:c}={},message:h}=await C("POST","/files",r);if(d)i.image=c;else{this.props.setGlobalAlert({type:"error",message:`${a.sourceImage} for [${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${h}`}),this.props.adminLessonContext.enableSaveButton();return}}}if(Array.isArray(s.horizontalListItems)){for(const i of s.horizontalListItems)if(i.image instanceof File){const r=new FormData;r.append("file",i.image);const{success:d,response:{fileId:c}={},message:h}=await C("POST","/files",r);if(d)i.image=c;else{this.props.setGlobalAlert({type:"error",message:`${a.sourceImage} for [${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${h}`}),this.props.adminLessonContext.enableSaveButton();return}}}if(Array.isArray(s.mnemonicList)){for(const i of s.mnemonicList)for(const r of i)if(r.image instanceof File){const d=new FormData;d.append("file",r.image);const{success:c,response:{fileId:h}={},message:p}=await C("POST","/files",d);if(c)r.image=h;else{this.props.setGlobalAlert({type:"error",message:`${a.sourceImage} for [${e.orderIndex+1}] ${e.cardTitle} could not be saved: ${p}`}),this.props.adminLessonContext.enableSaveButton();return}}}return s});o(this,"handleDeletedLessonCards",async()=>{const e=[];if(this.props.adminLessonContext.deletedCards.length)for(const{cardTitle:s,_id:a,orderIndex:i}of this.props.adminLessonContext.deletedCards){const{success:r,message:d}=await C("DELETE",`/courses/lessons/cards/${a}`);r||(this.props.setGlobalAlert({type:"error",message:`[${i+1}] ${s} could not be deleted: ${d}`}),e.push({cardTitle:s,_id:a,orderIndex:i}))}this.props.adminLessonContext.updateDeletedCards(e)});o(this,"handlePublish",()=>{window.socket.emit("publish course lesson",this.props.match.params.lessonId)});o(this,"handleRevert",async()=>{const{lessonId:e}=this.props.match.params,{success:s,message:a}=await C("POST",`/courses/lessons/${e}/revert`);s?this.props.history.go(0):this.props.setGlobalAlert({type:"error",message:"Failed to revert course lesson draft: "+a})})}componentDidMount(){this.setPageButtons()}componentDidUpdate(e,s,a){var i,r,d,c,h,p,u,b;(((r=(i=this.props.adminLessonContext)==null?void 0:i.lesson)==null?void 0:r._id)!==((c=(d=e.adminLessonContext)==null?void 0:d.lesson)==null?void 0:c._id)||((h=this.props.adminLessonContext)==null?void 0:h.isSaveDisabled)!==((p=e.adminLessonContext)==null?void 0:p.isSaveDisabled)||((u=this.props.adminLessonContext)==null?void 0:u.isSubmitDisabled)!==((b=e.adminLessonContext)==null?void 0:b.isSubmitDisabled))&&this.setPageButtons()}render(){const{pageStatus:e,lessonForm:s}=this.props.adminLessonContext,{showRevertModal:a}=this.state;return e==="READY"?n(w,{children:[t(Qc,{lessonForm:s}),n("div",{className:"lesson-cards",children:[t("h5",{children:"Content"}),t(vh,{})]}),n(N,{show:a,onHide:this.handleShowRevertWarningModal,children:[t(N.Header,{closeButton:!0,children:"Revert draft changes to published?"}),t(N.Body,{children:"If you proceed with this action all the draft changes you have made will be lost and will be reverted to the published version"}),n(N.Footer,{children:[t("button",{className:"bd",onClick:this.handleRevert,children:"Revert"}),t("button",{className:"bp",onClick:this.handleShowRevertWarningModal,children:"Cancel"})]})]})]}):t(Q,{})}}var Sh=$(null,{setFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(xh));const Bt=z.createContext(null),re=z.createContext({data:null,unlockedLessons:[],completedLessons:[]});class En extends g.exports.Component{constructor(){super(...arguments);o(this,"_isMounted",!1);o(this,"state",{chapters:null,pageStatus:"LOADING",activeAccordion:null,fixedProgress:!1});o(this,"menuRef",z.createRef());o(this,"initMenuScrollEvent",()=>{this.menuRef.current.addEventListener("scroll",e=>{const s=e.target,a=s.querySelector("header > h3"),{fixedProgress:i}=this.state;if(a&&s.scrollTop>=a.clientHeight){if(i)return;this.setState({fixedProgress:!0})}else{if(!i)return;this.setState({fixedProgress:!1})}})});o(this,"toggleOpenAccordion",e=>{this.state.activeAccordion===e?this.setState({activeAccordion:null}):this.setState({activeAccordion:e})})}async componentDidMount(){this._isMounted=!0;const{success:e,response:s}=await C("GET",this.props.itemsEndpoint);e&&this._isMounted&&this.setState({chapters:Array.isArray(s)?s:s.chapters,pageStatus:"READY",activeAccordion:this.props.match.params.chapterId}),this.menuRef.current&&this.initMenuScrollEvent()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(e,s){this.props.match.params.chapterId!==e.match.params.chapterId&&this.setState({activeAccordion:this.props.match.params.chapterId})}render(){const{state:{pageStatus:e},props:{children:s},context:{lessonLayout:a,isMenuOpen:i,animateMenu:r}}=this;if(e==="READY"&&a!==null){const{state:{chapters:d,fixedProgress:c},props:{itemsComponent:h,showHeader:p=!1}}=this,{title:u,percentageProgress:b,lessons:v,courseProgress:S,expiresAt:_,availability:k}=this.context.data||{},O=qe((v==null?void 0:v.totalRequiredTime)*6e4,{units:["h"],round:!0}),F=qe(S*6e4,{units:["h"],round:!0}),G=Math.floor(new Date(_).getTime()-Date.now()),q=k*24*36e5,j=qe(G>q?q:G,{units:["d"],round:!0});return n("menu",{ref:this.menuRef,className:`cmenu${c?" cmenu__progress--fixed":""}${a?` cmenu--${a.toLowerCase()}`:""}${i?` cmenu--${a.toLowerCase()}--open`:""}${r?` cmenu--${a.toLowerCase()}--animate`:""}`,children:[p&&n(w,{children:[t("header",{children:t("h3",{children:u})}),n("div",{className:"cmenu__progress",children:[t(pn,{value:b,text:`${Math.floor(b)}%`,strokeWidth:14}),n("span",{children:[F.slice(0,-6)," of ",O," completed"]}),n("b",{children:["Expires in ",j]})]})]}),t(Bt.Provider,{value:this.menuRef,children:t(T,{activeKey:this.state.activeAccordion,children:d.map(Y=>t(h,{item:Y,onClick:()=>{this.toggleOpenAccordion(Y._id)}},Y._id))})}),s]})}else return e==="READY"?t(w,{}):t("menu",{ref:this.menuRef,className:"cmenu",children:t(Q,{})})}}o(En,"contextType",re);var Gt=D(En);class Ih extends g.exports.Component{get shouldTitleSplit(){const{splitTitle:e,title:s}=this.props;return e===!1?!1:/^Chapter ([\d\w\.]+)\s*-/.test(s)}get heading(){return this.props.title.split("-")[0].trim()}get subHeading(){return this.props.title.split("-")[1].trim()}render(){return this.shouldTitleSplit?n(w,{children:[t("b",{children:this.heading}),this.subHeading&&t("span",{children:this.subHeading})]}):t("b",{children:this.props.title})}}class $n extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{scrollDidHappen:!1});o(this,"itemRef",z.createRef())}componentDidUpdate(e,s){this.props.match.params.lessonId===this.props._id?this.itemRef.current&&(this.state.scrollDidHappen||(this.setState({scrollDidHappen:!0}),this.props.match.params.chapterId!==e.match.params.chapterId?setTimeout(()=>{this.itemRef.current.scrollIntoView({behavior:"smooth"})},500):this.itemRef.current.scrollIntoView({behavior:"smooth"}))):this.state.scrollDidHappen&&this.setState({scrollDidHappen:!1})}render(){const{_id:e,title:s,unlocked:a,completed:i,userChapterId:r,match:{params:{courseId:d,lessonId:c}}}=this.props,h=`/courses/${d}/chapters/${r}/lessons/${e}/cards/1`,p=i||this.props.courseContext.completedLessons.includes(e)?To:No;return c===e?n(R,{ref:this.itemRef,to:h,className:"cmenu__lesson cmenu__lesson--active",children:[t("div",{className:"cmenu__lesson-icon",children:t(Ao,{})}),t("span",{children:s})]}):!a&&!this.props.courseContext.unlockedLessons.includes(e)?n("span",{ref:this.itemRef,className:"cmenu__lesson",children:[t("div",{className:"cmenu__lesson-icon",children:t(Lo,{})}),t("span",{children:s})]}):n(R,{ref:this.itemRef,to:h,className:`cmenu__lesson${i||this.props.courseContext.completedLessons.includes(e)?" cmenu__lesson--complete":""}`,children:[t("div",{className:"cmenu__lesson-icon",children:t(p,{})}),t("span",{children:s})]})}}o($n,"contextType",Bt);var wh=D($n);class Dn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{lessons:null,pageStatus:"LOADING"});o(this,"loadChapterLessons",async()=>{const{success:e,response:s}=await C("GET",`/users/chapters/${this.props.chapterId}/lessons`);e&&this.setState({pageStatus:"READY",lessons:s.docs})})}async componentDidMount(){this.context===this.props.chapterId&&await this.loadChapterLessons()}async componentDidUpdate(e,s){this.context===this.props.chapterId&&s.lessons===null&&await this.loadChapterLessons()}render(){const{state:{pageStatus:e,lessons:s}}=this;return e==="READY"?t(w,{children:s.map(a=>t(Bt.Consumer,{children:i=>t(re.Consumer,{children:r=>t(wh,m({courseContext:r,navigationContext:i},a))})},a._id))}):t(Q,{})}}o(Dn,"contextType",Ae);class _h extends g.exports.Component{render(){var i,r;const{props:{item:e,splitTitle:s},context:a}=this;return n("div",{className:"cmenu-item",children:[n(T.Toggle,{as:"div",onClick:this.props.onClick,eventKey:e._id,className:`cmenu-item__toggle${a===e._id?" cmenu-item__toggle--open":""}`,children:[t("span",{className:"cmenu-item__title",children:t(Ih,{title:(r=(i=e.title)==null?void 0:i.toString())!=null?r:"",splitTitle:s})}),t(I,{icon:Ue})]}),t(T.Collapse,{eventKey:e._id,children:t("div",{className:"cmenu-item__content",children:t(Dn,{chapterId:e._id})})})]})}}var kh=D(_h);class Pn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{pageStatus:"LOADING",subItems:null});o(this,"loadSubItemsData",async()=>{const{success:e,response:s}=await C("GET",`/courses/lessons/chapter/${this.props.item._id}`);e&&this.setState({subItems:s.lessons,pageStatus:"READY"})})}async componentDidMount(){this.context===this.props.item._id&&await this.loadSubItemsData()}async componentDidUpdate(e,s){this.context===this.props.item._id&&s.subItems===null&&await this.loadSubItemsData()}render(){const{item:e,match:{params:s}}=this.props,{subItems:a,pageStatus:i}=this.state;return n("div",{className:"lfmenu-item",children:[n(T.Toggle,{as:"header",eventKey:e._id,onClick:this.props.onClick,children:[t("div",{children:e.title}),t(I,{icon:this.context===e._id?Dt:Ue})]}),t(T.Collapse,{eventKey:e._id,children:t("div",{children:i==="READY"&&a.map(r=>t(R,{to:`/admin/courses/${s.courseId}/chapters/${r.chapterId}/lessons/${r._id}`,className:`lfmenu-subitem${s.lessonId===r._id?" lfmenu-subitem__active":""}`,children:r.title},r._id))})})]})}}o(Pn,"contextType",Ae);var Th=D(Pn);class On extends g.exports.Component{render(){const{data:{percentageProgress:e}}=this.context;return t("div",{className:"cmenu__small-progress",children:t(pn,{value:e,text:`${e}%`,strokeWidth:14})})}}o(On,"contextType",re);class ce extends g.exports.Component{render(){const{info:e,toggleInfo:s,infoOpen:a,imgBtn:i,imgOpen:r,toggleImg:d,imgPosition:c,imgId:h}=this.props;let p;switch(c){case"TOP":p="top";break;case"LEFT":p="left";break;case"BG":p="bg"}if(e)return n(w,{children:[t("div",{className:`cardInfo__icon ${p?`cardInfo__icon--${p}`:""}`,id:"infoBtn",onClick:s,children:t(I,{icon:a?fe:un})}),t("div",{className:`cardInfo__overlay ${a?"cardInfo__overlay--active":""}`,onClick:s,children:t("div",{id:"infoModal",className:`cardInfo__modal ${a?"cardInfo__modal--active":""}`,dangerouslySetInnerHTML:{__html:e}})})]});if(i)return n(w,{children:[t("div",{className:`cardImg__icon cardImg__icon--${p}`,id:"infoBtn",onClick:d,children:t(I,{icon:r?fe:Eo})}),t("div",{className:`cardInfo__overlay ${r?"cardInfo__overlay--active":""}`,onClick:d,children:t("div",{id:"infoModal",className:`cardImg__modal ${r?"cardImg__modal--active":""}`,children:t(de,{fileId:h})})})]})}}class Nh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})})}render(){const{heading:e,subHeading:s,content:a,info:i,sourceImage:r}=this.props;return n("div",{className:"lesson-cards__text-type",children:[i&&t(ce,{info:i,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("div",{className:"text-card-content",children:[n("header",{children:[e&&t("h1",{className:s?"":"single",children:e}),s&&t("h3",{className:e?"":"single",children:s})]}),r&&t(de,{fileId:r}),t("div",{dangerouslySetInnerHTML:{__html:a}})]})]})}}class Ah extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})})}render(){const{heading:e,subHeading:s,content:a,info:i}=this.props;return n("div",{className:"lesson-cards__heading-type",children:[i&&t(ce,{info:i,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("header",{children:[e&&t("h1",{className:s?"":"single",children:e}),s&&t("h3",{className:e?"":"single",children:s})]}),t("div",{dangerouslySetInnerHTML:{__html:a}})]})}}class Lh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{infoOpen:!1,imgBtn:!0,imgOpen:!1,fileUrl:null});o(this,"toggleInfo",()=>{const e={infoOpen:!this.state.infoOpen};this.state.imgOpen&&(e.imgOpen=!this.state.imgOpen),this.setState(e)});o(this,"toggleImg",()=>{const e={imgOpen:!this.state.imgOpen};this.state.infoOpen&&(e.infoOpen=!this.state.infoOpen),this.setState(e)})}async setFileUrl(){const{imageId:e}=this.props;if(Array.isArray(e)||typeof e=="string"&&e.includes("http")){this.setState({fileUrl:e});return}if(e instanceof File){this.setState({fileUrl:URL.createObjectURL(e)});return}this.setState({fileUrl:await xe(e)})}async componentDidMount(){await this.setFileUrl()}async componentDidUpdate(e){this.props.cardId!==e.cardId&&((this.state.infoOpen||this.state.imgOpen)&&this.setState({imgOpen:!1,infoOpen:!1}),await this.setFileUrl())}render(){const{imagePosition:e,heading:s,subHeading:a,content:i,imageUrl:r,imageImportance:d,info:c,allowEnlargeImage:h}=this.props,{fileUrl:p}=this.state;return n("div",{className:`lesson-cards__image-type lesson-cards__image-type--${e==null?void 0:e.toLowerCase()} ${d?" preserve-sizing":""}`,children:[p&&h&&t(ce,{imgBtn:this.state.imgBtn,toggleImg:this.toggleImg,imgPosition:e,imgOpen:this.state.imgOpen,imgId:p}),c&&t(ce,{info:c,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen,imgPosition:e}),t(Te,{condition:!!r,wrapper:u=>t("a",{href:r,target:"_blank",rel:"noopener nofollow noreferrer",children:u}),children:t("div",{className:"lesson-cards__image-type__image",style:{backgroundImage:`url(${typeof p=="string"?p:p==null?void 0:p[1]})`}})}),(i||s||a)&&n("div",{className:"lesson-cards__image-type__content",children:[n("header",{children:[s&&t("h1",{children:s}),a&&t("h3",{children:a})]}),t("div",{className:"lesson-cards__image-type__content--text",dangerouslySetInnerHTML:{__html:i}})]})]})}}class Eh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{documentOpen:!1,infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})});o(this,"toggleDocument",()=>{this.setState({documentOpen:!this.state.documentOpen})})}render(){const{fileId:e,lessonLayout:s,heading:a,content:i,info:r}=this.props;return n("div",{className:`lesson-cards__document-type ${s!=="page"?"lesson-cards__document-type--card":"lesson-cards__document-type--page"}`,children:[s==="page"&&n(w,{children:[t("header",{children:!!a&&t("h1",{children:a})}),!!i&&t("div",{dangerouslySetInnerHTML:{__html:i}}),t(At,{fileId:e})]}),s!=="page"&&n("div",{className:"lesson-cards__document-type__card",children:[r&&t(ce,{info:r,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),t("header",{children:!!a&&t("h1",{children:a})}),!!i&&t("div",{dangerouslySetInnerHTML:{__html:i}}),n("button",{className:"bp",onClick:this.toggleDocument,children:["View document ",t(I,{icon:$o})]}),n(yn,{fileId:e,children:["Download document ",t(I,{icon:Do})]}),n(N,{size:"lg",className:"document-card-modal",show:this.state.documentOpen,onHide:this.toggleDocument,children:[t(N.Header,{closeButton:!0,children:a}),t(N.Body,{children:t(At,{fileId:e})})]})]})]})}}class $h extends g.exports.Component{constructor(e){super(e);this.state={userInactive:!1,playing:!1},this.vimeoIframe=z.createRef()}render(){const{videoId:e,width:s,height:a}=this.props;return t("iframe",{ref:this.vimeoIframe,src:`https://player.vimeo.com/video/${e}?player_id=vimeo${e}`,width:s,height:a,frameBorder:"0",allowFullScreen:!0,referrerPolicy:"strict-origin-when-cross-origin"})}}class Dh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})})}render(){const{videoId:e,transcript:s,info:a}=this.props;return console.log(a),n("div",{className:"lesson-cards__video-type",children:[a&&t(ce,{info:a,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),t($h,{videoId:e,width:532,height:300}),!!s&&t("div",{className:"transcript",dangerouslySetInnerHTML:{__html:s}})]})}}class Ph extends g.exports.Component{render(){const{isViewed:e,isActive:s,onClick:a,className:i}=this.props;return t("div",{className:`hotspotIcon${s?" hotspotIcon--active":""} ${i}`,onClick:a,children:e&&!s?t(I,{icon:se}):t("div",{className:`hotspotIcon__internal${s?" hotspotIcon__internal--active":""}`})})}}var ki,Ti,Ni,Ai,Li,Ei,$i,Di,Pi;class Rn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{activeContent:((Ni=(Ti=(ki=this.props)==null?void 0:ki.imageTextList)==null?void 0:Ti[0])==null?void 0:Ni.content)||"",activeTitle:((Ei=(Li=(Ai=this.props)==null?void 0:Ai.imageTextList)==null?void 0:Li[0])==null?void 0:Ei.title)||"",activeNodeIndex:0,viewedNodes:(Pi=(Di=($i=this.context)==null?void 0:$i.hotspotsCardsViewedNodes)==null?void 0:Di[this.props.cardId])!=null?Pi:[],hasManyItems:!1,infoOpen:!1});o(this,"listRef",z.createRef());o(this,"scrollPos",{top:0,left:0,x:0,y:0});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})});o(this,"mouseMoveHandler",e=>{if(this.listRef.current){const s=e.clientX-this.scrollPos.x,a=e.clientY-this.scrollPos.y;this.listRef.current.style.cursor="grabbing",this.listRef.current.style.userSelect="none",this.listRef.current.scrollTop=this.scrollPos.top-a,this.listRef.current.scrollLeft=this.scrollPos.left-s}});o(this,"mouseDownHandler",e=>{this.listRef.current&&(this.scrollPos={left:this.listRef.current.scrollLeft,top:this.listRef.current.scrollTop,x:e.clientX,y:e.clientY},this.listRef.current.addEventListener("mousemove",this.mouseMoveHandler),this.listRef.current.addEventListener("mouseup",this.mouseUpOrLeaveHandler),this.listRef.current.addEventListener("mouseleave",this.mouseUpOrLeaveHandler))});o(this,"mouseUpOrLeaveHandler",e=>{this.listRef.current&&(this.listRef.current.removeEventListener("mousemove",this.mouseMoveHandler),this.listRef.current.removeEventListener("mouseup",this.mouseUpOrLeaveHandler),this.listRef.current.removeEventListener("mouseleave",this.mouseUpOrLeaveHandler),this.listRef.current.style.cursor="grab",this.listRef.current.style.removeProperty("user-select"))});o(this,"initList",async()=>{var s,a,i,r,d,c,h,p,u;const e={viewedNodes:(i=(a=(s=this.context)==null?void 0:s.hotspotsCardsViewedNodes)==null?void 0:a[this.props.cardId])!=null?i:[],activeContent:((c=(d=(r=this.props)==null?void 0:r.imageTextList)==null?void 0:d[0])==null?void 0:c.content)||"",activeTitle:((u=(p=(h=this.props)==null?void 0:h.imageTextList)==null?void 0:p[0])==null?void 0:u.title)||"",activeNodeIndex:0};if(!e.viewedNodes.includes(0)){const{cardId:b}=this.props,{lessonId:v}=this.props.match.params,{success:S}=await C("POST",`/users/lessons/${v}/cards/${b}/hotspots/0/viewed`);S&&e.viewedNodes.push(0)}if(this.listRef.current){const b=this.listRef.current,{imageTextList:v,direction:S}=this.props,_=94,k=S==="vertical"?b.offsetHeight:b.offsetWidth;(v==null?void 0:v.length)*_+14>k&&(e.hasManyItems=!0),b.addEventListener("mousedown",this.mouseDownHandler)}this.setState(e,()=>{var b,v,S,_,k,O,F,G,q,j,Y,ee,me;!this.props.allowSkipNodes&&((v=(b=this.state)==null?void 0:b.viewedNodes)==null?void 0:v.length)!==((_=(S=this.props)==null?void 0:S.imageTextList)==null?void 0:_.length)?((k=this.context)==null?void 0:k.isBlockedByNodes)!==!0&&((F=(O=this.context)==null?void 0:O.setIsBlockedByNodes)==null||F.call(O,!0)):((G=this.context)==null?void 0:G.isBlockedByNodes)!==!1&&((j=(q=this.context)==null?void 0:q.setIsBlockedByNodes)==null||j.call(q,!1),(me=(Y=this.context)==null?void 0:Y.setViewedNodes)==null||me.call(Y,this.props.cardId,(ee=this.state)==null?void 0:ee.viewedNodes))})});o(this,"handleNodeClick",e=>async s=>{var d,c,h,p,u,b;s.stopPropagation();const a=[...this.state.viewedNodes];let{activeNodeIndex:i}=this.state,r=e;if(i!==null&&!a.includes(r)){const{cardId:v}=this.props,{lessonId:S}=this.props.match.params,{success:_}=await C("POST",`/users/lessons/${S}/cards/${v}/hotspots/${r}/viewed`);_&&a.push(r)}i===r&&(r=null),this.setState({viewedNodes:a,activeNodeIndex:r,activeContent:((h=(c=(d=this.props)==null?void 0:d.imageTextList)==null?void 0:c[e])==null?void 0:h.content)||"",activeTitle:((b=(u=(p=this.props)==null?void 0:p.imageTextList)==null?void 0:u[e])==null?void 0:b.title)||""})})}async componentDidMount(){this.handleNodeClick(),await this.initList(),window.addEventListener("resize",this.initList)}async componentDidUpdate(e,s){var a,i,r,d,c,h,p,u,b;JSON.stringify(e)!==JSON.stringify(this.props)&&await this.initList(),!this.props.allowSkipNodes&&((i=(a=this.state)==null?void 0:a.viewedNodes)==null?void 0:i.length)===((d=(r=this.props)==null?void 0:r.imageTextList)==null?void 0:d.length)&&this.context.isBlockedByNodes!==!1&&((h=(c=this.context)==null?void 0:c.setIsBlockedByNodes)==null||h.call(c,!1),(b=(p=this.context)==null?void 0:p.setViewedNodes)==null||b.call(p,this.props.cardId,(u=this.state)==null?void 0:u.viewedNodes))}componentWillUnmount(){window.addEventListener("resize",this.initList)}render(){const{heading:e,subHeading:s,content:a,info:i,imageTextList:r,direction:d}=this.props,{activeContent:c,activeNodeIndex:h,viewedNodes:p,hasManyItems:u}=this.state;return n("div",{className:`lesson-cards__hotspot-list-type lesson-cards__hotspot-list-type--${d}`,children:[i&&t(ce,{info:i,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("header",{className:"lesson-cards__hotspot-list-type__header",children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),a&&t("section",{dangerouslySetInnerHTML:{__html:a}}),n("div",{className:"lesson-cards__hotspot-list-type__hotspotContent",children:[r&&t("div",{ref:this.listRef,className:"lesson-cards__hotspot-list-type__list",children:r.map((b,v)=>n("div",{className:`lesson-cards__hotspot-list-type__list__item${h===v?" lesson-cards__hotspot-list-type__list__item--active":""}${p.includes(v)?" lesson-cards__hotspot-list-type__list__item--viewed":""}`,onClick:this.handleNodeClick(v),children:[t(de,{fileId:b.image,draggable:"false"}),t("h6",{children:b.title}),t(Ph,{className:`hotspotIcon--${d}`,isViewed:p.includes(v),isActive:h===v,index:v})]},v))}),t("div",{className:"lesson-cards__hotspot-list-type__activeItemContent",children:h!==null?t("span",{dangerouslySetInnerHTML:{__html:c}}):t("span",{className:"greyed",children:"Select an image reveal more..."})})]})]})}}o(Rn,"contextType",pe);var Oh=D(Rn);class Rh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{items:this.props.horizontalListItems||[],infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})})}componentDidUpdate(e){JSON.stringify(e.horizontalListItems)!==JSON.stringify(this.props.horizontalListItems)&&this.setState({items:this.props.horizontalListItems})}render(){const{heading:e,subHeading:s,content:a,info:i}=this.props;return n("div",{className:"lesson-cards__horizontal-list-type",children:[i&&t(ce,{info:i,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("div",{className:"headings",children:[n("header",{children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),a&&t("div",{dangerouslySetInnerHTML:{__html:a}})]}),t("div",{className:"horizontal-list",children:this.state.items.map((r,d)=>n("div",{className:"list-item",children:[r.image&&t(de,{fileId:r.image}),t("div",{className:"text-content",dangerouslySetInnerHTML:{__html:r.content}})]},d))})]})}}class Fh extends g.exports.Component{render(){const{top:e,left:s,isViewed:a,isActive:i,onClick:r,transform:d}=this.props;return t("div",{className:`hotspotIcon${i?" hotspotIcon--active":""}`,style:{top:e,left:s,transform:d},onClick:r,children:a&&!i?t(I,{icon:se}):t("div",{className:`hotspotIcon__internal${i?" hotspotIcon__internal--active":""}`})})}}class Uh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{imageWidth:0,imageHeight:0,isDragging:!1});o(this,"canvasRef",z.createRef());o(this,"calculateImageDimensions",async e=>{const{canvasRef:s,fileUrl:a}=this.props,{clientWidth:i,clientHeight:r}=s.current;let{imageWidth:d,imageHeight:c}=await new Promise((h,p)=>{const u=new Image;u.onload=function(){h({imageHeight:this.height,imageWidth:this.width})},u.src=a});d<i&&(c=c*(i/d),d=i),c<r&&(d=d*(r/c),c=r),this.setState({imageWidth:d,imageHeight:c})});o(this,"toggleHidingInfo",()=>this.setState({isDragging:!this.state.isDragging}))}componentDidMount(){this.calculateImageDimensions(),window.addEventListener("resize",this.calculateImageDimensions),this.canvasRef.current&&(this.canvasRef.current.addEventListener("mousedown",this.toggleHidingInfo),this.canvasRef.current.addEventListener("mouseup",this.toggleHidingInfo),this.canvasRef.current.addEventListener("touchstart",this.toggleHidingInfo),this.canvasRef.current.addEventListener("touchend",this.toggleHidingInfo))}componentDidUpdate(e,s){(e.fileUrl!==this.props.fileUrl||e.canvasRef.current!==this.props.canvasRef.current)&&this.calculateImageDimensions()}componentWillUnmount(){window.removeEventListener("resize",this.calculateImageDimensions),this.canvasRef.current&&(this.canvasRef.current.removeEventListener("mousedown",this.toggleHidingInfo),this.canvasRef.current.removeEventListener("mouseup",this.toggleHidingInfo),this.canvasRef.current.removeEventListener("touchstart",this.toggleHidingInfo),this.canvasRef.current.removeEventListener("touchend",this.toggleHidingInfo))}render(){const{nodes:e,fileUrl:s,viewedNodes:a,activeNodeIndex:i,handleNodeClick:r}=this.props,{imageWidth:d,imageHeight:c,isDragging:h}=this.state;return n("div",{ref:this.canvasRef,children:[n("span",{className:`lesson-cards__hotspot-map-type__hiding-info${h?" lesson-cards__hotspot-map-type__hiding-info--hidden":""}`,children:[t(I,{icon:un})," Try dragging the image around"]}),n("span",{className:`lesson-cards__hotspot-map-type__hiding-info${h?" lesson-cards__hotspot-map-type__hiding-info--hidden":""} lesson-cards__hotspot-map-type__hiding-info--right`,children:[t(I,{icon:ut})," ",a.length," / ",e.length," viewed"]}),t(Po,{children:n(Oo,{children:[t("img",{className:"canvas-img",style:{width:`${d}px`,height:`${c}px`},draggable:"false",src:s}),e.map(({x:p,y:u},b)=>t(Fh,{top:`${u/100*c}px`,left:`${p/100*d}px`,isViewed:a.includes(b),isActive:i===b,onClick:r(b),index:b},b))]})})]})}}var Oi,Ri,Fi;class Fn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:null,title:"",message:"",activeNodeIndex:null,viewedNodes:(Fi=(Ri=(Oi=this.context)==null?void 0:Oi.hotspotsCardsViewedNodes)==null?void 0:Ri[this.props.cardId])!=null?Fi:[],ready:!1,infoOpen:!1});o(this,"canvasRef",{current:null});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})});o(this,"canvasRefCallback",e=>{e!==null&&(this.canvasRef={current:e},this.setState({ready:!0}))});o(this,"fetchFileUrl",async()=>{const{sourceImage:e}=this.props;let s;return e&&typeof e=="string"&&e.substr(0,4)!=="blob"&&(s=await xe(e)),e instanceof File&&(s=URL.createObjectURL(e)),Array.isArray(e)&&(s=e[1]),s});o(this,"handleNodeClick",e=>async s=>{s.stopPropagation();const a=[...this.state.viewedNodes];let{activeNodeIndex:i}=this.state,{title:r,message:d}=this.props.nodes[e],c=e;if(i!==null&&!a.includes(i)){const{cardId:h}=this.props,{lessonId:p}=this.props.match.params,{success:u}=await C("POST",`/users/lessons/${p}/cards/${h}/hotspots/${i}/viewed`);u&&a.push(i)}i===e&&(c=null,r="",d=""),this.setState({viewedNodes:a,title:r,message:d,activeNodeIndex:c})});o(this,"handleWrapperClick",async()=>{const{activeNodeIndex:e}=this.state;if(e!==null){const s=[...this.state.viewedNodes];if(e!==null&&!s.includes(e)){const{cardId:a}=this.props,{lessonId:i}=this.props.match.params,{success:r}=await C("POST",`/users/lessons/${i}/cards/${a}/hotspots/${e}/viewed`);r&&s.push(e)}this.setState({viewedNodes:s,activeNodeIndex:null,title:"",message:""})}})}async componentDidMount(){var e,s;this.props.allowSkipNodes||(s=(e=this.context)==null?void 0:e.setIsBlockedByNodes)==null||s.call(e,!0),this.setState({fileUrl:await this.fetchFileUrl()})}async componentDidUpdate(e,s){var i,r,d,c,h,p,u,b,v,S,_,k,O,F,G,q;const a={};e.sourceImage!==this.props.sourceImage&&(a.fileUrl=await this.fetchFileUrl()),e.cardId!==this.props.cardId&&(a.viewedNodes=(d=(r=(i=this.context)==null?void 0:i.hotspotsCardsViewedNodes)==null?void 0:r[this.props.cardId])!=null?d:[]),!this.props.allowSkipNodes&&((h=(c=this.state)==null?void 0:c.viewedNodes)==null?void 0:h.length)!==((u=(p=this.props)==null?void 0:p.nodes)==null?void 0:u.length)?((b=this.context)==null?void 0:b.isBlockedByNodes)!==!0&&((S=(v=this.context)==null?void 0:v.setIsBlockedByNodes)==null||S.call(v,!0)):((_=this.context)==null?void 0:_.isBlockedByNodes)!==!1&&((O=(k=this.context)==null?void 0:k.setIsBlockedByNodes)==null||O.call(k,!1),(q=(F=this.context)==null?void 0:F.setViewedNodes)==null||q.call(F,this.props.cardId,(G=this.state)==null?void 0:G.viewedNodes)),Object.keys(a).length!==0&&this.setState(a)}render(){const{heading:e,subHeading:s,nodes:a,nodesTheme:i,info:r}=this.props,{fileUrl:d,viewedNodes:c,activeNodeIndex:h,title:p,message:u,ready:b}=this.state;return n("div",{className:"lesson-cards__hotspot-map-type",children:[r&&t(ce,{info:r,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("header",{children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),d&&t("div",{ref:this.canvasRefCallback,className:`lesson-cards__hotspot-map-type__canvas lesson-cards__hotspot-map-type__canvas--${i}${h!==null?" lesson-cards__hotspot-map-type__canvas--active":""}`,onClick:this.handleWrapperClick,children:b&&t(Uh,{fileUrl:d,canvasRef:this.canvasRef,handleNodeClick:this.handleNodeClick,viewedNodes:c,activeNodeIndex:h,nodes:a})}),h!==null&&n("div",{className:"lesson-cards__hotspot-map-type__popup",children:[t("span",{onClick:this.handleWrapperClick,children:t(I,{icon:fe})}),t("h1",{children:p}),t("div",{children:u})]})]})}}o(Fn,"contextType",pe);var Mh=D(Fn);class Bh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fileUrl:"",isPlaying:!1,volume:1,currentTime:0,duration:0,isInfoOpen:!1});o(this,"track",null);o(this,"audioContext",null);o(this,"audioRef",z.createRef());o(this,"loadAudioFile",async()=>{const{sourceAudio:e}=this.props;this.setState({fileUrl:await xe(e)},()=>{this.audioRef.current.volume=1})});o(this,"handlePlayButonClick",()=>{const{isPlaying:e}=this.state;e?this.setState({isPlaying:!1},()=>{this.audioRef.current.pause()}):this.setState({isPlaying:!0},()=>{this.audioRef.current.play()})});o(this,"handleVolumeButtonClick",()=>{const{isMuted:e}=this.state;e?this.setState({isMuted:!1},()=>{this.audioRef.current.muted=!1}):this.setState({isMuted:!0},()=>{this.audioRef.current.muted=!0})});o(this,"handleMetaDataLoaded",()=>{this.setState({duration:this.audioRef.current.duration})});o(this,"handleTimeUpdated",e=>{this.setState({currentTime:this.audioRef.current.currentTime})});o(this,"handlePlaybackEnded",e=>{this.setState({isPlaying:!1})});o(this,"handleTrackClick",e=>{const s=e.target.getBoundingClientRect(),{duration:a}=this.state,i=(e.clientX-s.left)/210*100;this.setState({currentTime:a*((i>99?100:i)/100)},()=>{const{currentTime:r}=this.state;this.audioRef.current.currentTime=r})});o(this,"handleVolumeTrackClick",e=>{const s=e.target.getBoundingClientRect(),a=(e.clientX-s.left)/80;this.setState({volume:a>=.95?1:a},()=>{const{volume:i}=this.state;this.audioRef.current.volume=i})});o(this,"secondsToTimeStamp",e=>new Date(e*1e3).toISOString().substr(14,5));o(this,"toggleInfo",()=>{this.setState({isInfoOpen:!this.state.isInfoOpen})})}componentDidMount(){this.loadAudioFile()}componentDidUpdate(e,s){this.props.sourceAudio!==e.sourceAudio&&this.loadAudioFile()}get volumeLevelIcon(){const{isMuted:e,volume:s}=this.state;return e?Ro:s===0?Fo:s<.5?Uo:Mo}render(){const{isPlaying:e,isMuted:s,volume:a,currentTime:i,duration:r,isInfoOpen:d}=this.state,{heading:c,subHeading:h,transcript:p,info:u,content:b}=this.props;return n("div",{className:"lesson-cards__audio-type",children:[u&&t(ce,{info:u,toggleInfo:this.toggleInfo,infoOpen:d}),t("audio",{controls:"controls",src:this.state.fileUrl,ref:this.audioRef,preload:"metadata",onDurationChange:this.handleMetaDataLoaded,onTimeUpdate:this.handleTimeUpdated,onEnded:this.handlePlaybackEnded}),n("header",{children:[n("div",{className:"lesson-cards__audio-type__player",children:[t(I,{icon:e?Go:Bo,onClick:this.handlePlayButonClick}),n("div",{className:"lesson-cards__audio-type__body",children:[t("div",{className:"lesson-cards__audio-type__track",onClick:this.handleTrackClick,children:t("div",{style:{width:`${i*100/r}%`}})}),n("div",{className:"lesson-cards__audio-type__details",children:[n("div",{className:"lesson-cards__audio-type__time",children:[this.secondsToTimeStamp(i)," / ",this.secondsToTimeStamp(r)]}),n("div",{className:"lesson-cards__audio-type__volume",children:[t(I,{icon:this.volumeLevelIcon,onClick:this.handleVolumeButtonClick}),t("div",{onClick:this.handleVolumeTrackClick,children:t("div",{style:{width:`${s?0:a*100}%`}})})]})]})]})]}),(c||h)&&n("div",{className:"lesson-cards__audio-type__heading",children:[c&&t("h1",{children:c}),h&&t("h3",{children:h})]})]}),p&&t("div",{className:"lesson-cards__audio-type__transcript",dangerouslySetInnerHTML:{__html:p}}),b&&!p&&t("div",{className:"lesson-cards__audio-type__content",dangerouslySetInnerHTML:{__html:b}})]})}}const tt=z.createContext({});class Un extends g.exports.Component{constructor(){super(...arguments);o(this,"isImageQuestion",e=>{var s,a,i,r;return(r=(i=(a=(s=this.context.questions)==null?void 0:s[e])==null?void 0:a.options)==null?void 0:i.some)==null?void 0:r.call(i,d=>d.image!==void 0)});o(this,"getFileURL",()=>{})}render(){var i,r,d;const{detailedQuestion:e,heading:s,subHeading:a}=this.context;return n("div",{className:"single-question-card-component",children:[e?t("header",{children:t("h1",{children:(d=(r=(i=this.context)==null?void 0:i.questions)==null?void 0:r[0])==null?void 0:d.question})}):n("header",{children:[s&&t("h1",{children:s}),a&&t("h3",{children:a})]}),t("div",{children:t("div",{className:"questions",children:this.context.questions.map((c,h)=>n("div",{className:`question ${this.isImageQuestion(h)?"image-question":""}`,children:[!e&&t("span",{children:c.question}),c.options.map((p,u)=>{var b,v;return n("div",{className:`option${this.context.isOptionSelectedAnswer(h,u)||this.isImageQuestion(h)&&this.context.isOptionSelected(h,u)?" selected":""}`,children:[!this.isImageQuestion(h)&&t("div",{className:`left-container ${this.context.isOptionSelectedAnswer(h,u)?this.context.isSelectedCorrect(h,u):""}`,children:(v=(b=this.context)==null?void 0:b.questionResults)!=null&&v.length?this.context.getResultIcon(h,u):t(De,{onChange:S=>{this.context.selectAnswer(h,S)},type:c.answer.length===1?"radio":"checkbox",id:u,name:c.answer.length===1?`${h}`:`${h}-${u}`,value:u,checked:this.context.isOptionSelected(h,u)})}),this.isImageQuestion(h)&&p.image&&t(de,{className:"file-image",onClick:()=>{this.context.selectAnswer(h,null,u)},fileId:p.image}),t("label",{htmlFor:u,children:p.text})]},u)})]},h))})})]})}}o(Un,"contextType",tt);var Gh=D(Un);class Mn extends g.exports.Component{constructor(){super(...arguments);o(this,"optionIndexes",{});o(this,"getOptionIndex",(e,s)=>{if(this.optionIndexes[e]||(this.optionIndexes[e]={0:null,1:null}),this.optionIndexes[e][s]!==null)return this.optionIndexes[e][s];if(this.optionIndexes[e][s?0:1]!==null)return this.optionIndexes[e][s?0:1]?0:1;{let a=Math.random()>=.5?1:0;return this.optionIndexes[e][s]=a,a}});o(this,"getSelectedOptionIndex",e=>{if(this.context.userAnswers[e])return this.context.userAnswers[e][0]})}render(){const{heading:e,subHeading:s}=this.context;return n("div",{className:"boolean-answer-card-component",children:[n("header",{children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),n("div",{children:[this.context.content&&t("div",{className:"content",dangerouslySetInnerHTML:{__html:this.context.content}}),t("div",{className:"questions",children:this.context.questions.map((a,i)=>{var r,d,c,h,p;return n("div",{className:"question",children:[t("div",{className:`result ${(d=(r=this.context)==null?void 0:r.questionResults)!=null&&d.length?(p=(h=(c=this.context)==null?void 0:c.questionResults)==null?void 0:h[i])!=null&&p.isUserAnswerCorrect?"correct":"incorrect":""}`,children:this.context.getResultIcon(i,this.getSelectedOptionIndex(i))}),n("div",{className:"content",children:[t("span",{children:a.question}),n("div",{className:"options",children:[t("button",{onClick:u=>{this.context.selectAnswer(i,u,0)},className:`option ${this.context.isOptionSelected(i,0)?"selected":""}`,children:a.options[0].text}),t("button",{onClick:u=>{this.context.selectAnswer(i,u,1)},className:`option ${this.context.isOptionSelected(i,1)?"selected":""}`,children:a.options[1].text})]})]})]},i)})})]})]})}}o(Mn,"contextType",tt);var Hh=D(Mn);class ht{static on(e,s){document.addEventListener(e,a=>s(a.detail))}static dispatch(e,s=!0){document.dispatchEvent(new CustomEvent(e,{detail:s}))}static remove(e,s=()=>{}){document.removeEventListener(e,s)}}class Bn extends g.exports.Component{render(){const{questions:e,heading:s,subHeading:a,content:i,userAnswers:r}=this.context;return n("div",{className:"lesson-cards__fillgap-type",children:[n("header",{children:[s&&t("h1",{children:s}),a&&t("h3",{children:a})]}),i&&t("div",{className:"lesson-cards__fillgap-content",dangerouslySetInnerHTML:{__html:i}}),t("div",{className:"lesson-cards__fillgap-questions",children:e.map(({question:d,options:c},h)=>{var p,u;return t(Rt,{title:d,options:c.map(b=>b.text),answer:(u=(p=r==null?void 0:r[h])==null?void 0:p[0])!=null?u:-1,onAnswer:b=>this.context.selectAnswer(h,null,b),prepend:n("b",{children:[h+1,"."]},"prefix")},h)})})]})}}o(Bn,"contextType",tt);class Gn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fadeOutDirection:"left",fadeOutIndex:null});o(this,"handleNextAnswer",(e,s)=>a=>{const i=this.context.questions[e].options.length-1===s?0:s+1;this.setState({fadeOutIndex:s,fadeOutDirection:"right",fadeQuestionIndex:e},()=>{setTimeout(()=>{this.setState({fadeOutIndex:null})},200)}),this.context.selectAnswer(e,a,i)});o(this,"handlePreviousAnswer",(e,s)=>a=>{const i=s===0?this.context.questions[e].options.length-1:s-1;this.setState({fadeOutIndex:s,fadeOutDirection:"left",fadeQuestionIndex:e},()=>{setTimeout(()=>{this.setState({fadeOutIndex:null})},200)}),this.context.selectAnswer(e,a,i)})}render(){const{heading:e,subHeading:s,content:a,questions:i,getSelectedOption:r}=this.context,{fadeOutDirection:d,fadeOutIndex:c,fadeQuestionIndex:h}=this.state;return n("div",{className:"switch-choice",children:[(e||s)&&n("header",{children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),a&&t("section",{dangerouslySetInnerHTML:{__html:a}}),Array.isArray(i)&&i.map((p,u)=>{var v,S,_,k;const b=r(u);return n("div",{className:`switch-choice__question-block${(S=(v=this.context)==null?void 0:v.questionResults)!=null&&S.length?`${(k=(_=this.context)==null?void 0:_.questionResults[u])!=null&&k.isUserAnswerCorrect?" switch-choice__question-block--correct":" switch-choice__question-block--wrong"}`:""}`,children:[t("b",{className:"switch-choice__question",children:p.question}),n("div",{className:"switch-choice__options",children:[t("div",{className:"switch-choice__previous",onClick:this.handlePreviousAnswer(u,b),children:t(I,{icon:Xe})}),t("section",{children:p.options.map((O,F)=>t("div",{className:`switch-choice__option${b===F?" switch-choice__option--active":""}${c===F&&h===u?` switch-choice__option--fadeout-${d}`:""}${c!==null&&b===F&&h===u?` switch-choice__option--fadein-${d}`:""}`,children:t("span",{children:O.text})},F))}),t("div",{className:"switch-choice__after",onClick:this.handleNextAnswer(u,b),children:t(I,{icon:Be})})]})]},u)})]})}}o(Gn,"contextType",tt);var Ui,Mi,Bi,Gi,Hi,qi,zi,Vi,Qi,Wi,Ki;class Hn extends g.exports.Component{constructor(){super(...arguments);o(this,"isMultipleAnswers",e=>{var s;return!(e&&((s=e==null?void 0:e[0])==null?void 0:s.answer.length)===1)});o(this,"state",{bgColor:"#25255e",fgColor:"white",questionType:(Ui=this.props.questionType)!=null?Ui:"SINGLE_QUESTION",questions:(Mi=this.props.questions)!=null?Mi:[],multipleAnswers:this.isMultipleAnswers(this.props.questions),questionResults:((Bi=this.props)==null?void 0:Bi.questionAttempt)&&((Hi=(Gi=this.props)==null?void 0:Gi.questionAttempt)==null?void 0:Hi.status)!=="passed"?(Vi=(zi=(qi=this.props)==null?void 0:qi.questionAttempt)==null?void 0:zi.questions)!=null?Vi:[]:[],result:((Qi=this.props)==null?void 0:Qi.questionAttempt)&&((Ki=(Wi=this.props)==null?void 0:Wi.questionAttempt)==null?void 0:Ki.status)==="passed",userAnswers:{},infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})});o(this,"retry",()=>{this.setState({result:null,userAnswers:this.props.questionType==="SWITCH_CHOICE"?this.props.questions.reduce((e,s,a)=>Object.assign({},e,{[a]:[0]}),{}):{},questionResults:[]},()=>{this.context.setFeedback({expanded:!1,show:!1})})});o(this,"isOptionSelectedAnswer",(e,s)=>{var a,i,r,d,c;return((c=(d=(r=(i=(a=this.state)==null?void 0:a.questionResults)==null?void 0:i[e])==null?void 0:r.userAnswer)==null?void 0:d.findIndex)==null?void 0:c.call(d,h=>h.answer===s))!==-1});o(this,"isOptionSelected",(e,s)=>{var a,i,r;return(r=(i=(a=this.state)==null?void 0:a.userAnswers)==null?void 0:i[e])==null?void 0:r.includes(s)});o(this,"getSelectedOption",e=>{var s,a,i,r;return(r=(i=(a=(s=this.state)==null?void 0:s.userAnswers)==null?void 0:a[e])==null?void 0:i[0])!=null?r:0});o(this,"isSelectedCorrect",(e,s)=>{var i,r,d,c,h;const a=(h=(c=(d=(r=(i=this.state)==null?void 0:i.questionResults)==null?void 0:r[e])==null?void 0:d.userAnswer)==null?void 0:c.find)==null?void 0:h.call(c,p=>p.answer===s);return a===void 0?"":a.isCorrect?"correct":"incorrect"});o(this,"selectAnswer",(e,s,a)=>{var i;if(a===void 0&&(a=parseInt(s.target.value)),!this.state.questionResults.length){let r=this.state.userAnswers;if(!this.state.multipleAnswers)r[e]=[a];else{let d=(i=r[e])!=null?i:[],c=d.indexOf(a);c!==-1?d.splice(c,1):d.push(a),r[e]=d}this.setState({userAnswers:r})}});o(this,"checkAnswers",async()=>{let e={answers:this.state.userAnswers,userLessonId:this.props.match.params.lessonId},{success:s,response:a}=await C("post",`/courses/lessons/cards/${this.props.id}/checkanswers`,e);if(s){const{cardIndex:i}=this.props,r=a.status==="passed";this.setState({result:r,questionResults:a.questions},()=>{var d;r?(this.context.setFeedback({correct:!0,show:!0,title:"That's correct!",content:this.props.correctFeedback,nextCardAvailable:this.props.nextCardAvailable}),this.context.setLessonCardQuestionAttempt({cardIndex:i,questionAttempt:a},(d=this.props)==null?void 0:d.updateBlockingCardIndex)):this.context.setFeedback({correct:!1,show:!0,title:"That's not quite right",content:this.props.incorrectFeedback,expanded:!0,nextCardAvailable:this.props.nextCardAvailable})})}});o(this,"getResultIcon",(e,s)=>{switch(this.isSelectedCorrect(e,s)){case"correct":return t(I,{icon:se});case"incorrect":return t(I,{icon:fe});default:return t(w,{})}});o(this,"renderQuestionCard",()=>{switch(this.state.questionType){case"SINGLE_QUESTION":return t(Gh,{});case"DOUBLE_CHOICE":return t(Hh,{});case"FILL_GAP":return t(Bn,{});case"SWITCH_CHOICE":return t(Gn,{})}})}componentDidMount(){var e,s,a,i;this.context.setFeedback&&(!((s=(e=this.props)==null?void 0:e.questionAttempt)!=null&&s.status)||((i=(a=this.props)==null?void 0:a.questionAttempt)==null?void 0:i.status)==="passed"?this.context.setFeedback({expanded:!1,show:!1}):this.props.questionAttempt&&this.context.setFeedback({correct:!1,show:!0,title:"That's not quite right",content:this.props.incorrectFeedback,expanded:!1,nextCardAvailable:this.props.nextCardAvailable})),this.props.questionType==="SWITCH_CHOICE"&&this.setState({userAnswers:this.props.questions.reduce((r,d,c)=>Object.assign({},r,{[c]:[0]}),{})}),ht.on("base-question-card-retry",this.retry)}componentWillUnmount(){ht.remove("base-question-card-retry",this.retry),this.context.setFeedback({expanded:!1,show:!1})}componentDidUpdate(e){var a,i,r,d,c,h,p,u,b;const s={};JSON.stringify(e.result)!==JSON.stringify(this.props.result)&&(s.result=this.props.result),JSON.stringify(e.userAnswers)!==JSON.stringify(this.props.userAnswers)&&(s.userAnswers=this.props.userAnswers),JSON.stringify(e.id)!==JSON.stringify(this.props.id)&&(this.context.setFeedback&&(!((i=(a=this.props)==null?void 0:a.questionAttempt)!=null&&i.status)||((d=(r=this.props)==null?void 0:r.questionAttempt)==null?void 0:d.status)==="passed"?this.context.setFeedback({expanded:!1,show:!1}):this.props.questionAttempt&&this.context.setFeedback({correct:!1,show:!0,title:"That's not quite right",content:this.props.incorrectFeedback,expanded:!1,nextCardAvailable:this.props.nextCardAvailable})),s.questions=this.props.questions,s.result=((h=(c=this.props)==null?void 0:c.questionAttempt)==null?void 0:h.status)==="passed",s.questionResults=s.result?[]:(b=(u=(p=this.props)==null?void 0:p.questionAttempt)==null?void 0:u.questions)!=null?b:[],s.multipleAnswers=this.isMultipleAnswers(this.props.questions),s.userAnswers=this.props.questionType==="SWITCH_CHOICE"?this.props.questions.reduce((v,S,_)=>Object.assign({},v,{[_]:[0]}),{}):{}),e.questionType!==this.props.questionType&&(s.questionType=this.props.questionType),Object.keys(s).length!==0&&this.setState(s)}render(){return t("div",{className:`base-question-card-component${this.props.detailedQuestion?" detailed":""}`,children:n(tt.Provider,{value:{heading:this.props.heading,subHeading:this.props.subHeading,content:this.props.content,questions:this.state.questions,bgColor:this.state.bgColor,fgColor:this.state.fgColor,result:this.state.result,detailedQuestion:this.props.detailedQuestion,multipleAnswers:this.state.multipleAnswers,questionResults:this.state.questionResults,userAnswers:this.state.userAnswers,selectAnswer:this.selectAnswer,isOptionSelected:this.isOptionSelected,isOptionSelectedAnswer:this.isSelectedCorrect,isSelectedCorrect:this.isSelectedCorrect,getSelectedOption:this.getSelectedOption,checkAnswers:this.checkAnswers,getResultIcon:this.getResultIcon,retry:this.retry},children:[this.props.info&&t(ce,{info:this.props.info,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),this.renderQuestionCard(),t("div",{className:"check-answer-container",children:!this.state.questionResults.length&&n("button",{onClick:this.checkAnswers,children:["Check Answer",this.state.multipleAnswers?"":"s"]})})]})})}}o(Hn,"contextType",pe);var qh=D(Hn);class zh extends g.exports.Component{render(){var r,d;if(!((d=(r=this.props)==null?void 0:r.rows)!=null&&d.length))return t(w,{});const{rows:e,onItemClick:s,activeItemIndex:a,viewedNodes:i}=this.props;return console.log(i),t("div",{className:"lesson-cards__mnemonic-type__rows",children:e.map((c,h)=>t("div",{className:"lesson-cards__mnemonic-type__row",children:c.map((p,u)=>p.image?t(de,{className:(a==null?void 0:a[0])===h&&(a==null?void 0:a[1])===u||i.includes(`${h}-${u}`)?"active":"",onClick:s([h,u]),fileId:p.image},u):t("span",{onClick:s([h,u]),children:p.title}))},h))})}}var Yi,ji,Zi,Ji,ot,Xi,en;class qn extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{activeItemIndex:null,title:"",message:"",viewedNodes:(Zi=(ji=(Yi=this.context)==null?void 0:Yi.hotspotsCardsViewedNodes)==null?void 0:ji[this.props.cardId])!=null?Zi:[],totalNodes:(en=(Xi=(ot=(Ji=this.props)==null?void 0:Ji.mnemonicList)==null?void 0:ot.reduce)==null?void 0:Xi.call(ot,(e,s)=>e+s.length,0))!=null?en:0,infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})});o(this,"setActiveItemIndex",e=>async s=>{const[a,i]=e,{title:r,content:d}=this.props.mnemonicList[a][i],c=[...this.state.viewedNodes];if(e!==null&&!c.includes(`${a}-${i}`)){const{cardId:h}=this.props,{lessonId:p}=this.props.match.params,{success:u}=await C("POST",`/users/lessons/${p}/cards/${h}/hotspots/${a}-${i}/viewed`);u&&c.push(`${a}-${i}`)}this.setState({activeItemIndex:e,title:r,message:d,viewedNodes:c})});o(this,"unsetActiveItemIndex",()=>{this.setState({activeItemIndex:null,title:"",message:""})})}componentDidMount(){var e,s;this.props.allowSkipNodes||(s=(e=this.context)==null?void 0:e.setIsBlockedByNodes)==null||s.call(e,!0)}componentDidUpdate(e,s){var a,i,r,d,c,h,p,u,b,v,S,_,k,O,F;e.cardId!==this.props.cardId&&this.setState({viewedNodes:(r=(i=(a=this.context)==null?void 0:a.hotspotsCardsViewedNodes)==null?void 0:i[this.props.cardId])!=null?r:[],totalNodes:(p=(h=(c=(d=this.props)==null?void 0:d.mnemonicList)==null?void 0:c.reduce)==null?void 0:h.call(c,(G,q)=>G+q.length,0))!=null?p:0},()=>{var G,q,j,Y,ee;!this.props.allowSkipNodes&&((q=(G=this.state)==null?void 0:G.viewedNodes)==null?void 0:q.length)!==this.state.totalNodes&&((j=this.context)==null?void 0:j.isBlockedByNodes)!==!0&&((ee=(Y=this.context)==null?void 0:Y.setIsBlockedByNodes)==null||ee.call(Y,!0))}),!this.props.allowSkipNodes&&((b=(u=this.state)==null?void 0:u.viewedNodes)==null?void 0:b.length)===this.state.totalNodes&&((v=this.context)==null?void 0:v.isBlockedByNodes)!==!1&&((_=(S=this.context)==null?void 0:S.setIsBlockedByNodes)==null||_.call(S,!1),(F=(k=this.context)==null?void 0:k.setViewedNodes)==null||F.call(k,this.props.cardId,(O=this.state)==null?void 0:O.viewedNodes))}render(){const{heading:e,subHeading:s,content:a,mnemonicList:i,info:r}=this.props,{activeItemIndex:d,title:c,message:h}=this.state;return n("div",{className:"lesson-cards__mnemonic-type",children:[r&&t(ce,{info:r,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),n("header",{children:[e&&t("h1",{children:e}),s&&t("h3",{children:s})]}),a&&t("div",{className:"lesson-cards__mnemonic-type__content",dangerouslySetInnerHTML:{__html:a}}),t(zh,{activeItemIndex:d,rows:i,onItemClick:this.setActiveItemIndex,viewedNodes:this.state.viewedNodes}),d!==null&&n("div",{className:"lesson-cards__mnemonic-type__popup",children:[t("span",{onClick:this.unsetActiveItemIndex,children:t(I,{icon:fe})}),t("h1",{children:c}),t("div",{dangerouslySetInnerHTML:{__html:h}})]})]})}}o(qn,"contextType",pe);var Vh=D(qn);class Qh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{infoOpen:!1});o(this,"toggleInfo",()=>{this.setState({infoOpen:!this.state.infoOpen})})}render(){const{sourceImage:e,sourceIcon:s,content:a,iconPosition:i="TOP",info:r}=this.props;return n("div",{className:`lesson-cards__transition-type lesson-cards__transition-type--${i.toLowerCase()} ${e?" transition-card-with-background-image":""}`,children:[r&&t(ce,{info:r,toggleInfo:this.toggleInfo,infoOpen:this.state.infoOpen}),e&&t(de,{fileId:e}),s&&t("div",{className:"lesson-cards__transition-type__icon",children:t(de,{fileId:s})}),t("div",{className:"lesson-cards__transition-type__content",dangerouslySetInnerHTML:{__html:a}})]})}}class Ht extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isComponentReady:!1});o(this,"themeRef",z.createRef())}get cardSwitch(){const{_id:e,lessonLayout:s,cardType:a,heading:i,subHeading:r,content:d,bgColor:c,fgColor:h,info:p,sourceImage:u,sourceDocument:b,sourceVideo:v,sourceAudio:S,imageImportance:_,transcript:k,imagePosition:O,imageUrl:F,questions:G,nextCardAvailable:q,questionAttempt:j,questionType:Y,imageTextList:ee,horizontalListItems:me,nodes:ye,lessonId:ve,correctFeedback:Le,incorrectFeedback:Ee,detailedQuestion:$e,direction:He,updateBlockingCardIndex:st,cardIndex:te,allowEnlargeImage:at,nodesTheme:kr,allowSkipNodes:vt}=this.props;switch(a){case"HEADING":return t(Ah,{cardIndex:te,cardType:a,heading:i,subHeading:r,content:d,bgColor:c,fgColor:h,info:p});case"TEXT":return t(Nh,{cardIndex:te,heading:i,subHeading:r,content:d,info:p,sourceImage:u});case"IMAGE":return t(Lh,{cardIndex:te,heading:i,subHeading:r,content:d,info:p,imageId:u,imagePosition:O,imageImportance:_,allowEnlargeImage:at,imageUrl:F,cardId:e});case"AUDIO":return t(Bh,{cardIndex:te,heading:i,subHeading:r,content:d,transcript:k,sourceAudio:S,info:p});case"DOCUMENT":return t(Eh,{cardIndex:te,fileId:b,lessonLayout:s,heading:i,content:d,info:p});case"VIDEO":return t(Dh,{info:p,cardIndex:te,videoId:v,transcript:k});case"QUIZ":return t(Hd,{info:p,cardIndex:te,lessonLayout:s});case"SINGLE_QUESTION":return t(qh,{cardIndex:te,heading:i,subHeading:r,nextCardAvailable:q,setNextCardAvailable:this.props.setNextCardAvailable,bgColor:c,fgColor:h,questions:G,questionAttempt:j,id:e,detailedQuestion:$e,questionType:Y,correctFeedback:Le,incorrectFeedback:Ee,content:d,updateBlockingCardIndex:st,info:p});case"HOTSPOT_LIST":return t(Oh,{cardIndex:te,heading:i,subHeading:r,content:d,direction:He,imageTextList:ee,cardId:e,allowSkipNodes:vt,info:p});case"HORIZONTAL_LIST":return t(Rh,{cardIndex:te,heading:i,subHeading:r,content:d,horizontalListItems:me,id:e,info:p});case"HOTSPOT_MAP":return t(Mh,{cardIndex:te,heading:i,subHeading:r,sourceImage:u,nodes:ye,cardId:e,lessonId:ve,nodesTheme:kr,allowSkipNodes:vt,info:p});case"MNEMONIC":{const{mnemonicList:xt}=this.props;return t(Vh,{cardIndex:te,heading:i,subHeading:r,mnemonicList:xt,content:d,cardId:e,lessonId:ve,allowSkipNodes:vt,info:p})}case"TRANSITION":{const{sourceIcon:xt,iconPosition:Tr}=this.props;return t(Qh,{cardIndex:te,sourceIcon:xt,iconPosition:Tr,sourceImage:u,content:d,cardId:e,lessonId:ve,info:p})}default:return t("div",{})}}componentDidMount(){setTimeout(()=>{this.setState({isComponentReady:!0})},250)}componentDidUpdate(e){var s,a,i;((a=(s=this.props)==null?void 0:s.cardsQuiz)==null?void 0:a.isInQuiz)&&!((i=e==null?void 0:e.cardsQuiz)!=null&&i.isInQuiz)&&this.themeRef.current&&this.themeRef.current.scrollTo(0,0),JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState({isComponentReady:!1},()=>{setTimeout(()=>{this.setState({isComponentReady:!0})},400)})}render(){const{theme:e,lessonLayout:s,cardsQuiz:a}=this.props,{isComponentReady:i}=this.state;return t("main",{ref:this.themeRef,className:`lesson-cards__theme-${e||"default"}${i?" lesson-cards__ready":""}${s==="card"&&(a==null?void 0:a.isInQuiz)?" no-scroll":""}`,children:this.cardSwitch})}}class zn extends g.exports.Component{constructor(){super(...arguments);o(this,"_isMounted",!1);o(this,"countDownRef",z.createRef());o(this,"state",{countdownLimit:0});o(this,"enterUserLesson",e=>{this.context.isAdminPreview||(window.socket.emit("enter user lesson",e),window.socket.on("entered user lesson",({currentTime:s,lessonId:a,requiredTime:i})=>{a===e&&i&&this._isMounted&&this.setState({countdownLimit:new Date().getTime()+(i-s)})}))});o(this,"handleTimerComplete",()=>{this.context.unlockNextLessonFn()})}componentDidMount(){this._isMounted=!0,this.enterUserLesson(this.props.match.params.lessonId)}componentDidUpdate(e,s){e.match.params.lessonId!==this.props.match.params.lessonId&&this.enterUserLesson(this.props.match.params.lessonId)}componentWillUnmount(){this._isMounted=!1}render(){var a,i;const{lesson:e}=this.props,{countdownLimit:s}=this.state;return s?n("div",{className:`lesson-timer${e.unlockNextLesson!=="REQUIRED_TIME_MET"||!!((a=e==null?void 0:e.nextLesson)!=null&&a.unlocked)?" lesson-timer--hidden":""}`,children:[t("span",{children:"Lesson time remaining: "}),t($t,{ref:this.countDownRef,date:s,onComplete:e.unlockNextLesson==="REQUIRED_TIME_MET"&&!((i=e==null?void 0:e.nextLesson)!=null&&i.unlocked)?this.handleTimerComplete:void 0,renderer:({hours:r,minutes:d,seconds:c})=>n("span",{children:[r.toString().padStart(2,"0"),":",d.toString().padStart(2,"0"),":",c.toString().padStart(2,"0")]})})]}):t(w,{})}}o(zn,"contextType",pe);var Vn=D(zn);class qt extends g.exports.Component{render(){return t("div",{className:"cmenu-toggle",onClick:this.context.toggleIsMenuOpen,children:this.context.isMenuOpen?t(qo,{}):t(Ho,{})})}}o(qt,"contextType",re);class Wh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{disabled:"",canSitExam:!1});o(this,"fetchData",()=>{var e;(e=this.props.lessonContext)!=null&&e.isAdminPreview?(this.checkNextLesson(),this.canUserSitExam()):this.props.lessonContext.enableNextButton(()=>{this.checkNextLesson(),this.canUserSitExam()})});o(this,"handleClick",()=>{const{courseId:e}=this.props.match.params,{nextLesson:s,isAdminPreview:a,cardsQuiz:{isInQuiz:i,answers:r,allowSkip:d,questionIndex:c}={}}=this.props.lessonContext,{disabled:h}=this.state;if(!i&&!s){this.state.canSitExam&&this.props.history.push(`/courses/${e}/preexam`);return}if(!(a||i&&(d||!d&&typeof r[c]=="number")||!h||(s==null?void 0:s.unlocked)||s&&this.state.canSitExam)||!(typeof this.props.middleware=="function"?this.props.middleware(this.state.canSitExam):!0)||a)return;const{userChapterId:u,_id:b}=s;this.props.history.push(`/courses/${e}/chapters/${u}/lessons/${b}`)});o(this,"canUserSitExam",async()=>{const{success:e,response:s}=await C("GET",`/users/exam/${this.props.match.params.courseId}/available`);e&&this.setState({canSitExam:s.available})})}componentDidMount(){this.fetchData()}componentDidUpdate(e,s){const{isBlockedByNodes:a,cardsQuiz:{isInQuiz:i,questionIndex:r,answerInc:d=0}={}}=this.props.lessonContext,{isBlockedByNodes:c,cardsQuiz:{questionIndex:h,answerInc:p=0}={}}=e.lessonContext;(this.props.match.params.lessonId!==e.match.params.lessonId||this.props.activeCardIndex!==e.activeCardIndex||a!==c||!!i&&(d!==p||r!==h))&&this.fetchData()}checkNextLesson(){var b,v,S,_;const{nextLesson:e,unlockNextLesson:s,cards:a}=this.props.lessonContext,{activeCardIndex:i}=this.props,r=a==null?void 0:a.length,d=a==null?void 0:a[i],{isInQuiz:c,allowSkip:h,answers:p,questionIndex:u}=(b=this.props.lessonContext.cardsQuiz)!=null?b:{};if(!!c&&!h&&typeof p[u]!="number"){this.setState({disabled:"You must provide an answer for this question before progressing any further"});return}if(!((v=this.props.lessonContext)!=null&&v.isAdminPreview)){if(i!==void 0){if((d==null?void 0:d.cardType)==="SINGLE_QUESTION"){if((d==null?void 0:d.nextCardAvailable)==="AFTER_CORRECT"&&((S=d==null?void 0:d.questionAttempt)==null?void 0:S.status)!=="passed"){this.setState({disabled:"You must answer this question correctly in other to progress any further"});return}if((d==null?void 0:d.nextCardAvailable)==="AFTER_ANSWER"&&!(d!=null&&d.questionAttempt)){this.setState({disabled:"You must attempt to answer this question in other to progress any further"});return}}if(["HOTSPOT_LIST","HOTSPOT_MAP","MNEMONIC"].includes(d==null?void 0:d.cardType)&&((_=this.props.lessonContext)==null?void 0:_.isBlockedByNodes)){this.setState({disabled:"You must view all nodes in other to progress any further"});return}}(i!==void 0&&i===r-1||i===void 0)&&e&&(e.unlocked||(s==="REQUIRED_TIME_MET"&&this.setState({disabled:"The timer must reach 0 before you can progress any further"}),s==="ON_QUIZ_START"&&this.setState({disabled:"You must start a quiz attempt before you can progress any further"}),s==="ON_QUIZ_END"&&this.setState({disabled:"You must complete a quiz attempt before you can progress any further"}),s==="ON_QUIZ_PASS"&&this.setState({disabled:"You must pass a quiz attempt before you can progress any further"})))}this.setState({disabled:""})}render(){const{visible:e,children:s}=this.props,{disabled:a}=this.state,{isAdminPreview:i,nextLesson:r,cardsQuiz:{isInQuiz:d,allowSkip:c,answers:h,questionIndex:p,questionsLength:u}={}}=this.props.lessonContext;return t(Te,{condition:!!d&&!c&&typeof h[p]!="number"&&!i||!d&&(!!a||!(r!=null&&r.unlocked))&&!i&&!!r||!d&&!r&&!this.state.canSitExam&&!i,wrapper:b=>t(U,{overlay:t(M,{id:"tooltip-next-lesson",children:a}),children:b}),children:t("div",{className:`lesson-button lesson-button--next${e?"":" lesson-button--hidden"}${!!d&&!c&&typeof h[p]!="number"&&!i||!d&&(!!a||!(r!=null&&r.unlocked))&&!i&&!!r||!d&&!r&&!this.state.canSitExam&&!i?" lesson-button--disabled":""}`,onClick:this.handleClick,children:s||n(w,{children:[d?p===u-1?"Submit":"Next":r?"Next":"Take final exam",t(I,{icon:Be})]})})})}}var zt=D(Wh);class Qn extends g.exports.Component{constructor(){super(...arguments);o(this,"nextLessonMiddleware",()=>{const e=this.context.cards.length,{activeCardIndex:s,course:a}=this.props,{nextLesson:i}=this.context,{nextCardAvailable:r,correct:d}=this.context.feedback;if(r==="AFTER_CORRECT"&&!d)return ht.dispatch("base-question-card-retry"),!1;if(!(i!=null&&i._id)){if(!a.preExamUpdatedAt)return this.props.history.push(`/courses/${a._id}/preexam`),!1;if(a.passedAt)return this.props.history.push(`/courses/${a._id}/postexam`),!1}return s!==e-1?(this.props.setActiveCardIndex(s+1),!1):!0});o(this,"handleToggleClick",()=>{this.context.setFeedback({expanded:!this.context.feedback.expanded})})}render(){const{show:e,expanded:s,correct:a,nextCardAvailable:i,content:r,title:d}=this.context.feedback;return e?n("div",{className:`card-container__feedback${a?" card-container__feedback--correct":""}${e?" card-container__feedback--visible":""}${s&&r?" card-container__feedback--expanded":""}`,children:[n("div",{className:"card-container__feedback__header",children:[t("h1",{children:d}),t(zt,{middleware:this.nextLessonMiddleware,lessonContext:this.context,visible:!0,children:i==="AFTER_CORRECT"&&!a?"Retry":"Next"})]}),r&&n("div",{className:"card-container__feedback__content",children:[t("div",{className:"card-container__feedback__toggle",onClick:this.handleToggleClick,children:t(I,{icon:s?Ue:Dt})}),t("main",{dangerouslySetInnerHTML:{__html:r}})]})]}):t(w,{})}}o(Qn,"contextType",pe);class Kh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{disabled:""});o(this,"handleClick",()=>{if(this.state.disabled||!(typeof this.props.middleware=="function"?this.props.middleware():!0))return;const{courseId:s}=this.props.match.params,{userChapterId:a,_id:i}=this.props.lessonContext.previousLesson;this.props.history.push(`/courses/${s}/chapters/${a}/lessons/${i}/last`)})}render(){const{visible:e}=this.props,{disabled:s}=this.state;return n("div",{className:`lesson-button lesson-button--previous${e?"":" lesson-button--hidden"}${s?" lesson-button--disabled":""}`,onClick:this.handleClick,children:[t(I,{icon:Xe}),"Previous"]})}}var Wn=D(Kh);class Kn extends g.exports.Component{constructor(){super(...arguments);o(this,"handleCardChange",e=>{const{isInQuiz:s=!1}=this.context.cardsQuiz;s?this.context.setCardsQuizState({questionIndex:parseInt(e.target.value)}):this.props.setActiveCardIndex(parseInt(e.target.value))});o(this,"nextLessonMiddleware",e=>{var v,S,_,k,O;const s=this.context.cards.length,{activeCardIndex:a,course:i}=this.props,{nextLesson:r,isAdminPreview:d}=this.context,{isInQuiz:c=!1,questionsLength:h=0,questionIndex:p=0,allowSkip:u,answers:b}=(v=this.context.cardsQuiz)!=null?v:{};if(c)return p!==h-1&&(u||!u&&typeof b[p]=="number")&&this.context.setCardsQuizState({questionIndex:p+1,currentAnswer:void 0}),p===h-1&&(this.context.cardsQuiz.onSubmit(),this.context.setCardsQuizState({isInQuiz:!1})),!1;if(a!==s-1)return this.props.setActiveCardIndex(a+1),(_=(S=this.context)==null?void 0:S.setIsBlockedByNodes)==null||_.call(S,!1),!1;if(!(r!=null&&r._id)&&!d){if(e)return this.props.history.push(`/courses/${i._id}/preexam`),!1;if(i.passedAt)return this.props.history.push(`/courses/${i._id}/postexam`),!1}return(O=(k=this.context)==null?void 0:k.setIsBlockedByNodes)==null||O.call(k,!1),!0});o(this,"previousLessonMiddleWare",()=>{const{activeCardIndex:e}=this.props,{isInQuiz:s=!1,questionIndex:a=0}=this.context.cardsQuiz;return s?(a!==0&&this.context.setCardsQuizState({questionIndex:a-1}),!1):e!==0?(this.props.setActiveCardIndex(e-1),!1):!0})}render(){var b,v,S;const e=this.context.cards.length,{activeCardIndex:s,course:a,blockingCardIndex:i}=this.props,{previousLesson:r,feedback:d}=this.context,{isInQuiz:c=!1,questionsLength:h=0,questionIndex:p=0,answers:u}=(b=this.context.cardsQuiz)!=null?b:{};return d.show?t(w,{}):n("div",{className:"card-container__navigation",children:[t(Wn,{lessonContext:this.context,activeCardIndex:s,visible:s!==0||r,middleware:this.previousLessonMiddleWare}),t("select",{name:"page",id:"page",value:c?p:s,onChange:this.handleCardChange,children:Array.from({length:c?h:e},(_,k)=>t("option",{value:k,disabled:!c&&i!==-1&&k>i||c&&[void 0,null].includes(u==null?void 0:u[k]),children:k+1},k))}),"\xA0| ",c?h:e,t(zt,{answerInc:(S=(v=this.context)==null?void 0:v.cardsQuiz)==null?void 0:S.answerInc,lessonContext:this.context,activeCardIndex:s,visible:!0,middleware:this.nextLessonMiddleware})]})}}o(Kn,"contextType",pe);var Yh=D(Kn);class Yn extends g.exports.Component{constructor(){super(...arguments);o(this,"findBlockingCardIndex",()=>this.props.lesson.cards.findIndex(e=>{var s;return!this.context.isAdminPreview&&e.cardType==="SINGLE_QUESTION"&&((e==null?void 0:e.nextCardAvailable)==="AFTER_ANSWER"&&!(e!=null&&e.questionAttempt)||(e==null?void 0:e.nextCardAvailable)==="AFTER_CORRECT"&&((s=e==null?void 0:e.questionAttempt)==null?void 0:s.status)!=="passed")}));o(this,"state",{activeCardIndex:0,blockingCardIndex:this.findBlockingCardIndex(),animationStatus:"first_in"});o(this,"updateBlockingCardIndex",()=>{this.setState({blockingCardIndex:this.findBlockingCardIndex()})});o(this,"setDefaultActiveCardIndex",async e=>{var i,r;const{cardIndex:s}=this.props.match.params;let a=0;if(this.context.data.lastCardIndex&&((r=(i=this.props.lesson)==null?void 0:i.previousLesson)==null?void 0:r._id)!==this.context.data.lastLessonId&&(a=e!=null?e:this.context.data.lastCardIndex),s==="last"){const{blockingCardIndex:d}=this.state;a=d&&d!==-1?d:this.props.lesson.cards.length-1}this.setState({activeCardIndex:a})});o(this,"setActiveCardIndex",async e=>{this.context.isAdminPreview||await C("POST",`/users/courses/${this.props.match.params.courseId}/latest/card`,{lastCardIndex:e}),this.setState({activeCardIndex:e})});o(this,"timeoutAnimation",()=>{setTimeout(()=>{this.setState({animationStatus:null})},550)})}componentDidMount(){this.setDefaultActiveCardIndex(),this.timeoutAnimation()}async componentDidUpdate(e,s){this.props.match.params.lessonId!==e.match.params.lessonId&&(this.context.isAdminPreview||await C("POST",`/users/courses/${this.props.match.params.courseId}/latest/card`,{lastCardIndex:0}),this.setDefaultActiveCardIndex(0)),s.activeCardIndex!==this.state.activeCardIndex&&(s.activeCardIndex<this.state.activeCardIndex?this.setState({animationStatus:"next_in"},this.timeoutAnimation):this.setState({animationStatus:"previous_in"},this.timeoutAnimation))}render(){const{lesson:e,chapter:s}=this.props,{data:a,animateMenu:i,isMenuOpen:r}=this.context,{activeCardIndex:d,blockingCardIndex:c,animationStatus:h}=this.state,p=e.cards[d],u=(d+1)*100/e.cards.length;return n("div",{className:`card-container${h?` card-container--${h}`:""}${i?" card-container--animate":""}${r?"":" card-container--menu-collapsed"}`,children:[t(qt,{}),t(On,{}),n("div",{className:"card-container__wrapper",children:[n("header",{children:[t("h3",{children:a.title}),n("h5",{children:[s.title," | ",e.title]}),n("div",{className:"card-container__info",children:[t("div",{className:"card-container__timer",children:t(Vn,{lesson:e})}),e.lessonType!=="BASIC"&&t("div",{className:`card-container__badge card-container__badge--${e.lessonType.toLowerCase()}`,children:e.lessonType.toLowerCase()})]})]}),t(Ht,y(m({},p),{cardsQuiz:e.cardsQuiz,cardIndex:d,updateBlockingCardIndex:this.updateBlockingCardIndex,lessonLayout:"card"})),n("footer",{children:[t(Yh,{course:a,activeCardIndex:d,setActiveCardIndex:this.setActiveCardIndex,blockingCardIndex:c}),t(Qn,{course:a,activeCardIndex:d,setActiveCardIndex:this.setActiveCardIndex}),t("div",{className:"card-container__progress",children:t("div",{style:{width:`${u}%`}})})]})]})]})}}o(Yn,"contextType",re);var Vt=D(Yn);class jh extends g.exports.Component{render(){return t("div",{className:`lesson-content ${this.props.className}`,children:this.props.children})}}class jn extends g.exports.Component{constructor(){super(...arguments);o(this,"nextLessonMiddleware",()=>{const{data:e}=this.context,{nextLesson:s}=this.props.lesson;if(!(s!=null&&s._id)){if(!e.preExamUpdatedAt)return this.props.history.push(`/courses/${e._id}/preexam`),!1;if(e.passedAt)return this.props.history.push(`/courses/${e._id}/postexam`),!1}return!0})}render(){var d,c;const{chapter:e,lesson:s}=this.props,{data:a,animateMenu:i,isMenuOpen:r}=this.context;return n(jh,{className:`lesson-page${i?" lesson-page--animate":""}${r?" lesson-page--menu-open":""}`,children:[n("nav",{className:"lesson-page__breadcrumb",children:[t("span",{children:e.title}),t(I,{icon:Be}),t("span",{children:s.title})]}),n("div",{className:"lesson-page__content",children:[s.lessonType&&s.lessonType!=="BASIC"&&t("div",{className:`lesson-status lesson-status--${(d=s.lessonType)==null?void 0:d.toLowerCase()}`,children:t("span",{children:(c=s.lessonType)==null?void 0:c.toLowerCase()})}),s.cards.map(h=>t(Ht,y(m({},h),{lessonLayout:"page"}),h._id))]}),t(pe.Consumer,{children:h=>t("footer",{className:"lesson-page__footer",children:n("div",{children:[t(qt,{}),t(Wn,{lessonContext:h,visible:!!(h!=null&&h.previousLesson)}),t("div",{children:t(Vn,{lesson:s})}),t(zt,{lessonContext:h,visible:!0,middleware:this.nextLessonMiddleware})]})})})]})}}o(jn,"contextType",re);var Qt=D(jn);class Zh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{feedback:{show:!1,expanded:!1}});o(this,"setFeedback",(e,s)=>{var a;this.setState({feedback:m(m({},(a=this.state)==null?void 0:a.feedback),e)},s)})}render(){const{course:e,chapter:s,lesson:a,cards:i}=this.props,{feedback:r}=this.state,d=a.lessonLayout==="PAGE"?Qt:Vt,c=y(m({},a),{cards:i,feedback:r,setFeedback:this.setFeedback,isAdminPreview:!0});return a.lessonType?t(re.Provider,{value:{data:e,isAdminPreview:!0},children:t(pe.Provider,{value:c,children:t(d,{lesson:c,chapter:s})})}):t(w,{})}}class Jh extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{cards:[],lesson:{},feedback:{show:!1,expanded:!1}});o(this,"setFeedback",(e,s)=>{var a;this.setState({feedback:m(m({},(a=this.state)==null?void 0:a.feedback),e)},s)});o(this,"loadLessonCards",async e=>{const{success:s,response:a}=await C("GET",`/courses/lessons/${e}/cards`),i=await this.loadLessonData(e);if(s){const r=a.filter(d=>!!d.publishedAt);return this.props.setForcePublishedPreviewUpdate(),this.setState({cards:r,lesson:i}),r.length}return 0});o(this,"loadLessonData",async e=>{const{success:s,response:a}=await C("GET",`/courses/lessons/${e}`);return s?a:{}})}async componentDidUpdate(e,s){(e.currentLessonId!==this.props.currentLessonId||this.props.forcePublishedPreviewUpdate)&&await this.loadLessonCards(this.props.currentLessonId)}render(){const{course:e,chapter:s}=this.props,{lesson:a,cards:i}=this.state,{feedback:r}=this.state,d=a.lessonLayout==="PAGE"?Qt:Vt,c=y(m({},a),{cards:i,feedback:r,setFeedback:this.setFeedback,isAdminPreview:!0});return a.lessonType?t(re.Provider,{value:{data:e,isAdminPreview:!0},children:t(pe.Provider,{value:c,children:t(d,{lesson:c,chapter:s})})}):t(w,{})}}var Zn=z.createContext({});class os extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isMobile:!1});o(this,"toggleIsMobile",()=>{this.setState({isMobile:!this.state.isMobile})})}render(){const{isMobile:e}=this.state;return n("div",{className:`preview-wrapper${e?" preview-wrapper--mobile":""}`,children:[n("div",{className:"preview-wrapper__toggle",onClick:this.toggleIsMobile,children:[t(zo,{className:e?"":"active"}),t(Vo,{className:e?"active":""})]}),t("div",{className:"preview-wrapper__container",children:this.props.children})]})}}class Xh extends g.exports.Component{constructor(){super(...arguments);o(this,"_isMounted",!1);o(this,"state",{lesson:{},lessonForm:{},chapter:{},course:{},cards:[],deletedCards:[],pageStatus:"LOADING",currentlyPublished:0,toPublish:0,publishStatus:null,forcePublishedPreviewUpdate:!1,isSaveDisabled:!0,isSubmitDisabled:!0});o(this,"updateDeletedCards",e=>{this.setState({deletedCards:e})});o(this,"loadLessonData",async e=>{const{success:s,response:a}=await C("GET",`/courses/lessons/${e}`);this._isMounted&&(s?(this.setState({lesson:a,lessonForm:{},chapter:await this.loadChapterData(),pageStatus:"READY",isSubmitDisabled:a.updatedAt>a.draft.updatedAt,isSaveDisabled:!0}),this.props.pushBreadcrumbLink({text:`Lesson: ${a.title}`,path:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.props.match.params.chapterId}/lessons/${this.props.match.params.lessonId}`})):this.props.setGlobalAlert({type:"error",message:"Failed to load lesson data"}))});o(this,"loadChapterData",async()=>{const{chapterId:e}=this.props.match.params,{success:s,response:a}=await C("GET",`/courses/chapters/${e}`);return s?a:{}});o(this,"addSocketEventsListeners",()=>{window.socket.on("publishing course lesson",({currentlyPublished:e,toPublish:s})=>{this.setState({currentlyPublished:e,toPublish:s,publishStatus:"PUBLISHING"})}),window.socket.on("published course lesson",()=>{this.setState({publishStatus:"PUBLISHED",isPublishDisabled:!0},()=>{this.disablePublishButton(),setTimeout(()=>{this.setState({publishStatus:null,forcePublishedPreviewUpdate:!0})},1500)})})});o(this,"handleLessonChange",(e,s,a)=>{if(e==="card"){const i=[...this.state.cards];s.setHotspots!==void 0&&delete s.setHotspots,i[s.orderIndex]=s,this.setState({cards:i},a)}});o(this,"patchLessonCard",(e,s,a)=>{const i=[...this.state.cards],r=i[e];i[e]=m(m({},r),s),this.setState({cards:i},a)});o(this,"updateCards",(e,s)=>{this.setState({cards:e},s)});o(this,"updateLessonForm",(e,s)=>{this.setState({lessonForm:m(m({},this.state.lessonForm),e)},s)});o(this,"enableSaveButton",e=>{this.state.isSaveDisabled!==!1?this.setState({isSaveDisabled:!1},e):typeof e=="function"&&e()});o(this,"disableSaveButton",e=>{this.state.isSaveDisabled!==!0?this.setState({isSaveDisabled:!0},e):typeof e=="function"&&e()});o(this,"enablePublishButton",e=>{this.state.isSubmitDisabled!==!1?this.setState({isSubmitDisabled:!1},e):typeof e=="function"&&e()});o(this,"disablePublishButton",e=>{this.state.isSubmitDisabled!==!0?this.setState({isSubmitDisabled:!0},e):typeof e=="function"&&e()});o(this,"setLessonId",(e,s)=>{this.setState({lesson:{_id:e}},s)});o(this,"setForcePublishedPreviewUpdate",()=>{this.setState({forcePublishedPreviewUpdate:!1})})}async componentDidMount(){this._isMounted=!0;const{lessonId:e}=this.props.match.params;await this.loadLessonData(e),this.addSocketEventsListeners()}async componentDidUpdate(e,s){if(e.match.params.lessonId!==this.props.match.params.lessonId){const{lessonId:a}=this.props.match.params;a!=="new"&&(this.props.removeBreadcrumbLink({text:`Lesson: ${this.state.lesson.title}`,path:`/admin/courses/${e.match.params.courseId}/chapters/${e.match.params.chapterId}/lessons/${e.match.params.lessonId}`}),await this.loadLessonData(a))}}componentWillUnmount(){this._isMounted=!1,this.props.removeBreadcrumbLink({text:`Lesson: ${this.state.lesson.title}`,path:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.props.match.params.chapterId}/lessons/${this.props.match.params.lessonId}`})}render(){const{lesson:e,lessonForm:s,chapter:a,course:i,cards:r,pageStatus:d,currentlyPublished:c,toPublish:h,publishStatus:p,forcePublishedPreviewUpdate:u,deletedCards:b,isSaveDisabled:v,isSubmitDisabled:S}=this.state;return n(w,{children:[t(cn,{when:!this.state.isSaveDisabled,message:_=>"Page has unsaved changes. Are you sure you want to go to leave?"}),t(Ke.Provider,{value:{lesson:e,lessonForm:s,chapter:a,course:i,cards:r,deletedCards:b,pageStatus:d,isSaveDisabled:v,isSubmitDisabled:S,cardsQuiz:{},setGlobalAlert:this.props.setGlobalAlert,handleLessonChange:this.handleLessonChange,patchLessonCard:this.patchLessonCard,updateDeletedCards:this.updateDeletedCards,updateCards:this.updateCards,updateLessonForm:this.updateLessonForm,enableSaveButton:this.enableSaveButton,enablePublishButton:this.enablePublishButton,disableSaveButton:this.disableSaveButton,disablePublishButton:this.disablePublishButton,setLessonId:this.setLessonId,lessonLayout:"PAGE"},children:n("div",{className:"admin-lesson",children:[t(Gt,{itemsEndpoint:`/courses/chapters/course/${this.props.match.params.courseId}/title`,itemsComponent:Th}),n("main",{children:[!!p&&n("span",{className:"message-alert positive narrow",children:[p==="PUBLISHING"?t(I,{icon:Qo,spin:!0}):t(I,{icon:se}),p==="PUBLISHING"?"Publishing":"Published"," ",c,"\xA0 of \xA0",h," lesson cards"]}),t(Ke.Consumer,{children:_=>t(Zn.Consumer,{children:k=>n(et,{children:[t(Sh,{tabTitle:"Edit",adminLessonContext:_}),t(os,{tabTitle:"Preview",children:t(Zh,{course:k,chapter:_.chapter,lesson:m(m({},_.lesson),_.lessonForm),cards:_.cards})}),t(os,{tabTitle:"Published",children:t(Jh,{course:k,chapter:_.chapter,forcePublishedPreviewUpdate:u,setForcePublishedPreviewUpdate:this.setForcePublishedPreviewUpdate,currentLessonId:e==null?void 0:e._id})})]})})})]})]})})]})}}var ep=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(Xh));class tp extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{_id:"",title:""})}async componentDidMount(){if(this.props.match.params.courseId!=="new"&&this.props.match.params.courseId!=="ext"){const{success:e,response:s,message:a}=await C("GET",`/courses/${this.props.match.params.courseId}`);e?(this.setState({_id:s._id,title:s.title}),this.props.pushBreadcrumbLink({text:`Course: ${s.title}`,path:`/admin/courses/${s._id}`})):this.props.setGlobalAlert({type:"success",message:"Failed to load course data: "+a})}}componentWillUnmount(){this.props.removeBreadcrumbLink({text:`Course: ${this.state.title}`,path:`/admin/courses/${this.state._id}`})}render(){return t(Zn.Provider,{value:this.state,children:n(Z,{children:[t(P,{exact:!0,path:"/admin/courses/:courseId/students",component:Vc}),t(P,{exact:!0,path:"/admin/courses/:courseId/chapters/:chapterId/lessons/:lessonId",component:ep}),t(P,{path:"/admin/courses/:courseId",component:qc},"admin-courses-edit")]})})}}var sp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(tp);class ap extends g.exports.Component{componentDidMount(){this.props.pushBreadcrumbLink({text:"Courses",path:"/admin/courses"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Courses",path:"/admin/courses"})}render(){return n(Z,{children:[t(P,{exact:!0,path:"/admin/courses",component:rc}),t(P,{path:"/admin/courses/:courseId",component:sp})]})}}var ip=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(ap);class np extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"handleChange",e=>{this.setState({[e.target.name]:e.target.value})});o(this,"getEmptyItem",()=>{let e=null,s=K();if(this.props.type==="chapter")e={_id:s,draggableId:s,title:"",chapterTime:0,isNew:!0};else if(this.props.type==="lesson")e={_id:s,lessonLayout:"PAGE",draggableId:s,title:"",lessonTime:0,isNew:!0,conditionStatement:"ALL_TIME"};else if(this.props.type==="course")e={draggableId:s,courseId:this.state.selectedChildItem._id,conditionStatement:"ANY_TIME"};else throw new Error("Unrecognized item type!");return e.title=this.state.newItemTitle,e});o(this,"componentDidMount",async()=>{if(this._isMounted=!0,this.props.source!=="core"){const{success:e,response:s}=await C("GET","/core");if(e&&this._isMounted){const a=s.docs.map(i=>({label:i.title,value:i._id,library:i}));this.setState({coreLibraryOpts:a})}}});o(this,"componentWillUnmount",()=>{this._isMounted=!1});o(this,"loadOptions",async e=>{let s;this.props.type==="course"?s="/courses":this.props.type==="package"?s="/packages":s=`/core/${this.props.type}s/core/${this.state.selectedCoreLibraryId}`;const{success:a,response:i}=await C("GET",`${s}?search=${encodeURI(e)}`);let r=[];return a&&this._isMounted&&(["course","package"].indexOf(this.props.type)>=0?r=i.docs:this.props.type==="chapter"?r=i.chapters:r=i,r=r.filter(d=>d._id===this.props.parentDocId?!1:this.props.existingItems.every(c=>this.props.type==="course"?c.courseId!==d._id:this.props.type==="package"?c!==d._id:c[this.props.coreKey]!==d._id))),this.props.unsetRefreshLinkedOptions(),r});this.state={typeTitle:e.type[0].toUpperCase()+e.type.substr(1).toLowerCase(),newItemTitle:"",coreLibraryOpts:[],selectedCoreLibraryId:null,selectedChildItem:null,selectedChildItemInputVal:"",inputTree:["course","package"].indexOf(this.props.type)>=0}}render(){return n("div",{children:[t(E,{children:n("p",{children:["Add new ",this.props.type==="package"?"upsell package":this.props.type]})}),n(A,{children:[!this.state.inputTree&&n(w,{children:[t(x,{md:9,xl:this.props.source==="core"?9:3,children:t(f.Control,{type:"text",minLength:"3",maxLength:"512",id:"newItemTitle",name:"newItemTitle",placeholder:`${this.state.typeTitle} title`,value:this.state.newItemTitle,onChange:this.handleChange,className:"my-2 my-md-0"})}),t(x,{md:3,xl:this.props.source==="core"?3:2,children:t(L,{disabled:!this.state.newItemTitle,type:"button",variant:"dark",className:"form-control my-2 my-md-0",onClick:()=>{this.props.addNewItem(this.getEmptyItem()),this.setState({newItemTitle:""})},children:t("strong",{children:"Create"})})}),this.props.source!=="core"?n(w,{children:[t(x,{md:12,xl:1,className:"text-center my-2",children:t("strong",{children:"OR"})}),t(x,{md:5,xl:2,children:t(Fe,{options:this.state.coreLibraryOpts,value:this.state.selectedCoreLibraryId?void 0:"",menuPortalTarget:document.body,menuPosition:"fixed",onChange:async e=>{this.setState({selectedCoreLibraryId:e.value,selectedChildItem:null})},id:"coreLibary",placeholder:"Select Core Library",className:"my-2 my-md-0"})})]}):t(w,{})]}),this.props.source!=="core"?n(w,{children:[t(x,{xs:12,md:this.state.inputTree?9:5,xl:this.state.inputTree?9:3,children:this.state.selectedCoreLibraryId||this.state.inputTree?t(Wo,{id:`${this.state.typeTitle}Select-${this.state.selectedCoreLibraryId}`,placeholder:`Search ${this.state.typeTitle}`,defaultOptions:!0,cacheOptions:!0,menuPortalTarget:document.body,menuPosition:"fixed",loadOptions:this.loadOptions,getOptionLabel:e=>e.title,getOptionValue:e=>e._id,onChange:e=>{this.setState({selectedChildItem:e})},onInputChange:e=>{this.setState({selectedChildItemInputVal:e})},value:this.state.selectedChildItem,inputValue:this.state.selectedChildItemInputVal,className:"my-2 my-md-0"},`${this.state.typeTitle}Select-${this.state.selectedCoreLibraryId}-${this.props.refreshLinkedOptions}`):t(Fe,{isDisabled:!0,placeholder:`Search ${this.state.typeTitle}`,className:"my-2 my-md-0"})}),t(x,{xs:12,md:this.state.inputTree?3:2,xl:this.state.inputTree?3:1,children:t(L,{disabled:!this.state.selectedChildItem,type:"button",variant:"dark",className:"form-control my-2 my-md-0",onClick:()=>{let e;if(this.props.type!=="package"){const s=this.getEmptyItem();e=y(m(m({},s),this.state.selectedChildItem),{conditionStatement:s.conditionStatement}),this.props.type!=="course"&&(e["core"+this.state.typeTitle+"sLink"]=this.state.selectedChildItem._id),this.props.type==="chapter"&&(e.coreLibraryId=this.state.selectedCoreLibraryId)}else e=this.state.selectedChildItem._id;this.props.addNewItem(y(m({},e),{conditionStatement:"ANY_TIME"})),this.setState({selectedChildItem:null,selectedChildItemInputVal:""})},children:t("strong",{children:"Add"})})})]}):t(w,{})]})]})}}class rp extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"loadThings",async()=>{if(["chapter","lesson"].indexOf(this.props.type)>=0){this.setState({loading:!0});let e="";this.props.type==="chapter"&&this.props.source!=="core"?e=`/courses/chapters/course/${this.props.parentDocId}`:this.props.type==="chapter"?e=`/core/chapters/core/${this.props.parentDocId}`:this.props.type==="lesson"&&this.props.source!=="core"?this.props.parentsCoreLink?e=`/core/chapters/${this.props.parentsCoreLink}/lessons`:e=`/courses/lessons/chapter/${this.props.parentDocId}`:this.props.type==="lesson"&&(e=`/core/chapters/${this.props.parentDocId}/lessons`);const{success:s,response:a}=await C("GET",e);if(this._isMounted&&(this.setState({loading:!1}),s&&a&&a[this.props.type+"s"]&&a[this.props.type+"s"].length)){const i=a[this.props.type+"s"].map(r=>y(m({},r),{draggableId:r._id,ref:z.createRef()}));this.setState({items:i}),this.props.type==="lesson"&&this.recalculateTimes(i),this.props.parentsCoreLink||this.props.updateRegister(i,"add",this.props.parentDocId),[this.state.params.focus,this.state.params.highlight].forEach(r=>{if(r){let d=this.state.items.filter(c=>c._id===r);d.length&&(d=d[0]),d.ref&&d.ref.current&&(d.ref.current.scrollIntoView({behavior:"smooth",block:"start"}),d.ref.current.classList.toggle("cardHighlight"),setTimeout(()=>{d.ref.current&&d.ref.current.classList.toggle("cardHighlight")},5e3))}})}}});o(this,"componentDidMount",()=>{this._isMounted=!0,this.loadThings()});o(this,"componentWillUnmount",()=>{this._isMounted=!1});o(this,"unsetRefreshLinkedOptions",()=>{this.setState({refreshLinkedOptions:!1})});o(this,"addNewItem",e=>{this.props.setItems?this.props.setItems(this.props.type,[...this.props.items,e]):(this.setState({items:[...this.state.items,e]}),this.props.updateRegister(e,"add",this.props.parentDocId)),this.setState({refreshLinkedOptions:!0}),this.props.setIsDirty&&this.props.setIsDirty(!0)});o(this,"deleteItem",e=>{this.setState({modalShow:!0,modalAction:()=>{const s=(this.props.items||this.state.items).filter(a=>this.props.type==="package"?e!==a:e.draggableId!==a.draggableId);if(this.props.setItems)this.props.setItems(this.props.type,s),this.setState({modalShow:!1});else{let a=[...this.state.itemsToDelete];e.isNew?this.props.updateRegister(e,"delete"):(a.push(e),this.props.updateRegister(e,"delete_children")),this.setState({modalShow:!1,itemsToDelete:a,items:s})}this.setState({refreshLinkedOptions:!0}),this.props.setIsDirty&&this.props.setIsDirty(!0)},modalType:this.state.typeTitle==="Package"||this.state.typeTitle==="Course"?"remove":"delete"})});o(this,"updateItem",e=>{let s=[...this.props.items?this.props.items:this.state.items];this.props.setItems(this.props.type,s.map(a=>a.draggableId===e.draggableId?e:a))});o(this,"unlinkItem",e=>{this.setState({modalShow:!0,modalAction:()=>{this.setState({items:this.state.items.map(s=>(e._id===s._id&&(s["core"+this.state.typeTitle+"sLink"]=null),s)),modalShow:!1,refreshLinkedOptions:!0}),this.props.setIsDirty&&this.props.setIsDirty(!0)},modalType:"unlink"})});o(this,"cloneItem",async e=>{this.setState({modalShow:!0,modalAction:async()=>{const{success:s}=await C("POST",`/${this.props.source}/${this.props.type}s/${e._id}/clone`);s?(this.loadThings(),this.props.setGlobalAlert({type:"success",message:`${this.state.typeTitle} has been cloned succesfully!`})):this.props.setGlobalAlert({type:"error",message:`There was an unexpected problem with cloning this ${this.state.typeTitle}. Please try again.`}),this.setState({modalShow:!1})},modalType:"clone"})});o(this,"submit",async()=>{if(this.state.itemsToDelete.length>0){const e=this.state.itemsToDelete.map(a=>a._id).join(","),{success:s}=await C("DELETE",`/${this.props.source}/${this.props.type}s/${e}`);this._isMounted&&s?this.props.updateRegister(this.state.itemsToDelete,"submitted"):this.props.updateRegister(this.state.itemsToDelete,"error")}});o(this,"handleDragAndDrop",e=>{if(!e.destination||e.destination.index===e.source.index)return;let s=[...this.props.items?this.props.items:this.state.items],a=s.length>0?s[0]:null;const[i]=s.splice(e.source.index,1);s.splice(e.destination.index,0,i),this.props.type!=="package"&&this.props.source!=="core"&&(a&&(a.conditionStatement="ANY_TIME"),s[0].conditionStatement="ANY_TIME"),this.props.setItems?this.props.setItems(this.props.type,s):this.setState({items:s}),this.props.setIsDirty&&this.props.setIsDirty(!0)});o(this,"totalTime",(e,s)=>e.reduce((a,i)=>(i=i.isNew?i:i.draft,a+parseInt(i&&i[s]?i[s]:0)),0));o(this,"recalculateTimes",e=>{const s=this.totalTime(e,"maxTime"),a=this.totalTime(e,"requiredTime");this.props.updateTime(s,a)});o(this,"updateStateItem",e=>{const s=this.state.items.map(a=>a.draggableId===e.draggableId?e:a);this.setState({items:s}),this.props.updateTime&&this.recalculateTimes(s)});o(this,"handleSelectLesson",e=>{});o(this,"handleUnselectLesson",e=>{});o(this,"render",()=>{var e;return this.state.loading?t(Q,{}):n("div",{children:[this.props.items&&this.props.items.length>0||this.state.items&&this.state.items.length>0?n(w,{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this ",`${this.state.typeTitle}.${this.state.modalType=="clone"&&" Any unsaved changes will be lost."}`]}),t(E,{children:n("p",{className:"form-label",children:[this.state.typeTitle==="Package"?"Upsell Package":this.state.typeTitle,"s"]})})]}):t(w,{}),t(be,{onDragEnd:this.handleDragAndDrop,children:t(Ce,{droppableId:this.props.type,children:s=>t(w,{children:this.renderAs(this.props.type==="lesson"?"table":"cards",s)})})}),t("br",{}),this.props.parentsCoreLink?t(w,{}):t(np,{type:this.props.type,source:this.props.source,addNewItem:this.addNewItem,existingItems:(e=this.props.items)!=null?e:this.state.items,coreKey:this.state.coreKey,refreshLinkedOptions:this.state.refreshLinkedOptions,unsetRefreshLinkedOptions:this.unsetRefreshLinkedOptions,parentDocId:this.props.parentDocId})]})});o(this,"renderAs",(e,s)=>e==="table"?n("div",{className:"table",children:[(this.props.items?this.props.items:this.state.items).length?n("div",{className:"header",children:[t("div",{className:"col",style:{maxWidth:"45px"}}),t("div",{className:"col",style:{minWidth:"30%"},children:"Lesson Name"}),t("div",{className:"col",children:"Progress Time"}),t("div",{className:"col",children:"Required Time"}),t("div",{className:"col",style:{minWidth:"20%"},children:"Unlock Next Lesson"}),t("div",{className:"col"})]}):t(w,{children:"No lessons."}),n("div",y(m({className:"main",style:{minWidth:"auto"}},s.droppableProps),{ref:s.innerRef,children:[(this.props.items?this.props.items:this.state.items).map((a,i)=>{const r=this.props.type!=="package"?a.draggableId:a;return t(le,{isDragDisabled:Boolean(this.props.parentsCoreLink),draggableId:`draggable${this.state.typeTitle}-${r}`,index:i,children:d=>t("div",y(m({ref:d.innerRef,className:"row"},d.draggableProps),{children:t(ds,{selectedLessons:this.props.selectedLessons,selectLesson:this.handleSelectLesson,unselectLesson:this.handleUnselectLesson,dragHandleProps:d.dragHandleProps,type:this.props.type,source:this.props.source,coreKey:this.state.coreKey,item:a,itemIdx:i,accordionOpen:this.state.params.focus&&this.state.params.focus===a._id,deleteItem:this.deleteItem,unlinkItem:this.unlinkItem,addNewItem:this.props.addNewItem,doSubmit:this.props.doSubmit,parentDocId:this.props.parentDocId,parentsCoreLink:this.props.parentsCoreLink,cloneItem:this.cloneItem,setIsDirty:this.props.setIsDirty,updateRegister:this.props.updateRegister,updateStateItem:this.updateStateItem,updateMasterTime:this.props.updateMasterTime},`itemCard${this.state.typeTitle}-${a._id}-${a[this.state.coreKey]}`)}),`itemCard-${a._id}`)},`draggable${this.state.typeTitle}-${r}`)}),s.placeholder]}))]}):n("ul",y(m({},s.droppableProps),{ref:s.innerRef,style:{listStyleType:"none",padding:"0px",margin:"0px"},children:[(this.props.items?this.props.items:this.state.items).map((a,i)=>{const r=this.props.type!=="package"?a.draggableId:a;return t(le,{isDragDisabled:Boolean(this.props.parentsCoreLink),draggableId:`draggable${this.state.typeTitle}-${r}`,index:i,children:d=>t("li",y(m({className:"li_admin",ref:d.innerRef},d.draggableProps),{children:t("div",{ref:a.ref,className:"my-2",children:t(ds,{selectedLessons:this.props.selectedLessons,selectLesson:this.handleSelectLesson,unselectLesson:this.handleUnselectLesson,dragHandleProps:d.dragHandleProps,type:this.props.type,source:this.props.source,coreKey:this.state.coreKey,item:a,itemIdx:i,accordionOpen:this.state.params.focus&&this.state.params.focus===a._id,deleteItem:this.deleteItem,unlinkItem:this.unlinkItem,addNewItem:this.props.addNewItem,doSubmit:this.props.doSubmit,parentDocId:this.props.parentDocId,parentsCoreLink:this.props.parentsCoreLink,cloneItem:this.cloneItem,setIsDirty:this.props.setIsDirty,updateRegister:this.props.updateRegister,updateStateItem:this.updateStateItem,updateMasterTime:this.props.updateMasterTime,updateItem:this.updateItem},`itemCard${this.state.typeTitle}-${a._id}-${a[this.state.coreKey]}`)},`itemCard-${a._id}`)}))},`draggable${this.state.typeTitle}-${r}`)}),s.placeholder]})));const s=e.type[0].toUpperCase()+e.type.substr(1).toLowerCase();this.state={params:Ko.parse(this.props.location.search,{ignoreQueryPrefix:!0}),loading:!1,items:e.items?null:[],itemsToDelete:[],typeTitle:s,modalShow:!1,modalAction:null,modalType:"",coreKey:"core"+s+"sLink",refreshLinkedOptions:!1,selectedLessons:e.selectedLessons}}componentDidUpdate(e,s,a){!e.doSubmit&&this.props.doSubmit&&this._isMounted&&this.submit(),e.selectedLessons!==this.props.selectedLessons&&this.setState({selectedLessons:this.props.selectedLessons})}}var pt=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(rp));function ls(){const l=g.exports.useContext(Ae);return t(L,{variant:"link",type:"button",className:"float-right ml-1",children:t(I,{icon:l?mt:gt})})}class op extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"componentDidMount",async()=>{this._isMounted=!0;const e={ANY_TIME:`Start ${this.props.type} at any time`,PREVIOUS_STARTED:`Cannot start until previous ${this.props.type} started`,PREVIOUS_COMPLETED:`Cannot start until previous ${this.props.type} completed`,PREVIOUS_PASSED:`Cannot start until previous ${this.props.type} passed`,PROMPT_STARTED:`Prompt if started before previous ${this.props.type} started`,PROMPT_COMPLETED:`Prompt if started before previous ${this.props.type} completed`,PROMPT_PASSED:`Prompt if started before previous ${this.props.type} passed`,ALWAYS_UNLOCKED:"All time",ON_LESSON_START:"When started",REQUIRED_TIME_MET:"When Timer Met",ON_QUIZ_START:"When Quiz Started",ON_QUIZ_END:"When Quiz Finished",ON_QUIZ_PASS:"When Quiz Passed"};let s=[];if(this.props.type==="lesson"?s=["ALWAYS_UNLOCKED","ON_LESSON_START","REQUIRED_TIME_MET","ON_QUIZ_START","ON_QUIZ_END","ON_QUIZ_PASS"]:this.props.type==="course"&&(s=["ANY_TIME","PREVIOUS_STARTED","PREVIOUS_COMPLETED","PREVIOUS_PASSED","PROMPT_STARTED","PROMPT_COMPLETED","PROMPT_PASSED"]),s=s.map(a=>({value:a,label:e[a]})),["course","package"].indexOf(this.props.type)>=0){let a;this.props.type==="course"?a=`/courses/${this.props.item.courseId}`:a=`/packages/${this.props.item}`;const{success:i,response:r}=await C("GET",a);i&&this._isMounted&&this.setState({item:m(m(m({},this.props.item),this.state.item),r)})}else this.setState({item:this.props.item});this._isMounted&&this.setState({conditionStatementOpts:s}),ht.on("CourseForm-select-all-lessons",()=>{this.props.selectLesson(this.props.item._id)})});o(this,"componentWillUnmount",async()=>{this._isMounted=!1});o(this,"submit",async e=>{let s=y(m({},this.state.item),{_id:void 0,menuIndex:this.props.itemIdx});this.props.source==="courses"?s[(this.props.type==="chapter"?"course":"chapter")+"Id"]=this.props.parentDocId:this.props.source==="core"&&(s[(this.props.type==="chapter"?"coreLibrary":"coreChapter")+"Id"]=this.props.parentDocId),this.props.source==="courses"&&this.props.type==="chapter"&&this.state.item.coreChaptersLink&&(this.props.item.title!==this.state.item.title&&(s.titleModified=!0),this.props.item.chapterTime!==this.state.item.chapterTime&&(s.chapterTimeModified=!0),this.props.item.title===this.state.item.title&&!this.props.item.titleModified&&(s.title=""),this.props.item.chapterTime===this.state.item.chapterTime&&!this.props.item.chapterTimeModified&&(s.chapterTime=0));let a=this.state.item.isNew?"POST":"PUT";this.props.source==="courses"&&this.props.type==="lesson"&&!this.props.parentsCoreLink&&this.state.item.coreChapterId&&(a="POST",s.conditionStatement="ALWAYS_UNLOCKED",s._id=void 0,s.chapterId=this.props.parentDocId);let i=`/${this.props.source}/${this.props.type}s/`;a==="PUT"&&(i+=this.props.item._id),this.props.type==="lesson"&&!this.state.item.isNew&&(s=y(m({},s.draft),{chapterId:s.chapterId,menuIndex:s.menuIndex,conditionStatement:s.conditionStatement,coreLessonsLink:s.coreLessonsLink||""}),delete s.updatedAt),delete s.ref,delete s.draggableId;const{success:r,response:d}=await C(a,i,s);this._isMounted&&r&&d?(this.setState({submittedDocId:this.props.item.isNew?d._id:this.props.item._id}),e&&this.setState({editable:y(m({},this.state.editable),{[e]:!1}),item:y(m(m(m({},this.props.item),this.state.item),d),{isNew:!1})}),this.props.updateRegister(this.state.item,"submitted")):e||this.props.updateRegister(this.state.item,"error")});o(this,"submitField",async(e,s=null)=>{const{success:a,response:i}=await C("PATCH","/courses/lessons/"+this.props.item._id,{[e]:s||this.state.item[e]});a&&this.setState({editable:y(m({},this.state.editable),{[e]:!1}),item:y(m(m(m({},this.props.item),this.state.item),i),{isNew:!1})})});o(this,"componentDidUpdate",(e,s,a)=>{!e.doSubmit&&this.props.doSubmit&&!this.state.submittedDocId&&this.submit(),e.parentsCoreLink&&!this.props.parentsCoreLink&&this.props.updateRegister(this.state.item,"add",this.props.parentDocId)});o(this,"duplicateItem",()=>{this.props.cloneItem(this.props.item)});o(this,"handleChange",(e,s)=>{if(this.state.item){let a=y(m({},this.state.item),{[e]:s});this.setState({item:a}),this.props.updateStateItem&&this.props.updateStateItem(a),this.props.setIsDirty&&this.props.setIsDirty(!0)}});o(this,"updateTime",(e,s)=>{this.setState({totalMaxTime:e,totalRequiredTime:s}),this.props.updateMasterTime&&this.props.updateMasterTime(this.state.item,e,s)});o(this,"renderAs",e=>{let s;this.props.type==="course"?s=`/admin/courses/${this.props.item.courseId}`:this.props.type==="package"?s=`/admin/packages/edit/${this.props.item}`:this.props.type==="lesson"&&(this.state.item.coreLessonsLink?s=`/admin/core-libraries/lessons/edit/${this.state.item.coreLessonsLink}`:this.props.source==="courses"?s=`/admin/courses/${this.props.match.params.id}/chapters/${this.state.item.chapterId}/lessons/${this.state.item._id}`:s=`/admin/core-libraries/lessons/edit/${this.state.item._id}`);let a=wt;this.props.source!=="packages"&&this.state.item&&!this.state.item[this.props.coreKey]&&(a=Ge);let i=Math.floor(this.state.totalMaxTime/60),r=this.state.totalMaxTime-i*60,d=Math.floor(this.state.totalRequiredTime/60),c=this.state.totalRequiredTime-d*60;return e==="tableRow"?[t("div",{className:"col col--center",style:{maxWidth:"45px"},children:!this.props.parentsCoreLink&&t("span",y(m({},this.props.dragHandleProps),{onClick:h=>{h.stopPropagation()},children:t(I,{icon:Re})}))},"col--1"),n("div",{className:"col",style:{minWidth:"30%"},children:[this.state.editable.title?t(f.Control,{style:{width:"86%"},className:"d-inline-block",type:"text",required:!0,minLength:"3",maxLength:"512",name:"title",value:this.lessonTitle||"",onClick:h=>{h.stopPropagation()},onChange:h=>{this.handleChange("title",h.target.value)}}):this.lessonTitle,this.state.editable.title?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submitField("title")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{title:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]},"col--2"),t("div",{className:"col",children:n("div",{className:"d-inline-block",style:{textAlign:"left"},children:[this.state.editable.maxTime?t(f.Control,{style:{width:"50%"},className:"d-inline-block",type:"number",id:"guideTime",name:"guideTime",min:"0",value:this.lessonProgressTime||0,onChange:h=>{this.handleChange("maxTime",h.target.value)}}):this.lessonProgressTime,this.state.editable.maxTime?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submitField("maxTime")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{maxTime:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]})},"col--3"),t("div",{className:"col",children:n("div",{className:"d-inline-block",style:{textAlign:"left"},children:[this.state.editable.requiredTime?t(f.Control,{style:{width:"50%"},className:"d-inline-block",type:"number",id:"requiredTime",name:"requiredTime",min:"0",value:this.lessonRequiredTime||0,onChange:h=>{this.handleChange("requiredTime",h.target.value)}}):this.lessonRequiredTime,this.state.editable.requiredTime?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submitField("requiredTime")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{requiredTime:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]})},"col--4"),t("div",{className:"col",style:{minWidth:"20%"},children:t(Fe,{menuShouldBlockScroll:!0,name:"conditionStatement",defaultValue:this.state.item?this.state.item.unlockNextLesson:"ALWAYS_UNLOCKED",value:this.state.conditionStatementOpts.filter(h=>this.state.item&&h.value===this.state.item.unlockNextLesson)[0],options:this.state.conditionStatementOpts,menuPortalTarget:document.body,menuPosition:"fixed",onChange:h=>{this.submitField("unlockNextLesson",h.value);let p=this.state.item;p.unlockNextLesson=h.value,this.setState({item:p})}})},"col--5"),t("div",{className:"col",children:this.props.type!="lesson"||!this.props.parentsCoreLink?n("div",{children:[this.props.source!=="packages"&&this.props.type!=="lesson"?t(ls,{}):this.props.type!=="package"?t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${this.props.itemIdx}`,children:this.props.source!=="packages"&&this.state.item.isNew?`To edit this ${this.state.typeTitle} save the form first`:"Edit"}),children:t("span",{className:"d-inline-block float-right",children:this.props.source!=="packages"&&this.state.item.isNew?t(L,{variant:"link",style:{pointerEvents:"none"},disabled:!0,className:"btn ml-1",children:t(I,{icon:a})}):t(R,{className:"btn float-right ml-1",to:s,children:t(I,{icon:a})})})},`tooltip-edit-${this.props.itemIdx}`):t(w,{}),this.props.type==="chapter"||this.props.type==="lesson"&&!this.props.parentsCoreLink?t(U,{placement:"top",overlay:t(M,{id:`tooltip-clone-${this.props.itemIdx}`,children:this.state.item.isNew?`To duplicate this ${this.state.typeTitle} save the form first`:"Duplicate"}),children:t("span",{className:"d-inline-block float-right",children:t(L,{variant:"link",type:"button",className:"float-right ml-1",disabled:this.state.item.isNew,onClick:h=>{h.stopPropagation(),this.props.cloneItem(this.props.item)},children:t(I,{icon:Ne})})})},`tooltip-clone-${this.props.itemIdx}`):t(w,{}),t(U,{placement:"top",overlay:t(M,{id:`tooltip-delete-${this.props.itemIdx}`,children:this.props.type==="course"||this.props.type==="package"?"Remove":"Delete"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:h=>{h.stopPropagation(),this.props.deleteItem(this.props.item)},children:t(I,{icon:this.props.type==="course"||this.props.type==="package"?fe:Ve})})},`tooltip-delete-${this.props.itemIdx}`),this.state.item&&this.state.item[this.props.coreKey]?[t(U,{placement:"top",overlay:t(M,{id:`tooltip-unlink-${this.props.itemIdx}`,children:"Unlink from Core"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:h=>{h.stopPropagation(),this.props.unlinkItem(this.props.item)},children:t(I,{icon:ts})})},`tooltip-unlink-${this.props.itemIdx}`),this.props.type==="chapter"?t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${this.props.itemIdx}`,children:"Edit"}),children:t(R,{to:`/admin/core-libraries/edit/${this.state.item.coreLibraryId}?focus=${this.state.item.coreChaptersLink}`,className:"btn float-right ml-1",children:t(I,{icon:wt})})},`tooltip-edit-${this.props.itemIdx}`):t("div",{},"dummyKey")]:t(w,{})]}):t(w,{})},"col--6")]:t(T,{defaultActiveKey:this.props.accordionOpen?this.props.itemIdx+1:"",children:n(B,{children:[t(T.Toggle,{style:this.props.type==="chapter"?{backgroundColor:"#dcf5ee",fontWeight:700}:{},as:B.Header,eventKey:this.props.itemIdx+1,children:n(A,{children:[n(x,{xs:12,lg:4,style:{paddingTop:"6px"},className:"my-2 my-lg-0",children:[!this.props.parentsCoreLink&&n(w,{children:[t("span",y(m({},this.props.dragHandleProps),{onClick:h=>{h.stopPropagation()},children:t(I,{icon:Re,style:{marginRight:"20px"}})})),this.props.type==="chapter"?t(w,{}):t(w,{})]}),this.props.source==="packages"?t("span",{style:{marginRight:"10px"},children:this.state.item?this.state.item.title:""}):n("div",{className:"d-inline-block",style:{width:"90%"},children:[this.state.editable.title?t(f.Control,{style:{width:"86%"},className:"d-inline-block",type:"text",required:!0,minLength:"3",maxLength:"512",name:"title",value:this.state.item?this.props.type==="lesson"&&!this.state.item.isNew?this.state.item.draft.title:this.state.item.title:"",onClick:h=>{h.stopPropagation()},onChange:h=>{this.handleChange("title",h.target.value)}}):this.state.item?this.props.type==="lesson"&&!this.state.item.isNew?this.state.item.draft.title:this.state.item.title:"",this.state.editable.title?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submit("title")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{title:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]})]}),t(x,{xs:12,lg:5,className:"my-2 my-lg-0",children:t(A,{children:this.props.source!=="packages"?[n(x,{xs:12,lg:6,className:"pt-2 text-right",children:[t(f.Label,{htmlFor:"guideTime",className:"d-inline-block",children:"Progress Time:\xA0"}),this.props.type==="lesson"?n("div",{className:"d-inline-block",style:{width:"50%",textAlign:"left"},children:[this.state.editable.maxTime?t(f.Control,{style:{width:"50%"},className:"d-inline-block",type:"number",id:"guideTime",name:"guideTime",min:"0",value:this.state.item&&this.state.item.isNew?this.state.item.maxTime||"":this.state.item&&!this.state.item.isNew&&this.state.item.draft.maxTime||"",onChange:h=>{this.handleChange("maxTime",h.target.value)}}):this.state.item?this.props.type==="lesson"&&!this.state.item.isNew?this.state.item.draft.maxTime:this.state.item.maxTime:"",this.state.editable.maxTime?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submit("maxTime")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{maxTime:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]}):t("span",{style:{fontWeight:"normal"},children:`${i}h ${r}m`})]},"time-col-1"),n(x,{xs:12,lg:6,className:"pt-2 text-right",children:[t(f.Label,{htmlFor:"requiredTime",children:"Required Time:\xA0"}),this.props.type==="lesson"?n("div",{className:"d-inline-block",style:{width:"50%",textAlign:"left"},children:[this.state.editable.requiredTime?t(f.Control,{style:{width:"50%"},className:"d-inline-block",type:"number",id:"requiredTime",name:"requiredTime",min:"0",value:this.state.item&&this.state.item.isNew?this.state.item.requiredTime||"":this.state.item&&!this.state.item.isNew&&this.state.item.draft.requiredTime||"",onChange:h=>{this.handleChange("requiredTime",h.target.value)}}):this.state.item?this.props.type==="lesson"&&!this.state.item.isNew?this.state.item.draft.requiredTime:this.state.item.requiredTime:"",this.state.editable.requiredTime?t("button",{type:"button",className:"btn bp ml-2",onClick:h=>{h.stopPropagation(),this.submit("requiredTime")},children:t(I,{icon:se})}):t(I,{onClick:h=>{h.stopPropagation(),this.setState({editable:y(m({},this.state.editable),{requiredTime:!0})})},style:{cursor:"pointer",fontSize:"14px",marginLeft:"7px"},icon:J})]}):t("span",{style:{fontWeight:"normal"},children:`${d}h ${c}m`})]},"time-col-2")]:t(x,{children:this.props.itemIdx>0?t(Fe,{name:"conditionStatement",defaultValue:this.props.item?this.props.item.conditionStatement:"ANY_TIME",value:this.state.conditionStatementOpts.filter(h=>this.props.item&&h.value===this.props.item.conditionStatement)[0],options:this.state.conditionStatementOpts,menuPortalTarget:document.body,menuPosition:"fixed",onChange:h=>{const p=y(m({},this.state.item),{conditionStatement:h.value});this.props.updateItem?this.props.updateItem(p):this.setState({item:p}),this.props.setIsDirty&&this.props.setIsDirty(!0)}}):t(w,{})})})}),t(x,{xs:12,lg:3,className:"my-2 my-lg-0",children:this.props.type!="lesson"||!this.props.parentsCoreLink?n("div",{children:[this.props.source!=="packages"&&this.props.type!=="lesson"?t(ls,{}):this.props.type!=="package"?t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${this.props.itemIdx}`,children:this.props.source!=="packages"&&this.state.item.isNew?`To edit this ${this.state.typeTitle} save the form first`:"Edit"}),children:t("span",{className:"d-inline-block float-right",children:this.props.source!=="packages"&&this.state.item.isNew?t(L,{variant:"link",style:{pointerEvents:"none"},disabled:!0,className:"btn ml-1",children:t(I,{icon:a})}):t(R,{className:"btn float-right ml-1",to:s,children:t(I,{icon:a})})})},`tooltip-edit-${this.props.itemIdx}`):t(w,{}),this.props.type==="chapter"||this.props.type==="lesson"&&!this.props.parentsCoreLink?t(U,{placement:"top",overlay:t(M,{id:`tooltip-clone-${this.props.itemIdx}`,children:this.state.item.isNew?`To duplicate this ${this.state.typeTitle} save the form first`:"Duplicate"}),children:t("span",{className:"d-inline-block float-right",children:t(L,{variant:"link",type:"button",className:"float-right ml-1",disabled:this.state.item.isNew,onClick:h=>{h.stopPropagation(),this.props.cloneItem(this.props.item)},children:t(I,{icon:Ne})})})},`tooltip-clone-${this.props.itemIdx}`):t(w,{}),t(U,{placement:"top",overlay:t(M,{id:`tooltip-delete-${this.props.itemIdx}`,children:this.props.type==="course"||this.props.type==="package"?"Remove":"Delete"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:h=>{h.stopPropagation(),this.props.deleteItem(this.props.item)},children:t(I,{icon:this.props.type==="course"||this.props.type==="package"?fe:Ve})})},`tooltip-delete-${this.props.itemIdx}`),this.state.item&&this.state.item[this.props.coreKey]?[t(U,{placement:"top",overlay:t(M,{id:`tooltip-unlink-${this.props.itemIdx}`,children:"Unlink from Core"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:h=>{h.stopPropagation(),this.props.unlinkItem(this.props.item)},children:t(I,{icon:ts})})},`tooltip-unlink-${this.props.itemIdx}`),this.props.type==="chapter"?t(U,{placement:"top",overlay:t(M,{id:`tooltip-edit-${this.props.itemIdx}`,children:"Edit"}),children:t(R,{to:`/admin/core-libraries/edit/${this.state.item.coreLibraryId}?focus=${this.state.item.coreChaptersLink}`,className:"btn float-right ml-1",children:t(I,{icon:wt})})},`tooltip-edit-${this.props.itemIdx}`):t("div",{},"dummyKey")]:t(w,{})]}):t(w,{})})]})}),this.props.type==="chapter"?t(T.Collapse,{eventKey:this.props.itemIdx+1,children:t(B.Body,{children:t(A,{children:t(x,{children:t(E,{children:t(pt,{type:"lesson",source:this.props.source,parentDocId:this.state.submittedDocId||this.props.item._id,doSubmit:this.state.submittedDocId&&this.props.doSubmit,parentsCoreLink:this.state.item?this.state.item[this.props.coreKey]:null,setIsDirty:this.props.setIsDirty,updateRegister:this.props.updateRegister,updateTime:this.updateTime})})})})})}):t(w,{})]})})});const s=e.type[0].toUpperCase()+e.type.substr(1).toLowerCase();let a=e.item;["course","package"].indexOf(this.props.type)>=0&&(a=null),this.state={item:a,submittedDocId:null,typeTitle:s,modalShow:!1,totalMaxTime:0,totalRequiredTime:0,editable:{title:!1,maxTime:!1,requiredTime:!1},conditionStatementOpts:[]}}get lessonTitle(){const{state:{item:e},props:{type:s}}=this;return e&&s==="lesson"?e.title:""}get lessonProgressTime(){const{state:{item:e},props:{type:s}}=this;return e&&s==="lesson"?e.maxTime:0}get lessonRequiredTime(){const{state:{item:e},props:{type:s}}=this;return e&&s==="lesson"?e.requiredTime:0}render(){return n(w,{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.deleteQuiz,titleText:"Are you sure?",bodyText:["You are about to delete this Quiz."]}),this.renderAs(this.props.type==="lesson"?"tableRow":"card")]})}}var ds=D(op),Jn=[{value:"ALABAMA",key:"AL"},{value:"ALASKA",key:"AK"},{value:"AMERICAN SAMOA",key:"AS"},{value:"ARIZONA",key:"AZ"},{value:"ARKANSAS",key:"AR"},{value:"CALIFORNIA",key:"CA"},{value:"COLORADO",key:"CO"},{value:"CONNECTICUT",key:"CT"},{value:"DELAWARE",key:"DE"},{value:"DISTRICT OF COLUMBIA",key:"DC"},{value:"FEDERATED STATES OF MICRONESIA",key:"FM"},{value:"FLORIDA",key:"FL"},{value:"GEORGIA",key:"GA"},{value:"GUAM",key:"GU"},{value:"HAWAII",key:"HI"},{value:"IDAHO",key:"ID"},{value:"ILLINOIS",key:"IL"},{value:"INDIANA",key:"IN"},{value:"IOWA",key:"IA"},{value:"KANSAS",key:"KS"},{value:"KENTUCKY",key:"KY"},{value:"LOUISIANA",key:"LA"},{value:"MAINE",key:"ME"},{value:"MARSHALL ISLANDS",key:"MH"},{value:"MARYLAND",key:"MD"},{value:"MASSACHUSETTS",key:"MA"},{value:"MICHIGAN",key:"MI"},{value:"MINNESOTA",key:"MN"},{value:"MISSISSIPPI",key:"MS"},{value:"MISSOURI",key:"MO"},{value:"MONTANA",key:"MT"},{value:"NEBRASKA",key:"NE"},{value:"NEVADA",key:"NV"},{value:"NEW HAMPSHIRE",key:"NH"},{value:"NEW JERSEY",key:"NJ"},{value:"NEW MEXICO",key:"NM"},{value:"NEW YORK",key:"NY"},{value:"NORTH CAROLINA",key:"NC"},{value:"NORTH DAKOTA",key:"ND"},{value:"NORTHERN MARIANA ISLANDS",key:"MP"},{value:"OHIO",key:"OH"},{value:"OKLAHOMA",key:"OK"},{value:"OREGON",key:"OR"},{value:"PALAU",key:"PW"},{value:"PENNSYLVANIA",key:"PA"},{value:"PUERTO RICO",key:"PR"},{value:"RHODE ISLAND",key:"RI"},{value:"SOUTH CAROLINA",key:"SC"},{value:"SOUTH DAKOTA",key:"SD"},{value:"TENNESSEE",key:"TN"},{value:"TEXAS",key:"TX"},{value:"UTAH",key:"UT"},{value:"VERMONT",key:"VT"},{value:"VIRGIN ISLANDS",key:"VI"},{value:"VIRGINIA",key:"VA"},{value:"WASHINGTON",key:"WA"},{value:"WEST VIRGINIA",key:"WV"},{value:"WISCONSIN",key:"WI"},{value:"WYOMING",key:"WY"}];const Xn=[{key:"AGENT",value:"Agent licensing"},{key:"MORTGAGE",value:"Mortgage loan origination"},{key:"APPRAISAL",value:"Appraisal"},{key:"HOME_INSPECTION",value:"Home inspection"}],lp=Xn.reduce((l,{key:e,value:s})=>y(m({},l),{[e]:s}),{});var Wt=z.createContext({});class er extends g.exports.Component{constructor(){super(...arguments);o(this,"_isMounted",!1);o(this,"doRedirect",e=>{this.context.setPackage({redirect:`/admin/packages/edit/${e}`})});o(this,"getPayload",()=>{const{title:e,description:s,image:a,publishDate:i,unpublishDate:r,price:d,availability:c,taxType:h,taxValue:p,courses:u,upsell:b,state:v,division:S,hideProduct:_}=this.context.packageData;return{title:e,description:s,image:a,publishDate:i!=null?i:null,unpublishDate:r!=null?r:null,price:d,availability:c!=null?c:365,taxType:h!=null?h:"FIXED",taxValue:p!=null?p:0,courses:u,upsell:b,state:v!=null?v:"AL",division:S!=null?S:"AGENT",hideProduct:_!=null?_:!1}});o(this,"setIsDirty",e=>{this.context.setPackage({isDirty:e})});o(this,"handleChange",e=>{this.context.setPackage({[e.target.name]:e.target.type==="checkbox"?e.target.checked:e.target.value,isDirty:!0})});o(this,"handleDateChange",(e,s)=>{this.context.setPackage({[e]:s,isDirty:!0})});o(this,"handleImageChange",(e,s,a)=>{this.context.setPackage({imageUrl:s,imageFile:a,isDirty:!0})});o(this,"handleSubmit",e=>{e&&(e.preventDefault(),e.stopPropagation()),this._isMounted&&(this.setIsDirty(!1),this.context.setPackage({loading:!0})),this.submit()});o(this,"submit",async()=>{if(this.context.packageData.imageFile){let r=new FormData;r.append("file",this.context.packageData.imageFile);const{success:d,response:c}=await C("POST","/files",r);d&&this._isMounted&&this.context.setPackage({imageUrl:await xe(c.fileId),image:c.fileId})}if(!this._isMounted)return;let e="POST",s="/packages";this.props.docId&&(e="PUT",s=`/packages/${this.props.docId}`);const{success:a,response:i}=await C(e,s,this.getPayload());this._isMounted&&(a&&i?(this.props.setGlobalAlert({type:"success",message:`Package has been ${this.props.docId?"updated":"created"}`}),this.props.docId?this.context.setPackage({loading:!1}):this.doRedirect(i._id)):(this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Package. Please try again"}),this.context.setPackage({loading:!1})))});o(this,"componentDidMount",async()=>{this._isMounted=!0,this.props.createFormActions({save:!0,cancel:!0,id:"packageForm"})});o(this,"componentDidUpdate",(e,s,a)=>{this.props.formActions.state&&this.props.formActions.state.reload&&(this.props.formActions.state.cancel&&this.props.history.push("/admin/packages"),this.props.createFormActions(y(m({},this.props.formActions.state),{reload:!1})))});o(this,"setItems",(e,s)=>{let a={},i;e==="package"?i="upsell":e==="course"?i=e+"s":i=e,a[i]=s,this.context.setPackage(a)});o(this,"onKeyPress",e=>{if(e.charCode===13&&e.target.nodeName!=="TEXTAREA"){e.preventDefault();const s=["TEXTAREA","INPUT","SELECT"],a=document.getElementById("form"),i=Array.from(a.elements).filter(d=>s.indexOf(d.tagName)>=0),r=i.indexOf(e.target);i[(r+1)%i.length].focus()}})}componentWillUnmount(){this._isMounted=!1,this.props.createFormActions({})}render(){let e;return this.context.packageData.redirect?e=t(Se,{to:this.context.packageData.redirect}):this.context.packageData.loading?e=t(Q,{}):e=n(f,{onSubmit:this.handleSubmit,id:"packageForm",onKeyPress:this.onKeyPress,children:[n(A,{className:"pt-5",children:[n(x,{xs:12,lg:4,children:[n(E,{children:[n(f.Label,{htmlFor:"title",children:[t(kt,{effect:"solid",multiline:!0}),"Package title",t(Tt,{"data-tip":"Package title is used in all menus <br/> and tiles linking to the package."})]}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"title",name:"title",value:this.context.packageData.title,onChange:this.handleChange})]}),n(E,{children:[t(f.Label,{htmlFor:"state",children:"State"}),t(f.Control,{as:"select",required:!0,id:"state",name:"state",custom:!0,value:this.context.packageData.state,onChange:this.handleChange,children:Jn.map(({key:s,value:a})=>t("option",{value:s,children:a},s))})]}),n(E,{children:[t(f.Label,{htmlFor:"division",children:"Division"}),t(f.Control,{as:"select",required:!0,id:"division",name:"division",custom:!0,value:this.context.packageData.division,onChange:this.handleChange,children:Xn.map(({key:s,value:a})=>t("option",{value:s,children:a},s))})]}),n(E,{children:[t(f.Label,{htmlFor:"description",children:"Description"}),t(f.Control,{as:"textarea",type:"text",required:!0,rows:"5",id:"description",name:"description",value:this.context.packageData.description,onChange:this.handleChange})]})]}),n(x,{xs:12,lg:4,children:[t(Qe,{id:"publishDate",handleDateChange:this.handleDateChange,date:this.context.packageData.publishDate,label:"Publish Date"}),t(Qe,{id:"unpublishDate",handleDateChange:this.handleDateChange,date:this.context.packageData.unpublishDate,label:"Unpublish Date"}),n(E,{children:[t(A,{children:n(x,{children:[t(f.Label,{htmlFor:"hideProduct",children:"Hide product"}),t(f.Control,{type:"checkbox",id:"hideProduct",name:"hideProduct",checked:this.context.packageData.hideProduct,onChange:this.handleChange})]})}),t(A,{children:n(x,{children:[t(f.Label,{htmlFor:"availability",children:"Availability"}),t(f.Control,{type:"number",id:"availability",name:"availability",min:"0",value:this.context.packageData.availability,onChange:this.handleChange})]})}),n(A,{children:[n(x,{children:[t(f.Label,{htmlFor:"price",children:"Price"}),t(f.Control,{type:"number",id:"price",name:"price",required:!0,min:"0",value:this.context.packageData.price,onChange:this.handleChange})]}),n(x,{children:[t(f.Label,{htmlFor:"taxType",children:"Tax"}),n(f.Control,{as:"select",id:"taxType",name:"taxType",required:!0,value:this.context.packageData.taxType,onChange:this.handleChange,children:[t("option",{value:"FIXED",children:"$"}),t("option",{value:"PERCENTAGE",children:"%"})]})]}),n(x,{children:[t(f.Label,{htmlFor:"taxValue",children:"\xA0"}),t(f.Control,{type:"number",id:"taxValue",name:"taxValue",min:"0",value:this.context.packageData.taxValue,onChange:this.handleChange})]})]})]})]}),t(x,{xs:12,lg:4,children:t(E,{children:t(We,{id:"image",name:"image",url:this.context.packageData.imageUrl,handleFileChange:this.handleImageChange,type:"image"})})})]}),t(A,{className:"pt-4",children:t(x,{children:t(pt,{type:"course",source:"packages",items:this.context.packageData.courses,setItems:this.setItems,setIsDirty:this.setIsDirty})})}),t(A,{className:"pt-5",children:t(x,{children:t(pt,{type:"package",source:"packages",items:this.context.packageData.upsell,setItems:this.setItems,parentDocId:this.props.docId,setIsDirty:this.setIsDirty})})})]}),n("div",{children:[t(Ye,{when:this.context.packageData.isDirty,navigate:s=>this.props.history.push(s),shouldBlockNavigation:()=>this.context.packageData.isDirty}),t("main",{children:e})]})}}o(er,"contextType",Wt);var dp=$(l=>({formActions:l.formActions}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(er));class cp extends g.exports.Component{render(){return t("div",{children:"Vouchers!"})}}class hp extends g.exports.Component{render(){return t("div",{children:"Messages!"})}}var yt=z.createContext({});class pp extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isReadOnly:!0,initialValue:""});o(this,"toggleReadOnly",e=>{e.stopPropagation();const{isReadOnly:s}=this.state,a={isReadOnly:!s};s?a.initialValue=this.props.value:(this.props.onChange({target:{name:this.props.name,value:this.state.initialValue}}),a.initialValue=""),this.setState(a)});o(this,"handleOnSave",e=>{e.stopPropagation(),this.props.onSave({target:{name:this.props.name,value:this.props.value}}),this.setState({isReadOnly:!0,initialValue:""})})}render(){var r;const{name:e,value:s,onChange:a}=this.props,{isReadOnly:i}=this.state;return n("div",{className:"toggle-text-input-component",children:[t("input",{type:"text",name:e,style:{width:`calc(${(r=s==null?void 0:s.length)!=null?r:1}ch + 30px)`},value:s,onChange:a,onClick:d=>{d.stopPropagation()},readOnly:i}),i?t(Yo,{onClick:this.toggleReadOnly}):n(w,{children:[t(jo,{onClick:this.handleOnSave}),t(Zo,{onClick:this.toggleReadOnly})]})]})}}class tr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",async e=>{const{bundleOrderIndex:s,orderIndex:a,bundleId:i}=this.props,r=Array.from(this.context.bundles),d=e.target.type==="number"?parseInt(e.target.value):e.target.value;r[s].packages[a][e.target.name]=d,C("PATCH",`/packages/bundles/${i}/${a}`,{[e.target.name]:d}),this.context.setBundles(r)});o(this,"handleRemovePackage",async()=>{const{bundleOrderIndex:e,orderIndex:s,bundleId:a}=this.props,i=Array.from(this.context.bundles);await C("DELETE",`/packages/bundles/${a}/${s}`),i[e].packages.splice(s,1),this.context.setBundles(i)})}render(){const{packageId:e,title:s,discountType:a,discountValue:i}=this.props.bundlePackage;return t(le,{draggableId:e,index:this.props.orderIndex,children:(r,d)=>t(B,y(m({className:"mb-2",ref:r.innerRef},r.draggableProps),{children:n(B.Header,{className:"d-flex align-items-center",children:[t("div",y(m({},r.dragHandleProps),{children:t(Pt,{style:{fontSize:"24px",marginRight:"10px"}})})),t("div",{className:"mr-3",style:{width:"300px"},children:s}),n("div",{className:"d-flex align-items-center",children:[t("label",{className:"font-weight-bold mr-2",htmlFor:"discountType",children:"Discount type"}),n("select",{style:{width:"150px"},name:"discountType",id:"discountType",value:a,onChange:this.handleInputChange,children:[t("option",{value:"PERCENTANGE",children:"Percentange"}),t("option",{value:"FIXED",children:"Fixed"})]})]}),n("div",{className:"d-flex align-items-center ml-3",children:[t("label",{className:"font-weight-bold mr-2",htmlFor:"discountValue",children:"Discount value"}),t("input",{style:{width:"100px"},type:"number",name:"discountValue",value:i,onChange:this.handleInputChange})]}),t(R,{to:`/admin/packages/edit/${e}`,target:"_blank",className:"ml-3",children:t(mn,{style:{fontSize:"20px"}})}),t("div",{className:"ml-3",onClick:this.handleRemovePackage,children:t(Ot,{style:{fontSize:"20px",cursor:"pointer"}})})]})}))})}}o(tr,"contextType",yt);class sr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{selectedPackage:null});o(this,"onDragEnd",e=>{if(!e.destination)return;const{orderIndex:s}=this.props.bundle,a=Array.from(this.context.bundles),i=Array.from(this.props.bundle.packages),[r]=i.splice(e.source.index,1);i.splice(e.destination.index,0,r),a[s].packages=i,this.context.setBundles(a)});o(this,"handleInputChange",async e=>{const{orderIndex:s}=this.props.bundle,a=Array.from(this.context.bundles),{name:i,value:r}=e.target;a[s][i]=r,this.context.setBundles(a)});o(this,"handleInputSave",async e=>{await C("PATCH",`/packages/bundles/${this.props.bundle._id}`,{[e.target.name]:e.target.value})});o(this,"handlePackageSelection",(e,s)=>{this.setState({selectedPackage:{packageId:s.value,title:s.name,discountType:"PERCENTANGE",discountValue:0}})});o(this,"addPackageToBundle",async()=>{if(this.state.selectedPackage===null)return;const{orderIndex:e,_id:s}=this.props.bundle,a=Array.from(this.context.bundles),{selectedPackage:i}=this.state;a[e].packages.push(i),await C("POST",`/packages/bundles/${s}/package`,i),this.context.setBundles(a),this.setState({selectedPackage:null})});o(this,"handleDeleteBundle",async e=>{e.stopPropagation();const{orderIndex:s,_id:a}=this.props.bundle,i=Array.from(this.context.bundles);await C("DELETE",`/packages/bundles/${a}`),i.splice(s,1),this.context.setBundles(i)})}render(){const{_id:e,title:s,orderIndex:a,packages:i}=this.props.bundle,{availablePackages:r}=this.context;return t(le,{draggableId:e,index:a,children:(d,c)=>n(B,y(m({className:"bundle-card",ref:d.innerRef},d.draggableProps),{children:[n(T.Toggle,{as:B.Header,eventKey:e,className:"d-flex align-items-center",children:[t("div",y(m({},d.dragHandleProps),{children:t(Pt,{style:{fontSize:"24px",marginRight:"10px"}})})),t(pp,{name:"title",value:s,onChange:this.handleInputChange,onSave:this.handleInputSave}),t("div",{onClick:this.handleDeleteBundle,style:{marginLeft:"auto",fontSize:"20px",cursor:"pointer"},children:t(Ot,{})})]}),t(T.Collapse,{eventKey:e,children:n(B.Body,{style:{minHeight:"200px"},children:[n("header",{className:"d-flex pt-4 mb-3",children:[t(lt,{search:!0,name:"selectPackage",options:r,placeholder:"Select package...",onChange:this.handlePackageSelection}),t("button",{className:"bp ml-3",style:{width:"170px"},onClick:this.addPackageToBundle,children:t("strong",{children:"Add package"})})]}),t(be,{onDragEnd:this.onDragEnd,children:t(Ce,{droppableId:"packagesDropZone",children:(h,p)=>n("main",y(m({},h.droppableProps),{ref:h.innerRef,children:[i.map((u,b)=>t(tr,{bundlePackage:u,orderIndex:b,bundleOrderIndex:a,bundleId:e},u.packageId)),h.placeholder]}))})})]})})]}))})}}o(sr,"contextType",yt);class ar extends g.exports.Component{constructor(){super(...arguments);o(this,"onDragEnd",e=>{if(!e.destination)return;const s=Array.from(this.context.bundles),[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.context.setBundles(s.map((i,r)=>y(m({},i),{orderIndex:r})),async()=>{await Promise.all(s.map(async({_id:i,orderIndex:r},d)=>{r!==d&&await C("PATCH",`/packages/bundles/${i}`,{orderIndex:d})}))})})}render(){const{bundles:e}=this.context;return t(be,{onDragEnd:this.onDragEnd,children:t(Ce,{droppableId:"bundlesDropZone",children:(s,a)=>n(T,y(m({},s.droppableProps),{ref:s.innerRef,children:[e.map(i=>t(sr,{bundle:i},i._id)),s.placeholder]}))})})}}o(ar,"contextType",yt);class up extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{title:"",status:"LOADING",bundles:[],availablePackages:[]});o(this,"loadBundles",async()=>{const{id:e}=this.props.match.params,{success:s,response:a}=await C("GET",`/packages/${e}/bundles`);s?this.setState({status:"READY",bundles:a}):this.setState({status:"ERROR"})});o(this,"loadPackages",async()=>{const{success:e,response:s}=await C("GET","/packages?perPage=all");e&&this.setState({availablePackages:s.docs.map(({_id:a,title:i})=>({value:a,name:i}))})});o(this,"createBundle",async()=>{const{id:e}=this.props.match.params,{title:s}=this.state,a=Array.from(this.state.bundles),{success:i,response:r}=await C("POST","/packages/bundles",{packageId:e,title:s,orderIndex:0});i&&(a.unshift(r),this.setState({title:"",bundles:a.map((d,c)=>y(m({},d),{orderIndex:c}))}))});o(this,"setBundles",(e,s)=>{this.setState({bundles:e},s)});o(this,"handleInputChange",e=>{this.setState({[e.target.name]:e.target.value})})}async componentDidMount(){await this.loadBundles(),await this.loadPackages(),this.props.createFormActions({save:!1,cancel:!1,id:"bundlesTab"})}render(){const{title:e,status:s,bundles:a,availablePackages:i}=this.state;return t("div",{className:"bundles-admin-form",children:s==="LOADING"?t(Q,{}):n(w,{children:[n("header",{className:"d-flex pt-4 mb-3",children:[t(f.Control,{type:"text",name:"title",onChange:this.handleInputChange,value:e}),t("button",{className:"bp ml-3",onClick:this.createBundle,children:t("strong",{children:"Create"})})]}),t(yt.Provider,{value:{bundles:a,availablePackages:i,setBundles:this.setBundles},children:t(ar,{})})]})})}}var mp=$(null,{createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(up));class ir extends g.exports.Component{constructor(){super(...arguments);o(this,"locationUpsellTypes",[{key:"ALL",text:"All products"},{key:"SAME_ONLY",text:"Same-division only"},{key:"CROSS_ONLY",text:"Cross-division only"},{key:"SAME_PRIO",text:"Same-division prioritised"},{key:"CROSS_PRIO",text:"Cross-division prioritised"}]);o(this,"handleChange",async e=>{const s=y(m({},this.context.packageData.locationsUpsellsType),{[e.target.name]:e.target.value});await C("PUT",`/packages/${this.props.match.params.id}`,{locationsUpsellsType:s}),this.context.setPackage({locationsUpsellsType:s})})}render(){const{cart:e,suggestion:s,thankYou:a,dashboard:i}=this.context.packageData.locationsUpsellsType;return n(w,{children:[n(A,{children:[t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"cart",children:"Cart"}),t(f.Control,{as:"select",required:!0,id:"cart",name:"cart",value:e,onChange:this.handleChange,children:this.locationUpsellTypes.map(({key:r,text:d})=>t("option",{value:r,children:d},r))})]})}),t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"thankYou",children:"Thank you"}),t(f.Control,{as:"select",required:!0,id:"thankYou",name:"thankYou",value:a,onChange:this.handleChange,children:this.locationUpsellTypes.map(({key:r,text:d})=>t("option",{value:r,children:d},r))})]})})]}),n(A,{children:[t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"suggestion",children:"Suggestion"}),t(f.Control,{as:"select",required:!0,id:"suggestion",name:"suggestion",value:s,onChange:this.handleChange,children:this.locationUpsellTypes.map(({key:r,text:d})=>t("option",{value:r,children:d},r))})]})}),t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"dashboard",children:"Dashboard"}),t(f.Control,{as:"select",required:!0,id:"dashboard",name:"dashboard",value:i,onChange:this.handleChange,children:this.locationUpsellTypes.map(({key:r,text:d})=>t("option",{value:r,children:d},r))})]})})]})]})}}o(ir,"contextType",Wt);var gp=D(ir),nr=z.createContext({});class rr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleRemoveUpsell",async e=>{e.stopPropagation();const{orderIndex:s,_id:a}=this.props.packageData,i=Array.from(this.context.upsells);await C("DELETE",`/packages/upsells/${a}`),i.splice(s,1),this.context.setUpsells(i)});o(this,"handleChange",async e=>{const{orderIndex:s,_id:a}=this.props.packageData,i=Array.from(this.context.upsells),r=e.target.type==="number"?parseInt(e.target.value):e.target.value;await C("PATCH",`/packages/upsells/${a}`,{[e.target.name]:r}),i[s][e.target.name]=r,this.context.setUpsells(i)});o(this,"handleChangeDisplayLocations",async e=>{const{orderIndex:s,_id:a}=this.props.packageData,i=Array.from(this.context.upsells),r=y(m({},i[s].displayLocations),{[e.target.name]:e.target.checked});await C("PATCH",`/packages/upsells/${a}`,{displayLocations:r}),i[s].displayLocations=r,this.context.setUpsells(i)});o(this,"handleChangeDiscountLocations",async e=>{const{orderIndex:s,_id:a}=this.props.packageData,i=Array.from(this.context.upsells),r=y(m({},i[s].discountLocations),{[e.target.name]:e.target.checked});await C("PATCH",`/packages/upsells/${a}`,{discountLocations:r}),i[s].discountLocations=r,this.context.setUpsells(i)});o(this,"stopPropagation",e=>{e.stopPropagation()})}render(){const{_id:e,upsoldPackageId:s,title:a,division:i,discountType:r,discountValue:d,importance:c,displayLocations:h,discountLocations:p,orderIndex:u}=this.props.packageData;return t(le,{draggableId:e,index:u,children:(b,v)=>n(B,y(m({className:"admin-upsell-package-card",ref:b.innerRef},b.draggableProps),{children:[n(T.Toggle,{as:B.Header,eventKey:e,className:"d-flex justify-content-between",children:[n("div",{children:[t("span",y(m({},b.dragHandleProps),{children:t(Pt,{onClick:this.stopPropagation,style:{fontSize:"24px",marginRight:"10px"}})})),"\xA0",a]}),n("div",{children:[t("b",{children:"Division:"})," ",lp[i]]}),n("div",{className:"d-flex",children:[t(R,{onClick:this.stopPropagation,to:`/admin/packages/edit/${s}`,target:"_blank",className:"ml-3",children:t(mn,{style:{fontSize:"20px"}})}),t("div",{className:"ml-3",onClick:this.handleRemoveUpsell,children:t(Ot,{style:{fontSize:"20px",cursor:"pointer"}})})]})]}),t(T.Collapse,{eventKey:e,children:n(B.Body,{children:[n(E,{children:[t(f.Label,{htmlFor:"discountType",children:"Discount type"}),n(f.Control,{as:"select",id:"discountType",name:"discountType",value:r,onChange:this.handleChange,children:[t("option",{value:"PERCENTANGE",children:"Percentange"}),t("option",{value:"FIXED",children:"Fixed"})]})]}),n(E,{children:[t(f.Label,{htmlFor:"discountValue",children:"Discount value"}),t(f.Control,{type:"number",id:"discountValue",name:"discountValue",value:d,onChange:this.handleChange})]}),n(E,{children:[t(f.Label,{htmlFor:"importance",children:"Importance"}),t(f.Control,{type:"number",min:0,max:100,id:"importance",name:"importance",value:c,onChange:this.handleChange})]}),n("fieldset",{children:[t("legend",{children:"Allow display at:"}),n("label",{htmlFor:"cart",children:[t("input",{type:"checkbox",name:"cart",checked:h.cart,onChange:this.handleChangeDisplayLocations}),"\xA0Cart"]}),t("br",{}),n("label",{htmlFor:"suggestion",children:[t("input",{type:"checkbox",name:"suggestion",checked:h.suggestion,onChange:this.handleChangeDisplayLocations}),"\xA0Suggestion"]}),t("br",{}),n("label",{htmlFor:"thankYou",children:[t("input",{type:"checkbox",name:"thankYou",checked:h.thankYou,onChange:this.handleChangeDisplayLocations}),"\xA0Thank you"]}),t("br",{}),n("label",{htmlFor:"dashboard",children:[t("input",{type:"checkbox",name:"dashboard",checked:h.dashboard,onChange:this.handleChangeDisplayLocations}),"\xA0Dashboard"]}),t("br",{})]}),n("fieldset",{children:[t("legend",{children:"Allow discount at:"}),n("label",{htmlFor:"cart",children:[t("input",{type:"checkbox",name:"cart",checked:p.cart,onChange:this.handleChangeDiscountLocations}),"\xA0Cart"]}),t("br",{}),n("label",{htmlFor:"suggestion",children:[t("input",{type:"checkbox",name:"suggestion",checked:p.suggestion,onChange:this.handleChangeDiscountLocations}),"\xA0Suggestion"]}),t("br",{}),n("label",{htmlFor:"thankYou",children:[t("input",{type:"checkbox",name:"thankYou",checked:p.thankYou,onChange:this.handleChangeDiscountLocations}),"\xA0Thank you"]}),t("br",{}),n("label",{htmlFor:"dashboard",children:[t("input",{type:"checkbox",name:"dashboard",checked:p.dashboard,onChange:this.handleChangeDiscountLocations}),"\xA0Dashboard"]}),t("br",{})]})]})})]}))})}}o(rr,"contextType",nr);class fp extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{upsells:[],availablePackages:[],selectedPackage:null});o(this,"loadUpsells",async()=>{const{success:e,response:s}=await C("GET",`/packages/${this.props.match.params.id}/upsells`);e&&this.setState({upsells:s})});o(this,"loadPackages",async()=>{const{success:e,response:s}=await C("GET","/packages?perPage=all");e&&this.setState({availablePackages:s.docs.map(({_id:a,title:i,division:r})=>({value:a,name:i,division:r}))})});o(this,"handlePackageSelection",(e,s)=>{this.setState({selectedPackage:{packageId:s.value,title:s.name,division:s.division}})});o(this,"addPackageUpsell",async()=>{if(this.state.selectedPackage===null)return;const{id:e}=this.props.match.params,s=Array.from(this.state.upsells),{selectedPackage:a}=this.state,i={packageId:e,upsoldPackageId:a.packageId,title:a.title,division:a.division,importance:0,discountType:"PERCENTAGE",discountValue:0,displayLocations:{cart:!0,suggestion:!0,thankYou:!0,dashboard:!0},discountLocations:{cart:!0,suggestion:!0,thankYou:!0,dashboard:!0},orderIndex:0},{response:r}=await C("POST","/packages/upsells",i);s.unshift(y(m({},i),{_id:r._id})),this.setState({selectedPackage:null,upsells:s.map((d,c)=>y(m({},d),{orderIndex:c}))})});o(this,"setUpsells",(e,s)=>{this.setState({upsells:e},s)});o(this,"onDragEnd",e=>{if(!e.destination)return;const s=Array.from(this.state.upsells),[a]=s.splice(e.source.index,1);s.splice(e.destination.index,0,a),this.setUpsells(s.map((i,r)=>y(m({},i),{orderIndex:r})),async()=>{await Promise.all(s.map(async({_id:i,orderIndex:r},d)=>{r!==d&&await C("PATCH",`/packages/upsells/${i}`,{orderIndex:d})}))})})}async componentDidMount(){await this.loadPackages(),await this.loadUpsells()}render(){const{availablePackages:e,upsells:s}=this.state;return n(w,{children:[n("div",{className:"d-flex pt-4 mb-3",children:[t(lt,{search:!0,name:"selectPackage",options:e,placeholder:"Select package...",onChange:this.handlePackageSelection}),t("button",{className:"bp ml-3",style:{width:"170px"},onClick:this.addPackageUpsell,children:t("strong",{children:"Add package"})})]}),t(nr.Provider,{value:{upsells:s,setUpsells:this.setUpsells},children:t(be,{onDragEnd:this.onDragEnd,children:t(Ce,{droppableId:"bundlesDropZone",children:(a,i)=>n(T,y(m({},a.droppableProps),{ref:a.innerRef,children:[s.map(r=>t(rr,{packageData:r},r._id)),a.placeholder]}))})})})]})}}var bp=D(fp);class Cp extends g.exports.Component{async componentDidMount(){this.props.createFormActions({save:!1,cancel:!1,id:"bundlesTab"})}render(){return n("div",{className:"admin-package-upsells pt-4",children:[t(gp,{}),t(bp,{})]})}}var yp=$(null,{createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(Cp);class vp extends g.exports.Component{constructor(e){super(e);o(this,"initialState",{loading:!0,redirect:null,title:"",description:"",imageUrl:"",imageFile:"",publishDate:"",unpublishDate:"",availability:"",price:365,taxType:"",taxValue:"",courses:[],upsell:[],image:void 0,isDirty:!1});o(this,"state",m({},this.initialState));o(this,"loadPackage",async()=>{const{id:e}=this.props.match.params;if(e){this.setState({loading:!0});const{success:s,response:a}=await C("GET",`/packages/${e}`);if(s){const i=a.publishDate?a.publishDate.split("T")[0]:"",r=a.unpublishDate?a.unpublishDate.split("T")[0]:"",d=a.taxType?a.taxType:"FIXED";this.setState(y(m({},a),{imageUrl:await xe(a.image),image:a.image,publishDate:i,unpublishDate:r,taxType:d,courses:a.courses.map(c=>y(m({},c),{draggableId:c.courseId})),loading:!1,redirect:null}))}}});o(this,"createBreadcrumbs",()=>{this.props.pushBreadcrumbLink({text:"Packages",path:"/admin/packages"});const{id:e}=this.props.match.params;e&&this.props.pushBreadcrumbLink({text:`Package: ${this.state.title}`,path:`/admin/packages/edit/${e}`})});o(this,"removeBreadcrumbs",()=>{this.props.removeBreadcrumbLink({text:"Packages",path:"/admin/packages"});const{id:e}=this.props.match.params;e&&this.props.removeBreadcrumbLink({text:`Package: ${this.state.title}`,path:`/admin/packages/edit/${e}`})});o(this,"setPackage",e=>{this.setState(e)});this.tabs=[{tabTitle:"Package",TabComponent:dp}],e.match.params.id&&(this.tabs=this.tabs.concat([{tabTitle:"Bundles",TabComponent:mp},{tabTitle:"Upsells",TabComponent:yp},{tabTitle:"Vouchers",TabComponent:cp},{tabTitle:"Messages",TabComponent:hp}]))}async componentDidMount(){await this.loadPackage(),this.createBreadcrumbs()}componentWillUnmount(){this.removeBreadcrumbs()}async componentDidUpdate(e){this.props.match.params.id!==e.match.params.id&&(this.removeBreadcrumbs(),await this.loadPackage(),this.createBreadcrumbs())}render(){return t(Wt.Provider,{value:{packageData:m({},this.state),setPackage:this.setPackage},children:t(et,{tabs:this.tabs,docId:this.props.match.params.id})})}}var cs=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(vp));class xp extends g.exports.Component{constructor(e){super(e);o(this,"componentDidMount",()=>{this.props.pushBreadcrumbLink({text:"Packages",path:"/admin/packages"})});o(this,"duplicatePackage",async(e,s)=>{const{success:a}=await C("POST",`/packages/${e}/clone`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Package has been duplicated"})):this.props.setGlobalAlert({type:"error",message:"Package has not been duplicated. Please try again."})});o(this,"deletePackage",async(e,s)=>{const{success:a}=await C("DELETE",`/packages/${e}`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Package has been deleted"})):this.props.setGlobalAlert({type:"error",message:"Package has not been deleted. Please try again."})});this.state={modalShow:!1,modalAction:null,modalType:""}}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Packages",path:"/admin/packages"})}render(){return n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this Package."]}),t("a",{className:"btn bp btn--small",href:"/admin/packages/create",children:"New Package"}),t(he,{basePath:"/admin/packages",apiCall:{method:"GET",path:"/packages"},columns:[{text:"",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-edit-package)}`,children:"Edit package"}),children:t(R,{className:"btn btn--small",to:"/admin/packages/edit/"+e._id,children:t(I,{icon:Ge})})}),maxWidth:"3.11rem"},{text:"Title",field:"title",minWidth:"45%",sortKey:"title"},{text:"Status",field:e=>{const s=new Date().toISOString();return e.publishDate&&e.publishDate<=s&&(!e.unpublishDate||s<e.unpublishDate)?"Published":"Unpublished"}},{text:"Created at",field:e=>new Date(e.createdAt).toLocaleString("en-US"),sortKey:"createdAt"}],rowButtons:[{type:"button",text:"Duplicate package",icon:Ne,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.duplicatePackage(s._id,a)},modalType:"duplicate"})}},{type:"button",text:"Delete package",icon:ae,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.deletePackage(s._id,a)},modalType:"delete"})}}]})]})}}var Sp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(xp);class Ip extends g.exports.Component{render(){return t("div",{id:"invoices",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/packages",component:Sp}),t(P,{exact:!0,path:"/admin/packages/create",component:cs},"admin-packages-create"),t(P,{exact:!0,path:"/admin/packages/edit/:id",component:cs},"admin-packages-edit")]})})}}class wp extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"initialState",{loading:!0,redirect:null,title:"",doSubmit:!1,submitRegister:{},rerenderId:0,isDirty:!1});o(this,"updateRegister",(e,s,a)=>{Array.isArray(e)||(e=[e]);let i=m({},this.state.submitRegister);const r=h=>{Object.keys(i).map(p=>{i[p].parent===h._id&&delete i[p]})};let d=this.state.doSubmit;e.map(h=>{s==="add"?i[h._id]={submitted:!1,error:!1,parent:a}:s==="delete"?(delete i[h._id],r(h),d=!1):s==="delete_children"?(r(h),d=!1):s==="submitted"&&i[h._id]?i[h._id].submitted=!0:s==="error"&&i[h._id]&&(i[h._id].error=!0)}),this.setState({submitRegister:i});const c=this.anyErrorInChildren(i);d=!c,d&&this.areAllChildrenSubmitted(i)?this.doRedirect(this.state.submittedDocId):c&&this.state.doSubmit&&this.handleSubmitFailed()});o(this,"areAllChildrenSubmitted",e=>{const s=e||this.state.submitRegister;return Object.keys(s).every(a=>s[a].submitted)});o(this,"anyErrorInChildren",e=>{const s=e||this.state.submitRegister;return Object.keys(s).some(a=>s[a].error)});o(this,"doRedirect",e=>{this.toggleSpinner(!1),this.props.setGlobalAlert({type:"success",message:`Core Library has been ${this.props.match.params.id?"updated":"created"}`}),this.props.match.params.id?(this.setState({doSubmit:!1,rerenderId:this.state.rerenderId+1,submitRegister:{}}),this.removeBreadcrumbs(),this.createBreadcrumbs()):this.setState({redirect:`/admin/core-libraries/edit/${e}`})});o(this,"getPayload",()=>({title:this.state.title}));o(this,"setIsDirty",e=>{this.setState({isDirty:e})});o(this,"handleChange",e=>{this.setState({[e.target.name]:e.target.value,isDirty:!0})});o(this,"handleSubmit",e=>{e&&(e.preventDefault(),e.stopPropagation()),this.setIsDirty(!1),this.toggleSpinner(!0),this.submit()});o(this,"handleSubmitFailed",()=>{this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Core Library. Please try again"}),this.setState({doSubmit:!1,rerenderId:this.state.rerenderId+1}),this.toggleSpinner(!1)});o(this,"toggleSpinner",e=>{const s=document.getElementById("coreLibraryForm"),a=document.getElementById("spinner");s&&a&&(e?(s.style.display="none",a.removeAttribute("hidden")):(s.style.display="block",a.setAttribute("hidden",!0)))});o(this,"submit",async()=>{let e="POST",s="/core";this.props.match.params.id&&(e="PUT",s=`/core/${this.props.match.params.id}`);const{success:a,response:i}=await C(e,s,this.getPayload());this._isMounted&&(a&&i?this.areAllChildrenSubmitted()?this.doRedirect(i._id):this.setState({doSubmit:!0,submittedDocId:i._id}):this.handleSubmitFailed())});o(this,"loadCoreLib",async()=>{if(this.props.match.params.id){this.setState({loading:!0});const{success:e,response:s}=await C("GET",`/core/${this.props.match.params.id}`);e&&this._isMounted&&this.setState(m({},s))}else this.setState(m({},this.initialState));this._isMounted&&this.setState({loading:!1,redirect:null})});o(this,"createBreadcrumbs",()=>{this.props.pushBreadcrumbLink({text:"Core Libraries",path:"/admin/core-libraries"}),this.props.match.params.id&&this.props.pushBreadcrumbLink({text:`Core Library: ${this.state.title}`,path:`/admin/core-libraries/edit/${this.props.match.params.id}`})});o(this,"removeBreadcrumbs",()=>{this.props.removeBreadcrumbLink({text:"Core Libraries",path:"/admin/core-libraries"}),this.props.match.params.id&&this.props.removeBreadcrumbLink({text:`Core Lib: ${this.state.title}`,path:`/admin/core-libraries/edit/${this.props.match.params.id}`})});o(this,"componentDidMount",async()=>{this._isMounted=!0,await this.loadCoreLib(),this.createBreadcrumbs(),this.props.createFormActions({save:!0,cancel:!0,id:"coreLibraryForm"})});o(this,"componentWillUnmount",()=>{this._isMounted=!1,this.removeBreadcrumbs(),this.props.createFormActions({})});o(this,"onKeyPress",e=>{if(e.charCode===13&&e.target.nodeName!=="TEXTAREA"){e.preventDefault();const s=["TEXTAREA","INPUT","SELECT"],a=document.getElementById("form"),i=Array.from(a.elements).filter(d=>s.indexOf(d.tagName)>=0),r=i.indexOf(e.target);i[(r+1)%i.length].focus()}});this.state=m({},this.initialState)}async componentDidUpdate(e,s,a){this.props.formActions.state&&this.props.formActions.state.reload&&(this.props.createFormActions(y(m({},this.props.formActions.state),{reload:!1})),this.props.formActions.state.cancel&&this.props.history.push("/admin/core-libraries"),await this.loadCoreLib())}render(){let e;return this.state.redirect?e=t(Se,{to:this.state.redirect}):this.state.loading?e=t(Q,{}):e=n("div",{className:"tab-content",children:[t("div",{id:"spinner",hidden:!0,children:t(Q,{})}),n(f,{onSubmit:this.handleSubmit,id:"coreLibraryForm",onKeyPress:this.onKeyPress,children:[t(A,{className:"pt-5",children:t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Core Library Name"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"title",name:"title",value:this.state.title,onChange:this.handleChange})]})})}),t(A,{className:"pt-4",children:t(x,{children:t(pt,{type:"chapter",source:"core",parentDocId:this.state.submittedDocId||this.props.match.params.id,doSubmit:this.state.submittedDocId&&this.state.doSubmit,setIsDirty:this.setIsDirty,updateRegister:this.updateRegister},this.state.rerenderId)})})]})]}),n("div",{children:[t(Ye,{when:this.state.isDirty,navigate:s=>this.props.history.push(s),shouldBlockNavigation:()=>this.state.isDirty}),t("main",{children:e})]})}}var hs=$(l=>({formActions:l.formActions}),{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(wp));class _p extends g.exports.Component{constructor(e){super(e);o(this,"componentDidMount",()=>{this.props.pushBreadcrumbLink({text:"Core Libraries",path:"/admin/core-libraries"})});o(this,"duplicateCoreLibrary",async(e,s)=>{const{success:a}=await C("POST",`/core/clone/${e}/`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Core Library has been duplicated"})):this.props.setGlobalAlert({type:"error",message:"Core Library has not been duplicated. Please try again."})});o(this,"deleteCoreLibrary",async(e,s)=>{const{success:a}=await C("DELETE",`/core/${e}`);a?(this.setState({modalShow:!1}),await s(),this.props.setGlobalAlert({type:"success",message:"Core Library has been deleted"})):this.props.setGlobalAlert({type:"error",message:"Core Library has not been deleted. Please try again."})});this.state={modalShow:!1,modalAction:null,modalType:""}}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Core Libraries",path:"/admin/core-libraries"})}render(){return n("div",{children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:this.state.modalAction,titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:this.state.modalType},"modal-type")," this Core Library."]}),t("a",{className:"btn bp btn--small",href:"/admin/core-libraries/create",children:"New Core Library"}),t(he,{basePath:"/admin/core-libraries",apiCall:{method:"GET",path:"/core"},columns:[{text:"",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-edit-core-library)}`,children:"Edit core library"}),children:t(R,{className:"btn btn--small",to:"/admin/core-libraries/edit/"+e._id,children:t(I,{icon:Ge})})}),maxWidth:"3.11rem"},{text:"Title",field:"title",minWidth:"55%",sortKey:"title"},{text:"Created at",field:"createdAt",sortKey:"createdAt"}],rowButtons:[{type:"button",text:"Duplicate core library",icon:Ne,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.duplicateCoreLibrary(s._id,a)},modalType:"duplicate"})}},{type:"button",text:"Delete core library",icon:ae,clickCallback:(e,s,a)=>{this.setState({modalShow:!0,modalAction:()=>{this.deleteCoreLibrary(s._id,a)},modalType:"delete"})}}]})]})}}var kp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(_p);class Tp extends g.exports.Component{constructor(e){super(e);o(this,"_isMounted",!1);o(this,"state",{modalShow:!1,showQuizModal:!1});o(this,"cardTypes",["TEXT","HEADING","AUDIO","AUDIO_BIG","VIDEO","IMAGE","SINGLE_QUESTION","DOCUMENT","QUIZ"]);o(this,"handleVideoIdPaste",async e=>{const s=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/gi.exec((e.clipboardData||window.clipboardData).getData("text"));s&&s[1]&&(e.preventDefault(),e.stopPropagation(),this.props.handleCardChange(this.props.card,e.target.name,s[1]))});o(this,"componentWillUnmount",async()=>{this._isMounted=!1});o(this,"componentDidMount",async()=>{this._isMounted=!0});o(this,"handleFileChange",(e,s,a)=>{this.props.handleFileChange(this.props.card,e,s,a)});o(this,"quizModalHandleClose",(e=void 0)=>this.setState({showQuizModal:!1,endOfChapterQuizId:e}));o(this,"quizModalHandleShow",()=>this.setState({showQuizModal:!0}));o(this,"handleQuizChange",e=>{this.props.handleCardChange(this.props.card,"quiz",e)});this.cardTypeOpts=this.cardTypes.map(s=>({label:(s.charAt(0).toUpperCase()+s.substr(1).toLowerCase()).replaceAll("_"," "),value:s}))}render(){var s,a;const{card:e}=this.props;return n("div",{className:"admin-lesson-card-form",children:[t(X,{show:this.state.modalShow,hideModal:()=>{this.setState({modalShow:!1})},confirmAction:()=>{this.props.deleteItem(this.props.idx),this.setState({modalShow:!1})},titleText:"Are you sure?",bodyText:["You are about to ",t("strong",{children:"delete"},"modal-type")," this Card."]}),this.props.editable&&e.orderIndex===0?t(L,{className:"btn-plus my-1",size:"sm",block:!0,onClick:i=>{this.props.addNewCard(0)},children:"+"}):t(w,{}),t(T,{children:n(B,{children:[t(T.Toggle,{as:B.Header,eventKey:"0",children:n(A,{children:[n(x,{xs:12,md:4,className:"my-2 my-lg-0",children:[this.props.editable?t("span",y(m({},this.props.dragHandleProps),{onClick:i=>{i.stopPropagation()},children:t(I,{icon:Re,style:{marginRight:"20px"}})})):t(w,{}),t(f.Control,{type:"number",placeholder:"Index",min:"1",max:this.props.numOfCards,id:"orderIndex",name:"orderIndex",className:"d-inline-block",style:{width:"20%",marginRight:"20px"},onClick:i=>{i.stopPropagation()},value:e.orderIndex+1,onChange:i=>{this.props.manualIdxChange(i.target.value-1,e.orderIndex)},readOnly:!this.props.editable||e.submissionInProgress}),t(f.Control,{type:"text",placeholder:"Card title...",minLength:"3",maxLength:"512",id:"cardTitle",name:"cardTitle",className:"d-inline-block",style:{width:"50%"},onClick:i=>{i.stopPropagation()},value:e.cardTitle,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})]}),t(x,{xs:12,md:5,onClick:i=>{i.stopPropagation()},children:t(Fe,{name:"cardType",placeholder:"Card type...",menuPortalTarget:document.body,menuPosition:"fixed",value:this.cardTypeOpts.filter(i=>e.cardType===i.value)[0],defaultValue:this.cardTypeOpts[0],options:this.cardTypeOpts,onChange:i=>{this.props.handleCardChange(e,"cardType",i.value)},isDisabled:!this.props.editable||e.submissionInProgress})}),this.props.editable?n(x,{xs:12,md:3,className:"my-2 my-md-0",children:[t(U,{placement:"top",overlay:t(M,{children:"Delete"}),children:t(L,{variant:"link",type:"button",className:"float-right ml-1",onClick:i=>{i.stopPropagation(),this.setState({modalShow:!0})},disabled:e.submissionInProgress,children:t(I,{icon:ae})})}),t(U,{placement:"top",overlay:t(M,{children:"Edit"}),children:t(T.Toggle,{as:L,variant:"link",className:"float-right mx-1",eventKey:"0",children:t(I,{icon:J})})})]}):t(w,{})]})}),t(T.Collapse,{eventKey:"0",children:t(B.Body,{children:t(A,{children:e.cardType==="SINGLE_QUESTION"?n(x,{children:[n(E,{children:[t(f.Label,{htmlFor:"question",children:"Question"}),t(f.Control,{id:"question",name:"question",type:"text",minLength:"3",maxLength:"512",value:Array.isArray(e==null?void 0:e.questions)&&(e==null?void 0:e.questions[0])?(s=e==null?void 0:e.questions[0])==null?void 0:s.question:"",onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})]}),n(f.Group,{children:[t(f.Label,{children:"Answers"}),t(x,{children:[0,1,2,3].map(i=>n(f.Label,{className:"d-block",children:[t(f.Check,{type:"checkbox",name:`answersCorrect-${e.uuid}`,className:"d-inline-block",checked:Array.isArray(e==null?void 0:e.questions)&&e.questions[0]&&e.questions[0].correctAnswers&&e.questions[0].correctAnswers.contains(i),onChange:r=>{e.questions[0].answers.map((c,h)=>(c.correct=h===i,c));const d=Array.isArray(e.questions)?e.questions:[];this.props.handleCardChange(e,"questions",d)},disabled:!this.props.editable||e.submissionInProgress}),t(f.Control,{className:"d-inline-block ml-3",style:{width:"80%"},value:e.answers&&e.answers[i].value,onChange:r=>{const d=e.answers.map((c,h)=>(i===h&&(c.value=r.target.value),c));this.props.handleCardChange(e,"answers",d)}})]},i))})]}),t(f.Group,{children:t(f.Check,{className:"ml-3 mt-3",id:"requiresCorrectAnswer",name:"requiresCorrectAnswer",type:"checkbox",label:"\xA0Require Correct Answer To Proceed",checked:e.requiresCorrectAnswer,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.checked)},disabled:!this.props.editable||e.submissionInProgress})})]}):e.cardType==="QUIZ"?t(x,{children:t(L,{onClick:this.quizModalHandleShow,children:e.quiz&&!this.props.editable?"View":"Edit"})}):n(x,{children:[n(E,{children:[t(f.Label,{htmlFor:"heading",children:"Heading"}),t(f.Control,{id:"heading",name:"heading",type:"text",minLength:"3",maxLength:"512",value:e.heading,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})]}),(e.cardType==="HEADING"||e.cardType==="TEXT"||e.cardType==="IMAGE"||e.cardType==="DOCUMENT")&&n(E,{children:[t(f.Label,{htmlFor:"text",children:"Text"}),t(H,{defaultValue:e.content,onChange:i=>{this.props.handleCardChange(e,"content",i.target.value)},disabled:!this.props.editable||e.submissionInProgress})]}),(e.cardType==="VIDEO"||e.cardType==="AUDIO"||e.cardType==="AUDIO_BIG")&&n(E,{children:[t(f.Label,{htmlFor:"subHeading",children:"Sub Heading"}),t(f.Control,{id:"subHeading",name:"subHeading",type:"text",minLength:"3",maxLength:"512",value:e.subHeading,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})]}),e.cardType==="HEADING"&&n(w,{children:[t(E,{children:n(T,{children:[t(f.Label,{htmlFor:"bgColor",children:t(T.Toggle,{as:L,variant:"link",eventKey:"0",children:t("strong",{children:"Background Color"})})}),t(T.Collapse,{eventKey:"0",children:t(f.Control,{type:"color",id:"bgColor",name:"bgColor",value:e.bgColor,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})})]})}),t(E,{children:n(T,{children:[t(f.Label,{htmlFor:"fgColor",children:t(T.Toggle,{as:L,variant:"link",eventKey:"0",children:t("strong",{children:"Font Color"})})}),t(T.Collapse,{eventKey:"0",children:t(f.Control,{type:"color",id:"fgColor",name:"fgColor",value:e.fgColor,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})})]})})]}),e.cardType==="IMAGE"&&n(w,{children:[n(A,{children:[t(x,{children:t(E,{children:t(ne,{id:"sourceImage",name:"sourceImage",file:e.sourceImage,handleFileChange:this.handleFileChange,type:"image",disabled:!this.props.editable||e.submissionInProgress})})}),t(x,{className:"pt-2",children:t(f.Group,{children:t(f.Check,{id:"imageImportance",name:"imageImportance",type:"checkbox",label:"\xA0Mark Image as Important",checked:e.imageImportance,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.checked)},disabled:!this.props.editable||e.submissionInProgress})})})]}),n(A,{children:[t(x,{children:n(E,{children:[t("label",{htmlFor:"imagePosition",children:"Image position"}),n("select",{name:"imagePosition",onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},defaultValue:(a=e==null?void 0:e.imagePosition)!=null?a:"TOP",children:[t("option",{value:"TOP",children:"Top"}),t("option",{value:"LEFT",children:"Left"}),t("option",{value:"RIGHT",children:"Right"}),t("option",{value:"BG",children:"Background"})]})]})}),t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"imageUrl",children:"Link URL"}),t(f.Control,{id:"imageUrl",name:"imageUrl",type:"url",value:e.imageUrl,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},readOnly:!this.props.editable||e.submissionInProgress})]})})]})]}),(e.cardType==="AUDIO"||e.cardType==="AUDIO_BIG")&&t(E,{children:t(ne,{id:"sourceAudio",name:"sourceAudio",file:e.sourceAudio,handleFileChange:this.handleFileChange,type:"audio",disabled:!this.props.editable||e.submissionInProgress})}),e.cardType==="VIDEO"&&n(E,{children:[t(f.Label,{htmlFor:"heading",children:"Video ID"}),t(f.Control,{id:"sourceVideo",name:"sourceVideo",placeholder:"123456789",type:"url",value:e.sourceVideo,onChange:i=>{this.props.handleCardChange(e,i.target.name,i.target.value)},onPaste:this.handleVideoIdPaste,readOnly:!this.props.editable||e.submissionInProgress})]}),e.cardType!=="TEXT"&&e.cardType!=="HEADING"&&e.cardType!=="DOCUMENT"&&e.cardType!=="IMAGE"&&n(E,{children:[t(f.Label,{htmlFor:"transcript",children:"Transcript"}),t(H,{defaultValue:e.transcript,onChange:i=>{this.props.handleCardChange(e,"transcript",i.target.value)},disabled:!this.props.editable||e.submissionInProgress})]}),e.cardType==="DOCUMENT"&&t(E,{children:t(ne,{id:"sourceDocument",name:"sourceDocument",file:e.sourceDocument,handleFileChange:this.handleFileChange,type:"document",disabled:!this.props.editable||e.submissionInProgress})}),t(E,{children:n(T,{children:[t(f.Label,{htmlFor:"info",children:t(T.Toggle,{as:L,variant:"link",eventKey:"0",children:t("strong",{children:"Information"})})}),t(T.Collapse,{eventKey:"0",children:t(H,{defaultValue:e.info,onChange:i=>{this.props.handleCardChange(e,"info",i.target.value)},disabled:!this.props.editable||e.submissionInProgress})})]})})]})})})})]})}),this.props.editable?t(L,{className:"btn-plus my-1",size:"sm",block:!0,onClick:i=>{this.props.addNewCard(e.orderIndex+1)},children:"+"}):t(w,{})]})}}class ps extends g.exports.Component{render(){if(!this.props.editable&&!this.props.published)return"This Lesson has not been published yet.";const e=this.props.cards.some(s=>s.cardType==="QUIZ");return n(f,{onSubmit:this.props.parent.handleSubmit,id:this.props.editable?"lessonForm":"",children:[this.props.editable?t(A,{className:"pt-4",children:t(x,{md:6,children:this.props.parent.state.minsAgo!==null?n(ft,{variant:"light",children:["Last saved\xA0",this.props.parent.state.minsAgo===0?"seconds ago":this.props.parent.state.minsAgo===1?"1 minute ago":this.props.parent.state.minsAgo+" minutes ago","."]}):t(w,{})})}):t(w,{}),n(A,{className:"pt-5",children:[n(x,{md:7,children:[n(A,{children:[t(x,{md:7,children:n(E,{children:[t(f.Label,{htmlFor:"title",children:"Lesson Name"}),t(f.Control,{type:"text",required:!0,minLength:"3",maxLength:"512",id:"title",name:"title",value:this.props.lesson.title||"",onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.lesson.submissionInProgress})]})}),n(x,{md:5,children:[t(f.Label,{htmlFor:"maxTime",children:"Progress Time (mins)"}),t(f.Control,{type:"number",id:"maxTime",name:"maxTime",min:"0",value:this.props.lesson.maxTime||0,onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.lesson.submissionInProgress})]})]}),n(A,{children:[n(x,{md:7,children:[t(f.Label,{htmlFor:"unlockNextLesson",children:"Unlock next lesson"}),n(f.Control,{as:"select",id:"unlockNextLesson",name:"unlockNextLesson",value:this.props.lesson.unlockNextLesson||"",onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.parent.state.lessonsubmissionInProgress,children:[t("option",{value:"ALWAYS_UNLOCKED",children:"All time"}),t("option",{value:"ON_LESSON_START",children:"When started"}),t("option",{value:"REQUIRED_TIME_MET",children:"When Timer Met"}),t("option",{disabled:!e,value:"ON_QUIZ_START",children:"When Quiz Started"}),t("option",{disabled:!e,value:"ON_QUIZ_END",children:"When Quiz Finished"}),t("option",{disabled:!e,value:"ON_QUIZ_PASS",children:"When Quiz Passed"})]})]}),n(x,{md:5,children:[t(f.Label,{htmlFor:"requiredTime",children:"Required Time (mins)"}),t(f.Control,{type:"number",id:"requiredTime",name:"requiredTime",min:"0",value:this.props.lesson.requiredTime||0,onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.lesson.submissionInProgress})]})]}),t(A,{children:n(x,{children:[t(f.Label,{htmlFor:"lessonLayout",children:"Lesson Layout"}),n(f.Control,{as:"select",id:"lessonLayout",name:"lessonLayout",value:this.props.lesson.lessonLayout||"CARD",onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.parent.state.lessonsubmissionInProgress,children:[t("option",{value:"PAGE",children:"Page"}),t("option",{value:"CARD",children:"Card"})]})]})})]}),n(x,{md:5,children:[t(A,{children:n(x,{children:[t(f.Label,{htmlFor:"lessonType",children:"Lesson Type"}),n(f.Control,{as:"select",id:"lessonType",name:"lessonType",value:this.props.lesson.lessonType||"",onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.parent.state.lessonsubmissionInProgress,children:[t("option",{value:"BASIC",children:"Basic"}),t("option",{value:"STATE",children:"State"}),t("option",{value:"NATIONAL",children:"National"})]})]})}),t(A,{children:"lessonType"in this.props.lesson&&this.props.lesson.lessonType!=="BASIC"&&t(x,{children:n(E,{children:[t(f.Label,{htmlFor:"lessonTypeComment",children:"Lesson Description"}),t(f.Control,{as:"textarea",type:"text",rows:"4",id:"lessonTypeComment",name:"lessonTypeComment",value:this.props.lesson.lessonTypeComment||"",onChange:this.props.parent.handleChange,readOnly:!this.props.editable||this.props.lesson.submissionInProgress})]})})})]})]}),t(A,{className:"pt-5",children:t(x,{children:t(E,{children:t(f.Label,{children:"Content"})})})}),this.props.lessonCardsLoading?t(Q,{}):t(be,{onDragEnd:this.props.parent.handleDragAndDrop,children:t(Ce,{droppableId:"lessonCardsDroppable",children:s=>n("ul",y(m({},s.droppableProps),{ref:s.innerRef,style:{listStyleType:"none",padding:"0px",margin:"0px"},children:[this.props.cards.length?t(w,{}):t(L,{variant:"btn bd",type:"button",onClick:this.props.parent.addNewCard,children:"Add new Card"}),this.props.cards.map((a,i)=>t(le,{draggableId:a.uuid,index:i,isDragDisabled:!this.props.editable,children:r=>t("li",y(m({ref:r.innerRef},r.draggableProps),{children:t(A,{children:t(x,{children:t(Tp,{editable:this.props.editable,card:this.props.editable?m(m({},a),a.draft):a,idx:i,deleteItem:this.props.parent.deleteItem,dragHandleProps:r.dragHandleProps,manualIdxChange:this.props.parent.manualIdxChange,numOfCards:this.props.cards.length,addNewCard:this.props.parent.addNewCard,updateDraftUpdateTs:this.props.updateDraftUpdateTs,handleCardChange:this.props.parent.handleCardChange,handleFileChange:this.props.parent.handleFileChange})})},a.uuid)}))},`draggable-${a.uuid}`)),s.placeholder]}))})})]})}}class or extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{pageStatus:"LOADING",subItems:null});o(this,"loadSubItemsData",async()=>{const{success:e,response:s}=await C("GET",`/courses/lessons/chapter/${this.props.item._id}`);e&&this.setState({subItems:s.lessons,pageStatus:"READY"})})}async componentDidMount(){this.context===this.props.item._id&&await this.loadSubItemsData()}async componentDidUpdate(e,s){this.context===this.props.item._id&&s.subItems===null&&await this.loadSubItemsData()}render(){const{item:e,match:{params:s}}=this.props,{subItems:a,pageStatus:i}=this.state;return n("div",{className:"lfmenu-item",children:[n(T.Toggle,{as:"header",eventKey:e._id,onClick:this.props.onClick,children:[t("div",{children:e.title}),t(I,{icon:this.context===e._id?Dt:Ue})]}),t(T.Collapse,{eventKey:e._id,children:t("div",{children:i==="READY"&&a.map(r=>t(R,{to:`/admin/courses/${s.courseId}/chapters/${r.chapterId}/ext/lessons/edit/${r._id}`,className:`lfmenu-subitem${s.id===r._id?" lfmenu-subitem__active":""}`,children:r.title},r._id))})})]})}}o(or,"contextType",Ae);var Np=D(or);class Ap extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{page:0,cards:this.props.cards,nextLessonId:this.props.nextLessonId,previousLessonId:this.props.previousLessonId});o(this,"pageOptions",()=>{let e=[];for(let s=1;s<=this.state.cards.length;s++)e.push(t("option",{value:s,children:s},s));return e});o(this,"setCurrentLessonCard",async e=>{e<0&&(e=await this.loadLessonCards(this.state.previousLessonId)-1),e>this.state.cards.length-1&&(await this.loadLessonCards(this.state.nextLessonId),e=0),this.setState({page:e})});o(this,"loadLessonCards",async e=>{const{success:s,response:a}=await C("GET",`/courses/lessons/${e}/cards`),{nextLessonId:i,previousLessonId:r}=await this.loadLessonData(e);return s?(this.setState({cards:a,nextLessonId:i,previousLessonId:r}),a.length):0});o(this,"loadLessonData",async e=>{var i,r;const{success:s,response:a}=await C("GET",`/courses/lessons/${e}`);return s?{nextLessonId:(i=a==null?void 0:a.nextLesson)==null?void 0:i._id,previousLessonId:(r=a==null?void 0:a.previousLesson)==null?void 0:r._id}:{}})}get previousText(){return this.state.page===0?"Previous lesson":"Previous"}get nextText(){return this.state.page===this.state.cards.length-1?"Next lesson":"Next"}render(){const{page:e,cards:s,previousLessonId:a,nextLessonId:i}=this.state,r=s[e];return n("div",{className:"lesson-preview__container",children:[t(Ht,m({},r)),n("footer",{className:"lesson-preview__controls",children:[!!(a||e)&&n("span",{onClick:()=>{this.setCurrentLessonCard(e-1)},children:[t(Jo,{})," ",this.previousText]}),n("div",{children:[t("select",{style:{width:`${s.length.toString().length+1.5}ch`},type:"number",name:"page",id:"page",value:e+1,onChange:d=>{this.setCurrentLessonCard(d.target.value)},children:this.pageOptions()}),n("div",{children:[" | ",s.length]})]}),!!(i||e<s.length)&&n("span",{onClick:()=>{this.setCurrentLessonCard(e+1)},children:[this.nextText,t(Xo,{})]})]})]})}}class Lp extends g.exports.Component{constructor(){super(...arguments);o(this,"_isMounted",!1);o(this,"eventSource",null);o(this,"state",{source:this.props.match.path.indexOf("courses")>=0?"courses":"core",type:this.props.match.path.indexOf("courses")>=0?"Course":"Core Library",lessonLoading:!1,lessonCardsLoading:!1,lastSavedTs:null,minsAgo:null,lesson:{},cardsPublished:[],cardsDraft:[],course:{},showPreview:!1,canPublish:!1});o(this,"createBreadcrumbs",()=>{const{state:e,props:s}=this;this.props.pushBreadcrumbLink({text:e.source==="core"?"Core Libraries":"Courses",path:`/admin/${e.source==="core"?"core-libraries":"courses"}`}),this.props.pushBreadcrumbLink({text:`${e.type}: ${e.course.title}`,path:`/admin/${e.source==="core"?"core-libraries/edit":"courses"}/${e.course._id}?focus=${e.lesson.chapterId}&highlight=${e.lesson._id}`}),this.props.pushBreadcrumbLink({text:`Lesson: ${e.lesson.title?e.lesson.title:e.lesson.draft.title}`,path:this.props.match.url})});o(this,"togglePreview",()=>{this.setState({showPreview:!this.state.showPreview})});o(this,"removeBreadcrumbs",(e,s)=>{var a,i,r,d,c;!s||(this.props.removeBreadcrumbLink({text:s.source==="core"?"Core Libraries":"Courses",path:`/admin/${s.source==="core"?"core-libraries":"courses"}`}),this.props.removeBreadcrumbLink({text:`${s.type}: ${(a=s==null?void 0:s.course)==null?void 0:a.title}`,path:`/admin/${s.source==="core"?"core-libraries/edit":"courses"}/${s.course._id}?focus=${s.lesson.chapterId}&highlight=${s.lesson._id}`}),this.props.removeBreadcrumbLink({text:`Lesson: ${(i=s==null?void 0:s.lesson)!=null&&i.title?(r=s==null?void 0:s.lesson)==null?void 0:r.title:(c=(d=s==null?void 0:s.lesson)==null?void 0:d.draft)==null?void 0:c.title}`,path:e.match.url}))});o(this,"cancel",async()=>{const{success:e}=await C("POST",`/${this.state.source}/lessons/${this.props.match.params.id}/cancel`);e&&this.setState({canPublish:!1},this.loadThings)});o(this,"createButtons",()=>{var s,a,i,r;let e=[{label:"Save",onClick:this.handleSubmit,className:"bp"},{label:"Reset",onClick:this.cancel},{label:"Publish",onClick:()=>{this.handleSubmit(null,this.publish)}},{label:"Preview",onClick:this.togglePreview}];(a=(s=this.state)==null?void 0:s.lesson)!=null&&a.previousLesson&&e.push({label:"Previous",className:"lesson-navigation-btn",icon:Xe,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.state.lesson.previousLesson.chapterId}/ext/lessons/edit/${this.state.lesson.previousLesson._id}`}),(r=(i=this.state)==null?void 0:i.lesson)!=null&&r.nextLesson&&e.push({label:"Next",className:"lesson-navigation-btn",icon:Be,link:`/admin/courses/${this.props.match.params.courseId}/chapters/${this.state.lesson.nextLesson.chapterId}/ext/lessons/edit/${this.state.lesson.nextLesson._id}`}),this.props.createFormActions({customButtons:e})});o(this,"componentWillUnmount",async()=>{this._isMounted=!1,clearInterval(this.updateTimeInterval),clearInterval(this.saveInterval),this.removeBreadcrumbs(this.props,this.state),this.props.createFormActions({})});o(this,"componentDidUpdate",(e,s,a)=>{const i=s.lesson.isDirty||s.cardsDraft.some(h=>h.isDirty),r=!this.state.lesson.isDirty&&this.state.cardsDraft.every(h=>!h.isDirty),d=this.state.lesson.isDirty||this.state.cardsDraft.some(h=>h.isDirty),c=!s.lesson.isDirty&&s.cardsDraft.every(h=>!h.isDirty);i&&r&&(this.setState({lastSavedTs:Date.now(),minsAgo:0,canPublish:!0}),this.updateTimeInterval=setInterval(()=>{this.setState({minsAgo:Math.floor((Date.now()-this.state.lastSavedTs)/1e3/60)})},1e3*60)),c&&d&&this.createButtons(),e.match.params.id!==this.props.match.params.id&&(this.removeBreadcrumbs(e,s),this.loadThings()),!s.lesson&&this.state.lesson&&this.createButtons()});o(this,"loadThings",async()=>{this._isMounted=!0,clearInterval(this.saveInterval),this.setState({lessonLoading:!0,lessonCardsLoading:!0});try{const{success:e,response:s}=await C("GET",`/${this.state.source}/lessons/${this.props.match.params.id}`),a={lessonLoading:!1};if(e){a.lesson=m({},s);const i=`/${this.state.source}/${a.lesson.chapter[this.state.source=="courses"?"courseId":"coreLibraryId"]}`,{success:r,response:d}=await C("GET",i);r&&(a.course=d)}this.setState(a,this.createBreadcrumbs)}catch{this.setState({lessonLoading:!1})}C("GET",`/${this.state.source}/lessons/${this.props.match.params.id}/cards`).then(({success:e,response:s})=>{const a={lessonCardsLoading:!1};this._isMounted&&e&&(a.cardsDraft=s.map((i,r)=>(i.uuid=i._id,i)),a.cardsPublished=a.cardsDraft.splice()),this.setState(a)}).catch(()=>{this.setState({lessonCardsLoading:!1})}),this.createButtons()});o(this,"handleFileChange",(e,s,a,i)=>{this.handleCardChange(e,`${s}File`,i),this.handleCardChange(e,`source${s[0].toUpperCase()+s.substr(1).toLowerCase()}`,a)});o(this,"handleChange",e=>{this.state.lesson.draft[e.target.name]!==e.target.value&&this.setState({lesson:y(m({},this.state.lesson),{draft:y(m({},this.state.lesson.draft),{[e.target.name]:e.target.value}),isDirty:!0})})});o(this,"handleCardChange",(e,s,a)=>{this.setState({cards:this.state.cardsDraft.map(i=>(i.uuid===e.uuid&&i.draft[s]!==a&&(i.draft[s]=a,i.isDirty=!0),i))})});o(this,"handleSubmit",async(e,s)=>{if(e&&(e.preventDefault(),e.stopPropagation()),this.state.lesson.isDirty&&!this.state.lesson.submissionInProgress){this.setState({lesson:y(m({},this.state.lesson),{submissionInProgress:!0})});let i=y(m({},this.state.lesson.draft),{chapterId:this.state.lesson.chapterId,menuIndex:this.state.lesson.menuIndex,unlockNextLesson:this.state.lesson.draft.unlockNextLesson});delete i._id,delete i.isDirty,delete i.submissionInProgress,delete i.updatedAt,"conditionStatement"in i&&delete i.conditionStatement;const{success:r,response:d}=await C("PUT",`/${this.state.source}/lessons/${this.props.match.params.id}`,i);this._isMounted&&r?(this.removeBreadcrumbs(this.props,this.state),this.setState({lesson:y(m({},d.data?d.data:d),{isDirty:!1,submissionInProgress:!1})}),this.createBreadcrumbs()):(this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this Lesson. Please try again"}),this.setState({lesson:y(m({},this.state.lesson),{submissionInProgress:!1})}))}const a=this.state.cardsDraft.map(async i=>{if(!i.isDirty&&!i.isNew||i.submissionInProgress)return;this.setState({cardsDraft:this.state.cardsDraft.map(v=>(i.uuid===v.uuid&&(v=y(m({},v),{submissionInProgress:!0})),v))});const r=["image","audio","video","document"].map(async v=>{if(i.draft&&i.draft[`${v}File`]){let S=new FormData;S.append("file",i.draft[`${v}File`]);const{success:_,response:k}=await C("POST","/files",S);_&&this._isMounted&&(i.draft[`source${v[0].toUpperCase()+v.substr(1).toLowerCase()}`]=k.fileId,delete i.draft[`${v}File`])}});await Promise.all(r);const d=i.isNew?"POST":"PUT",c=i.isNew?`${this.state.lesson._id}/cards`:`cards/${i._id}`,h=`/${this.state.source}/lessons/${c}`,p=i.uuid;i=m({},i.draft);const{success:u,response:b}=await C(d,h,i);this._isMounted&&u&&b&&b._id?this.setState({cardsDraft:this.state.cardsDraft.map(v=>(p===v.uuid&&(v=y(m({},b),{uuid:b._id,submissionInProgress:!1})),v)),canPublish:!0}):(this.props.setGlobalAlert({type:"error",message:"There was a problem with saving this lesson. Please try again"}),this.setState({cardsDraft:this.state.cardsDraft.map(v=>(p===v.uuid&&(v=y(m({},v),{submissionInProgress:!1})),v))}))});await Promise.all(a),s&&typeof s=="function"&&s()});o(this,"swapCards",(e,s)=>{let a=[...this.state.cardsDraft];const[i]=a.splice(e,1);a.splice(s,0,i),this.setState({cardsDraft:a.map((r,d)=>(r.draft.orderIndex!==d&&(r=y(m({},y(m({},r),{draft:y(m({},r.draft),{orderIndex:d})})),{isDirty:!0})),r))})});o(this,"handleDragAndDrop",e=>{!e.destination||e.source.index===e.destination.index||this.swapCards(e.source.index,e.destination.index)});o(this,"manualIdxChange",(e,s)=>{s!==e&&this.swapCards(s,e)});o(this,"addNewCard",async e=>{e=parseInt(e)||0;let s=[...this.state.cardsDraft];s.splice(e,0,await this.getEmptyCard()),this.setState({cardsDraft:s.map((a,i)=>(a.draft&&a.draft.orderIndex!==i&&(a.draft.orderIndex=i,a.isDirty=!0),a))})});o(this,"getEmptyCard",async()=>{const{success:e,response:s}=await C("GET","/settings/values/default_heading_bgcolor,default_heading_textcolor");return{uuid:K(),draft:{cardTitle:"Card",cardType:"TEXT",imageImportance:"default",heading:"",subHeading:"",sourceImage:void 0,sourceVideo:void 0,sourceAudio:void 0,sourceDocument:void 0,bgColor:e?s.default_heading_bgcolor:"#000000",fgColor:e?s.default_heading_textcolor:"#FFFFFF",transcript:"",content:"",info:"",orderIndex:0,question:"",quiz:{},answers:[{value:"",correct:!1},{value:"",correct:!1},{value:"",correct:!1},{value:"",correct:!1}],requiresCorrectAnswer:!1},isNew:!0,isDirty:!0}});o(this,"deleteItem",async e=>{let s=[...this.state.cardsDraft];const[a]=s.splice(e,1);if(a.isNew)this.setState({cardsDraft:s.map((i,r)=>y(m({},i),{draft:y(m({},i.draft),{orderIndex:r})}))});else{const{success:i,response:r}=await C("DELETE",`/${this.state.source}/lessons/cards/${a._id}`);this._isMounted&&i&&r?(this.setState({cardsDraft:s.map((d,c)=>(d.draft.orderIndex!==c&&(d=y(m({},d),{draft:y(m({},d.draft),{orderIndex:c}),isDirty:!0})),d))}),this.isAnythingDirty()&&this.handleSubmit(),this.props.setGlobalAlert({type:"success",message:"Lesson Card was deleted"})):this.props.setGlobalAlert({type:"error",message:"There was a problem with deleting the Card. Please try again"})}});o(this,"isAnythingDirty",()=>this.state.lesson.isDirty||this.state.cardsDraft.some(e=>e.isDirty)||this.isAnythingDifferent());o(this,"canPublish",()=>this.state.canPublish||!this.isAnythingDirty());o(this,"isAnythingDifferent",()=>{var e,s;return(s=(e=this.state.lesson)==null?void 0:e.draft)!=null&&s.updatedAt?new Date(this.state.lesson.updatedAt).getTime()<=new Date(this.state.lesson.draft.updatedAt).getTime():!1});o(this,"updateDraftUpdateTs",()=>{this.setState({lesson:y(m({},this.state.lesson),{draft:y(m({},this.state.lesson.draft),{updatedAt:new Date})})},this.createButtons)});o(this,"publish",async()=>{this.eventSource===null&&(this.isAnythingDirty()&&await this.handleSubmit(),this.setState({lessonLoading:!0,lessonCardsLoading:!0,canPublish:!1}),this.eventSource=new EventSource(`http://localhost:5000/api/${this.state.source}/lessons/${this.props.match.params.id}/publish?token=${encodeURI(this.props.loggedIn.token)}`),this.eventSource.onmessage=e=>{const s=JSON.parse(e.data);if(s.success){const{currentlyPublished:a,toPublish:i}=s.data;i===a&&(this.eventSource.close(),this.eventSource=null,this.loadThings(),this.props.setGlobalAlert({type:"success",message:"Lesson has been published"}))}else this.props.setGlobalAlert({type:"error",message:"There was a problem with publishing this Lesson. Please try again."})},this.eventSource.onerror=()=>{this.eventSource.close(),this.eventSource=null,this.setState({lessonLoading:!1,lessonCardsLoading:!1}),this.props.setGlobalAlert({type:"error",message:"There was a problem with publishing this Lesson. Please try again."})})})}async componentDidMount(){await this.loadThings()}render(){var e,s,a,i;return this.state.lessonLoading?t(Q,{}):n("div",{className:"lesson-form",children:[t(Gt,{itemsEndpoint:`/courses/chapters/course/${this.props.match.params.courseId}/title`,itemsComponent:Np}),n("div",{style:{display:"inline-block",width:"80%",verticalAlign:"top"},children:[t(Ye,{when:this.isAnythingDirty(),navigate:r=>this.props.history.push(r),shouldBlockNavigation:()=>this.isAnythingDirty()}),n(dn,{children:[t(dt,{eventKey:"1",title:"Draft",children:t(ps,{editable:!0,togglePreview:this.togglePreview,parent:this,lesson:this.state.lesson.draft||{},cards:this.state.cardsDraft,handleSubmit:this.handleSubmit,updateDraftUpdateTs:this.updateDraftUpdateTs})},"1"),t(dt,{eventKey:"2",title:"Published",children:t(ps,{editable:!1,parent:this,published:this.state.lesson.title!=="",lesson:this.state.lesson,cards:this.state.cardsPublished})},"2")]}),t(N,{className:"lesson-preview",show:this.state.showPreview,size:"lg",onHide:this.togglePreview,children:t(N.Body,{onClick:r=>{r.stopPropagation()},children:t(Ap,{cards:this.state.cardsDraft,nextLessonId:(s=(e=this.state.lesson)==null?void 0:e.nextLesson)==null?void 0:s._id,previousLessonId:(i=(a=this.state.lesson)==null?void 0:a.previousLesson)==null?void 0:i._id})})})]})]})}}const Ep=l=>{const{loggedIn:e}=l;return{loggedIn:e}},$p={pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})};var Dp=$(Ep,$p)(D(Lp));class Pp extends g.exports.Component{render(){return t("div",{children:n(Z,{children:[t(P,{exact:!0,path:"/admin/core-libraries",component:kp}),t(P,{exact:!0,path:"/admin/core-libraries/create",component:hs},"admin-coreLibrary-create"),t(P,{exact:!0,path:"/admin/core-libraries/edit/:id",component:hs},"admin-coreLibrary-edit"),t(P,{exact:!0,path:"/admin/core-libraries/lessons/edit/:id",component:Dp})]})})}}class Op extends g.exports.Component{render(){return t("div",{children:n(Z,{children:[n(P,{exact:!0,path:"/admin/quizzes",children:[t(R,{to:"/admin/quizzes/new",className:"btn btn-primary",children:"New Quiz"}),t(he,{basePath:"/admin/quizzes",apiCall:{method:"GET",path:"/quizzes"},columns:[{text:"Title",field:"title",minWidth:"70%"},{text:"Status",field:e=>`${e.status.charAt(0).toUpperCase()+e.status.slice(1)}`}],rowButtons:[{text:"Edit quiz",url:"/admin/quizzes/:_id",icon:J},{text:"Delete quiz",icon:ae,clickCallback:async(e,s,a)=>{if(window.confirm("Are you sure you want to delete this quiz?")){const{success:i}=await C("DELETE","/quizzes/"+s._id);i?(alert(`Quiz ${s.title} was deleted`),await a()):alert(`Quiz ${s.title} couldn't be deleted`)}else alert(`Quiz ${s.title} not deleted`)}}]})]}),t(P,{exact:!0,path:"/admin/quizzes/new",children:t("div",{children:"New Quiz Form"})})]})})}}class Rp extends g.exports.Component{render(){return n("div",{children:[t(he,{basePath:"/admin/invoices",apiCall:{method:"GET",path:"/users/invoices"},columns:[{text:"",field:e=>[t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-view)}`,children:"View invoice"}),children:t(R,{className:"btn btn--small",to:"/admin/invoices/"+e._id,children:t(I,{icon:ut})})},`invoice-${e._id}-view)}`),t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-print)}`,children:"Print invoice"}),children:t(R,{className:"btn btn--small",to:"/admin/invoices/"+e._id+"/print",children:t(I,{icon:gn})})},`invoice-${e._id}-print)}`)],maxWidth:"6.17rem",className:"col--controls"},{text:"Status",field:e=>t(ft,{pill:!0,variant:this.props.statusMap[e.status].badge,children:this.props.statusMap[e.status].text}),maxWidth:"7rem",className:"col--center",headClassName:"col--center",sortKey:"status"},{text:"Id",field:"_id",minWidth:"20%",sortKey:"_id"},{text:"Amount",field:e=>e.totalPrice.toLocaleString("en-US",{style:"currency",currency:"USD"}),sortKey:"totalPrice"},{text:"Student",field:e=>n(R,{to:`/admin/users/${e.user._id}`,children:[e.user.firstName," ",e.user.lastName]}),sortKey:"firstName-lastName"},{text:"Date",field:e=>new Date(e.date).toLocaleString("en-US")}],rowButtons:[{text:"Mark invoice as Paid",icon:fn,clickCallback:async(e,s,a)=>{await this.props.changeInvoiceStatus(s._id,"paid",a)},condition:e=>["CANC","PAID"].indexOf(e.status)===-1},{text:"Cancel invoice",icon:bn,clickCallback:async(e,s,a)=>{await this.props.changeInvoiceStatus(s._id,"cancel",a)},condition:e=>["CANC","PAID"].indexOf(e.status)===-1}]}),t(X,{show:!1,hideModal:null,titleText:"mark as paid",bodyText:"Are you sure you want to delete user's account?",confirmAction:null})]})}}class Fp extends g.exports.Component{constructor(e){super(e);o(this,"state",{});e.pushBreadcrumbLink({text:e.match.params.id,path:"/admin/invoices/"+e.match.params.id})}async componentDidMount(){await this.loadInvoice()}async loadInvoice(){const{response:e,success:s,message:a}=await C("GET","/users/invoices/"+this.props.match.params.id);s?this.setState(m({},e)):this.props.setGlobalAlert({type:"error",message:a})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:this.props.match.params.id,path:"/admin/invoices/"+this.props.match.params.id})}render(){const{user:e}=this.state;let s=0,a=0;return this.state._id?n(A,{children:[t(x,{xs:"8",children:t("div",{className:"table-wrapper",children:n("div",{className:"table",children:[n("div",{className:"header",children:[t("div",{className:"col",children:"Id"}),t("div",{className:"col",children:"Title"}),t("div",{className:"col",children:"Price"}),t("div",{className:"col",children:"Tax"})]}),n("div",{className:"main",children:[this.state.packages&&this.state.packages.map(i=>{const r=i.taxType==="FIXED"?i.taxValue:i.taxValue/100*i.price;return a+=i.price,s+=r,n("div",{className:"row",children:[t("div",{className:"col",children:i.data._id}),t("div",{className:"col",children:i.data.title}),t("div",{className:"col",children:i.price.toLocaleString("en-US",{style:"currency",currency:"USD"})}),t("div",{className:"col",children:r.toLocaleString("en-US",{style:"currency",currency:"USD"})})]},i.data._id)}),n("div",{className:"row row--sep",children:[t("div",{className:"col"}),t("div",{className:"col",children:t("b",{children:"Subtotal"})}),t("div",{className:"col",children:a.toLocaleString("en-US",{style:"currency",currency:"USD"})}),t("div",{className:"col",children:s.toLocaleString("en-US",{style:"currency",currency:"USD"})})]}),n("div",{className:"row",children:[t("div",{className:"col"}),t("div",{className:"col",children:t("b",{children:"Total"})}),t("div",{className:"col",children:t("b",{children:(a+s).toLocaleString("en-US",{style:"currency",currency:"USD"})})}),t("div",{className:"col"})]})]})]})})}),n(x,{children:[t(A,{children:t("div",{className:"table-wrapper",children:t("div",{className:"table table--no-head",children:n("div",{className:"main",children:[n(A,{children:[t(x,{children:t("b",{children:"Total amount:"})}),t(x,{children:(a+s).toLocaleString("en-US",{style:"currency",currency:"USD"})})]}),n(A,{children:[t(x,{children:t("b",{children:"Status:"})}),t(x,{children:t(ft,{pill:!0,variant:this.props.statusMap[this.state.status].badge,children:this.props.statusMap[this.state.status].text})})]}),n(A,{children:[t(x,{children:t("b",{children:"Billing address:"})}),n(x,{children:[e.addressLineOne,", ",e.addressLineTwo&&e.addressLineTwo+", ",e.townCity,", ",e.state,", ",e.zipCode]})]})]})})})}),n(A,{className:"items-spacing-right",children:[this.state.status&&["CANC","PAID"].indexOf(this.state.status)===-1&&n("span",{className:"btn btn--secondary",onClick:async()=>{await this.props.changeInvoiceStatus(this.state._id,"paid",async()=>{await this.loadInvoice()})},children:[t(I,{icon:fn}),"\xA0Mark As Paid"]}),this.state.status&&["CANC","PAID"].indexOf(this.state.status)===-1&&n("span",{className:"btn bp",onClick:async()=>{await this.props.changeInvoiceStatus(this.state._id,"cancel",async()=>{await this.loadInvoice()})},children:[t(I,{icon:bn}),"\xA0Cancel"]}),n("span",{className:"btn btn--secondary btn--right",children:[t(I,{icon:gn}),"\xA0Print"]})]})]})]}):null}}var Up=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(Fp));class Mp extends g.exports.Component{constructor(e){super(e);o(this,"statusMap",{NEW:{text:"PENDING",badge:"dark"},PAID:{text:"PAID",badge:"success"},CANC:{text:"CANCELED",badge:"danger"},FAIL:{text:"FAILED",badge:"dark"}});o(this,"changeInvoiceStatus",async(e,s="paid",a)=>{const{success:i,message:r}=await C("POST",`/users/invoices/${e}/${s}`);i?(a&&await a(),this.props.setGlobalAlert({type:"success",message:r})):this.props.setGlobalAlert({type:"error",message:r})});e.pushBreadcrumbLink({text:"Invoices",path:"/admin/invoices"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Invoices",path:"/admin/invoices"})}render(){return t("div",{id:"invoices",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/invoices",children:t(Rp,{statusMap:this.statusMap,changeInvoiceStatus:this.changeInvoiceStatus})}),t(P,{exact:!0,path:"/admin/invoices/:id",children:t(Up,{statusMap:this.statusMap,changeInvoiceStatus:this.changeInvoiceStatus})})]})})}}var Bp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Mp);class Gp extends g.exports.Component{render(){return"General Settings"}}class Hp extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{value:""});o(this,"handleFormSubmit",async e=>{e.preventDefault();const{message:s,success:a}=await C("POST","/settings/save/"+this.props.settingKey,{value:this.state.value});a?this.props.setGlobalAlert({type:"success",message:this.props.title+" saved!"}):this.props.setGlobalAlert({type:"error",message:s})});o(this,"handleCKEditorChange",e=>{const{value:s}=e.target;this.setState({value:s})});o(this,"setCKEditor",e=>{this.setState({CKEditor:e})})}async componentDidMount(){const{response:e,success:s,message:a}=await C("GET","/settings/"+this.props.settingKey);s?this.setState({value:e}):this.props.setGlobalAlert({type:"error",message:a})}render(){return t("div",{className:"form",children:t("div",{className:"form__content",children:n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[t("div",{className:"form__field",children:t(H,{name:"message",defaultValue:this.state.value,onChange:this.handleCKEditorChange})}),t("div",{className:"form__buttons",children:t("button",{type:"submit",className:"btn bp",children:"Save"})})]})})})}}var us=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Hp);class qp extends g.exports.Component{constructor(e){super(e);e.pushBreadcrumbLink({text:"Settings",path:"/admin/settings"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Settings",path:"/admin/settings"})}render(){return n("div",{id:"admin-settings",children:[n(V,{variant:"tabs",as:"nav",defaultActiveKey:this.props.location.pathname.split("/")[3],children:[t(V.Item,{children:t(V.Link,{eventKey:"general",as:R,to:"/admin/settings/general",children:"General"})}),t(V.Item,{children:t(V.Link,{eventKey:"terms",as:R,to:"/admin/settings/terms",children:"Terms of Service"})}),t(V.Item,{children:t(V.Link,{eventKey:"privacy",as:R,to:"/admin/settings/privacy",children:"Privacy Policy"})})]}),t("div",{className:"padding",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/settings/general",component:Gp}),t(P,{exact:!0,path:"/admin/settings/terms",children:t(us,{title:"Terms Of Service",settingKey:"terms_of_service"})},"terms_of_service"),t(P,{exact:!0,path:"/admin/settings/privacy",children:t(us,{title:"Privacy Policy",settingKey:"privacy_policy"})},"privacy_policy"),t(Se,{exact:!0,from:"/admin/settings/",to:"/admin/settings/general"})]})})]})}}var zp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(qp));class Vp extends g.exports.Component{render(){return t(he,{apiCall:{method:"GET",path:"/users/sessions"},columns:[{text:"Device",field:e=>t(U,{placement:"top",overlay:t(M,{id:`tooltip-${e._id}-deviceType)}`,children:e.isMobile?"Mobile":"Desktop"}),children:t(I,{icon:e.isMobile?el:tl})}),maxWidth:"7%",className:"col--center",headClassName:"col--center"},{text:"User",field:"name",sortKey:"name",maxWidth:"17%"},{text:"Session start",field:e=>new Date(e.startedAt).toLocaleString("en-US"),sortKey:"startedAt",maxWidth:"17%"},{text:"Last interaction",field:e=>{const s=e.interactions[e.interactions.length-1],a=new Date(s==null?void 0:s.interactedAt).toLocaleString("en-US");return s?t(U,{placement:"right",overlay:n(Pe,{id:`popover-${e._id}-interaction)}`,children:[t(Pe.Title,{as:"h3",children:a}),t(Pe.Content,{children:s.interaction})]}),children:t("span",{children:a})}):"-"},maxWidth:"17%"},{text:"Current course",field:"currentCourse",maxWidth:"17%"},{text:"Current lesson",field:"currentLesson",maxWidth:"17%"},{text:"Status",field:e=>t(ft,{pill:!0,variant:{ACTIVE:"success",IDLE:"warning",OFFLINE:"dark"}[e.status],children:e.status}),sortKey:"status",maxWidth:"7rem",className:"col--center",headClassName:"col--center"}],rowButtons:[{text:"Invalidate session",icon:sl,clickCallback:async(e,s,a)=>{e.preventDefault();const{success:i,message:r}=await C("POST","/users/sessions/invalidate/"+s._id);i?(this.props.setGlobalAlert({type:"success",message:"User session was invalidated!"}),a()):this.props.setGlobalAlert({type:"error",message:r})},condition:e=>["CANC","PAID"].indexOf(e.status)===-1}]})}}var Qp=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Vp);class Wp extends g.exports.Component{constructor(e){super(e);e.pushBreadcrumbLink({text:"Sessions",path:"/admin/sessions"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Sessions",path:"/admin/sessions"})}render(){return t(Z,{children:t(P,{exact:!0,path:"/admin/sessions",component:Qp})})}}var Kp=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(Wp);class Yp extends g.exports.Component{constructor(e){super(e);o(this,"suspendAccount",async e=>{e.preventDefault();const{success:s,message:a}=await C("POST","/users/"+this.props.userId+"/suspend");s?this.props.setGlobalAlert({type:"success",message:a}):this.props.setGlobalAlert({type:"error",message:a}),this.setState(i=>({suspended:!i.suspended}))});o(this,"verifyAccount",async e=>{e.preventDefault();const{success:s,message:a}=await C("POST","/users/"+this.props.userId+"/verify");s?this.props.setGlobalAlert({type:"error",message:a}):this.props.setGlobalAlert({type:"success",message:a}),this.setState(i=>({verified:!i.verified}))});o(this,"handleCKEditorChange",e=>{const{value:s}=e.target;this.setState({value:s})});o(this,"setCKEditor",e=>{this.setState({CKEditor:e})});o(this,"handleFormSubmit",async e=>{e.preventDefault(),this.setState({passwordLoading:"loading"});const{success:s,message:a}=await C("POST","/users/password/id/"+this.props.userId,{message:this.state.value});s?this.setState({passwordLoading:"success"},()=>{setTimeout(()=>{this.toggleShowModal(),this.props.setGlobalAlert({type:"success",message:a})},500)}):this.setState({passwordLoading:"fail"},()=>{this.setState({passwordError:a},()=>{setTimeout(()=>{this.setState({passwordLoading:null})},500)})})});o(this,"handleInputChange",e=>{const s=e.target;this.setState({[s.name]:s.value})});o(this,"toggleShowModal",()=>{this.setState({showModal:!this.state.showModal})});this.state={suspended:e.suspended,verified:e.verified,showModal:!1,newPassword:"",passwordCheck:"",passwordLoading:null,passwordError:null,CKEditor:null,value:"<p>This email was triggered in our system by an admin at your request.</p>"}}render(){const{passwordError:e}=this.state;return n("div",{id:"user-actions",children:[n(_e,{children:[t(_e.Toggle,{as:"button",className:"btn bd",children:"User actions"}),n(_e.Menu,{alignRight:!0,children:[!this.state.verified&&t(_e.Item,{onClick:this.verifyAccount,children:"Verify account"}),t(_e.Item,{onClick:this.suspendAccount,children:this.state.suspended?"Activate account":"Suspend account"}),t(_e.Item,{onClick:this.toggleShowModal,children:"Send password reset email"})]})]}),n(N,{show:this.state.showModal,onHide:this.toggleShowModal,children:[t(N.Header,{closeButton:!0,children:t(N.Title,{children:"Send password reset email"})}),t(N.Body,{children:n("div",{className:"form"+(e?" form--with-error":""),children:[e&&t("div",{className:"form__error",children:e}),t("div",{className:"form__content",children:n("form",{action:"/",onSubmit:this.handleFormSubmit,children:[t("div",{className:"form__fields",children:n("div",{className:"form__field",children:[t("label",{htmlFor:"message",children:"Additional message"}),t(H,{name:"message",defaultValue:this.state.value,onChange:this.handleCKEditorChange})]})}),n("div",{className:"form__buttons",children:[n("button",{type:"submit",disabled:this.state.passwordLoading!==null,className:"btn bp",children:[this.state.passwordLoading==="loading"&&t(Oe,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),this.state.passwordLoading==="success"&&t(I,{icon:nn}),this.state.passwordLoading==="fail"&&t(I,{icon:rn}),this.state.passwordLoading!==null&&t("span",{children:"\xA0"}),"Save"]}),t("span",{className:"btn btn--link",onClick:this.toggleShowModal,children:"Cancel"})]})]})})]})})]})]})}}var jp=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(Yp);class Zp extends g.exports.Component{constructor(){super(...arguments);o(this,"downloadReport",e=>{const a=`${"https://reulmsdev.blob.core.windows.net/"+e.destinationContainer}/${e.originalName}-${e._id}.${e.fileExtension}`;window.open(a,"_blank")});o(this,"deleteReport",async(e,s)=>{const{success:a,response:i}=await C("delete",`/reporting/${e}`);a&&s()})}render(){return t(he,{noSearch:!0,apiCall:{method:"GET",path:"/reporting/history"},columns:[{text:"Course",field:e=>t("span",{children:e.course.title}),minWidth:"40%"},{text:"Title",field:e=>t("span",{children:e.title})},{text:"Format",field:e=>t("span",{children:e.format})},{text:"Created at",field:e=>t("span",{children:new Date(e.createdAt).toLocaleString()})}],rowButtons:[{type:"button",text:"Download Report",icon:al,clickCallback:(e,s,a)=>{this.downloadReport(s.file)}},{type:"button",text:"Delete Report",icon:ae,clickCallback:(e,s,a)=>{this.deleteReport(s._id,a)}}]})}}class Jp extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isLoading:!1});o(this,"newTemplate",async()=>{const{success:e,response:s}=await C("post","/reporting/templates");e&&this.props.history.replace(`/admin/reporting/templates/${s._id}`)});o(this,"deleteTemplate",async(e,s,a)=>{const{success:i,response:r}=await C("delete",`/reporting/templates/${s._id}`);i&&a()})}render(){return this.state.isLoading?t(Q,{}):t(he,{noSearch:!0,addNew:{label:"New Template",action:this.newTemplate},apiCall:{method:"GET",path:"/reporting/templates"},columns:[{text:"Title",field:e=>t("span",{children:e.title}),minWidth:"40%"},{text:"Created at",field:e=>t("span",{children:new Date(e.createdAt).toLocaleString()})}],rowButtons:[{type:"button",text:"Edit Template",icon:J,url:"/admin/reporting/templates/:_id"},{type:"button",text:"Delete Template",icon:ae,clickCallback:this.deleteTemplate}]})}}var Xp=D(Jp);class eu extends g.exports.Component{render(){return n("div",{children:[n(V,{variant:"tabs",activeKey:this.props.location.pathname,children:[t(V.Item,{children:t(V.Link,{as:R,eventKey:"/admin/reporting",to:"/admin/reporting",children:"Report History"})},"history"),t(V.Item,{children:t(V.Link,{as:R,eventKey:"/admin/reporting/templates",to:"/admin/reporting/templates",children:"Report Templates"})},"course")]}),t("div",{className:"tab-content pt-4",children:n(Z,{children:[t(P,{exact:!0,path:"/admin/reporting",component:Zp}),t(P,{exact:!0,path:"/admin/reporting/templates",component:Xp})]})})]})}}var tu=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(eu));class su extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{isLoading:!0,isEdited:!1,templateData:{_id:"",title:"",start:new Date(Date.now()),end:new Date(Date.now()),format:"excel",target:"passed",fields:[]},availableDataTargets:[]});o(this,"fetchTemplateData",async()=>{var a;this.state.isLoading||this.setState({isLoading:!0});const{success:e,response:s}=await C("get",`/reporting/templates/${this.props.match.params.templateId}`);e&&(s.target=(a=s.target)!=null?a:"passed",this.setState({templateData:s,isLoading:!1}))});o(this,"fetchavAilableDataTargets",async()=>{const{success:e,response:s}=await C("GET","/courses/reportsettings/targets");e&&this.setState({availableDataTargets:s})});o(this,"setButtons",()=>{this.props.createFormActions({customButtons:[{label:"Save",onClick:this.handleSubmit,className:"bp",disabled:!this.state.isEdited}]})});o(this,"setBreadcumbs",()=>{this.props.pushBreadcrumbLink({text:`Course: ${this.state.templateData.title}`,path:`/admin/reporting/templates/${this.props.match.params.templateId}`})});o(this,"handleSubmit",async()=>{this.state.isLoading||this.setState({isLoading:!0});const{success:e,message:s}=await C("patch",`/reporting/templates/${this.props.match.params.templateId}`,this.submitData);e?this.props.setGlobalAlert({type:"success",message:"Saved successfully"}):this.props.setGlobalAlert({type:"error",message:s}),this.setState({isLoading:!1,isEdited:!1})});o(this,"handleUpdate",e=>{this.setState({templateData:e,isEdited:!0})})}async componentDidMount(){await this.fetchTemplateData(),this.fetchavAilableDataTargets(),this.setBreadcumbs(),this.setButtons()}componentDidUpdate(e,s){s.isEdited!==this.state.isEdited&&this.setButtons()}componentWillUnmount(){this.props.createFormActions({customButtons:[]})}get submitData(){const e=Object.assign({},this.state.templateData);return e.fields=e.fields.map(s=>{const a=Object.assign({},s);return delete a.control,a}),e}render(){return this.state.isLoading?t(Q,{}):t("div",{className:"tab-content",children:t(kn,{update:this.handleUpdate,availableDataTargets:this.state.availableDataTargets,reportingData:this.state.templateData,type:"template"})})}}var au=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(su));class iu extends g.exports.Component{async componentDidMount(){this.props.pushBreadcrumbLink({text:"Reporting",path:"/admin/reporting"})}componentWillUnmount(){this.props.removeBreadcrumbLink({ext:"Reporting",path:"/admin/reporting"})}render(){return t("div",{children:n(Z,{children:[t(P,{exact:!0,path:"/admin/reporting/templates/:templateId",component:au}),t(P,{path:"/admin/reporting",component:tu})]})})}}var nu=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(iu));class ru extends g.exports.Component{render(){return t("div",{children:"CodesTab"})}}var Kt=z.createContext({status:"LOADING",details:{name:"",defaultDiscountType:"PERCENTAGE",defaultDiscountValue:"",defaultFixedCode:"",defaultCommisionType:"PERCENTAGE",defaultCommisionValue:"",isEdited:!1},packages:[],codes:[],setDetails:l=>{},setPackages:l=>{},setCodes:l=>{}});class lr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",e=>{let s=e.target.value;e.target.type==="number"&&(s=parseInt(s)),this.context.setDetails({[e.target.name]:s})})}get discountGroupId(){return this.props.match.params.discountGroupId}get isNew(){return this.discountGroupId==="new"}render(){const{name:e,defaultDiscountType:s,defaultDiscountValue:a,defaultFixedCode:i,defaultCommisionType:r,defaultCommisionValue:d}=this.context.details;return t("div",{className:"form form--two-cols",children:t("div",{className:"form__content pt-4 pb-1",children:t("form",{children:n(A,{children:[n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"name",children:"Group name"}),t("input",{type:"text",name:"name",value:e,onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"defaultDiscountType",children:"Default discount type"}),n("select",{name:"defaultDiscountType",value:s,onChange:this.handleInputChange,children:[t("option",{value:"PERCENTAGE",children:"Percentage"}),t("option",{value:"FIXED",children:"Fixed"})]})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"defaultDiscountValue",children:"Default discount value"}),t("input",{type:"number",name:"defaultDiscountValue",value:a,onChange:this.handleInputChange})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"defaultFixedCode",children:"Default fixed code"}),t("input",{type:"text",name:"defaultFixedCode",value:i,onChange:this.handleInputChange,disabled:this.isNew||this.context.codes.length===0}),(this.isNew||this.context.codes.length===0)&&t("small",{children:this.isNew?"You'll be able to set a default code after creating this group and creating a code":this.context.codes.length===0?"You must create a code before being able to use this field":""})]})]}),n(x,{children:[n("div",{className:"form__field",children:[t("label",{htmlFor:"asd",children:"Active affiliate groups"}),n("select",{name:"asd",children:[t("option",{value:"PERCENTAGE",children:"Percentage"}),t("option",{value:"FIXED",children:"Fixed"})]})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"defaultCommisionType",children:"Default commision type"}),n("select",{name:"defaultCommisionType",value:r,onChange:this.handleInputChange,children:[t("option",{value:"PERCENTAGE",children:"Percentage"}),t("option",{value:"FIXED",children:"Fixed"})]})]}),n("div",{className:"form__field",children:[t("label",{htmlFor:"defaultCommisionValue",children:"Default commision value"}),t("input",{type:"number",name:"defaultCommisionValue",value:d,onChange:this.handleInputChange})]})]})]})})})})}}o(lr,"contextType",Kt);var ou=D(lr);class dr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{packages:[],packageId:null,reloadTableCount:0});o(this,"loadPackages",async()=>{const{success:e,response:s}=await C("GET","/packages?perPage=all&publishedOnly=1");e&&this.setState({packages:s.docs})});o(this,"onPackageIdChange",e=>{this.setState({packageId:e.target.value})});o(this,"onAddPackageClick",async()=>{const{packageId:e}=this.state;if(e===null){this.props.setGlobalAlert({type:"error",message:"Select a package to add"});return}const{success:s,message:a}=await C("POST","/discounts/packages",{packageId:e,discountGroupId:this.discountGroupId,discountType:this.context.details.defaultDiscountType,discountValue:this.context.details.defaultDiscountValue,commisionType:this.context.details.defaultCommisionType,commisionValue:this.context.details.defaultCommisionValue,enabled:!0});s&&(this.props.setGlobalAlert({type:"success",message:a}),this.setState({reloadTableCount:this.state.reloadTableCount+1,packageId:null}))});o(this,"handleInputChange",e=>async s=>{let a=s.target.value;s.target.type==="number"&&(a=parseInt(a)),await C("PUT",`/discounts/packages/${e}`,{[s.target.name]:a})})}get discountGroupId(){return this.props.match.params.discountGroupId}async componentDidMount(){await this.loadPackages()}render(){const{packages:e,reloadTableCount:s}=this.state;return n("div",{className:"pt-4 pb-1",children:[n("div",{className:"d-flex mb-4",children:[n("select",{name:"packageId",onChange:this.onPackageIdChange,children:[t("option",{value:"",children:"Select package to add..."}),e.map(a=>t("option",{value:a._id,children:a.title},a._id))]}),t("div",{className:"bp ml-3 w-12",onClick:this.onAddPackageClick,children:"Add package"})]}),t(he,{apiCall:{method:"GET",path:`/discounts/groups/${this.discountGroupId}/packages`},columns:[{text:"name",field:"name"},{text:"Discount type",field:({discountType:a,_id:i})=>n("select",{name:"discountType",defaultValue:a,onChange:this.handleInputChange(i),children:[t("option",{value:"PERCENTAGE",children:"Percentage"}),t("option",{value:"FIXED",children:"Fixed"})]})},{text:"Discount value",field:({discountValue:a,_id:i})=>t("input",{type:"number",name:"discountValue",defaultValue:a,onChange:this.handleInputChange(i)})},{text:"Comission type",field:({commisionType:a,_id:i})=>n("select",{name:"commisionType",defaultValue:a,onChange:this.handleInputChange(i),children:[t("option",{value:"PERCENTAGE",children:"Percentage"}),t("option",{value:"FIXED",children:"Fixed"})]})},{text:"Commision value",field:({commisionValue:a,_id:i})=>t("input",{type:"number",name:"commisionValue",defaultValue:a,onChange:this.handleInputChange(i)})}],reload:s})]})}}o(dr,"contextType",Kt);var lu=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(dr));class du extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{status:"LOADING",details:{name:"",defaultDiscountType:"PERCENTAGE",defaultDiscountValue:"",defaultFixedCode:"",defaultCommisionType:"PERCENTAGE",defaultCommisionValue:"",isEdited:!1},packages:[],codes:[]});o(this,"loadDiscountGroupDetails",async()=>{const{success:e,response:s}=await C("GET",`/discounts/groups/${this.discountGroupId}`);return e?(this.props.pushBreadcrumbLink({text:s.name,path:`/admin/discounts/${s._id}`}),s):null});o(this,"loadDiscountGroupCodes",async()=>null);o(this,"loadDiscountGroup",async()=>{this.setState({status:"LOADING"});const e={status:"READY"},s=await this.loadDiscountGroupDetails();s&&(e.details=s),this.setState(e)});o(this,"handleSave",async()=>{const d=this.state.details,{isEdited:e}=d,s=oe(d,["isEdited"]),{success:a,response:i,message:r}=await C(this.isNew?"POST":"PUT",this.isNew?"/discounts/groups":`/discounts/groups/${this.discountGroupId}`,s);a&&(this.props.setGlobalAlert({type:"success",message:r}),this.isNew&&this.props.history.push(`/admin/discounts/${i._id}`))});o(this,"setDetails",e=>{this.setState({details:y(m(m({},this.state.details),e),{isEdited:!0})})});o(this,"setPackages",e=>{this.setState({packages:e})});o(this,"setCodes",e=>{this.setState({codes:e})})}async componentDidMount(){this.isNew?this.props.pushBreadcrumbLink({text:"New discount group",path:"/admin/discounts/new"}):await this.loadDiscountGroup()}async componentDidUpdate(e,s){e.match.params.discountGroupId!==this.discountGroupId&&!this.isNew&&(this.props.removeBreadcrumbLink({text:"",path:`/admin/discounts/${this.discountGroupId}`}),await this.loadDiscountGroup()),s.details.isEdited!==this.state.details.isEdited&&this.setButtons()}componentWillUnmount(){this.isNew?this.props.removeBreadcrumbLink({text:"New discount group",path:"/admin/discounts/new"}):this.props.removeBreadcrumbLink({text:"",path:`/admin/discounts/${this.discountGroupId}`}),this.props.createFormActions({customButtons:[]})}async setButtons(){this.props.createFormActions({customButtons:[{label:"Save",onClick:this.handleSave,className:"bp",disabled:!this.state.details.isEdited}]})}get discountGroupId(){return this.props.match.params.discountGroupId}get isNew(){return this.discountGroupId==="new"}render(){const e=[{tabTitle:"Details",TabComponent:ou}];return this.isNew||e.push({tabTitle:"Packages",TabComponent:lu},{tabTitle:"Codes",TabComponent:ru}),t(Kt.Provider,{value:y(m({},this.state),{setDetails:this.setDetails,setPackages:this.setPackages,setCodes:this.setPackages}),children:t(et,{tabs:e})})}}var cu=$(l=>({formActions:l.formActions,loggedIn:l.loggedIn}),{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(D(du));class hu extends g.exports.Component{render(){return n(w,{children:[n("div",{className:"page-header padding row",children:[t("div",{className:"col",children:t("h3",{children:"Discounts"})}),t("div",{className:"page-controls",children:t(R,{to:"/admin/discounts/new",className:"btn bp",children:"New discount group"})})]}),t(he,{apiCall:{method:"GET",path:"/discounts/groups"},columns:[{text:"Name",field:({name:e,_id:s})=>t(R,{to:`/admin/discounts/${s}`,children:e})},{text:"Created at",field:({createdAt:e})=>new Date(e).toLocaleDateString()}],rowButtons:[{text:"Edit discount group",icon:J,url:"/admin/discounts/:_id"}]})]})}}class pu extends g.exports.Component{componentDidMount(){this.props.pushBreadcrumbLink({text:"Discounts",path:"/admin/discounts"})}componentWillUnmount(){this.props.removeBreadcrumbLink({text:"Discounts",path:"/admin/discounts"})}render(){return t(w,{children:n(Z,{children:[t(P,{exact:!0,path:"/admin/discounts",component:hu}),t(P,{path:"/admin/discounts/:discountGroupId",component:cu})]})})}}var uu=$(null,{pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),removeBreadcrumbLink:l=>({type:"REMOVE_BREADCRUMB_LINK",payload:l})})(D(pu));class mu extends g.exports.Component{handleCancel(){this.props.createFormActions(y(m({},this.props.formActions.state),{reload:!0}))}handleSave(){this.props.createFormActions(y(m({},this.props.formActions.state),{save:!0}))}render(){const e=Object.keys(this.props.breadcrumb);return n(Cd,{children:[n("div",{className:"admin-header",children:[n("ul",{id:"breadcrumb",children:[n("li",{children:[t(R,{to:"/admin",children:"Dashboard"}),e&&e.length>0&&t(I,{icon:Ue})]}),e.map((s,a)=>n("li",{children:[t(R,{to:s,children:this.props.breadcrumb[s]}),a!==e.length-1&&t(I,{icon:Ue})]},s))]}),this.props.formActions.state&&n("div",{className:"admin-actions",children:[this.props.formActions.state.save?t("button",{className:"btn bp",onClick:()=>this.handleSave(),type:"submit",form:this.props.formActions.state.id,children:"Save"}):null,this.props.formActions.state.cancel?t("button",{className:"btn bd",type:"button",form:this.props.formActions.state.id,onClick:()=>this.handleCancel(),children:"Cancel"}):null,this.props.formActions.state.userActions?t("div",{children:t(jp,{verified:!!this.props.formActions.state.user.verified,suspended:!!this.props.formActions.state.user.suspended,userId:this.props.formActions.state.user._id})}):null,this.props.formActions.state.customButtons?this.props.formActions.state.customButtons.map((s,a)=>t(L,{disabled:s.disabled,as:s.link?R:void 0,to:s.link?s.link:"",className:`btn bd ${s.className}`,type:"button",onClick:s.onClick,children:s.icon?t(I,{icon:s.icon}):s.label},`customButton-${a}`)):t(w,{})]})]}),t("div",{id:"admin-content",children:n(Z,{children:[t(P,{path:"/admin/dashboard",component:vd}),t(P,{path:"/admin/sessions",component:Kp}),t(P,{path:"/admin/settings",component:zp}),t(P,{path:"/admin/messages",component:Td}),t(P,{path:"/admin/users",component:ic}),t(P,{path:"/admin/quizzes",component:Op}),t(P,{path:"/admin/courses",component:ip}),t(P,{path:"/admin/invoices",component:Bp}),t(P,{path:"/admin/packages",component:Ip}),t(P,{path:"/admin/core-libraries",component:Pp}),t(P,{path:"/admin/reporting",component:nu}),t(P,{path:"/admin/discounts",component:uu}),t(Se,{exact:!0,from:"/admin",to:"/admin/dashboard"})]})})]})}}var gu=$(l=>({loggedIn:l.loggedIn,breadcrumb:l.globalBreadcrumb,formActions:l.formActions}),{setLoggedIn:l=>({type:"SET_LOGGED_IN",payload:l}),pushBreadcrumbLink:l=>({type:"PUSH_BREADCRUMB_LINK",payload:l}),createFormActions:l=>({type:"SET_FORM_ACTIONS",payload:l})})(mu);class fu extends g.exports.Component{render(){const{doc:e}=this.props;return t(T,{children:n(B,{children:[n(B.Header,{children:[t(T.Toggle,{as:"div",className:"card-title",eventKey:e._id,children:e.subject}),t("div",{className:"card-controls float-right",children:!e.readAt&&t(U,{placement:"left",overlay:t(M,{id:`notification-${e._id}__tooltip__courses`,children:"Mark as read"}),children:t("span",{className:"btn btn--small btn--link",onClick:this.props.markAsRead,children:t(I,{icon:ut})})})})]}),t(T.Collapse,{eventKey:e._id,children:n(B.Body,{children:[e.emailSentAt&&n("p",{className:"color--light",children:["Email sent at ",e.emailSentAt]}),t("div",{dangerouslySetInnerHTML:{__html:e.message}})]})})]})})}}class bu extends g.exports.Component{constructor(e){super(e);o(this,"loadNotifications",async()=>{this.state.loading||this.setState({loading:!0});const{response:{docs:e,unreadCount:s},success:a,message:i}=await C("GET","/users/notifications/all");a?this.setState({unreadCount:s,notificationsList:e}):this.props.setGlobalAlert({type:"error",message:i}),this.setState({loading:!1})});o(this,"markAllRead",async()=>{const{response:e,success:s,message:a}=await C("POST","/users/notifications/read");s?(this.setState({unreadCount:0,notificationsList:this.state.notificationsList.map(i=>y(m({},i),{readAt:e}))}),this.props.setGlobalAlert({type:"success",message:"All notifications marked as read"})):this.props.setGlobalAlert({type:"error",message:a})});o(this,"markAsRead",async e=>{const{response:s,success:a,message:i}=await C("POST","/users/notifications/read/"+this.state.notificationsList[e]._id);if(a){const r=[...this.state.notificationsList];r[e].readAt=s,this.setState({unreadCount:this.state.unreadCount-1,notificationsList:r}),this.props.setGlobalAlert({type:"success",message:"Notification marked as read"})}else this.props.setGlobalAlert({type:"error",message:i})});this.state={unreadCount:0,notificationsList:[],loading:!1}}async componentDidMount(){await this.loadNotifications()}render(){const{notificationsList:e}=this.state;return this.state.loading?t("div",{className:"center-loading big",children:t(Oe,{animation:"border"})}):e.length!==0?n("div",{id:"user-messages",children:[n(A,{noGutters:!0,className:"padding",children:[t(x,{children:n("div",{children:[this.state.unreadCount," unread\xA0",this.state.unreadCount===1?"notification":"notifications"]})}),this.state.unreadCount>0&&t(x,{children:t("span",{className:"btn bd float-right",onClick:this.markAllRead,children:"Mark all as read"})})]}),e.map((s,a)=>t(fu,{doc:s,index:a,markAsRead:async()=>{await this.markAsRead(a)}},s._id))]}):t("div",{children:"No Messages"})}}var Cu=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(bu);class ms extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{content:""})}async componentDidMount(){const{response:e,success:s}=await C("GET","/settings/"+this.props.keyword);this.setState({content:s?e:"Failed to load"})}render(){return n(Cn,{children:[t("h1",{children:this.props.title}),t("br",{}),t("div",{id:this.props.keyword,dangerouslySetInnerHTML:{__html:this.state.content}})]})}}class yu extends g.exports.Component{render(){return n("div",{children:[t("h1",{children:"404"}),t("span",{children:"page not found"})]})}}class Yt extends g.exports.Component{render(){const{firstItem:e,secondItem:s,center:a}=this.props;return t("header",{className:"course-breadcrumb",style:{justifyContent:a?"center":void 0},children:n("div",{children:[t("span",{children:e}),t(il,{}),t("span",{children:s})]})})}}class vu extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{pageStatus:"LOADING",fields:null,redirect:null,title:null});o(this,"handleSubmit",async e=>{const{courseId:s}=this.props.match.params,{success:a}=await C("POST",`/users/courses/${s}/enrollment`,e);a?(localStorage.setItem("enrollmentCompleted",!0),this.props.history.push(`/courses/${s}`)):this.props.setGlobalAlert({type:"error",message:"There was a problem submitting your enrollment form"})})}async componentDidMount(){const{match:e,location:{search:s}}=this.props;s.includes("ref=NO_ENROLLMENT")&&this.props.setGlobalAlert({message:"Complete this enrollment form to be able to start the course"});const{success:a,response:i}=await C("GET",`/users/enrollment/${e.params.courseId}`);a&&("required"in i&&!i.required||i.fields&&i.fields.length===0?this.handleSubmit({}):this.setState({title:i.title,fields:i.fields,pageStatus:"READY"}))}render(){const{state:{fields:e,pageStatus:s,title:a}}=this;return s==="READY"?t(Ct,{fields:e,onSubmit:this.handleSubmit,header:()=>t(Yt,{center:!0,firstItem:a,secondItem:"Enrollment"})}):t(Q,{})}}var xu=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(vu));class cr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{chapter:null,lesson:null,feedback:{show:!1,expanded:!1},pageStatus:"LOADING",isBlockedByNodes:!1,cardsQuiz:{}});o(this,"setIsBlockedByNodes",e=>{this.setState({isBlockedByNodes:e})});o(this,"setFeedback",(e,s)=>{var a;this.setState({feedback:m(m({},(a=this.state)==null?void 0:a.feedback),e)},s)});o(this,"loadLessonData",async e=>{var r,d;const{success:s,response:a}=await C("GET",`/users/lessons/${e}`);let i=null;if(s){if(!("unlocked"in a)){const{history:c}=this.props,h=this.context.data;c.push(`/courses/${h._id}/chapters/${h.lastChapterId}/lessons/${h.lastLessonId}`)}i={lesson:y(m({},a),{countdownLimit:a.unlockNextLesson==="REQUIRED_TIME_MET"&&a.requiredTime&&!a.completed?new Date().getTime()+(a.requiredTime*60-a.currentTime)*1e3:0}),hotspotsCardsViewedNodes:(r=a==null?void 0:a.hotspotsCardsViewedNodes)!=null?r:{},pageStatus:"READY"},a.userChapterId!==((d=this.state.chapter)==null?void 0:d._id)&&(i.chapter=await this.loadChapterData(a.userChapterId))}i!==null&&this.setState(i,async()=>{const{unlockNextLesson:c,startedAt:h,completed:p}=this.state.lesson;p||((c==="ON_LESSON_START"&&h||c==="ALWAYS_UNLOCKED")&&await this.unlockNextLesson(),c==="REQUIRED_TIME_MET"&&window.socket.emit("complete user lesson",this.props.match.params.lessonId)),this.context.setLessonLayout(a.lessonLayout),window.innerWidth<=900&&this.context.isMenuOpen&&this.context.toggleIsMenuOpen()})});o(this,"unlockNextLesson",async({showPopupErrors:e}={showPopupErrors:!0})=>{var i,r,d;const{success:s,message:a}=await C("POST",`/users/lessons/${this.state.lesson._id}/next`);s?(this.context.unlockLesson((d=(r=(i=this.state)==null?void 0:i.lesson)==null?void 0:r.nextLesson)==null?void 0:d._id),this.context.completeLesson(this.state.lesson._id),this.setState({lesson:y(m({},this.state.lesson),{nextLesson:y(m({},this.state.lesson.nextLesson),{unlocked:!0})})})):e&&this.props.setGlobalAlert({type:"error",message:a})});o(this,"enableNextButton",(e=()=>{})=>{this.setState({lesson:y(m({},this.state.lesson),{nextLesson:y(m({},this.state.lesson.nextLesson),{unlocked:!0})})},e)});o(this,"loadChapterData",async e=>{const{success:s,response:a}=await C("GET",`/users/chapters/${e}`);if(s)return a});o(this,"setLessonCardQuestionAttempt",({cardIndex:e,questionAttempt:s},a)=>{const i=m({},this.state.lesson);i.cards[e].questionAttempt=s,this.setState({lesson:i},a)});o(this,"setViewedNodes",(e,s)=>{this.setState({hotspotsCardsViewedNodes:y(m({},this.state.hotspotsCardsViewedNodes),{[e]:s})})});o(this,"setCardsQuizState",(e,s)=>{this.setState({cardsQuiz:m(m({},this.state.cardsQuiz),e)},s)})}async componentDidMount(){"lessonId"in this.props.match.params&&await this.loadLessonData(this.props.match.params.lessonId)}async componentDidUpdate(e,s){(!("lessonId"in e.match.params)&&"lessonId"in this.props.match.params||e.match.params.lessonId!==this.props.match.params.lessonId)&&this.setState({pageStatus:"LOADING"},async()=>{await this.loadLessonData(this.props.match.params.lessonId)})}render(){const{state:{pageStatus:e}}=this;if(e==="READY"){const{chapter:s,lesson:a,feedback:i,isBlockedByNodes:r,hotspotsCardsViewedNodes:d,cardsQuiz:c}=this.state,h=a.lessonLayout==="PAGE"?Qt:Vt,p=y(m({},a),{feedback:i,cardsQuiz:c,isBlockedByNodes:r,hotspotsCardsViewedNodes:d,setViewedNodes:this.setViewedNodes,setIsBlockedByNodes:this.setIsBlockedByNodes,setFeedback:this.setFeedback,unlockNextLessonFn:this.unlockNextLesson,enableNextButton:this.enableNextButton,setLessonCardQuestionAttempt:this.setLessonCardQuestionAttempt,setCardsQuizState:this.setCardsQuizState});return t(pe.Provider,{value:p,children:t(h,{lesson:p,chapter:s})})}return t(Q,{})}}o(cr,"contextType",re);var Su=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(cr));class hr extends g.exports.Component{get redirectUrl(){const{data:e}=this.context;return e.passedAt?`/courses/${e._id}/postexam`:e.preExamUpdatedAt?`/courses/${e._id}/exam`:`/courses/${e._id}/preexam`}render(){const{data:e,canSitExam:s}=this.context;return t("div",{className:`final-exam-button${s?"":" disabled"}`,children:t(R,{to:this.redirectUrl,className:s?"bp":"bd",children:"Take final exam"})})}}o(hr,"contextType",re);class pr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{fields:[],pageStatus:"LOADING"});o(this,"loadPreExamFields",async()=>{const{courseId:e}=this.props.match.params,{success:s,response:a,message:i}=await C("GET",`/users/pre-exam/${e}/fields`),r=this.context.data.lessons;if(s){if(a.status==="IN_EXAM"){this.props.history.push(`/courses/${e}/exam`);return}if(r.total!==(r==null?void 0:r.completed)&&(this.props.setGlobalAlert({type:"error",message:"All course lessons must be completed before completing the pre-exam form"}),this.props.history.push(`/courses/${e}`)),a.status==="EXAM_PASSED"){this.props.setGlobalAlert({type:"success",message:"You have already completed this course"}),this.props.history.push(`/courses/${e}`);return}this.setState({fields:a.fields,pageStatus:"READY"})}else this.props.setGlobalAlert({type:"error",message:"Failed to load pre-exam fields: "+i})});o(this,"onSubmit",async e=>{const{courseId:s}=this.props.match.params,{success:a,message:i}=await C("POST",`/users/pre-exam/${s}`,e);a?(localStorage.setItem("isEnrollmentSubmittedNow",!0),this.props.history.replace(`/courses/${s}/exam`)):this.props.setGlobalAlert({type:"error",message:"Failed to submit pre-exam form: "+i})})}async componentDidMount(){await this.loadPreExamFields()}render(){const{pageStatus:e}=this.state;if(e==="LOADING")return t(Q,{});const{onSubmit:s,state:{fields:a},context:{data:{title:i}}}=this;return t(Ct,{onSubmit:s,fields:a,submitText:"Start exam",header:()=>t(Yt,{center:!0,firstItem:i,secondItem:"Pre-Exam Form"})})}}o(pr,"contextType",re);var Iu=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(pr));class ur extends g.exports.Component{render(){const{menuHidden:e,lessonLayout:s}=this.context;return n("div",{className:`course-layout${e?" cmenu--hidden":""} ${(s||"").toLowerCase()}-layout`,children:[t(Gt,{itemsEndpoint:`/users/courses/${this.props.match.params.courseId}/chapters`,itemsComponent:kh,showHeader:!0,menuHidden:e,children:t(hr,{})}),n(Z,{children:[t(P,{path:"/courses/:courseId/preexam",component:Iu}),t(P,{path:"/courses/:courseId/chapters/:chapterId/lessons/:lessonId/(cards)?/:cardIndex?",component:Su})]})]})}}o(ur,"contextType",re);var wu=D(ur);const _u=l=>({type:"SET_EXAM_REMINDER",payload:l});class mr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{current:{pausedAt:[],startedAt:[]},message:null,modalError:"",attemptToShow:null});o(this,"initSocketsEvents",()=>{window.socket.on("exam started",e=>{this.setState({current:y(m({},this.state.current),{startedAt:e})}),e.length>0&&this.props.setExamReminder(e,this.state.current.timeLimit),this.setLeaveWarning()}),window.socket.on("exam submited",e=>{var s,a,i,r;if(e.success){const d=(r=(i=(a=(s=e.data)==null?void 0:s.lastAttempts)==null?void 0:a[0])==null?void 0:i.status)!=null?r:e.data.status;this.props.setGlobalAlert({type:d==="FAIL"?"error":"success",message:d==="FAIL"?"You have failed your exam":"You have passed your exam"}),this.redirectToPostExam()}else this.setState({modalError:e.message})})});o(this,"redirectToPostExam",()=>{localStorage.setItem("examCompleted",!0),this.unsetLeaveWarning(),this.props.setExamReminder(!1),this.props.history.push(`/courses/${this.props.match.params.courseId}/postexam`)});o(this,"loadExamData",async()=>{var a,i,r;const{success:e,response:s}=await C("GET",`/users/exam/${this.props.match.params.courseId}`);e?((a=s==null?void 0:s.current)==null?void 0:a.completedAt)||(s==null?void 0:s.completedAt)?(this.setState({current:s}),s.status=="SUCCESS"&&this.props.history.push(`/courses/${((i=s==null?void 0:s.current)==null?void 0:i.userCourseId)||(s==null?void 0:s.userCourseId)}/postexam`)):(this.handleAttempt((r=s.current)==null?void 0:r._id),this.setState(m({},s))):this.props.setGlobalAlert({type:"error",message:"Could not find course exam"})});o(this,"setLeaveWarning",()=>{window.addEventListener("beforeunload",this.leaveWarningCallback)});o(this,"unsetLeaveWarning",()=>{window.removeEventListener("beforeunload",this.leaveWarningCallback)});o(this,"checkAnswer",async(e,s)=>{const{success:a,response:i}=await C("GET",`/users/exam/${this.state.current._id}/answer/${e}/${s}`);if(a){let r=this.state.current.answers;r[e]=s,this.setState({marks:this.state.marks+i.marks,current:y(m({},this.state.current),{answers:r,spentTime:i.spentTime})})}});o(this,"handleAttempt",async e=>{var s,a;((a=(s=this.state.current)==null?void 0:s.startedAt)==null?void 0:a.length)===0&&window.socket.emit("start exam",e)});o(this,"handleSubmit",async()=>{var e,s;window.socket.emit("submit exam",(e=this.state.current)==null?void 0:e._id,(s=this.state.current)==null?void 0:s.userCourseId)})}async componentDidMount(){if(!this.context.data.preExamUpdatedAt&&!localStorage.getItem("isEnrollmentSubmittedNow")){this.props.history.push(`/courses/${this.props.match.params.courseId}/preexam`);return}await this.loadExamData(),this.initSocketsEvents()}leaveWarningCallback(e){const s=e||window.event;s.returnValue="",s.preventDefault()}render(){var s,a;let{current:e}=this.state;return n("div",{className:"exam-info",children:[t("div",{children:t("h4",{children:t("b",{children:"Final Exam"})})}),e&&((s=e==null?void 0:e.startedAt)==null?void 0:s.length)>((a=e==null?void 0:e.pausedAt)==null?void 0:a.length)&&t(Je,{exam:!0,show:!0,title:e==null?void 0:e.title,questions:e==null?void 0:e.questions,answers:e==null?void 0:e.answers,error:this.state.modalError,timeLimit:new Date().getTime()+(e.timeLimit-e.spentTime)*6e4,allowSkip:e==null?void 0:e.allowSkip,onAnswer:this.checkAnswer,onSubmit:this.handleSubmit,onPause:this.handlePause})]})}}o(mr,"contextType",re);const ku=l=>{const{examReminder:e}=l;return{examReminder:e}},Tu={setExamReminder:_u,setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})};var Nu=$(ku,Tu)(D(mr));class gr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{courseTitle:"",fields:[],pageStatus:"LOADING"});o(this,"loadPreExamFields",async()=>{const{courseId:e}=this.props.match.params,{success:s,response:a,message:i}=await C("GET",`/users/post-exam/${e}/fields`);s?(a.status==="IN_EXAM"&&this.props.history.push(`/courses/${e}/exam`),this.setState({fields:a.fields,pageStatus:"READY"})):this.props.setGlobalAlert({type:"error",message:"Failed to load pre-exam fields: "+i})});o(this,"onSubmit",async e=>{const{courseId:s}=this.props.match.params,{success:a,message:i}=await C("POST",`/users/post-exam/${s}`,e);a?(this.props.setGlobalAlert({type:"success",message:"Course completed"}),localStorage.setItem("postExamCompleted",!0),this.props.history.push(`/courses/${s}`)):this.props.setGlobalAlert({type:"error",message:"Failed to submit post-exam form: "+i})})}async componentDidMount(){if(!this.context.data.preExamUpdatedAt&&!localStorage.getItem("isEnrollmentSubmittedNow")){this.props.history.push(`/courses/${this.props.match.params.courseId}/preexam`);return}await this.loadPreExamFields()}render(){const{pageStatus:e}=this.state;if(e==="LOADING")return t(Q,{});const{onSubmit:s,state:{fields:a},context:{data:{title:i}}}=this;return t(Ct,{onSubmit:s,fields:a,header:()=>t(Yt,{center:!0,firstItem:i,secondItem:"Post-Exam Form"})})}}o(gr,"contextType",re);var Au=$(null,{setGlobalAlert:l=>({type:"SET_GLOBAL_ALERT",payload:l})})(D(gr));class Lu extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{course:null,completedLessons:[],unlockedLessons:[],pageStatus:"LOADING",lessonLayout:null,isMenuOpen:!1,preExamFields:null,animateMenu:!1,canSitExam:!1});o(this,"updateCourseData",async()=>{const{success:e,response:s}=await C("GET",`/users/courses/${this.props.match.params.courseId}`);e&&this.setState({course:s,pageStatus:"READY"},()=>{this.handleRouting(),localStorage.removeItem("examCompleted"),localStorage.removeItem("postExamCompleted"),localStorage.removeItem("enrollmentCompleted"),localStorage.removeItem("isEnrollmentSubmittedNow")})});o(this,"canUserSitExam",async()=>{const{success:e,response:s}=await C("GET",`/users/exam/${this.props.match.params.courseId}/available`);e&&this.setState({canSitExam:s.available})});o(this,"setLessonLayout",e=>{this.setState({lessonLayout:e},()=>{setTimeout(()=>{this.setState({animateMenu:!0})},50)})});o(this,"toggleIsMenuOpen",()=>{this.setState({isMenuOpen:!this.state.isMenuOpen})});o(this,"handleRouting",()=>{const{state:{course:e},props:{match:s,history:a}}=this;if(e.status==="IN_EXAM"&&s.params.courseParam!=="exam"&&s.params.courseParam!=="postexam"&&!localStorage.getItem("examCompleted")){a.push(`/courses/${e._id}/exam`);return}if((e.status==="EXAM_PASSED"||e.status==="FAILED"||localStorage.getItem("examCompleted"))&&s.params.courseParam!=="postexam"&&!e.postExamUpdatedAt&&!localStorage.getItem("postExamCompleted")){a.push(`/courses/${e._id}/postexam`);return}if(!["exam","chapters","preexam","postexam","enrollment"].includes(s.params.courseParam)){if(!("enrollmentUpdatedAt"in e)&&s.params.courseParam!=="enrollment"&&!localStorage.getItem("enrollmentCompleted",!0)){a.push(`/courses/${e._id}/enrollment?ref=NO_ENROLLMENT`);return}if(!("preExamUpdatedAt"in e)&&e.status!=="NEW"){a.push(`/courses/${e._id}/preexam`);return}if((e.status==="NEW"&&!("lessonId"in s.params)||!("chapterId"in s.params))&&!s.params.courseParam){a.replace(`/courses/${e._id}/chapters/${e.lastChapterId}/lessons/${e.lastLessonId}`);return}}});o(this,"unlockLesson",e=>{this.state.unlockedLessons.includes(e)||this.setState({unlockedLessons:this.state.unlockedLessons.concat(e)})});o(this,"completeLesson",e=>{this.state.completedLessons.includes(e)||this.setState({completedLessons:this.state.completedLessons.concat(e),course:y(m({},this.state.course),{lessons:y(m({},this.state.course.lessons),{completed:this.state.course.lessons.completed+1})})},()=>{this.updateCourseData(),this.canUserSitExam()})})}componentDidMount(){this.updateCourseData(),this.canUserSitExam()}componentDidUpdate(e,s){this.state.course&&this.handleRouting()}render(){const{pageStatus:e,lessonLayout:s}=this.state;if(e==="LOADING")return t("div",{className:"course-layout",children:t(Q,{})});const{course:a,unlockedLessons:i,completedLessons:r,isMenuOpen:d,animateMenu:c,canSitExam:h}=this.state;return t(re.Provider,{value:{data:a,unlockLesson:this.unlockLesson,completeLesson:this.completeLesson,setLessonLayout:this.setLessonLayout,toggleIsMenuOpen:this.toggleIsMenuOpen,updateCourseData:this.updateCourseData,unlockedLessons:i,completedLessons:r,lessonLayout:s,isMenuOpen:d,animateMenu:c,canSitExam:h},children:n(Z,{children:[t(P,{exact:!0,path:"/courses/:courseId/enrollment",component:xu}),t(P,{exact:!0,path:"/courses/:courseId/exam",component:Nu}),t(P,{exact:!0,path:"/courses/:courseId/postexam",component:Au}),t(P,{path:"/courses/:courseId/:courseParam?/:chapterId?/(lessons)?/:lessonId?/(cards)?/:cardIndex?",component:wu})]})})}}var Ie=z.createContext({});class fr extends g.exports.Component{constructor(){super(...arguments);o(this,"deletePackageFromCart",e=>async()=>{const s=Array.from(this.context.packages),a=s.splice(e,1),i=localStorage.getItem("reuCheckoutCartId");i&&await C("DELETE",`/checkout/cart/${i}/item/${a.packageId}`),a.type==="UPSELL"&&this.context.includeUpsell(packageId),this.context.setPackages(s)})}render(){const{currentTab:e,packages:s}=this.context;if(![0,4].includes(e))return t(w,{});let a=0;return n("div",{className:"checkout-summary",children:[t("h2",{className:"heading",children:"Order Summary"}),n("div",{className:"products",children:[s.map((i,r)=>{var d,c,h;return a+=i.price,n("div",{className:"product",children:[t("img",{src:(d=i==null?void 0:i.image)==null?void 0:d[2],alt:i.title}),t("div",{className:"details",children:n("div",{className:"details-row",children:[t("h3",{className:"name",children:i.title}),n("span",{className:"price",children:[ze.USCurrency.format(i.price),!!i.oldPrice&&i.oldPrice!==i.price&&t("span",{className:"old",children:ze.USCurrency.format(i.oldPrice)})]})]})}),s.length!==1&&t("div",{className:"order-package-controls",children:t("di",{className:"delete",onClick:this.deletePackageFromCart(r),children:t(nl,{})})})]},(h=(c=i.packageId)!=null?c:i._id+(i==null?void 0:i.type))!=null?h:"PACKAGE")}),n("div",{className:"total",children:[n("h2",{className:"label",children:["Estimated Total\xA0",n("span",{className:"coupon-wrapper",children:["(",t("a",{className:"coupon-link",href:"/",children:"Have a coupon?"}),")"]})]}),t("h2",{className:"value",children:global.USCurrency.format(a)})]})]})]})}}o(fr,"contextType",Ie);class Eu extends g.exports.Component{constructor(){super(...arguments);o(this,"tabs",["Your Order","Contact Info","Address","Billing Info","Payment"]);o(this,"state",{status:"LOADING",currentTab:0,basket:[],packages:[],contactInfo:{},residentialAddress:{streetLines:[""]},billingAddress:{streetLines:[""]},excludedUpsells:[]});o(this,"loadInitialData",async()=>{localStorage.getItem("reuCheckoutCartId")?await this.loadCartData():await this.loadPackageData()});o(this,"loadCartData",async()=>{var a,i,r;const e=localStorage.getItem("reuCheckoutCartId"),{response:s}=await C("GET",`/checkout/cart/${e}`);this.setState({currentTab:(a=parseInt(localStorage.getItem("reuCheckoutCurrentTab")))!=null?a:0,status:"READY",contactInfo:{firstName:s.firstName,lastName:s.lastName,email:s.email},residentialAddress:(i=s.residentialAddress)!=null?i:{streetLines:[""]},billingAddress:(r=s.billingAddress)!=null?r:{streetLines:[""]},packages:s.packages,upsells:s.upsells})});o(this,"loadPackageData",async()=>{const{packageId:e}=this.props.match.params,{response:s}=await C("GET",`/packages/${e}?location=cart`),r=s,{upsells:a}=r,i=oe(r,["upsells"]);this.setState({status:"READY",packages:[i],upsells:a})});o(this,"setCurrentTab",e=>{this.setState({currentTab:e})});o(this,"setContactInfo",e=>{this.setState({contactInfo:m(m({},this.state.contactInfo),e)})});o(this,"setResidentialAddress",e=>{this.setState({residentialAddress:m(m({},this.state.residentialAddress),e)})});o(this,"setBillingAddress",e=>{this.setState({billingAddress:m(m({},this.state.billingAddress),e)})});o(this,"setPackages",e=>{this.setState({packages:e})});o(this,"setUpsells",e=>{this.setState({upsells:e})});o(this,"excludeUpsell",e=>{const s=Array.from(this.state.excludedUpsells);s.push(e),this.setState({excludedUpsells:s})});o(this,"includeUpsell",e=>{const s=Array.from(this.state.excludedUpsells);s.splice(s.indexOf(e),1),this.setState({excludedUpsells:s})})}async componentDidMount(){await this.loadInitialData()}get isUserLoggedIn(){var e,s,a;return!!((a=(s=(e=this.props)==null?void 0:e.loggedIn)==null?void 0:s.user)!=null&&a._id)}get isDirectPurchase(){return!this.isUserLoggedIn}render(){const{currentTab:e,packages:s,status:a,contactInfo:i,residentialAddress:r,billingAddress:d,upsells:c,excludedUpsells:h}=this.state;return t(Ie.Provider,{value:{currentTab:e,packages:s,contactInfo:i,residentialAddress:r,billingAddress:d,upsells:c,excludedUpsells:h,setContactInfo:this.setContactInfo,setResidentialAddress:this.setResidentialAddress,setBillingAddress:this.setBillingAddress,setPackages:this.setPackages,setUpsells:this.setUpsells,tabs:this.tabs,setCurrentTab:this.setCurrentTab,excludeUpsell:this.excludeUpsell},children:t("div",{className:"checkout-container",children:n(Te,{condition:!this.isDirectPurchase,wrapper:p=>t(br,{children:p}),children:[this.isDirectPurchase&&t("div",{className:"product-title",children:t("h4",{children:"placeholder product title"})}),t("div",{className:"checkout-main",children:a==="READY"?n(w,{children:[t(fr,{}),t(Cr,{}),t(wr,{}),t(Ou,{})]}):t(Q,{})})]})})})}}var $u=$(l=>({loggedIn:l.loggedIn}))(D(Eu));class br extends g.exports.Component{render(){return n("div",{className:"upsell-wrapper",children:[n("div",{className:"upsell-header",children:[t("h1",{className:"heading",children:"The fastest and most affordable way to become a licensed real estate agent in Texas!"}),t("p",{className:"subheading",children:"This bundle includes everything you need to fulfill the State\u2019s 180 hour education requirement."})]}),this.props.children]})}}o(br,"contextType",Ie);class Cr extends g.exports.Component{constructor(){super(...arguments);o(this,"setCurrentTab",e=>{e!==this.context.currentTab&&(localStorage.setItem("reuCheckoutCurrentTab",e),this.context.setCurrentTab(e))})}render(){const{currentTab:e}=this.context;return t("div",{className:"checkout-progress",children:this.context.tabs.map((s,a)=>{const i=e>a;return n("div",{className:`checkout-progress__tab${e===a?" checkout-progress__activeTab":""}${i?" checkout-progress__completeTab":""}`,children:[t("div",{onClick:()=>{this.setCurrentTab(a)},children:i?t(rl,{style:{fontSize:"34px"}}):`${(a+1).toString().padStart(2,"0")}`}),t("span",{onClick:()=>{this.setCurrentTab(a)},children:s})]},a)})})}}o(Cr,"contextType",Ie);class yr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",e=>{this.context.setResidentialAddress({[e.target.name]:e.target.value})});o(this,"handleStreetLineInputChange",e=>{const s=parseInt(e.target.name),a=[...this.context.residentialAddress.streetLines];a[s]=e.target.value,this.context.setResidentialAddress({streetLines:a})})}render(){const{streetLines:e,town:s,state:a,zipCode:i,phoneNumber:r}=this.context.residentialAddress;return n("div",{className:"checkout-address",children:[t("h1",{children:"Residential address"}),t("h3",{children:"Where will you be taking this course from?"}),n("div",{className:"checkout-form",children:[n("div",{children:[t("label",{htmlFor:"aTown",children:"City *"}),t("input",{type:"text",name:"town",value:s,id:"aTown",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aState",children:"State *"}),t("select",{name:"state",id:"aState",value:a,onChange:this.handleInputChange,children:Jn.map(({key:d,value:c})=>t("option",{value:d,children:c},d))})]}),n("div",{children:[t("label",{htmlFor:"aPhoneNumber",children:"Phone number *"}),t("input",{type:"text",name:"phoneNumber",value:r,id:"aPhoneNumber",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aZipCode",children:"Zip code *"}),t("input",{type:"text",name:"zipCode",value:i,id:"aZipCode",onChange:this.handleInputChange})]}),n("div",{className:"full-width",children:[t("label",{htmlFor:"aAddressLine0",children:"Address line *"}),t("input",{type:"text",id:"aAddressLine0",value:e[0],name:"0",onChange:this.handleStreetLineInputChange})]})]})]})}}o(yr,"contextType",Ie);class vr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",e=>{this.context.setContactInfo({[e.target.name]:e.target.value})})}render(){const{firstName:e,lastName:s,email:a}=this.context.contactInfo;return n("div",{className:"checkout-contact",children:[t("h1",{children:"Contact info"}),t("h3",{children:"Who is this for?"}),n("div",{className:"checkout-form",children:[n("div",{children:[t("label",{htmlFor:"cFirstName",children:"First name *"}),t("input",{type:"text",value:e,onChange:this.handleInputChange,name:"firstName",id:"cFirstName"})]}),n("div",{children:[t("label",{htmlFor:"cLastName",children:"Last name *"}),t("input",{type:"text",value:s,onChange:this.handleInputChange,name:"lastName",id:"cLastName"})]}),n("div",{children:[t("label",{htmlFor:"cEmail",children:"Email *"}),t("input",{type:"email",value:a,onChange:this.handleInputChange,name:"email",id:"cEmail"})]})]})]})}}o(vr,"contextType",Ie);class xr extends g.exports.Component{constructor(){super(...arguments);o(this,"handleInputChange",e=>{this.context.setBillingAddress({[e.target.name]:e.target.value})});o(this,"handleStreetLineInputChange",e=>{const s=parseInt(e.target.name),a=[...this.context.billingAddress.streetLines];a[s]=e.target.value,this.context.setBillingAddress({streetLines:a})})}render(){const{streetLines:e,town:s,country:a,state:i,zipCode:r,phoneNumber:d}=this.context.billingAddress;return n("div",{className:"checkout-billing",children:[t("h1",{children:"Billing address"}),t("h3",{children:"Who should we send the bill?"}),n("div",{className:"checkout-form",children:[n("div",{children:[t("label",{htmlFor:"aCountry",children:"Country *"}),t("input",{type:"text",name:"country",value:a,id:"aCountry",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aTown",children:"City *"}),t("input",{type:"text",name:"town",value:s,id:"aTown",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aState",children:"State *"}),t("input",{type:"text",name:"state",value:i,id:"aState",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aPhoneNumber",children:"Phone number *"}),t("input",{type:"text",name:"phoneNumber",value:d,id:"aPhoneNumber",onChange:this.handleInputChange})]}),n("div",{children:[t("label",{htmlFor:"aZipCode",children:"Zip code *"}),t("input",{type:"text",name:"zipCode",value:r,id:"aZipCode",onChange:this.handleInputChange})]}),n("div",{className:"full-width",children:[t("label",{htmlFor:"aAddressLine0",children:"Address line *"}),t("input",{type:"text",id:"aAddressLine0",value:e[0],name:"0",onChange:this.handleStreetLineInputChange})]})]})]})}}o(xr,"contextType",Ie);class Du extends g.exports.Component{render(){return n("div",{className:"checkout-payment",children:[t("h1",{children:"Choose your payment method"}),n("label",{htmlFor:"studentAgreement",children:[t("input",{type:"checkbox",name:"studentAgreement",id:"studentAgreement"}),"I have read and agree to the student enrollment agreement"]}),n("label",{htmlFor:"termsAgreement",children:[t("input",{type:"checkbox",name:"termsAgreement",id:"termsAgreement"}),"I have read and agree to the terms and conditions"]}),n("div",{className:"checkout-payment__options",children:[n("div",{className:"checkout-payment__card",children:[n("button",{className:"dark sm",children:[t(ol,{}),"\xA0 Pay directly by card"]}),n("div",{className:"cards-logos",children:[t("img",{src:{}.PUBLIC_URL+"/visa.png",alt:"Visa logo"}),t("img",{src:{}.PUBLIC_URL+"/mastercard.png",alt:"Mastercard logo"}),t("img",{src:{}.PUBLIC_URL+"/americanexpress.png",alt:"American express logo"}),t("img",{src:{}.PUBLIC_URL+"/unionpay.svg",alt:"UnionPay logo"})]}),t("span",{children:"Pay directly with RealEstateU through our secured payment platform"}),n("div",{className:"checkout-payment__badges",children:[n("div",{className:"checkout-payment__stripe",children:["Powered by ",t("img",{src:{}.PUBLIC_URL+"/stripe.svg",alt:""})]}),n("div",{className:"checkout-payment__ssl",children:[t(ll,{}),n("div",{children:["Fully secured ",t("span",{children:"SSL checkout"})]})]})]})]}),t("div",{className:"checkout-payment__or",children:"or"}),n("div",{className:"checkout-payment__paypal",children:[n("button",{className:"light sm",children:["Pay with",t("img",{src:{}.PUBLIC_URL+"/paypal.svg",alt:"PayPal logo"})]}),t("span",{children:"If you prefer, you can also use PayPal as a payment platform at no extra cost. You will be taken to Paypal\u2019s website and taken back here upon completion."})]})]})]})}}class Sr extends g.exports.Component{constructor(){super(...arguments);o(this,"state",{status:"LOADING"});o(this,"addUpsellToCart",async()=>{const{upsoldPackageId:e,packageId:s,discountValue:a,discountType:i}=this.props,{price:r,title:d,image:c}=this.props.upsoldPackage,h=r-(i==="FIXED"?a:r*a/100),p=localStorage.getItem("reuCheckoutCartId"),u={price:h,packageId:e,title:d,image:c,upsoldToPackageId:s,discountValue:a,discountType:i,oldPrice:r,type:"UPSELL"};let b,v;if(p)({success:b,response:v}=await C("POST",`/checkout/cart/${p}`,u));else{const{packageId:S}=this.props.match.params,{excludedUpsells:_}=this.context;this.context.excludeUpsell(e),{success:b,response:v}=await C("GET",`/checkout/packages/${S}/upsells?excluded=${[..._,e].join(",")}`)}if(b){const S=Array.from(this.context.packages);S.push(u),this.context.setPackages(S),this.context.setUpsells(v.newUpsells)}})}render(){const{title:e,image:s,description:a,price:i}=this.props.upsoldPackage,{discountType:r,discountValue:d}=this.props,c=i-(r==="FIXED"?d:i*d/100);return n("div",{className:"checkout-upsells__item",children:[t("img",{src:s[2],alt:e}),n("main",{className:"checkout-upsells__itemData",children:[t("h1",{children:e}),t("span",{children:a})]}),n("div",{children:[t("button",{className:"sm light-blue",onClick:this.addUpsellToCart,children:"Add to cart"}),n("div",{children:[c!==i&&t(dl,{}),t("span",{className:"checkout-upsells__price",children:ze.USCurrency.format(c)}),c!==i&&n(w,{children:[t("span",{className:"checkout-upsells__oldPrice",children:ze.USCurrency.format(i)}),t("span",{className:"checkout-upsells__discount",children:r==="FIXED"?ze.USCurrency.format(d)+" off":`${d}% off`})]})]})]})]})}}o(Sr,"contextType",Ie);var Pu=D(Sr);class Ir extends g.exports.Component{render(){const{upsells:e}=this.context;return e.length===0?null:n(w,{children:[t("h1",{className:"checkout-upsells__header",children:"Frequently bought together"}),n("h6",{children:["For a ",t("span",{children:"limited time"})," only we offer supportive material to the Texas Real Estate",t("br",{})," Licence Certification Course at a discounted price"]}),t("div",{className:"checkout-upsells",children:this.context.upsells.map(s=>t(Pu,m({},s),s._id))})]})}}o(Ir,"contextType",Ie);class wr extends g.exports.Component{render(){switch(this.context.currentTab){case 0:return t(Ir,{});case 1:return t(vr,{});case 2:return t(yr,{});case 3:return t(xr,{});case 4:return t(Du,{});default:return t(w,{})}}}o(wr,"contextType",Ie);class _r extends g.exports.Component{constructor(){super(...arguments);o(this,"handleClick",()=>{const{currentTab:e}=this.context;switch(e){case 0:this.goToNextStep();return;case 1:this.handleContactInfoNext();return;case 2:this.handleResidentialAddressNext();return;case 3:this.handleBillingAddressNext();return;default:return}});o(this,"goToNextStep",()=>{const{currentTab:e}=this.context;localStorage.setItem("reuCheckoutCurrentTab",e+1),this.context.setCurrentTab(e+1)});o(this,"handleContactInfoNext",async()=>{const e=localStorage.getItem("reuCheckoutCartId"),{packages:s}=this.context;if(params=new URLSearchParams(this.props.location.search),data=y(m({},this.context.contactInfo),{pacakges:[{type:params.get("type").toUpperCase(),pacakgeId:s[0]._id,price:s[0].price}]}),e)await C("PATCH",`/checkout/cart/${e}`,data);else{const{response:a}=await C("POST","/checkout/cart",data);localStorage.setItem("reuCheckoutCartId",a._id)}this.goToNextStep()});o(this,"handleResidentialAddressNext",async()=>{const e=localStorage.getItem("reuCheckoutCartId"),{residentialAddress:s}=this.context;await C("PATCH",`/checkout/cart/${e}`,{residentialAddress:s}),this.goToNextStep()});o(this,"handleBillingAddressNext",async()=>{const e=localStorage.getItem("reuCheckoutCartId"),{billingAddress:s}=this.context;await C("PATCH",`/checkout/cart/${e}`,{billingAddress:s}),this.goToNextStep()})}render(){return n("button",{onClick:this.handleClick,children:["Next ",t(cl,{})]})}}o(_r,"contextType",Ie);var Ou=D(_r);function Ru(){return t(hl,{children:t("div",{id:"app",children:t(zl,{children:n(Z,{children:[t(P,{exact:!0,path:"/",component:md}),t(P,{path:"/courses/:courseId/:courseParam?",component:Lu}),t(P,{exact:!0,path:"/login",component:Wl}),t(P,{exact:!0,path:"/profile",component:td}),t(P,{exact:!0,path:"/reset-password",component:Yl}),t(P,{exact:!0,path:"/change-password",component:Zl}),t(P,{exact:!0,path:"/verify-account",component:ad}),t(P,{path:"/admin",component:gu}),t(P,{exact:!0,path:"/notifications",component:Cu}),t(P,{exact:!0,path:"/checkout/:packageId",component:$u}),t(P,{path:"/terms_of_service",children:t(ms,{keyword:"terms_of_service",title:"Terms Of Service"})}),t(P,{path:"/privacy_policy",children:t(ms,{keyword:"privacy_policy",title:"Privacy Policy"})}),t(P,{path:"*",component:yu})]})})})})}pl.initialize();ul.render(t(ml,{store:ct,children:t(Ru,{})}),document.getElementById("root"));
